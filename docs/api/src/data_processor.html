<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>src.data_processor API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../src.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;src</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="class" href="#DataProcessor">DataProcessor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DataProcessor.__init__">DataProcessor</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataProcessor.dshield_attack_patterns">dshield_attack_patterns</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataProcessor.dshield_severity_mapping">dshield_severity_mapping</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataProcessor.dshield_category_mapping">dshield_category_mapping</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.process_security_events">process_security_events</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.process_dshield_attacks">process_dshield_attacks</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.process_dshield_reputation">process_dshield_reputation</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.process_dshield_top_attackers">process_dshield_top_attackers</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.generate_dshield_summary">generate_dshield_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.generate_security_summary">generate_security_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.generate_attack_report">generate_attack_report</a>
                        </li>
                        <li>
                                <a class="function" href="#DataProcessor.extract_unique_ips">extract_unique_ips</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../src.html">src</a><wbr>.data_processor    </h1>

                        <div class="docstring"><p>Data processor for formatting and structuring DShield SIEM data for AI consumption.</p>

<p>This module provides utilities for processing, normalizing, and structuring
DShield SIEM data for downstream AI analysis and reporting. It includes
functions for event normalization, attack pattern detection, enrichment,
summarization, and report generation.</p>

<p>Features:</p>

<ul>
<li>Security event normalization and enrichment</li>
<li>Attack pattern detection</li>
<li>DShield-specific data mapping</li>
<li>Summary and report generation</li>
<li>Utility methods for extracting and analyzing event data</li>
</ul>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>from <a href="">src.data_processor</a> import DataProcessor
      processor = DataProcessor()
      processed = processor.process_security_events(events)
      print(processed)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>

                        <input id="mod-data_processor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-data_processor-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;Data processor for formatting and structuring DShield SIEM data for AI consumption.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">This module provides utilities for processing, normalizing, and structuring</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">DShield SIEM data for downstream AI analysis and reporting. It includes</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">functions for event normalization, attack pattern detection, enrichment,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">summarization, and report generation.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">Features:</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">- Security event normalization and enrichment</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">- Attack pattern detection</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">- DShield-specific data mapping</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">- Summary and report generation</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">- Utility methods for extracting and analyzing event data</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">Example:</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">    &gt;&gt;&gt; from src.data_processor import DataProcessor</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    &gt;&gt;&gt; processor = DataProcessor()</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    &gt;&gt;&gt; processed = processor.process_security_events(events)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">    &gt;&gt;&gt; print(processed)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">datetime</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">structlog</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="n">DShieldAttack</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>    <span class="n">DShieldReputation</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">DShieldStatistics</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="n">DShieldTopAttacker</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="n">EventCategory</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>    <span class="n">EventSeverity</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_is_debug_mode</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if we&#39;re running in debug mode or test mode.&quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="c1"># Check for debug log level</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;LOG_LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">]:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="c1"># Check if we&#39;re running tests (common test indicators)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="n">test_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="s2">&quot;pytest&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYTEST_CURRENT_TEST&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>        <span class="s2">&quot;test&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PYTHONPATH&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>        <span class="s2">&quot;PYTEST&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="s2">&quot;TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="s2">&quot;UNITTEST&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="p">]</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">test_indicators</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DataProcessor</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process and structure DShield SIEM data for AI analysis.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    This class provides methods to normalize, enrich, and summarize DShield SIEM</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">    data for use in AI-driven analytics and reporting. It includes attack pattern</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">    detection, severity/category mapping, and report generation utilities.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">    Attributes:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        dshield_attack_patterns: Mapping of attack pattern names to keywords</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        dshield_severity_mapping: Mapping of severity labels to EventSeverity</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        dshield_category_mapping: Mapping of category labels to EventCategory</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    Example:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        &gt;&gt;&gt; processor = DataProcessor()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        &gt;&gt;&gt; summary = processor.generate_security_summary(events)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DataProcessor.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        Sets up DShield-specific mappings for attack patterns, severity, and category.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="c1"># DShield-specific attack patterns and signatures</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_attack_patterns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="s2">&quot;brute_force&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>                <span class="s2">&quot;failed login&quot;</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>                <span class="s2">&quot;authentication failure&quot;</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>                <span class="s2">&quot;invalid credentials&quot;</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>                <span class="s2">&quot;ssh brute force&quot;</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="p">],</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="s2">&quot;port_scan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;port scan&quot;</span><span class="p">,</span> <span class="s2">&quot;nmap&quot;</span><span class="p">,</span> <span class="s2">&quot;masscan&quot;</span><span class="p">,</span> <span class="s2">&quot;port scanning&quot;</span><span class="p">,</span> <span class="s2">&quot;syn scan&quot;</span><span class="p">],</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="s2">&quot;sql_injection&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sql injection&quot;</span><span class="p">,</span> <span class="s2">&quot;sql error&quot;</span><span class="p">,</span> <span class="s2">&quot;database error&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql error&quot;</span><span class="p">],</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="s2">&quot;xss&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cross-site scripting&quot;</span><span class="p">,</span> <span class="s2">&quot;xss&quot;</span><span class="p">,</span> <span class="s2">&quot;script injection&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript injection&quot;</span><span class="p">],</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>            <span class="s2">&quot;ddos&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;denial of service&quot;</span><span class="p">,</span> <span class="s2">&quot;ddos&quot;</span><span class="p">,</span> <span class="s2">&quot;flood attack&quot;</span><span class="p">,</span> <span class="s2">&quot;syn flood&quot;</span><span class="p">,</span> <span class="s2">&quot;udp flood&quot;</span><span class="p">],</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;malware&quot;</span><span class="p">,</span> <span class="s2">&quot;virus&quot;</span><span class="p">,</span> <span class="s2">&quot;trojan&quot;</span><span class="p">,</span> <span class="s2">&quot;ransomware&quot;</span><span class="p">,</span> <span class="s2">&quot;botnet&quot;</span><span class="p">],</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="s2">&quot;phishing&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                <span class="s2">&quot;phishing&quot;</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                <span class="s2">&quot;suspicious email&quot;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                <span class="s2">&quot;credential harvesting&quot;</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>                <span class="s2">&quot;social engineering&quot;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="p">],</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>                <span class="s2">&quot;reconnaissance&quot;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>                <span class="s2">&quot;information gathering&quot;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>                <span class="s2">&quot;enumeration&quot;</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>                <span class="s2">&quot;network scan&quot;</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>            <span class="p">],</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>            <span class="s2">&quot;exploit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;exploit&quot;</span><span class="p">,</span> <span class="s2">&quot;vulnerability&quot;</span><span class="p">,</span> <span class="s2">&quot;cve&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer overflow&quot;</span><span class="p">,</span> <span class="s2">&quot;code injection&quot;</span><span class="p">],</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="s2">&quot;backdoor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;backdoor&quot;</span><span class="p">,</span> <span class="s2">&quot;reverse shell&quot;</span><span class="p">,</span> <span class="s2">&quot;command injection&quot;</span><span class="p">,</span> <span class="s2">&quot;remote access&quot;</span><span class="p">],</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data theft&quot;</span><span class="p">,</span> <span class="s2">&quot;exfiltration&quot;</span><span class="p">,</span> <span class="s2">&quot;sensitive data&quot;</span><span class="p">,</span> <span class="s2">&quot;confidential&quot;</span><span class="p">],</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="s2">&quot;privilege_escalation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;privilege escalation&quot;</span><span class="p">,</span> <span class="s2">&quot;sudo&quot;</span><span class="p">,</span> <span class="s2">&quot;root access&quot;</span><span class="p">,</span> <span class="s2">&quot;admin access&quot;</span><span class="p">],</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;persistence&quot;</span><span class="p">,</span> <span class="s2">&quot;startup&quot;</span><span class="p">,</span> <span class="s2">&quot;registry&quot;</span><span class="p">,</span> <span class="s2">&quot;cron job&quot;</span><span class="p">,</span> <span class="s2">&quot;scheduled task&quot;</span><span class="p">],</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="p">}</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="c1"># DShield-specific severity mapping</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>            <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>            <span class="s2">&quot;medium&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>            <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="p">}</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="c1"># DShield-specific category mapping</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_category_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ATTACK</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">BLOCK</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">REPUTATION</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="s2">&quot;geographic&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">GEOGRAPHIC</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>            <span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ASN</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ORGANIZATION</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PORT</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PROTOCOL</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>            <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>            <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">AUTHENTICATION</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">MALWARE</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>            <span class="s2">&quot;intrusion&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">INTRUSION</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DATA_EXFILTRATION</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">RECONNAISSANCE</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>            <span class="s2">&quot;denial_of_service&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DENIAL_OF_SERVICE</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>            <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="p">}</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_security_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process and normalize security events from DShield SIEM.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        Normalizes, enriches, and detects attack patterns in a list of security events.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        Handles error logging and skips events that cannot be processed.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        Args:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">            events: List of raw event dictionaries</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        Returns:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">            List of processed and normalized event dictionaries</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="n">processed_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                <span class="c1"># Skip None events</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>                    <span class="k">continue</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>                <span class="c1"># Normalize event data</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>                <span class="c1"># Detect attack patterns</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>                <span class="n">normalized_event</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                    <span class="p">[</span><span class="n">normalized_event</span><span class="p">]</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>                <span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                <span class="c1"># Add DShield-specific enrichments</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_dshield_data</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                <span class="n">processed_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                    <span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                    <span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                <span class="k">continue</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="s2">&quot;Processed security events&quot;</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="n">total_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>            <span class="n">processed_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_events</span><span class="p">),</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="k">return</span> <span class="n">processed_events</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_attacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldAttack</span><span class="p">]:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield attack events into structured format.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Converts raw attack event dictionaries into DShieldAttack model instances.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        Handles error logging and skips attacks that cannot be processed.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        Args:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">            attacks: List of raw attack event dictionaries</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Returns:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">            List of DShieldAttack model instances</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="n">processed_attacks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">attacks</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="c1"># Create DShieldAttack object</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>                <span class="n">dshield_attack</span> <span class="o">=</span> <span class="n">DShieldAttack</span><span class="p">(</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                    <span class="n">timestamp</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)),</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>                    <span class="n">source_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>                    <span class="n">destination_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>                    <span class="n">source_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_port&quot;</span><span class="p">),</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>                    <span class="n">destination_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>                    <span class="n">protocol</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>                    <span class="n">attack_type</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>                    <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>                        <span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">),</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>                        <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>                    <span class="p">),</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                    <span class="n">attack_methods</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                    <span class="n">indices</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                <span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                <span class="n">processed_attacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attack</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>                        <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                    <span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span> <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                    <span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                <span class="k">continue</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="k">return</span> <span class="n">processed_attacks</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_reputation</span><span class="p">(</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">reputation_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DShieldReputation</span><span class="p">]:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield reputation data into structured format.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        Converts raw reputation data dictionaries into DShieldReputation model instances.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        Handles error logging and skips entries that cannot be processed.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        Args:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">            reputation_data: List of raw reputation data dictionaries</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        Returns:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">            Dictionary mapping IP addresses to DShieldReputation model instances</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="n">processed_reputation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="k">for</span> <span class="n">rep_data</span> <span class="ow">in</span> <span class="n">reputation_data</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="n">ip_address</span> <span class="o">=</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ip_address&quot;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_address</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                    <span class="k">continue</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="c1"># Create DShieldReputation object</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                <span class="n">dshield_rep</span> <span class="o">=</span> <span class="n">DShieldReputation</span><span class="p">(</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                    <span class="n">threat_level</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threat_level&quot;</span><span class="p">),</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>                    <span class="n">port_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port_count&quot;</span><span class="p">),</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                    <span class="n">service_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;service_count&quot;</span><span class="p">),</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="n">processed_reputation</span><span class="p">[</span><span class="n">ip_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">dshield_rep</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>                    <span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                    <span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>                <span class="k">continue</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">return</span> <span class="n">processed_reputation</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">attackers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldTopAttacker</span><span class="p">]:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield top attackers data into structured format.&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="n">processed_attackers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">attackers</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="c1"># Create DShieldTopAttacker object</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="n">dshield_attacker</span> <span class="o">=</span> <span class="n">DShieldTopAttacker</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                    <span class="n">target_ports</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_ports&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                    <span class="n">target_services</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_services&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                <span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                <span class="n">processed_attackers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attacker</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                    <span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                    <span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                <span class="k">continue</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="k">return</span> <span class="n">processed_attackers</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dshield_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">DShieldStatistics</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DShield-specific security summary.&quot;&quot;&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_dshield_statistics</span><span class="p">()</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="c1"># Extract DShield-specific data</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="c1"># Compile statistics</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">DShieldStatistics</span><span class="p">(</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="n">time_range_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>            <span class="n">total_attacks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dshield_attacks</span><span class="p">),</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="n">unique_attackers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>                <span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="p">),</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="n">total_targets</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">))</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                <span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="p">),</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="n">countries_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">))</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                <span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="p">),</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="n">ports_targeted</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">))</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>                <span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="p">),</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="n">protocols_used</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">))</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                <span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="p">),</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="n">asns_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                <span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="p">),</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>            <span class="n">organizations_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">))</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="p">),</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">high_reputation_ips</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">]),</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">top_countries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_countries</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="n">top_ports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_ports</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="n">top_protocols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_protocols</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="n">top_asns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_asns</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="n">top_organizations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_organizations</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="n">average_reputation_score</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_average_reputation</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="n">indices_queried</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]))),</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            <span class="n">query_duration_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: Calculate actual query duration</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security summary statistics with DShield enrichment.&quot;&quot;&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_summary</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="s2">&quot;time_range_hours&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="s2">&quot;events_by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="s2">&quot;events_by_category&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="s2">&quot;unique_source_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="s2">&quot;top_source_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="s2">&quot;top_destination_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="s2">&quot;high_risk_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="s2">&quot;threat_intelligence_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="s2">&quot;timeline&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="s2">&quot;indices_queried&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="c1"># DShield-specific statistics</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="s2">&quot;dshield_blocks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="s2">&quot;geographic_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="s2">&quot;port_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="s2">&quot;asn_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="s2">&quot;organization_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="s2">&quot;reputation_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="p">}</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="c1"># Extract unique IPs</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="n">source_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="n">destination_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="n">ip_event_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="c1"># Process events</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>            <span class="c1"># Count by severity</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="c1"># Ensure severity is hashable</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">][</span><span class="n">severity</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>            <span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="c1"># Count by category</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="c1"># Ensure category is hashable</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="c1"># Track IPs - ensure they are hashable</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="n">source_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_ip_str</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="n">ip_event_counts</span><span class="p">[</span><span class="n">source_ip_str</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="n">destination_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="k">if</span> <span class="n">destination_ip</span><span class="p">:</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                <span class="n">destination_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">destination_ip_str</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="c1"># Count high-risk events</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="k">if</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;high_risk_events&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>            <span class="c1"># DShield-specific counting</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_attacks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_blocks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>            <span class="c1"># Track indices</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>            <span class="k">if</span> <span class="s2">&quot;indices&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>                    <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="c1"># Update summary with IP statistics</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_ips</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">destination_ips</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="c1"># Get top source IPs</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;top_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="p">{</span><span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_event_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="p">]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="c1"># Generate DShield-specific distributions</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;geographic_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geographic_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;port_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_port_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;asn_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_asn_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;organization_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_organization_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;reputation_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reputation_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="c1"># Generate timeline</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;timeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_timeline</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="c1"># Detect attack patterns</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="c1"># Remove duplicates from indices</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]))</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_attack_report</span><span class="p">(</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate structured attack report with DShield data.&quot;&quot;&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_attack_report</span><span class="p">()</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        <span class="n">threat_intelligence</span> <span class="o">=</span> <span class="n">threat_intelligence</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="c1"># Generate report ID</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">report_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="c1"># Analyze events</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="c1"># Extract threat indicators</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="n">threat_indicators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_threat_indicators</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="c1"># Identify attack vectors</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="n">attack_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_attack_vectors</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="c1"># Determine affected systems</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="n">affected_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_affected_systems</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="c1"># Assess impact</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">impact_assessment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_impact</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="c1"># Generate recommendations</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">(</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">,</span> <span class="n">impact_assessment</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="c1"># Process DShield-specific data</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_attacks</span><span class="p">(</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="n">dshield_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_reputation</span><span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">]</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="n">top_attackers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="c1"># Create attack report</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Security Incident Report - </span><span class="si">{</span><span class="n">report_id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_executive_summary</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                <span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="p">),</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="s2">&quot;time_range&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time_range</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="s2">&quot;threat_indicators&quot;</span><span class="p">:</span> <span class="n">threat_indicators</span><span class="p">,</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="s2">&quot;high_risk_ips&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_high_risk_ips</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="s2">&quot;attack_vectors&quot;</span><span class="p">:</span> <span class="n">attack_vectors</span><span class="p">,</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="s2">&quot;affected_systems&quot;</span><span class="p">:</span> <span class="n">affected_systems</span><span class="p">,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="s2">&quot;impact_assessment&quot;</span><span class="p">:</span> <span class="n">impact_assessment</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attack</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">dshield_attacks</span><span class="p">],</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="s2">&quot;dshield_reputation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">rep</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">dshield_reputation</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attacker</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">top_attackers</span><span class="p">],</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="n">recommendations</span><span class="p">,</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_mitigation_actions</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="s2">&quot;confidence_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_confidence_level</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_tags</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="s2">&quot;threat_intelligence&quot;</span><span class="p">:</span> <span class="n">threat_intelligence</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="p">}</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="k">return</span> <span class="n">report</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_unique_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract unique IP addresses from events.&quot;&quot;&quot;</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">])</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">]</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                <span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">):</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">])</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">]</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize event data structure.&quot;&quot;&quot;</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="c1"># Ensure severity and category are strings before using as dictionary keys</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="n">severity_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">)</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">category_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_raw</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category_raw</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category_raw</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)),</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="s2">&quot;source_ip&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="s2">&quot;destination_ip&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>            <span class="s2">&quot;source_port&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_port&quot;</span><span class="p">),</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="s2">&quot;destination_port&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">severity</span><span class="p">,</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_category_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                <span class="n">category</span><span class="p">,</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                <span class="n">EventCategory</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>            <span class="s2">&quot;reputation_score&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="s2">&quot;attack_count&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="s2">&quot;first_seen&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="s2">&quot;last_seen&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="s2">&quot;attack_types&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="s2">&quot;raw_data&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="p">}</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">return</span> <span class="n">normalized</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_enrich_dshield_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enrich event with DShield-specific data.&quot;&quot;&quot;</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="c1"># Add threat level based on reputation score</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="n">reputation_score</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="k">if</span> <span class="n">reputation_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="k">if</span> <span class="n">reputation_score</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>            <span class="k">elif</span> <span class="n">reputation_score</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;low&quot;</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="c1"># Add geographic context</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;geographic_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Attacker from </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="c1"># Add ASN context</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ASN: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;asn&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="c1"># Add organization context</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Organization: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="k">return</span> <span class="n">event</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_attack_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect attack patterns in events.&quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">pattern_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>            <span class="c1"># Robustly handle both strings and lists for description and event_type</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">description_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description_raw</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">description_raw</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description_raw</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">event_type_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_type_raw</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="n">event_type</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">event_type_raw</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                <span class="n">event_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_type_raw</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_attack_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">description</span> <span class="ow">or</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">event_type</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">):</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                    <span class="n">pattern_counts</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pattern_counts</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top countries by attack count.&quot;&quot;&quot;</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">country_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                <span class="n">country_counts</span><span class="p">[</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="p">{</span><span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">country</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>            <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">country_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="p">]</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top ports by attack count.&quot;&quot;&quot;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="n">port_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="n">port_counts</span><span class="p">[</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">])</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">]</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">port</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">port_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_protocols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top protocols by attack count.&quot;&quot;&quot;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">protocol_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">):</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="n">protocol_counts</span><span class="p">[</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">])</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="p">{</span><span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">protocol</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="k">for</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">protocol_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="p">]</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_asns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top ASNs by attack count.&quot;&quot;&quot;</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="n">asn_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                <span class="n">asn_counts</span><span class="p">[</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">]</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">asn</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">asn</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">asn_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_organizations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top organizations by attack count.&quot;&quot;&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="n">org_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="n">org_counts</span><span class="p">[</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">])</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">]</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">org</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">org_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_average_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate average reputation score.&quot;&quot;&quot;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="p">]</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="k">if</span> <span class="n">scores</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_geographic_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get geographic distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_port_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get port distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">])</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">]</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_asn_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ASN distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">]</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_organization_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get organization distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">])</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">]</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_reputation_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get reputation score distribution.&quot;&quot;&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                <span class="k">elif</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;medium&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate timeline of events.&quot;&quot;&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="n">timeline</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="k">if</span> <span class="n">timestamp</span><span class="p">:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                        <span class="n">dt</span> <span class="o">=</span> <span class="n">timestamp</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                    <span class="n">hour</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:00&quot;</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                    <span class="n">timeline</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                    <span class="k">continue</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze events for patterns and insights.&quot;&quot;&quot;</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="c1"># Filter out unhashable values for Counter</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">severity_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="n">category_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            <span class="c1"># Convert to string if it&#39;s not hashable</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="k">if</span> <span class="n">severity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                    <span class="n">severity_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">severity</span><span class="p">))</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                    <span class="n">severity_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                    <span class="n">category_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="p">))</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                    <span class="n">category_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="c1"># Extract unique IPs safely</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">),</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>            <span class="s2">&quot;severity_distribution&quot;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">severity_values</span><span class="p">),</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="s2">&quot;category_distribution&quot;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">category_values</span><span class="p">),</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="p">}</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_threat_indicators</span><span class="p">(</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract threat indicators from events and threat intelligence.&quot;&quot;&quot;</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="n">indicators</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                    <span class="p">{</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;high_reputation_score&quot;</span><span class="p">,</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                        <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IP </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">),</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has high reputation score&quot;</span><span class="p">,</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                    <span class="p">}</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                <span class="p">)</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                    <span class="p">{</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;high_attack_count&quot;</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                        <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                        <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IP </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">),</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has high attack count&quot;</span><span class="p">,</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                    <span class="p">}</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                <span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="k">return</span> <span class="n">indicators</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_attack_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify attack vectors from events.&quot;&quot;&quot;</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">vectors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="sa">f</span><span class="s2">&quot;Port </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">):</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                    <span class="sa">f</span><span class="s2">&quot;Protocol </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="p">)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">):</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="c1"># Handle attack_types that might contain unhashable types</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="n">attack_types</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;attack_types&quot;</span><span class="p">]</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attack_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                    <span class="k">for</span> <span class="n">attack_type</span> <span class="ow">in</span> <span class="n">attack_types</span><span class="p">:</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attack_type</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                            <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attack_type</span><span class="p">))</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                            <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attack_type</span><span class="p">)</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attack_types</span><span class="p">))</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_affected_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify affected systems from events.&quot;&quot;&quot;</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="n">systems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">):</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                <span class="n">systems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">])</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">]</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                <span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_impact</span><span class="p">(</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess the impact of the security incident.&quot;&quot;&quot;</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="n">high_severity_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]])</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>        <span class="n">high_reputation_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">threat_indicators</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;high_reputation_score&quot;</span><span class="p">]</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="k">if</span> <span class="n">high_severity_count</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">high_reputation_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="k">return</span> <span class="s2">&quot;High - Multiple high-severity events and high-reputation attackers detected&quot;</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="k">if</span> <span class="n">high_severity_count</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">high_reputation_count</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="k">return</span> <span class="s2">&quot;Medium - Several high-severity events or high-reputation attackers detected&quot;</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="k">return</span> <span class="s2">&quot;Low - Limited high-severity events detected&quot;</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_recommendations</span><span class="p">(</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">impact</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security recommendations.&quot;&quot;&quot;</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="c1"># Basic recommendations</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review and update firewall rules to block suspicious IP addresses&quot;</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Implement rate limiting for authentication attempts&quot;</span><span class="p">)</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Enable logging and monitoring for all critical systems&quot;</span><span class="p">)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="c1"># DShield-specific recommendations</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">):</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Block IP addresses with high DShield reputation scores&quot;</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">):</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                <span class="s2">&quot;Implement additional monitoring for IPs with high attack counts&quot;</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>        <span class="k">if</span> <span class="n">impact</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consider implementing additional security controls&quot;</span><span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review incident response procedures&quot;</span><span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="k">return</span> <span class="n">recommendations</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_mitigation_actions</span><span class="p">(</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate specific mitigation actions.&quot;&quot;&quot;</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="c1"># Immediate actions</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">high_reputation_ips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">threat_indicators</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;high_reputation_score&quot;</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="p">]</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="k">if</span> <span class="n">high_reputation_ips</span><span class="p">:</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block IP addresses: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">high_reputation_ips</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="c1"># Monitoring actions</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Increase monitoring frequency for affected systems&quot;</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review and update security policies&quot;</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="k">return</span> <span class="n">actions</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_confidence_level</span><span class="p">(</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess confidence level of the analysis.&quot;&quot;&quot;</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">threat_intelligence</span><span class="p">:</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>            <span class="k">return</span> <span class="s2">&quot;High&quot;</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>            <span class="k">return</span> <span class="s2">&quot;Medium&quot;</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="k">return</span> <span class="s2">&quot;Low&quot;</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract tags from events.&quot;&quot;&quot;</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>            <span class="n">event_tags</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_tags</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">event_tags</span><span class="p">:</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                        <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                        <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">event_tags</span><span class="p">))</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_executive_summary</span><span class="p">(</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate executive summary of the security incident.&quot;&quot;&quot;</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="n">total_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="c1"># Extract unique IPs safely</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="n">high_severity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]])</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Security incident involving </span><span class="si">{</span><span class="n">total_events</span><span class="si">}</span><span class="s2"> events from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique IP addresses. &quot;</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">high_severity</span><span class="si">}</span><span class="s2"> high-severity events detected. &quot;</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="k">if</span> <span class="n">threat_indicators</span><span class="p">:</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">threat_indicators</span><span class="p">)</span><span class="si">}</span><span class="s2"> threat indicators identified requiring immediate attention.&quot;</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_high_risk_ips</span><span class="p">(</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify high-risk IP addresses.&quot;&quot;&quot;</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>        <span class="n">high_risk_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                    <span class="n">high_risk_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_ip_str</span><span class="p">)</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">high_risk_ips</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty security summary.&quot;&quot;&quot;</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="s2">&quot;time_range_hours&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="s2">&quot;events_by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;events_by_category&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;unique_source_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;top_source_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;top_destination_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="s2">&quot;high_risk_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="s2">&quot;threat_intelligence_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>            <span class="s2">&quot;timeline&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="s2">&quot;indices_queried&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="s2">&quot;dshield_blocks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="s2">&quot;geographic_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="s2">&quot;port_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="s2">&quot;asn_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="s2">&quot;organization_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="s2">&quot;reputation_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="p">}</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_attack_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty attack report.&quot;&quot;&quot;</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;No Security Events Detected&quot;</span><span class="p">,</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;No security events were found in the specified time range.&quot;</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="s2">&quot;time_range&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="s2">&quot;threat_indicators&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="s2">&quot;high_risk_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="s2">&quot;attack_vectors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="s2">&quot;affected_systems&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>            <span class="s2">&quot;impact_assessment&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            <span class="s2">&quot;dshield_reputation&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Continue monitoring for security events&quot;</span><span class="p">],</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>            <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="s2">&quot;confidence_level&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="s2">&quot;threat_intelligence&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="p">}</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_time_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate time range from events, handling empty sequences.&quot;&quot;&quot;</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="c1"># Extract valid timestamps</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>            <span class="k">if</span> <span class="n">timestamp</span><span class="p">:</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                <span class="c1"># Handle both string and datetime timestamps</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                        <span class="c1"># Try to parse ISO format timestamps</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                        <span class="k">if</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">):</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                        <span class="c1"># Skip malformed timestamps</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                        <span class="k">continue</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                    <span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                    <span class="c1"># Skip non-datetime objects</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                    <span class="k">continue</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="k">if</span> <span class="n">timestamps</span><span class="p">:</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>            <span class="p">}</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="c1"># Return current time as fallback</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="p">}</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_dshield_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DShieldStatistics</span><span class="p">:</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty DShield statistics.&quot;&quot;&quot;</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="k">return</span> <span class="n">DShieldStatistics</span><span class="p">(</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>            <span class="n">time_range_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>            <span class="n">total_attacks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="n">unique_attackers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="n">total_targets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">countries_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="n">ports_targeted</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="n">protocols_used</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="n">asns_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="n">organizations_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">high_reputation_ips</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>            <span class="n">top_countries</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="n">top_ports</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="n">top_protocols</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>            <span class="n">top_asns</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="n">top_organizations</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            <span class="n">average_reputation_score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="n">indices_queried</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="n">query_duration_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="p">)</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<input id="logger-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="logger-view-value"></label><span class="default_value">&lt;BoundLoggerLazyProxy(logger=None, wrapper_class=None, processors=None, context_class=None, initial_values={}, logger_factory_args=(&#39;<a href="">src.data_processor</a>&#39;,))&gt;</span>


    </div>
    <a class="headerlink" href="#logger"></a>



                </section>
                <section id="DataProcessor">
                            <input id="DataProcessor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">

    <span class="def">class</span>
    <span class="name">DataProcessor</span>:

                <label class="view-source-button" for="DataProcessor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor-63"><a href="#DataProcessor-63"><span class="linenos">  63</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DataProcessor</span><span class="p">:</span>
</span><span id="DataProcessor-64"><a href="#DataProcessor-64"><span class="linenos">  64</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process and structure DShield SIEM data for AI analysis.</span>
</span><span id="DataProcessor-65"><a href="#DataProcessor-65"><span class="linenos">  65</span></a>
</span><span id="DataProcessor-66"><a href="#DataProcessor-66"><span class="linenos">  66</span></a><span class="sd">    This class provides methods to normalize, enrich, and summarize DShield SIEM</span>
</span><span id="DataProcessor-67"><a href="#DataProcessor-67"><span class="linenos">  67</span></a><span class="sd">    data for use in AI-driven analytics and reporting. It includes attack pattern</span>
</span><span id="DataProcessor-68"><a href="#DataProcessor-68"><span class="linenos">  68</span></a><span class="sd">    detection, severity/category mapping, and report generation utilities.</span>
</span><span id="DataProcessor-69"><a href="#DataProcessor-69"><span class="linenos">  69</span></a>
</span><span id="DataProcessor-70"><a href="#DataProcessor-70"><span class="linenos">  70</span></a><span class="sd">    Attributes:</span>
</span><span id="DataProcessor-71"><a href="#DataProcessor-71"><span class="linenos">  71</span></a><span class="sd">        dshield_attack_patterns: Mapping of attack pattern names to keywords</span>
</span><span id="DataProcessor-72"><a href="#DataProcessor-72"><span class="linenos">  72</span></a><span class="sd">        dshield_severity_mapping: Mapping of severity labels to EventSeverity</span>
</span><span id="DataProcessor-73"><a href="#DataProcessor-73"><span class="linenos">  73</span></a><span class="sd">        dshield_category_mapping: Mapping of category labels to EventCategory</span>
</span><span id="DataProcessor-74"><a href="#DataProcessor-74"><span class="linenos">  74</span></a>
</span><span id="DataProcessor-75"><a href="#DataProcessor-75"><span class="linenos">  75</span></a><span class="sd">    Example:</span>
</span><span id="DataProcessor-76"><a href="#DataProcessor-76"><span class="linenos">  76</span></a><span class="sd">        &gt;&gt;&gt; processor = DataProcessor()</span>
</span><span id="DataProcessor-77"><a href="#DataProcessor-77"><span class="linenos">  77</span></a><span class="sd">        &gt;&gt;&gt; summary = processor.generate_security_summary(events)</span>
</span><span id="DataProcessor-78"><a href="#DataProcessor-78"><span class="linenos">  78</span></a>
</span><span id="DataProcessor-79"><a href="#DataProcessor-79"><span class="linenos">  79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DataProcessor-80"><a href="#DataProcessor-80"><span class="linenos">  80</span></a>
</span><span id="DataProcessor-81"><a href="#DataProcessor-81"><span class="linenos">  81</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-82"><a href="#DataProcessor-82"><span class="linenos">  82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DataProcessor.</span>
</span><span id="DataProcessor-83"><a href="#DataProcessor-83"><span class="linenos">  83</span></a>
</span><span id="DataProcessor-84"><a href="#DataProcessor-84"><span class="linenos">  84</span></a><span class="sd">        Sets up DShield-specific mappings for attack patterns, severity, and category.</span>
</span><span id="DataProcessor-85"><a href="#DataProcessor-85"><span class="linenos">  85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor-86"><a href="#DataProcessor-86"><span class="linenos">  86</span></a>        <span class="c1"># DShield-specific attack patterns and signatures</span>
</span><span id="DataProcessor-87"><a href="#DataProcessor-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_attack_patterns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-88"><a href="#DataProcessor-88"><span class="linenos">  88</span></a>            <span class="s2">&quot;brute_force&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor-89"><a href="#DataProcessor-89"><span class="linenos">  89</span></a>                <span class="s2">&quot;failed login&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-90"><a href="#DataProcessor-90"><span class="linenos">  90</span></a>                <span class="s2">&quot;authentication failure&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-91"><a href="#DataProcessor-91"><span class="linenos">  91</span></a>                <span class="s2">&quot;invalid credentials&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-92"><a href="#DataProcessor-92"><span class="linenos">  92</span></a>                <span class="s2">&quot;ssh brute force&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-93"><a href="#DataProcessor-93"><span class="linenos">  93</span></a>            <span class="p">],</span>
</span><span id="DataProcessor-94"><a href="#DataProcessor-94"><span class="linenos">  94</span></a>            <span class="s2">&quot;port_scan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;port scan&quot;</span><span class="p">,</span> <span class="s2">&quot;nmap&quot;</span><span class="p">,</span> <span class="s2">&quot;masscan&quot;</span><span class="p">,</span> <span class="s2">&quot;port scanning&quot;</span><span class="p">,</span> <span class="s2">&quot;syn scan&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-95"><a href="#DataProcessor-95"><span class="linenos">  95</span></a>            <span class="s2">&quot;sql_injection&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sql injection&quot;</span><span class="p">,</span> <span class="s2">&quot;sql error&quot;</span><span class="p">,</span> <span class="s2">&quot;database error&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql error&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-96"><a href="#DataProcessor-96"><span class="linenos">  96</span></a>            <span class="s2">&quot;xss&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cross-site scripting&quot;</span><span class="p">,</span> <span class="s2">&quot;xss&quot;</span><span class="p">,</span> <span class="s2">&quot;script injection&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript injection&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-97"><a href="#DataProcessor-97"><span class="linenos">  97</span></a>            <span class="s2">&quot;ddos&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;denial of service&quot;</span><span class="p">,</span> <span class="s2">&quot;ddos&quot;</span><span class="p">,</span> <span class="s2">&quot;flood attack&quot;</span><span class="p">,</span> <span class="s2">&quot;syn flood&quot;</span><span class="p">,</span> <span class="s2">&quot;udp flood&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-98"><a href="#DataProcessor-98"><span class="linenos">  98</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;malware&quot;</span><span class="p">,</span> <span class="s2">&quot;virus&quot;</span><span class="p">,</span> <span class="s2">&quot;trojan&quot;</span><span class="p">,</span> <span class="s2">&quot;ransomware&quot;</span><span class="p">,</span> <span class="s2">&quot;botnet&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-99"><a href="#DataProcessor-99"><span class="linenos">  99</span></a>            <span class="s2">&quot;phishing&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor-100"><a href="#DataProcessor-100"><span class="linenos"> 100</span></a>                <span class="s2">&quot;phishing&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-101"><a href="#DataProcessor-101"><span class="linenos"> 101</span></a>                <span class="s2">&quot;suspicious email&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-102"><a href="#DataProcessor-102"><span class="linenos"> 102</span></a>                <span class="s2">&quot;credential harvesting&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-103"><a href="#DataProcessor-103"><span class="linenos"> 103</span></a>                <span class="s2">&quot;social engineering&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-104"><a href="#DataProcessor-104"><span class="linenos"> 104</span></a>            <span class="p">],</span>
</span><span id="DataProcessor-105"><a href="#DataProcessor-105"><span class="linenos"> 105</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor-106"><a href="#DataProcessor-106"><span class="linenos"> 106</span></a>                <span class="s2">&quot;reconnaissance&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-107"><a href="#DataProcessor-107"><span class="linenos"> 107</span></a>                <span class="s2">&quot;information gathering&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-108"><a href="#DataProcessor-108"><span class="linenos"> 108</span></a>                <span class="s2">&quot;enumeration&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-109"><a href="#DataProcessor-109"><span class="linenos"> 109</span></a>                <span class="s2">&quot;network scan&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-110"><a href="#DataProcessor-110"><span class="linenos"> 110</span></a>            <span class="p">],</span>
</span><span id="DataProcessor-111"><a href="#DataProcessor-111"><span class="linenos"> 111</span></a>            <span class="s2">&quot;exploit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;exploit&quot;</span><span class="p">,</span> <span class="s2">&quot;vulnerability&quot;</span><span class="p">,</span> <span class="s2">&quot;cve&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer overflow&quot;</span><span class="p">,</span> <span class="s2">&quot;code injection&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-112"><a href="#DataProcessor-112"><span class="linenos"> 112</span></a>            <span class="s2">&quot;backdoor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;backdoor&quot;</span><span class="p">,</span> <span class="s2">&quot;reverse shell&quot;</span><span class="p">,</span> <span class="s2">&quot;command injection&quot;</span><span class="p">,</span> <span class="s2">&quot;remote access&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-113"><a href="#DataProcessor-113"><span class="linenos"> 113</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data theft&quot;</span><span class="p">,</span> <span class="s2">&quot;exfiltration&quot;</span><span class="p">,</span> <span class="s2">&quot;sensitive data&quot;</span><span class="p">,</span> <span class="s2">&quot;confidential&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-114"><a href="#DataProcessor-114"><span class="linenos"> 114</span></a>            <span class="s2">&quot;privilege_escalation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;privilege escalation&quot;</span><span class="p">,</span> <span class="s2">&quot;sudo&quot;</span><span class="p">,</span> <span class="s2">&quot;root access&quot;</span><span class="p">,</span> <span class="s2">&quot;admin access&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-115"><a href="#DataProcessor-115"><span class="linenos"> 115</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;persistence&quot;</span><span class="p">,</span> <span class="s2">&quot;startup&quot;</span><span class="p">,</span> <span class="s2">&quot;registry&quot;</span><span class="p">,</span> <span class="s2">&quot;cron job&quot;</span><span class="p">,</span> <span class="s2">&quot;scheduled task&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-116"><a href="#DataProcessor-116"><span class="linenos"> 116</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-117"><a href="#DataProcessor-117"><span class="linenos"> 117</span></a>
</span><span id="DataProcessor-118"><a href="#DataProcessor-118"><span class="linenos"> 118</span></a>        <span class="c1"># DShield-specific severity mapping</span>
</span><span id="DataProcessor-119"><a href="#DataProcessor-119"><span class="linenos"> 119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-120"><a href="#DataProcessor-120"><span class="linenos"> 120</span></a>            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
</span><span id="DataProcessor-121"><a href="#DataProcessor-121"><span class="linenos"> 121</span></a>            <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor-122"><a href="#DataProcessor-122"><span class="linenos"> 122</span></a>            <span class="s2">&quot;medium&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor-123"><a href="#DataProcessor-123"><span class="linenos"> 123</span></a>            <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="DataProcessor-124"><a href="#DataProcessor-124"><span class="linenos"> 124</span></a>            <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="DataProcessor-125"><a href="#DataProcessor-125"><span class="linenos"> 125</span></a>            <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor-126"><a href="#DataProcessor-126"><span class="linenos"> 126</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor-127"><a href="#DataProcessor-127"><span class="linenos"> 127</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor-128"><a href="#DataProcessor-128"><span class="linenos"> 128</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor-129"><a href="#DataProcessor-129"><span class="linenos"> 129</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor-130"><a href="#DataProcessor-130"><span class="linenos"> 130</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-131"><a href="#DataProcessor-131"><span class="linenos"> 131</span></a>
</span><span id="DataProcessor-132"><a href="#DataProcessor-132"><span class="linenos"> 132</span></a>        <span class="c1"># DShield-specific category mapping</span>
</span><span id="DataProcessor-133"><a href="#DataProcessor-133"><span class="linenos"> 133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_category_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-134"><a href="#DataProcessor-134"><span class="linenos"> 134</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ATTACK</span><span class="p">,</span>
</span><span id="DataProcessor-135"><a href="#DataProcessor-135"><span class="linenos"> 135</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">BLOCK</span><span class="p">,</span>
</span><span id="DataProcessor-136"><a href="#DataProcessor-136"><span class="linenos"> 136</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">REPUTATION</span><span class="p">,</span>
</span><span id="DataProcessor-137"><a href="#DataProcessor-137"><span class="linenos"> 137</span></a>            <span class="s2">&quot;geographic&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">GEOGRAPHIC</span><span class="p">,</span>
</span><span id="DataProcessor-138"><a href="#DataProcessor-138"><span class="linenos"> 138</span></a>            <span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ASN</span><span class="p">,</span>
</span><span id="DataProcessor-139"><a href="#DataProcessor-139"><span class="linenos"> 139</span></a>            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ORGANIZATION</span><span class="p">,</span>
</span><span id="DataProcessor-140"><a href="#DataProcessor-140"><span class="linenos"> 140</span></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PORT</span><span class="p">,</span>
</span><span id="DataProcessor-141"><a href="#DataProcessor-141"><span class="linenos"> 141</span></a>            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PROTOCOL</span><span class="p">,</span>
</span><span id="DataProcessor-142"><a href="#DataProcessor-142"><span class="linenos"> 142</span></a>            <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">,</span>
</span><span id="DataProcessor-143"><a href="#DataProcessor-143"><span class="linenos"> 143</span></a>            <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">AUTHENTICATION</span><span class="p">,</span>
</span><span id="DataProcessor-144"><a href="#DataProcessor-144"><span class="linenos"> 144</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">MALWARE</span><span class="p">,</span>
</span><span id="DataProcessor-145"><a href="#DataProcessor-145"><span class="linenos"> 145</span></a>            <span class="s2">&quot;intrusion&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">INTRUSION</span><span class="p">,</span>
</span><span id="DataProcessor-146"><a href="#DataProcessor-146"><span class="linenos"> 146</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DATA_EXFILTRATION</span><span class="p">,</span>
</span><span id="DataProcessor-147"><a href="#DataProcessor-147"><span class="linenos"> 147</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">RECONNAISSANCE</span><span class="p">,</span>
</span><span id="DataProcessor-148"><a href="#DataProcessor-148"><span class="linenos"> 148</span></a>            <span class="s2">&quot;denial_of_service&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DENIAL_OF_SERVICE</span><span class="p">,</span>
</span><span id="DataProcessor-149"><a href="#DataProcessor-149"><span class="linenos"> 149</span></a>            <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
</span><span id="DataProcessor-150"><a href="#DataProcessor-150"><span class="linenos"> 150</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-151"><a href="#DataProcessor-151"><span class="linenos"> 151</span></a>
</span><span id="DataProcessor-152"><a href="#DataProcessor-152"><span class="linenos"> 152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_security_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-153"><a href="#DataProcessor-153"><span class="linenos"> 153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process and normalize security events from DShield SIEM.</span>
</span><span id="DataProcessor-154"><a href="#DataProcessor-154"><span class="linenos"> 154</span></a>
</span><span id="DataProcessor-155"><a href="#DataProcessor-155"><span class="linenos"> 155</span></a><span class="sd">        Normalizes, enriches, and detects attack patterns in a list of security events.</span>
</span><span id="DataProcessor-156"><a href="#DataProcessor-156"><span class="linenos"> 156</span></a><span class="sd">        Handles error logging and skips events that cannot be processed.</span>
</span><span id="DataProcessor-157"><a href="#DataProcessor-157"><span class="linenos"> 157</span></a>
</span><span id="DataProcessor-158"><a href="#DataProcessor-158"><span class="linenos"> 158</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor-159"><a href="#DataProcessor-159"><span class="linenos"> 159</span></a><span class="sd">            events: List of raw event dictionaries</span>
</span><span id="DataProcessor-160"><a href="#DataProcessor-160"><span class="linenos"> 160</span></a>
</span><span id="DataProcessor-161"><a href="#DataProcessor-161"><span class="linenos"> 161</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor-162"><a href="#DataProcessor-162"><span class="linenos"> 162</span></a><span class="sd">            List of processed and normalized event dictionaries</span>
</span><span id="DataProcessor-163"><a href="#DataProcessor-163"><span class="linenos"> 163</span></a>
</span><span id="DataProcessor-164"><a href="#DataProcessor-164"><span class="linenos"> 164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor-165"><a href="#DataProcessor-165"><span class="linenos"> 165</span></a>        <span class="n">processed_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-166"><a href="#DataProcessor-166"><span class="linenos"> 166</span></a>
</span><span id="DataProcessor-167"><a href="#DataProcessor-167"><span class="linenos"> 167</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-168"><a href="#DataProcessor-168"><span class="linenos"> 168</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-169"><a href="#DataProcessor-169"><span class="linenos"> 169</span></a>                <span class="c1"># Skip None events</span>
</span><span id="DataProcessor-170"><a href="#DataProcessor-170"><span class="linenos"> 170</span></a>                <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-171"><a href="#DataProcessor-171"><span class="linenos"> 171</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor-172"><a href="#DataProcessor-172"><span class="linenos"> 172</span></a>
</span><span id="DataProcessor-173"><a href="#DataProcessor-173"><span class="linenos"> 173</span></a>                <span class="c1"># Normalize event data</span>
</span><span id="DataProcessor-174"><a href="#DataProcessor-174"><span class="linenos"> 174</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DataProcessor-175"><a href="#DataProcessor-175"><span class="linenos"> 175</span></a>
</span><span id="DataProcessor-176"><a href="#DataProcessor-176"><span class="linenos"> 176</span></a>                <span class="c1"># Detect attack patterns</span>
</span><span id="DataProcessor-177"><a href="#DataProcessor-177"><span class="linenos"> 177</span></a>                <span class="n">normalized_event</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span>
</span><span id="DataProcessor-178"><a href="#DataProcessor-178"><span class="linenos"> 178</span></a>                    <span class="p">[</span><span class="n">normalized_event</span><span class="p">]</span>
</span><span id="DataProcessor-179"><a href="#DataProcessor-179"><span class="linenos"> 179</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-180"><a href="#DataProcessor-180"><span class="linenos"> 180</span></a>
</span><span id="DataProcessor-181"><a href="#DataProcessor-181"><span class="linenos"> 181</span></a>                <span class="c1"># Add DShield-specific enrichments</span>
</span><span id="DataProcessor-182"><a href="#DataProcessor-182"><span class="linenos"> 182</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_dshield_data</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="DataProcessor-183"><a href="#DataProcessor-183"><span class="linenos"> 183</span></a>
</span><span id="DataProcessor-184"><a href="#DataProcessor-184"><span class="linenos"> 184</span></a>                <span class="n">processed_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="DataProcessor-185"><a href="#DataProcessor-185"><span class="linenos"> 185</span></a>
</span><span id="DataProcessor-186"><a href="#DataProcessor-186"><span class="linenos"> 186</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor-187"><a href="#DataProcessor-187"><span class="linenos"> 187</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor-188"><a href="#DataProcessor-188"><span class="linenos"> 188</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-189"><a href="#DataProcessor-189"><span class="linenos"> 189</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-190"><a href="#DataProcessor-190"><span class="linenos"> 190</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor-191"><a href="#DataProcessor-191"><span class="linenos"> 191</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-192"><a href="#DataProcessor-192"><span class="linenos"> 192</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor-193"><a href="#DataProcessor-193"><span class="linenos"> 193</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-194"><a href="#DataProcessor-194"><span class="linenos"> 194</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-195"><a href="#DataProcessor-195"><span class="linenos"> 195</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-196"><a href="#DataProcessor-196"><span class="linenos"> 196</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-197"><a href="#DataProcessor-197"><span class="linenos"> 197</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor-198"><a href="#DataProcessor-198"><span class="linenos"> 198</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-199"><a href="#DataProcessor-199"><span class="linenos"> 199</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-200"><a href="#DataProcessor-200"><span class="linenos"> 200</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor-201"><a href="#DataProcessor-201"><span class="linenos"> 201</span></a>
</span><span id="DataProcessor-202"><a href="#DataProcessor-202"><span class="linenos"> 202</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="DataProcessor-203"><a href="#DataProcessor-203"><span class="linenos"> 203</span></a>            <span class="s2">&quot;Processed security events&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-204"><a href="#DataProcessor-204"><span class="linenos"> 204</span></a>            <span class="n">total_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-205"><a href="#DataProcessor-205"><span class="linenos"> 205</span></a>            <span class="n">processed_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_events</span><span class="p">),</span>
</span><span id="DataProcessor-206"><a href="#DataProcessor-206"><span class="linenos"> 206</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-207"><a href="#DataProcessor-207"><span class="linenos"> 207</span></a>
</span><span id="DataProcessor-208"><a href="#DataProcessor-208"><span class="linenos"> 208</span></a>        <span class="k">return</span> <span class="n">processed_events</span>
</span><span id="DataProcessor-209"><a href="#DataProcessor-209"><span class="linenos"> 209</span></a>
</span><span id="DataProcessor-210"><a href="#DataProcessor-210"><span class="linenos"> 210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_attacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldAttack</span><span class="p">]:</span>
</span><span id="DataProcessor-211"><a href="#DataProcessor-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield attack events into structured format.</span>
</span><span id="DataProcessor-212"><a href="#DataProcessor-212"><span class="linenos"> 212</span></a>
</span><span id="DataProcessor-213"><a href="#DataProcessor-213"><span class="linenos"> 213</span></a><span class="sd">        Converts raw attack event dictionaries into DShieldAttack model instances.</span>
</span><span id="DataProcessor-214"><a href="#DataProcessor-214"><span class="linenos"> 214</span></a><span class="sd">        Handles error logging and skips attacks that cannot be processed.</span>
</span><span id="DataProcessor-215"><a href="#DataProcessor-215"><span class="linenos"> 215</span></a>
</span><span id="DataProcessor-216"><a href="#DataProcessor-216"><span class="linenos"> 216</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor-217"><a href="#DataProcessor-217"><span class="linenos"> 217</span></a><span class="sd">            attacks: List of raw attack event dictionaries</span>
</span><span id="DataProcessor-218"><a href="#DataProcessor-218"><span class="linenos"> 218</span></a>
</span><span id="DataProcessor-219"><a href="#DataProcessor-219"><span class="linenos"> 219</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor-220"><a href="#DataProcessor-220"><span class="linenos"> 220</span></a><span class="sd">            List of DShieldAttack model instances</span>
</span><span id="DataProcessor-221"><a href="#DataProcessor-221"><span class="linenos"> 221</span></a>
</span><span id="DataProcessor-222"><a href="#DataProcessor-222"><span class="linenos"> 222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor-223"><a href="#DataProcessor-223"><span class="linenos"> 223</span></a>        <span class="n">processed_attacks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-224"><a href="#DataProcessor-224"><span class="linenos"> 224</span></a>
</span><span id="DataProcessor-225"><a href="#DataProcessor-225"><span class="linenos"> 225</span></a>        <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">attacks</span><span class="p">:</span>
</span><span id="DataProcessor-226"><a href="#DataProcessor-226"><span class="linenos"> 226</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-227"><a href="#DataProcessor-227"><span class="linenos"> 227</span></a>                <span class="c1"># Create DShieldAttack object</span>
</span><span id="DataProcessor-228"><a href="#DataProcessor-228"><span class="linenos"> 228</span></a>                <span class="n">dshield_attack</span> <span class="o">=</span> <span class="n">DShieldAttack</span><span class="p">(</span>
</span><span id="DataProcessor-229"><a href="#DataProcessor-229"><span class="linenos"> 229</span></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
</span><span id="DataProcessor-230"><a href="#DataProcessor-230"><span class="linenos"> 230</span></a>                    <span class="n">timestamp</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)),</span>
</span><span id="DataProcessor-231"><a href="#DataProcessor-231"><span class="linenos"> 231</span></a>                    <span class="n">source_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-232"><a href="#DataProcessor-232"><span class="linenos"> 232</span></a>                    <span class="n">destination_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-233"><a href="#DataProcessor-233"><span class="linenos"> 233</span></a>                    <span class="n">source_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-234"><a href="#DataProcessor-234"><span class="linenos"> 234</span></a>                    <span class="n">destination_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-235"><a href="#DataProcessor-235"><span class="linenos"> 235</span></a>                    <span class="n">protocol</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-236"><a href="#DataProcessor-236"><span class="linenos"> 236</span></a>                    <span class="n">attack_type</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-237"><a href="#DataProcessor-237"><span class="linenos"> 237</span></a>                    <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataProcessor-238"><a href="#DataProcessor-238"><span class="linenos"> 238</span></a>                        <span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-239"><a href="#DataProcessor-239"><span class="linenos"> 239</span></a>                        <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor-240"><a href="#DataProcessor-240"><span class="linenos"> 240</span></a>                    <span class="p">),</span>
</span><span id="DataProcessor-241"><a href="#DataProcessor-241"><span class="linenos"> 241</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-242"><a href="#DataProcessor-242"><span class="linenos"> 242</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-243"><a href="#DataProcessor-243"><span class="linenos"> 243</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-244"><a href="#DataProcessor-244"><span class="linenos"> 244</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-245"><a href="#DataProcessor-245"><span class="linenos"> 245</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-246"><a href="#DataProcessor-246"><span class="linenos"> 246</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="DataProcessor-247"><a href="#DataProcessor-247"><span class="linenos"> 247</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-248"><a href="#DataProcessor-248"><span class="linenos"> 248</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-249"><a href="#DataProcessor-249"><span class="linenos"> 249</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-250"><a href="#DataProcessor-250"><span class="linenos"> 250</span></a>                    <span class="n">attack_methods</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-251"><a href="#DataProcessor-251"><span class="linenos"> 251</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor-252"><a href="#DataProcessor-252"><span class="linenos"> 252</span></a>                    <span class="n">indices</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-253"><a href="#DataProcessor-253"><span class="linenos"> 253</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-254"><a href="#DataProcessor-254"><span class="linenos"> 254</span></a>
</span><span id="DataProcessor-255"><a href="#DataProcessor-255"><span class="linenos"> 255</span></a>                <span class="n">processed_attacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attack</span><span class="p">)</span>
</span><span id="DataProcessor-256"><a href="#DataProcessor-256"><span class="linenos"> 256</span></a>
</span><span id="DataProcessor-257"><a href="#DataProcessor-257"><span class="linenos"> 257</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor-258"><a href="#DataProcessor-258"><span class="linenos"> 258</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor-259"><a href="#DataProcessor-259"><span class="linenos"> 259</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-260"><a href="#DataProcessor-260"><span class="linenos"> 260</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-261"><a href="#DataProcessor-261"><span class="linenos"> 261</span></a>                        <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-262"><a href="#DataProcessor-262"><span class="linenos"> 262</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-263"><a href="#DataProcessor-263"><span class="linenos"> 263</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor-264"><a href="#DataProcessor-264"><span class="linenos"> 264</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-265"><a href="#DataProcessor-265"><span class="linenos"> 265</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-266"><a href="#DataProcessor-266"><span class="linenos"> 266</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-267"><a href="#DataProcessor-267"><span class="linenos"> 267</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span> <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="DataProcessor-268"><a href="#DataProcessor-268"><span class="linenos"> 268</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-269"><a href="#DataProcessor-269"><span class="linenos"> 269</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor-270"><a href="#DataProcessor-270"><span class="linenos"> 270</span></a>
</span><span id="DataProcessor-271"><a href="#DataProcessor-271"><span class="linenos"> 271</span></a>        <span class="k">return</span> <span class="n">processed_attacks</span>
</span><span id="DataProcessor-272"><a href="#DataProcessor-272"><span class="linenos"> 272</span></a>
</span><span id="DataProcessor-273"><a href="#DataProcessor-273"><span class="linenos"> 273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_reputation</span><span class="p">(</span>
</span><span id="DataProcessor-274"><a href="#DataProcessor-274"><span class="linenos"> 274</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">reputation_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor-275"><a href="#DataProcessor-275"><span class="linenos"> 275</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DShieldReputation</span><span class="p">]:</span>
</span><span id="DataProcessor-276"><a href="#DataProcessor-276"><span class="linenos"> 276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield reputation data into structured format.</span>
</span><span id="DataProcessor-277"><a href="#DataProcessor-277"><span class="linenos"> 277</span></a>
</span><span id="DataProcessor-278"><a href="#DataProcessor-278"><span class="linenos"> 278</span></a><span class="sd">        Converts raw reputation data dictionaries into DShieldReputation model instances.</span>
</span><span id="DataProcessor-279"><a href="#DataProcessor-279"><span class="linenos"> 279</span></a><span class="sd">        Handles error logging and skips entries that cannot be processed.</span>
</span><span id="DataProcessor-280"><a href="#DataProcessor-280"><span class="linenos"> 280</span></a>
</span><span id="DataProcessor-281"><a href="#DataProcessor-281"><span class="linenos"> 281</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor-282"><a href="#DataProcessor-282"><span class="linenos"> 282</span></a><span class="sd">            reputation_data: List of raw reputation data dictionaries</span>
</span><span id="DataProcessor-283"><a href="#DataProcessor-283"><span class="linenos"> 283</span></a>
</span><span id="DataProcessor-284"><a href="#DataProcessor-284"><span class="linenos"> 284</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor-285"><a href="#DataProcessor-285"><span class="linenos"> 285</span></a><span class="sd">            Dictionary mapping IP addresses to DShieldReputation model instances</span>
</span><span id="DataProcessor-286"><a href="#DataProcessor-286"><span class="linenos"> 286</span></a>
</span><span id="DataProcessor-287"><a href="#DataProcessor-287"><span class="linenos"> 287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor-288"><a href="#DataProcessor-288"><span class="linenos"> 288</span></a>        <span class="n">processed_reputation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataProcessor-289"><a href="#DataProcessor-289"><span class="linenos"> 289</span></a>
</span><span id="DataProcessor-290"><a href="#DataProcessor-290"><span class="linenos"> 290</span></a>        <span class="k">for</span> <span class="n">rep_data</span> <span class="ow">in</span> <span class="n">reputation_data</span><span class="p">:</span>
</span><span id="DataProcessor-291"><a href="#DataProcessor-291"><span class="linenos"> 291</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-292"><a href="#DataProcessor-292"><span class="linenos"> 292</span></a>                <span class="n">ip_address</span> <span class="o">=</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ip_address&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-293"><a href="#DataProcessor-293"><span class="linenos"> 293</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_address</span><span class="p">:</span>
</span><span id="DataProcessor-294"><a href="#DataProcessor-294"><span class="linenos"> 294</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor-295"><a href="#DataProcessor-295"><span class="linenos"> 295</span></a>
</span><span id="DataProcessor-296"><a href="#DataProcessor-296"><span class="linenos"> 296</span></a>                <span class="c1"># Create DShieldReputation object</span>
</span><span id="DataProcessor-297"><a href="#DataProcessor-297"><span class="linenos"> 297</span></a>                <span class="n">dshield_rep</span> <span class="o">=</span> <span class="n">DShieldReputation</span><span class="p">(</span>
</span><span id="DataProcessor-298"><a href="#DataProcessor-298"><span class="linenos"> 298</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="DataProcessor-299"><a href="#DataProcessor-299"><span class="linenos"> 299</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-300"><a href="#DataProcessor-300"><span class="linenos"> 300</span></a>                    <span class="n">threat_level</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threat_level&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-301"><a href="#DataProcessor-301"><span class="linenos"> 301</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-302"><a href="#DataProcessor-302"><span class="linenos"> 302</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-303"><a href="#DataProcessor-303"><span class="linenos"> 303</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-304"><a href="#DataProcessor-304"><span class="linenos"> 304</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-305"><a href="#DataProcessor-305"><span class="linenos"> 305</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-306"><a href="#DataProcessor-306"><span class="linenos"> 306</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-307"><a href="#DataProcessor-307"><span class="linenos"> 307</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-308"><a href="#DataProcessor-308"><span class="linenos"> 308</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-309"><a href="#DataProcessor-309"><span class="linenos"> 309</span></a>                    <span class="n">port_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-310"><a href="#DataProcessor-310"><span class="linenos"> 310</span></a>                    <span class="n">service_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;service_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-311"><a href="#DataProcessor-311"><span class="linenos"> 311</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor-312"><a href="#DataProcessor-312"><span class="linenos"> 312</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-313"><a href="#DataProcessor-313"><span class="linenos"> 313</span></a>
</span><span id="DataProcessor-314"><a href="#DataProcessor-314"><span class="linenos"> 314</span></a>                <span class="n">processed_reputation</span><span class="p">[</span><span class="n">ip_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">dshield_rep</span>
</span><span id="DataProcessor-315"><a href="#DataProcessor-315"><span class="linenos"> 315</span></a>
</span><span id="DataProcessor-316"><a href="#DataProcessor-316"><span class="linenos"> 316</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor-317"><a href="#DataProcessor-317"><span class="linenos"> 317</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor-318"><a href="#DataProcessor-318"><span class="linenos"> 318</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-319"><a href="#DataProcessor-319"><span class="linenos"> 319</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-320"><a href="#DataProcessor-320"><span class="linenos"> 320</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-321"><a href="#DataProcessor-321"><span class="linenos"> 321</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-322"><a href="#DataProcessor-322"><span class="linenos"> 322</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor-323"><a href="#DataProcessor-323"><span class="linenos"> 323</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-324"><a href="#DataProcessor-324"><span class="linenos"> 324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-325"><a href="#DataProcessor-325"><span class="linenos"> 325</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-326"><a href="#DataProcessor-326"><span class="linenos"> 326</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-327"><a href="#DataProcessor-327"><span class="linenos"> 327</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-328"><a href="#DataProcessor-328"><span class="linenos"> 328</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-329"><a href="#DataProcessor-329"><span class="linenos"> 329</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-330"><a href="#DataProcessor-330"><span class="linenos"> 330</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor-331"><a href="#DataProcessor-331"><span class="linenos"> 331</span></a>
</span><span id="DataProcessor-332"><a href="#DataProcessor-332"><span class="linenos"> 332</span></a>        <span class="k">return</span> <span class="n">processed_reputation</span>
</span><span id="DataProcessor-333"><a href="#DataProcessor-333"><span class="linenos"> 333</span></a>
</span><span id="DataProcessor-334"><a href="#DataProcessor-334"><span class="linenos"> 334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="DataProcessor-335"><a href="#DataProcessor-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">attackers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor-336"><a href="#DataProcessor-336"><span class="linenos"> 336</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldTopAttacker</span><span class="p">]:</span>
</span><span id="DataProcessor-337"><a href="#DataProcessor-337"><span class="linenos"> 337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield top attackers data into structured format.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-338"><a href="#DataProcessor-338"><span class="linenos"> 338</span></a>        <span class="n">processed_attackers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-339"><a href="#DataProcessor-339"><span class="linenos"> 339</span></a>
</span><span id="DataProcessor-340"><a href="#DataProcessor-340"><span class="linenos"> 340</span></a>        <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">attackers</span><span class="p">:</span>
</span><span id="DataProcessor-341"><a href="#DataProcessor-341"><span class="linenos"> 341</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-342"><a href="#DataProcessor-342"><span class="linenos"> 342</span></a>                <span class="c1"># Create DShieldTopAttacker object</span>
</span><span id="DataProcessor-343"><a href="#DataProcessor-343"><span class="linenos"> 343</span></a>                <span class="n">dshield_attacker</span> <span class="o">=</span> <span class="n">DShieldTopAttacker</span><span class="p">(</span>
</span><span id="DataProcessor-344"><a href="#DataProcessor-344"><span class="linenos"> 344</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-345"><a href="#DataProcessor-345"><span class="linenos"> 345</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="DataProcessor-346"><a href="#DataProcessor-346"><span class="linenos"> 346</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-347"><a href="#DataProcessor-347"><span class="linenos"> 347</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-348"><a href="#DataProcessor-348"><span class="linenos"> 348</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-349"><a href="#DataProcessor-349"><span class="linenos"> 349</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-350"><a href="#DataProcessor-350"><span class="linenos"> 350</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-351"><a href="#DataProcessor-351"><span class="linenos"> 351</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-352"><a href="#DataProcessor-352"><span class="linenos"> 352</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-353"><a href="#DataProcessor-353"><span class="linenos"> 353</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-354"><a href="#DataProcessor-354"><span class="linenos"> 354</span></a>                    <span class="n">target_ports</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_ports&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-355"><a href="#DataProcessor-355"><span class="linenos"> 355</span></a>                    <span class="n">target_services</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_services&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-356"><a href="#DataProcessor-356"><span class="linenos"> 356</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor-357"><a href="#DataProcessor-357"><span class="linenos"> 357</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-358"><a href="#DataProcessor-358"><span class="linenos"> 358</span></a>
</span><span id="DataProcessor-359"><a href="#DataProcessor-359"><span class="linenos"> 359</span></a>                <span class="n">processed_attackers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attacker</span><span class="p">)</span>
</span><span id="DataProcessor-360"><a href="#DataProcessor-360"><span class="linenos"> 360</span></a>
</span><span id="DataProcessor-361"><a href="#DataProcessor-361"><span class="linenos"> 361</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor-362"><a href="#DataProcessor-362"><span class="linenos"> 362</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor-363"><a href="#DataProcessor-363"><span class="linenos"> 363</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-364"><a href="#DataProcessor-364"><span class="linenos"> 364</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-365"><a href="#DataProcessor-365"><span class="linenos"> 365</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-366"><a href="#DataProcessor-366"><span class="linenos"> 366</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-367"><a href="#DataProcessor-367"><span class="linenos"> 367</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor-368"><a href="#DataProcessor-368"><span class="linenos"> 368</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-369"><a href="#DataProcessor-369"><span class="linenos"> 369</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-370"><a href="#DataProcessor-370"><span class="linenos"> 370</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor-371"><a href="#DataProcessor-371"><span class="linenos"> 371</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-372"><a href="#DataProcessor-372"><span class="linenos"> 372</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-373"><a href="#DataProcessor-373"><span class="linenos"> 373</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor-374"><a href="#DataProcessor-374"><span class="linenos"> 374</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor-375"><a href="#DataProcessor-375"><span class="linenos"> 375</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor-376"><a href="#DataProcessor-376"><span class="linenos"> 376</span></a>
</span><span id="DataProcessor-377"><a href="#DataProcessor-377"><span class="linenos"> 377</span></a>        <span class="k">return</span> <span class="n">processed_attackers</span>
</span><span id="DataProcessor-378"><a href="#DataProcessor-378"><span class="linenos"> 378</span></a>
</span><span id="DataProcessor-379"><a href="#DataProcessor-379"><span class="linenos"> 379</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dshield_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">DShieldStatistics</span><span class="p">:</span>
</span><span id="DataProcessor-380"><a href="#DataProcessor-380"><span class="linenos"> 380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DShield-specific security summary.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-381"><a href="#DataProcessor-381"><span class="linenos"> 381</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-382"><a href="#DataProcessor-382"><span class="linenos"> 382</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_dshield_statistics</span><span class="p">()</span>
</span><span id="DataProcessor-383"><a href="#DataProcessor-383"><span class="linenos"> 383</span></a>
</span><span id="DataProcessor-384"><a href="#DataProcessor-384"><span class="linenos"> 384</span></a>        <span class="c1"># Extract DShield-specific data</span>
</span><span id="DataProcessor-385"><a href="#DataProcessor-385"><span class="linenos"> 385</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-386"><a href="#DataProcessor-386"><span class="linenos"> 386</span></a>
</span><span id="DataProcessor-387"><a href="#DataProcessor-387"><span class="linenos"> 387</span></a>        <span class="c1"># Compile statistics</span>
</span><span id="DataProcessor-388"><a href="#DataProcessor-388"><span class="linenos"> 388</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">DShieldStatistics</span><span class="p">(</span>
</span><span id="DataProcessor-389"><a href="#DataProcessor-389"><span class="linenos"> 389</span></a>            <span class="n">time_range_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="DataProcessor-390"><a href="#DataProcessor-390"><span class="linenos"> 390</span></a>            <span class="n">total_attacks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dshield_attacks</span><span class="p">),</span>
</span><span id="DataProcessor-391"><a href="#DataProcessor-391"><span class="linenos"> 391</span></a>            <span class="n">unique_attackers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-392"><a href="#DataProcessor-392"><span class="linenos"> 392</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-393"><a href="#DataProcessor-393"><span class="linenos"> 393</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-394"><a href="#DataProcessor-394"><span class="linenos"> 394</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-395"><a href="#DataProcessor-395"><span class="linenos"> 395</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-396"><a href="#DataProcessor-396"><span class="linenos"> 396</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="DataProcessor-397"><a href="#DataProcessor-397"><span class="linenos"> 397</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-398"><a href="#DataProcessor-398"><span class="linenos"> 398</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-399"><a href="#DataProcessor-399"><span class="linenos"> 399</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-400"><a href="#DataProcessor-400"><span class="linenos"> 400</span></a>            <span class="n">total_targets</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-401"><a href="#DataProcessor-401"><span class="linenos"> 401</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-402"><a href="#DataProcessor-402"><span class="linenos"> 402</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-403"><a href="#DataProcessor-403"><span class="linenos"> 403</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-404"><a href="#DataProcessor-404"><span class="linenos"> 404</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-405"><a href="#DataProcessor-405"><span class="linenos"> 405</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="DataProcessor-406"><a href="#DataProcessor-406"><span class="linenos"> 406</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-407"><a href="#DataProcessor-407"><span class="linenos"> 407</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-408"><a href="#DataProcessor-408"><span class="linenos"> 408</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-409"><a href="#DataProcessor-409"><span class="linenos"> 409</span></a>            <span class="n">countries_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-410"><a href="#DataProcessor-410"><span class="linenos"> 410</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-411"><a href="#DataProcessor-411"><span class="linenos"> 411</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-412"><a href="#DataProcessor-412"><span class="linenos"> 412</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-413"><a href="#DataProcessor-413"><span class="linenos"> 413</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-414"><a href="#DataProcessor-414"><span class="linenos"> 414</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-415"><a href="#DataProcessor-415"><span class="linenos"> 415</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-416"><a href="#DataProcessor-416"><span class="linenos"> 416</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-417"><a href="#DataProcessor-417"><span class="linenos"> 417</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-418"><a href="#DataProcessor-418"><span class="linenos"> 418</span></a>            <span class="n">ports_targeted</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-419"><a href="#DataProcessor-419"><span class="linenos"> 419</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-420"><a href="#DataProcessor-420"><span class="linenos"> 420</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-421"><a href="#DataProcessor-421"><span class="linenos"> 421</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-422"><a href="#DataProcessor-422"><span class="linenos"> 422</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-423"><a href="#DataProcessor-423"><span class="linenos"> 423</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-424"><a href="#DataProcessor-424"><span class="linenos"> 424</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-425"><a href="#DataProcessor-425"><span class="linenos"> 425</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-426"><a href="#DataProcessor-426"><span class="linenos"> 426</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-427"><a href="#DataProcessor-427"><span class="linenos"> 427</span></a>            <span class="n">protocols_used</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-428"><a href="#DataProcessor-428"><span class="linenos"> 428</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-429"><a href="#DataProcessor-429"><span class="linenos"> 429</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-430"><a href="#DataProcessor-430"><span class="linenos"> 430</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-431"><a href="#DataProcessor-431"><span class="linenos"> 431</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-432"><a href="#DataProcessor-432"><span class="linenos"> 432</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-433"><a href="#DataProcessor-433"><span class="linenos"> 433</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-434"><a href="#DataProcessor-434"><span class="linenos"> 434</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-435"><a href="#DataProcessor-435"><span class="linenos"> 435</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-436"><a href="#DataProcessor-436"><span class="linenos"> 436</span></a>            <span class="n">asns_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-437"><a href="#DataProcessor-437"><span class="linenos"> 437</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-438"><a href="#DataProcessor-438"><span class="linenos"> 438</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-439"><a href="#DataProcessor-439"><span class="linenos"> 439</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-440"><a href="#DataProcessor-440"><span class="linenos"> 440</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-441"><a href="#DataProcessor-441"><span class="linenos"> 441</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-442"><a href="#DataProcessor-442"><span class="linenos"> 442</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-443"><a href="#DataProcessor-443"><span class="linenos"> 443</span></a>            <span class="n">organizations_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-444"><a href="#DataProcessor-444"><span class="linenos"> 444</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-445"><a href="#DataProcessor-445"><span class="linenos"> 445</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-446"><a href="#DataProcessor-446"><span class="linenos"> 446</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-447"><a href="#DataProcessor-447"><span class="linenos"> 447</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-448"><a href="#DataProcessor-448"><span class="linenos"> 448</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-449"><a href="#DataProcessor-449"><span class="linenos"> 449</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-450"><a href="#DataProcessor-450"><span class="linenos"> 450</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-451"><a href="#DataProcessor-451"><span class="linenos"> 451</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-452"><a href="#DataProcessor-452"><span class="linenos"> 452</span></a>            <span class="n">high_reputation_ips</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">]),</span>
</span><span id="DataProcessor-453"><a href="#DataProcessor-453"><span class="linenos"> 453</span></a>            <span class="n">top_countries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_countries</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-454"><a href="#DataProcessor-454"><span class="linenos"> 454</span></a>            <span class="n">top_ports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_ports</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-455"><a href="#DataProcessor-455"><span class="linenos"> 455</span></a>            <span class="n">top_protocols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_protocols</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-456"><a href="#DataProcessor-456"><span class="linenos"> 456</span></a>            <span class="n">top_asns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_asns</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-457"><a href="#DataProcessor-457"><span class="linenos"> 457</span></a>            <span class="n">top_organizations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_organizations</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-458"><a href="#DataProcessor-458"><span class="linenos"> 458</span></a>            <span class="n">average_reputation_score</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_average_reputation</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-459"><a href="#DataProcessor-459"><span class="linenos"> 459</span></a>            <span class="n">indices_queried</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]))),</span>
</span><span id="DataProcessor-460"><a href="#DataProcessor-460"><span class="linenos"> 460</span></a>            <span class="n">query_duration_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: Calculate actual query duration</span>
</span><span id="DataProcessor-461"><a href="#DataProcessor-461"><span class="linenos"> 461</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-462"><a href="#DataProcessor-462"><span class="linenos"> 462</span></a>
</span><span id="DataProcessor-463"><a href="#DataProcessor-463"><span class="linenos"> 463</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="DataProcessor-464"><a href="#DataProcessor-464"><span class="linenos"> 464</span></a>
</span><span id="DataProcessor-465"><a href="#DataProcessor-465"><span class="linenos"> 465</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-466"><a href="#DataProcessor-466"><span class="linenos"> 466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security summary statistics with DShield enrichment.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-467"><a href="#DataProcessor-467"><span class="linenos"> 467</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-468"><a href="#DataProcessor-468"><span class="linenos"> 468</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_summary</span><span class="p">()</span>
</span><span id="DataProcessor-469"><a href="#DataProcessor-469"><span class="linenos"> 469</span></a>
</span><span id="DataProcessor-470"><a href="#DataProcessor-470"><span class="linenos"> 470</span></a>        <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-471"><a href="#DataProcessor-471"><span class="linenos"> 471</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor-472"><a href="#DataProcessor-472"><span class="linenos"> 472</span></a>            <span class="s2">&quot;time_range_hours&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="DataProcessor-473"><a href="#DataProcessor-473"><span class="linenos"> 473</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-474"><a href="#DataProcessor-474"><span class="linenos"> 474</span></a>            <span class="s2">&quot;events_by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-475"><a href="#DataProcessor-475"><span class="linenos"> 475</span></a>            <span class="s2">&quot;events_by_category&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-476"><a href="#DataProcessor-476"><span class="linenos"> 476</span></a>            <span class="s2">&quot;unique_source_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-477"><a href="#DataProcessor-477"><span class="linenos"> 477</span></a>            <span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-478"><a href="#DataProcessor-478"><span class="linenos"> 478</span></a>            <span class="s2">&quot;top_source_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-479"><a href="#DataProcessor-479"><span class="linenos"> 479</span></a>            <span class="s2">&quot;top_destination_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-480"><a href="#DataProcessor-480"><span class="linenos"> 480</span></a>            <span class="s2">&quot;high_risk_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-481"><a href="#DataProcessor-481"><span class="linenos"> 481</span></a>            <span class="s2">&quot;threat_intelligence_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-482"><a href="#DataProcessor-482"><span class="linenos"> 482</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-483"><a href="#DataProcessor-483"><span class="linenos"> 483</span></a>            <span class="s2">&quot;timeline&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-484"><a href="#DataProcessor-484"><span class="linenos"> 484</span></a>            <span class="s2">&quot;indices_queried&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-485"><a href="#DataProcessor-485"><span class="linenos"> 485</span></a>            <span class="c1"># DShield-specific statistics</span>
</span><span id="DataProcessor-486"><a href="#DataProcessor-486"><span class="linenos"> 486</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-487"><a href="#DataProcessor-487"><span class="linenos"> 487</span></a>            <span class="s2">&quot;dshield_blocks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-488"><a href="#DataProcessor-488"><span class="linenos"> 488</span></a>            <span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-489"><a href="#DataProcessor-489"><span class="linenos"> 489</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-490"><a href="#DataProcessor-490"><span class="linenos"> 490</span></a>            <span class="s2">&quot;geographic_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-491"><a href="#DataProcessor-491"><span class="linenos"> 491</span></a>            <span class="s2">&quot;port_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-492"><a href="#DataProcessor-492"><span class="linenos"> 492</span></a>            <span class="s2">&quot;asn_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-493"><a href="#DataProcessor-493"><span class="linenos"> 493</span></a>            <span class="s2">&quot;organization_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-494"><a href="#DataProcessor-494"><span class="linenos"> 494</span></a>            <span class="s2">&quot;reputation_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-495"><a href="#DataProcessor-495"><span class="linenos"> 495</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-496"><a href="#DataProcessor-496"><span class="linenos"> 496</span></a>
</span><span id="DataProcessor-497"><a href="#DataProcessor-497"><span class="linenos"> 497</span></a>        <span class="c1"># Extract unique IPs</span>
</span><span id="DataProcessor-498"><a href="#DataProcessor-498"><span class="linenos"> 498</span></a>        <span class="n">source_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-499"><a href="#DataProcessor-499"><span class="linenos"> 499</span></a>        <span class="n">destination_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-500"><a href="#DataProcessor-500"><span class="linenos"> 500</span></a>        <span class="n">ip_event_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-501"><a href="#DataProcessor-501"><span class="linenos"> 501</span></a>
</span><span id="DataProcessor-502"><a href="#DataProcessor-502"><span class="linenos"> 502</span></a>        <span class="c1"># Process events</span>
</span><span id="DataProcessor-503"><a href="#DataProcessor-503"><span class="linenos"> 503</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-504"><a href="#DataProcessor-504"><span class="linenos"> 504</span></a>            <span class="c1"># Count by severity</span>
</span><span id="DataProcessor-505"><a href="#DataProcessor-505"><span class="linenos"> 505</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-506"><a href="#DataProcessor-506"><span class="linenos"> 506</span></a>            <span class="c1"># Ensure severity is hashable</span>
</span><span id="DataProcessor-507"><a href="#DataProcessor-507"><span class="linenos"> 507</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-508"><a href="#DataProcessor-508"><span class="linenos"> 508</span></a>                <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
</span><span id="DataProcessor-509"><a href="#DataProcessor-509"><span class="linenos"> 509</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">][</span><span class="n">severity</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataProcessor-510"><a href="#DataProcessor-510"><span class="linenos"> 510</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DataProcessor-511"><a href="#DataProcessor-511"><span class="linenos"> 511</span></a>            <span class="p">)</span>
</span><span id="DataProcessor-512"><a href="#DataProcessor-512"><span class="linenos"> 512</span></a>
</span><span id="DataProcessor-513"><a href="#DataProcessor-513"><span class="linenos"> 513</span></a>            <span class="c1"># Count by category</span>
</span><span id="DataProcessor-514"><a href="#DataProcessor-514"><span class="linenos"> 514</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-515"><a href="#DataProcessor-515"><span class="linenos"> 515</span></a>            <span class="c1"># Ensure category is hashable</span>
</span><span id="DataProcessor-516"><a href="#DataProcessor-516"><span class="linenos"> 516</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-517"><a href="#DataProcessor-517"><span class="linenos"> 517</span></a>                <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="DataProcessor-518"><a href="#DataProcessor-518"><span class="linenos"> 518</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataProcessor-519"><a href="#DataProcessor-519"><span class="linenos"> 519</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DataProcessor-520"><a href="#DataProcessor-520"><span class="linenos"> 520</span></a>            <span class="p">)</span>
</span><span id="DataProcessor-521"><a href="#DataProcessor-521"><span class="linenos"> 521</span></a>
</span><span id="DataProcessor-522"><a href="#DataProcessor-522"><span class="linenos"> 522</span></a>            <span class="c1"># Track IPs - ensure they are hashable</span>
</span><span id="DataProcessor-523"><a href="#DataProcessor-523"><span class="linenos"> 523</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-524"><a href="#DataProcessor-524"><span class="linenos"> 524</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="DataProcessor-525"><a href="#DataProcessor-525"><span class="linenos"> 525</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-526"><a href="#DataProcessor-526"><span class="linenos"> 526</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor-527"><a href="#DataProcessor-527"><span class="linenos"> 527</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-528"><a href="#DataProcessor-528"><span class="linenos"> 528</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor-529"><a href="#DataProcessor-529"><span class="linenos"> 529</span></a>                <span class="n">source_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_ip_str</span><span class="p">)</span>
</span><span id="DataProcessor-530"><a href="#DataProcessor-530"><span class="linenos"> 530</span></a>                <span class="n">ip_event_counts</span><span class="p">[</span><span class="n">source_ip_str</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-531"><a href="#DataProcessor-531"><span class="linenos"> 531</span></a>
</span><span id="DataProcessor-532"><a href="#DataProcessor-532"><span class="linenos"> 532</span></a>            <span class="n">destination_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-533"><a href="#DataProcessor-533"><span class="linenos"> 533</span></a>            <span class="k">if</span> <span class="n">destination_ip</span><span class="p">:</span>
</span><span id="DataProcessor-534"><a href="#DataProcessor-534"><span class="linenos"> 534</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-535"><a href="#DataProcessor-535"><span class="linenos"> 535</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="DataProcessor-536"><a href="#DataProcessor-536"><span class="linenos"> 536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-537"><a href="#DataProcessor-537"><span class="linenos"> 537</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="DataProcessor-538"><a href="#DataProcessor-538"><span class="linenos"> 538</span></a>                <span class="n">destination_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">destination_ip_str</span><span class="p">)</span>
</span><span id="DataProcessor-539"><a href="#DataProcessor-539"><span class="linenos"> 539</span></a>
</span><span id="DataProcessor-540"><a href="#DataProcessor-540"><span class="linenos"> 540</span></a>            <span class="c1"># Count high-risk events</span>
</span><span id="DataProcessor-541"><a href="#DataProcessor-541"><span class="linenos"> 541</span></a>            <span class="k">if</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]:</span>
</span><span id="DataProcessor-542"><a href="#DataProcessor-542"><span class="linenos"> 542</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;high_risk_events&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-543"><a href="#DataProcessor-543"><span class="linenos"> 543</span></a>
</span><span id="DataProcessor-544"><a href="#DataProcessor-544"><span class="linenos"> 544</span></a>            <span class="c1"># DShield-specific counting</span>
</span><span id="DataProcessor-545"><a href="#DataProcessor-545"><span class="linenos"> 545</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">:</span>
</span><span id="DataProcessor-546"><a href="#DataProcessor-546"><span class="linenos"> 546</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_attacks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-547"><a href="#DataProcessor-547"><span class="linenos"> 547</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
</span><span id="DataProcessor-548"><a href="#DataProcessor-548"><span class="linenos"> 548</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_blocks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-549"><a href="#DataProcessor-549"><span class="linenos"> 549</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">:</span>
</span><span id="DataProcessor-550"><a href="#DataProcessor-550"><span class="linenos"> 550</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-551"><a href="#DataProcessor-551"><span class="linenos"> 551</span></a>
</span><span id="DataProcessor-552"><a href="#DataProcessor-552"><span class="linenos"> 552</span></a>            <span class="c1"># Track indices</span>
</span><span id="DataProcessor-553"><a href="#DataProcessor-553"><span class="linenos"> 553</span></a>            <span class="k">if</span> <span class="s2">&quot;indices&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
</span><span id="DataProcessor-554"><a href="#DataProcessor-554"><span class="linenos"> 554</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-555"><a href="#DataProcessor-555"><span class="linenos"> 555</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor-556"><a href="#DataProcessor-556"><span class="linenos"> 556</span></a>                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span><span id="DataProcessor-557"><a href="#DataProcessor-557"><span class="linenos"> 557</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-558"><a href="#DataProcessor-558"><span class="linenos"> 558</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="DataProcessor-559"><a href="#DataProcessor-559"><span class="linenos"> 559</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-560"><a href="#DataProcessor-560"><span class="linenos"> 560</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="DataProcessor-561"><a href="#DataProcessor-561"><span class="linenos"> 561</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-562"><a href="#DataProcessor-562"><span class="linenos"> 562</span></a>                    <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
</span><span id="DataProcessor-563"><a href="#DataProcessor-563"><span class="linenos"> 563</span></a>
</span><span id="DataProcessor-564"><a href="#DataProcessor-564"><span class="linenos"> 564</span></a>        <span class="c1"># Update summary with IP statistics</span>
</span><span id="DataProcessor-565"><a href="#DataProcessor-565"><span class="linenos"> 565</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_ips</span><span class="p">)</span>
</span><span id="DataProcessor-566"><a href="#DataProcessor-566"><span class="linenos"> 566</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">destination_ips</span><span class="p">)</span>
</span><span id="DataProcessor-567"><a href="#DataProcessor-567"><span class="linenos"> 567</span></a>
</span><span id="DataProcessor-568"><a href="#DataProcessor-568"><span class="linenos"> 568</span></a>        <span class="c1"># Get top source IPs</span>
</span><span id="DataProcessor-569"><a href="#DataProcessor-569"><span class="linenos"> 569</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;top_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataProcessor-570"><a href="#DataProcessor-570"><span class="linenos"> 570</span></a>            <span class="p">{</span><span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_event_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="DataProcessor-571"><a href="#DataProcessor-571"><span class="linenos"> 571</span></a>        <span class="p">]</span>
</span><span id="DataProcessor-572"><a href="#DataProcessor-572"><span class="linenos"> 572</span></a>
</span><span id="DataProcessor-573"><a href="#DataProcessor-573"><span class="linenos"> 573</span></a>        <span class="c1"># Generate DShield-specific distributions</span>
</span><span id="DataProcessor-574"><a href="#DataProcessor-574"><span class="linenos"> 574</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;geographic_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geographic_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-575"><a href="#DataProcessor-575"><span class="linenos"> 575</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;port_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_port_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-576"><a href="#DataProcessor-576"><span class="linenos"> 576</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;asn_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_asn_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-577"><a href="#DataProcessor-577"><span class="linenos"> 577</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;organization_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_organization_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-578"><a href="#DataProcessor-578"><span class="linenos"> 578</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;reputation_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reputation_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-579"><a href="#DataProcessor-579"><span class="linenos"> 579</span></a>
</span><span id="DataProcessor-580"><a href="#DataProcessor-580"><span class="linenos"> 580</span></a>        <span class="c1"># Generate timeline</span>
</span><span id="DataProcessor-581"><a href="#DataProcessor-581"><span class="linenos"> 581</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;timeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_timeline</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-582"><a href="#DataProcessor-582"><span class="linenos"> 582</span></a>
</span><span id="DataProcessor-583"><a href="#DataProcessor-583"><span class="linenos"> 583</span></a>        <span class="c1"># Detect attack patterns</span>
</span><span id="DataProcessor-584"><a href="#DataProcessor-584"><span class="linenos"> 584</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-585"><a href="#DataProcessor-585"><span class="linenos"> 585</span></a>
</span><span id="DataProcessor-586"><a href="#DataProcessor-586"><span class="linenos"> 586</span></a>        <span class="c1"># Remove duplicates from indices</span>
</span><span id="DataProcessor-587"><a href="#DataProcessor-587"><span class="linenos"> 587</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]))</span>
</span><span id="DataProcessor-588"><a href="#DataProcessor-588"><span class="linenos"> 588</span></a>
</span><span id="DataProcessor-589"><a href="#DataProcessor-589"><span class="linenos"> 589</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="DataProcessor-590"><a href="#DataProcessor-590"><span class="linenos"> 590</span></a>
</span><span id="DataProcessor-591"><a href="#DataProcessor-591"><span class="linenos"> 591</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_attack_report</span><span class="p">(</span>
</span><span id="DataProcessor-592"><a href="#DataProcessor-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DataProcessor-593"><a href="#DataProcessor-593"><span class="linenos"> 593</span></a>        <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="DataProcessor-594"><a href="#DataProcessor-594"><span class="linenos"> 594</span></a>        <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor-595"><a href="#DataProcessor-595"><span class="linenos"> 595</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-596"><a href="#DataProcessor-596"><span class="linenos"> 596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate structured attack report with DShield data.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-597"><a href="#DataProcessor-597"><span class="linenos"> 597</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-598"><a href="#DataProcessor-598"><span class="linenos"> 598</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_attack_report</span><span class="p">()</span>
</span><span id="DataProcessor-599"><a href="#DataProcessor-599"><span class="linenos"> 599</span></a>
</span><span id="DataProcessor-600"><a href="#DataProcessor-600"><span class="linenos"> 600</span></a>        <span class="n">threat_intelligence</span> <span class="o">=</span> <span class="n">threat_intelligence</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="DataProcessor-601"><a href="#DataProcessor-601"><span class="linenos"> 601</span></a>
</span><span id="DataProcessor-602"><a href="#DataProcessor-602"><span class="linenos"> 602</span></a>        <span class="c1"># Generate report ID</span>
</span><span id="DataProcessor-603"><a href="#DataProcessor-603"><span class="linenos"> 603</span></a>        <span class="n">report_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DataProcessor-604"><a href="#DataProcessor-604"><span class="linenos"> 604</span></a>
</span><span id="DataProcessor-605"><a href="#DataProcessor-605"><span class="linenos"> 605</span></a>        <span class="c1"># Analyze events</span>
</span><span id="DataProcessor-606"><a href="#DataProcessor-606"><span class="linenos"> 606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-607"><a href="#DataProcessor-607"><span class="linenos"> 607</span></a>
</span><span id="DataProcessor-608"><a href="#DataProcessor-608"><span class="linenos"> 608</span></a>        <span class="c1"># Extract threat indicators</span>
</span><span id="DataProcessor-609"><a href="#DataProcessor-609"><span class="linenos"> 609</span></a>        <span class="n">threat_indicators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_threat_indicators</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">)</span>
</span><span id="DataProcessor-610"><a href="#DataProcessor-610"><span class="linenos"> 610</span></a>
</span><span id="DataProcessor-611"><a href="#DataProcessor-611"><span class="linenos"> 611</span></a>        <span class="c1"># Identify attack vectors</span>
</span><span id="DataProcessor-612"><a href="#DataProcessor-612"><span class="linenos"> 612</span></a>        <span class="n">attack_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_attack_vectors</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-613"><a href="#DataProcessor-613"><span class="linenos"> 613</span></a>
</span><span id="DataProcessor-614"><a href="#DataProcessor-614"><span class="linenos"> 614</span></a>        <span class="c1"># Determine affected systems</span>
</span><span id="DataProcessor-615"><a href="#DataProcessor-615"><span class="linenos"> 615</span></a>        <span class="n">affected_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_affected_systems</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-616"><a href="#DataProcessor-616"><span class="linenos"> 616</span></a>
</span><span id="DataProcessor-617"><a href="#DataProcessor-617"><span class="linenos"> 617</span></a>        <span class="c1"># Assess impact</span>
</span><span id="DataProcessor-618"><a href="#DataProcessor-618"><span class="linenos"> 618</span></a>        <span class="n">impact_assessment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_impact</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">)</span>
</span><span id="DataProcessor-619"><a href="#DataProcessor-619"><span class="linenos"> 619</span></a>
</span><span id="DataProcessor-620"><a href="#DataProcessor-620"><span class="linenos"> 620</span></a>        <span class="c1"># Generate recommendations</span>
</span><span id="DataProcessor-621"><a href="#DataProcessor-621"><span class="linenos"> 621</span></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">(</span>
</span><span id="DataProcessor-622"><a href="#DataProcessor-622"><span class="linenos"> 622</span></a>            <span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">,</span> <span class="n">impact_assessment</span>
</span><span id="DataProcessor-623"><a href="#DataProcessor-623"><span class="linenos"> 623</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-624"><a href="#DataProcessor-624"><span class="linenos"> 624</span></a>
</span><span id="DataProcessor-625"><a href="#DataProcessor-625"><span class="linenos"> 625</span></a>        <span class="c1"># Process DShield-specific data</span>
</span><span id="DataProcessor-626"><a href="#DataProcessor-626"><span class="linenos"> 626</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_attacks</span><span class="p">(</span>
</span><span id="DataProcessor-627"><a href="#DataProcessor-627"><span class="linenos"> 627</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-628"><a href="#DataProcessor-628"><span class="linenos"> 628</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-629"><a href="#DataProcessor-629"><span class="linenos"> 629</span></a>        <span class="n">dshield_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_reputation</span><span class="p">(</span>
</span><span id="DataProcessor-630"><a href="#DataProcessor-630"><span class="linenos"> 630</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-631"><a href="#DataProcessor-631"><span class="linenos"> 631</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-632"><a href="#DataProcessor-632"><span class="linenos"> 632</span></a>        <span class="n">top_attackers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="DataProcessor-633"><a href="#DataProcessor-633"><span class="linenos"> 633</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="DataProcessor-634"><a href="#DataProcessor-634"><span class="linenos"> 634</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-635"><a href="#DataProcessor-635"><span class="linenos"> 635</span></a>
</span><span id="DataProcessor-636"><a href="#DataProcessor-636"><span class="linenos"> 636</span></a>        <span class="c1"># Create attack report</span>
</span><span id="DataProcessor-637"><a href="#DataProcessor-637"><span class="linenos"> 637</span></a>        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-638"><a href="#DataProcessor-638"><span class="linenos"> 638</span></a>            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">,</span>
</span><span id="DataProcessor-639"><a href="#DataProcessor-639"><span class="linenos"> 639</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor-640"><a href="#DataProcessor-640"><span class="linenos"> 640</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Security Incident Report - </span><span class="si">{</span><span class="n">report_id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-641"><a href="#DataProcessor-641"><span class="linenos"> 641</span></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_executive_summary</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="DataProcessor-642"><a href="#DataProcessor-642"><span class="linenos"> 642</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-643"><a href="#DataProcessor-643"><span class="linenos"> 643</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-644"><a href="#DataProcessor-644"><span class="linenos"> 644</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor-645"><a href="#DataProcessor-645"><span class="linenos"> 645</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-646"><a href="#DataProcessor-646"><span class="linenos"> 646</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-647"><a href="#DataProcessor-647"><span class="linenos"> 647</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-648"><a href="#DataProcessor-648"><span class="linenos"> 648</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-649"><a href="#DataProcessor-649"><span class="linenos"> 649</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-650"><a href="#DataProcessor-650"><span class="linenos"> 650</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-651"><a href="#DataProcessor-651"><span class="linenos"> 651</span></a>            <span class="p">),</span>
</span><span id="DataProcessor-652"><a href="#DataProcessor-652"><span class="linenos"> 652</span></a>            <span class="s2">&quot;time_range&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time_range</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-653"><a href="#DataProcessor-653"><span class="linenos"> 653</span></a>            <span class="s2">&quot;threat_indicators&quot;</span><span class="p">:</span> <span class="n">threat_indicators</span><span class="p">,</span>
</span><span id="DataProcessor-654"><a href="#DataProcessor-654"><span class="linenos"> 654</span></a>            <span class="s2">&quot;high_risk_ips&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_high_risk_ips</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="DataProcessor-655"><a href="#DataProcessor-655"><span class="linenos"> 655</span></a>            <span class="s2">&quot;attack_vectors&quot;</span><span class="p">:</span> <span class="n">attack_vectors</span><span class="p">,</span>
</span><span id="DataProcessor-656"><a href="#DataProcessor-656"><span class="linenos"> 656</span></a>            <span class="s2">&quot;affected_systems&quot;</span><span class="p">:</span> <span class="n">affected_systems</span><span class="p">,</span>
</span><span id="DataProcessor-657"><a href="#DataProcessor-657"><span class="linenos"> 657</span></a>            <span class="s2">&quot;impact_assessment&quot;</span><span class="p">:</span> <span class="n">impact_assessment</span><span class="p">,</span>
</span><span id="DataProcessor-658"><a href="#DataProcessor-658"><span class="linenos"> 658</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attack</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">dshield_attacks</span><span class="p">],</span>
</span><span id="DataProcessor-659"><a href="#DataProcessor-659"><span class="linenos"> 659</span></a>            <span class="s2">&quot;dshield_reputation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">rep</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">dshield_reputation</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="DataProcessor-660"><a href="#DataProcessor-660"><span class="linenos"> 660</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attacker</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">top_attackers</span><span class="p">],</span>
</span><span id="DataProcessor-661"><a href="#DataProcessor-661"><span class="linenos"> 661</span></a>            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="n">recommendations</span><span class="p">,</span>
</span><span id="DataProcessor-662"><a href="#DataProcessor-662"><span class="linenos"> 662</span></a>            <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_mitigation_actions</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="DataProcessor-663"><a href="#DataProcessor-663"><span class="linenos"> 663</span></a>            <span class="s2">&quot;confidence_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_confidence_level</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="DataProcessor-664"><a href="#DataProcessor-664"><span class="linenos"> 664</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_tags</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-665"><a href="#DataProcessor-665"><span class="linenos"> 665</span></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
</span><span id="DataProcessor-666"><a href="#DataProcessor-666"><span class="linenos"> 666</span></a>            <span class="s2">&quot;threat_intelligence&quot;</span><span class="p">:</span> <span class="n">threat_intelligence</span><span class="p">,</span>
</span><span id="DataProcessor-667"><a href="#DataProcessor-667"><span class="linenos"> 667</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-668"><a href="#DataProcessor-668"><span class="linenos"> 668</span></a>
</span><span id="DataProcessor-669"><a href="#DataProcessor-669"><span class="linenos"> 669</span></a>        <span class="k">return</span> <span class="n">report</span>
</span><span id="DataProcessor-670"><a href="#DataProcessor-670"><span class="linenos"> 670</span></a>
</span><span id="DataProcessor-671"><a href="#DataProcessor-671"><span class="linenos"> 671</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_unique_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-672"><a href="#DataProcessor-672"><span class="linenos"> 672</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract unique IP addresses from events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-673"><a href="#DataProcessor-673"><span class="linenos"> 673</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-674"><a href="#DataProcessor-674"><span class="linenos"> 674</span></a>
</span><span id="DataProcessor-675"><a href="#DataProcessor-675"><span class="linenos"> 675</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-676"><a href="#DataProcessor-676"><span class="linenos"> 676</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-677"><a href="#DataProcessor-677"><span class="linenos"> 677</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor-678"><a href="#DataProcessor-678"><span class="linenos"> 678</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-679"><a href="#DataProcessor-679"><span class="linenos"> 679</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-680"><a href="#DataProcessor-680"><span class="linenos"> 680</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-681"><a href="#DataProcessor-681"><span class="linenos"> 681</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-682"><a href="#DataProcessor-682"><span class="linenos"> 682</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-683"><a href="#DataProcessor-683"><span class="linenos"> 683</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor-684"><a href="#DataProcessor-684"><span class="linenos"> 684</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-685"><a href="#DataProcessor-685"><span class="linenos"> 685</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-686"><a href="#DataProcessor-686"><span class="linenos"> 686</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-687"><a href="#DataProcessor-687"><span class="linenos"> 687</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-688"><a href="#DataProcessor-688"><span class="linenos"> 688</span></a>
</span><span id="DataProcessor-689"><a href="#DataProcessor-689"><span class="linenos"> 689</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">)</span>
</span><span id="DataProcessor-690"><a href="#DataProcessor-690"><span class="linenos"> 690</span></a>
</span><span id="DataProcessor-691"><a href="#DataProcessor-691"><span class="linenos"> 691</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-692"><a href="#DataProcessor-692"><span class="linenos"> 692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize event data structure.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-693"><a href="#DataProcessor-693"><span class="linenos"> 693</span></a>        <span class="c1"># Ensure severity and category are strings before using as dictionary keys</span>
</span><span id="DataProcessor-694"><a href="#DataProcessor-694"><span class="linenos"> 694</span></a>        <span class="n">severity_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-695"><a href="#DataProcessor-695"><span class="linenos"> 695</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-696"><a href="#DataProcessor-696"><span class="linenos"> 696</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">)</span>
</span><span id="DataProcessor-697"><a href="#DataProcessor-697"><span class="linenos"> 697</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-698"><a href="#DataProcessor-698"><span class="linenos"> 698</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity_raw</span><span class="p">)</span>
</span><span id="DataProcessor-699"><a href="#DataProcessor-699"><span class="linenos"> 699</span></a>
</span><span id="DataProcessor-700"><a href="#DataProcessor-700"><span class="linenos"> 700</span></a>        <span class="n">category_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-701"><a href="#DataProcessor-701"><span class="linenos"> 701</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_raw</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-702"><a href="#DataProcessor-702"><span class="linenos"> 702</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category_raw</span><span class="p">)</span>
</span><span id="DataProcessor-703"><a href="#DataProcessor-703"><span class="linenos"> 703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-704"><a href="#DataProcessor-704"><span class="linenos"> 704</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category_raw</span><span class="p">)</span>
</span><span id="DataProcessor-705"><a href="#DataProcessor-705"><span class="linenos"> 705</span></a>
</span><span id="DataProcessor-706"><a href="#DataProcessor-706"><span class="linenos"> 706</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor-707"><a href="#DataProcessor-707"><span class="linenos"> 707</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
</span><span id="DataProcessor-708"><a href="#DataProcessor-708"><span class="linenos"> 708</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)),</span>
</span><span id="DataProcessor-709"><a href="#DataProcessor-709"><span class="linenos"> 709</span></a>            <span class="s2">&quot;source_ip&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-710"><a href="#DataProcessor-710"><span class="linenos"> 710</span></a>            <span class="s2">&quot;destination_ip&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-711"><a href="#DataProcessor-711"><span class="linenos"> 711</span></a>            <span class="s2">&quot;source_port&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-712"><a href="#DataProcessor-712"><span class="linenos"> 712</span></a>            <span class="s2">&quot;destination_port&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-713"><a href="#DataProcessor-713"><span class="linenos"> 713</span></a>            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-714"><a href="#DataProcessor-714"><span class="linenos"> 714</span></a>            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-715"><a href="#DataProcessor-715"><span class="linenos"> 715</span></a>            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataProcessor-716"><a href="#DataProcessor-716"><span class="linenos"> 716</span></a>                <span class="n">severity</span><span class="p">,</span>
</span><span id="DataProcessor-717"><a href="#DataProcessor-717"><span class="linenos"> 717</span></a>                <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor-718"><a href="#DataProcessor-718"><span class="linenos"> 718</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="DataProcessor-719"><a href="#DataProcessor-719"><span class="linenos"> 719</span></a>            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_category_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataProcessor-720"><a href="#DataProcessor-720"><span class="linenos"> 720</span></a>                <span class="n">category</span><span class="p">,</span>
</span><span id="DataProcessor-721"><a href="#DataProcessor-721"><span class="linenos"> 721</span></a>                <span class="n">EventCategory</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
</span><span id="DataProcessor-722"><a href="#DataProcessor-722"><span class="linenos"> 722</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="DataProcessor-723"><a href="#DataProcessor-723"><span class="linenos"> 723</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-724"><a href="#DataProcessor-724"><span class="linenos"> 724</span></a>            <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-725"><a href="#DataProcessor-725"><span class="linenos"> 725</span></a>            <span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-726"><a href="#DataProcessor-726"><span class="linenos"> 726</span></a>            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-727"><a href="#DataProcessor-727"><span class="linenos"> 727</span></a>            <span class="s2">&quot;reputation_score&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-728"><a href="#DataProcessor-728"><span class="linenos"> 728</span></a>            <span class="s2">&quot;attack_count&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-729"><a href="#DataProcessor-729"><span class="linenos"> 729</span></a>            <span class="s2">&quot;first_seen&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-730"><a href="#DataProcessor-730"><span class="linenos"> 730</span></a>            <span class="s2">&quot;last_seen&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-731"><a href="#DataProcessor-731"><span class="linenos"> 731</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-732"><a href="#DataProcessor-732"><span class="linenos"> 732</span></a>            <span class="s2">&quot;attack_types&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-733"><a href="#DataProcessor-733"><span class="linenos"> 733</span></a>            <span class="s2">&quot;raw_data&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor-734"><a href="#DataProcessor-734"><span class="linenos"> 734</span></a>            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor-735"><a href="#DataProcessor-735"><span class="linenos"> 735</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-736"><a href="#DataProcessor-736"><span class="linenos"> 736</span></a>
</span><span id="DataProcessor-737"><a href="#DataProcessor-737"><span class="linenos"> 737</span></a>        <span class="k">return</span> <span class="n">normalized</span>
</span><span id="DataProcessor-738"><a href="#DataProcessor-738"><span class="linenos"> 738</span></a>
</span><span id="DataProcessor-739"><a href="#DataProcessor-739"><span class="linenos"> 739</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_enrich_dshield_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-740"><a href="#DataProcessor-740"><span class="linenos"> 740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enrich event with DShield-specific data.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-741"><a href="#DataProcessor-741"><span class="linenos"> 741</span></a>        <span class="c1"># Add threat level based on reputation score</span>
</span><span id="DataProcessor-742"><a href="#DataProcessor-742"><span class="linenos"> 742</span></a>        <span class="n">reputation_score</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-743"><a href="#DataProcessor-743"><span class="linenos"> 743</span></a>        <span class="k">if</span> <span class="n">reputation_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-744"><a href="#DataProcessor-744"><span class="linenos"> 744</span></a>            <span class="k">if</span> <span class="n">reputation_score</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="DataProcessor-745"><a href="#DataProcessor-745"><span class="linenos"> 745</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
</span><span id="DataProcessor-746"><a href="#DataProcessor-746"><span class="linenos"> 746</span></a>            <span class="k">elif</span> <span class="n">reputation_score</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="DataProcessor-747"><a href="#DataProcessor-747"><span class="linenos"> 747</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
</span><span id="DataProcessor-748"><a href="#DataProcessor-748"><span class="linenos"> 748</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-749"><a href="#DataProcessor-749"><span class="linenos"> 749</span></a>                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;low&quot;</span>
</span><span id="DataProcessor-750"><a href="#DataProcessor-750"><span class="linenos"> 750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-751"><a href="#DataProcessor-751"><span class="linenos"> 751</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threat_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="DataProcessor-752"><a href="#DataProcessor-752"><span class="linenos"> 752</span></a>
</span><span id="DataProcessor-753"><a href="#DataProcessor-753"><span class="linenos"> 753</span></a>        <span class="c1"># Add geographic context</span>
</span><span id="DataProcessor-754"><a href="#DataProcessor-754"><span class="linenos"> 754</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-755"><a href="#DataProcessor-755"><span class="linenos"> 755</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;geographic_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Attacker from </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataProcessor-756"><a href="#DataProcessor-756"><span class="linenos"> 756</span></a>
</span><span id="DataProcessor-757"><a href="#DataProcessor-757"><span class="linenos"> 757</span></a>        <span class="c1"># Add ASN context</span>
</span><span id="DataProcessor-758"><a href="#DataProcessor-758"><span class="linenos"> 758</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-759"><a href="#DataProcessor-759"><span class="linenos"> 759</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ASN: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;asn&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataProcessor-760"><a href="#DataProcessor-760"><span class="linenos"> 760</span></a>
</span><span id="DataProcessor-761"><a href="#DataProcessor-761"><span class="linenos"> 761</span></a>        <span class="c1"># Add organization context</span>
</span><span id="DataProcessor-762"><a href="#DataProcessor-762"><span class="linenos"> 762</span></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-763"><a href="#DataProcessor-763"><span class="linenos"> 763</span></a>            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Organization: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataProcessor-764"><a href="#DataProcessor-764"><span class="linenos"> 764</span></a>
</span><span id="DataProcessor-765"><a href="#DataProcessor-765"><span class="linenos"> 765</span></a>        <span class="k">return</span> <span class="n">event</span>
</span><span id="DataProcessor-766"><a href="#DataProcessor-766"><span class="linenos"> 766</span></a>
</span><span id="DataProcessor-767"><a href="#DataProcessor-767"><span class="linenos"> 767</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_attack_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-768"><a href="#DataProcessor-768"><span class="linenos"> 768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect attack patterns in events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-769"><a href="#DataProcessor-769"><span class="linenos"> 769</span></a>        <span class="n">pattern_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-770"><a href="#DataProcessor-770"><span class="linenos"> 770</span></a>
</span><span id="DataProcessor-771"><a href="#DataProcessor-771"><span class="linenos"> 771</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-772"><a href="#DataProcessor-772"><span class="linenos"> 772</span></a>            <span class="c1"># Robustly handle both strings and lists for description and event_type</span>
</span><span id="DataProcessor-773"><a href="#DataProcessor-773"><span class="linenos"> 773</span></a>            <span class="n">description_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-774"><a href="#DataProcessor-774"><span class="linenos"> 774</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description_raw</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor-775"><a href="#DataProcessor-775"><span class="linenos"> 775</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">description_raw</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DataProcessor-776"><a href="#DataProcessor-776"><span class="linenos"> 776</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-777"><a href="#DataProcessor-777"><span class="linenos"> 777</span></a>                <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description_raw</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DataProcessor-778"><a href="#DataProcessor-778"><span class="linenos"> 778</span></a>
</span><span id="DataProcessor-779"><a href="#DataProcessor-779"><span class="linenos"> 779</span></a>            <span class="n">event_type_raw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-780"><a href="#DataProcessor-780"><span class="linenos"> 780</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_type_raw</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor-781"><a href="#DataProcessor-781"><span class="linenos"> 781</span></a>                <span class="n">event_type</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">event_type_raw</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DataProcessor-782"><a href="#DataProcessor-782"><span class="linenos"> 782</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-783"><a href="#DataProcessor-783"><span class="linenos"> 783</span></a>                <span class="n">event_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_type_raw</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DataProcessor-784"><a href="#DataProcessor-784"><span class="linenos"> 784</span></a>
</span><span id="DataProcessor-785"><a href="#DataProcessor-785"><span class="linenos"> 785</span></a>            <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dshield_attack_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DataProcessor-786"><a href="#DataProcessor-786"><span class="linenos"> 786</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">description</span> <span class="ow">or</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">event_type</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">):</span>
</span><span id="DataProcessor-787"><a href="#DataProcessor-787"><span class="linenos"> 787</span></a>                    <span class="n">pattern_counts</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-788"><a href="#DataProcessor-788"><span class="linenos"> 788</span></a>
</span><span id="DataProcessor-789"><a href="#DataProcessor-789"><span class="linenos"> 789</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pattern_counts</span><span class="p">)</span>
</span><span id="DataProcessor-790"><a href="#DataProcessor-790"><span class="linenos"> 790</span></a>
</span><span id="DataProcessor-791"><a href="#DataProcessor-791"><span class="linenos"> 791</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-792"><a href="#DataProcessor-792"><span class="linenos"> 792</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top countries by attack count.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-793"><a href="#DataProcessor-793"><span class="linenos"> 793</span></a>        <span class="n">country_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-794"><a href="#DataProcessor-794"><span class="linenos"> 794</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-795"><a href="#DataProcessor-795"><span class="linenos"> 795</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-796"><a href="#DataProcessor-796"><span class="linenos"> 796</span></a>                <span class="n">country_counts</span><span class="p">[</span>
</span><span id="DataProcessor-797"><a href="#DataProcessor-797"><span class="linenos"> 797</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-798"><a href="#DataProcessor-798"><span class="linenos"> 798</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-799"><a href="#DataProcessor-799"><span class="linenos"> 799</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-800"><a href="#DataProcessor-800"><span class="linenos"> 800</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-801"><a href="#DataProcessor-801"><span class="linenos"> 801</span></a>
</span><span id="DataProcessor-802"><a href="#DataProcessor-802"><span class="linenos"> 802</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="DataProcessor-803"><a href="#DataProcessor-803"><span class="linenos"> 803</span></a>            <span class="p">{</span><span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">country</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
</span><span id="DataProcessor-804"><a href="#DataProcessor-804"><span class="linenos"> 804</span></a>            <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">country_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="DataProcessor-805"><a href="#DataProcessor-805"><span class="linenos"> 805</span></a>        <span class="p">]</span>
</span><span id="DataProcessor-806"><a href="#DataProcessor-806"><span class="linenos"> 806</span></a>
</span><span id="DataProcessor-807"><a href="#DataProcessor-807"><span class="linenos"> 807</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-808"><a href="#DataProcessor-808"><span class="linenos"> 808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top ports by attack count.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-809"><a href="#DataProcessor-809"><span class="linenos"> 809</span></a>        <span class="n">port_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-810"><a href="#DataProcessor-810"><span class="linenos"> 810</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-811"><a href="#DataProcessor-811"><span class="linenos"> 811</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-812"><a href="#DataProcessor-812"><span class="linenos"> 812</span></a>                <span class="n">port_counts</span><span class="p">[</span>
</span><span id="DataProcessor-813"><a href="#DataProcessor-813"><span class="linenos"> 813</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-814"><a href="#DataProcessor-814"><span class="linenos"> 814</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-815"><a href="#DataProcessor-815"><span class="linenos"> 815</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-816"><a href="#DataProcessor-816"><span class="linenos"> 816</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-817"><a href="#DataProcessor-817"><span class="linenos"> 817</span></a>
</span><span id="DataProcessor-818"><a href="#DataProcessor-818"><span class="linenos"> 818</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">port</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">port_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="DataProcessor-819"><a href="#DataProcessor-819"><span class="linenos"> 819</span></a>
</span><span id="DataProcessor-820"><a href="#DataProcessor-820"><span class="linenos"> 820</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_protocols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-821"><a href="#DataProcessor-821"><span class="linenos"> 821</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top protocols by attack count.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-822"><a href="#DataProcessor-822"><span class="linenos"> 822</span></a>        <span class="n">protocol_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-823"><a href="#DataProcessor-823"><span class="linenos"> 823</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-824"><a href="#DataProcessor-824"><span class="linenos"> 824</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-825"><a href="#DataProcessor-825"><span class="linenos"> 825</span></a>                <span class="n">protocol_counts</span><span class="p">[</span>
</span><span id="DataProcessor-826"><a href="#DataProcessor-826"><span class="linenos"> 826</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-827"><a href="#DataProcessor-827"><span class="linenos"> 827</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-828"><a href="#DataProcessor-828"><span class="linenos"> 828</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-829"><a href="#DataProcessor-829"><span class="linenos"> 829</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-830"><a href="#DataProcessor-830"><span class="linenos"> 830</span></a>
</span><span id="DataProcessor-831"><a href="#DataProcessor-831"><span class="linenos"> 831</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="DataProcessor-832"><a href="#DataProcessor-832"><span class="linenos"> 832</span></a>            <span class="p">{</span><span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">protocol</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
</span><span id="DataProcessor-833"><a href="#DataProcessor-833"><span class="linenos"> 833</span></a>            <span class="k">for</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">protocol_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="DataProcessor-834"><a href="#DataProcessor-834"><span class="linenos"> 834</span></a>        <span class="p">]</span>
</span><span id="DataProcessor-835"><a href="#DataProcessor-835"><span class="linenos"> 835</span></a>
</span><span id="DataProcessor-836"><a href="#DataProcessor-836"><span class="linenos"> 836</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_asns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-837"><a href="#DataProcessor-837"><span class="linenos"> 837</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top ASNs by attack count.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-838"><a href="#DataProcessor-838"><span class="linenos"> 838</span></a>        <span class="n">asn_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-839"><a href="#DataProcessor-839"><span class="linenos"> 839</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-840"><a href="#DataProcessor-840"><span class="linenos"> 840</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-841"><a href="#DataProcessor-841"><span class="linenos"> 841</span></a>                <span class="n">asn_counts</span><span class="p">[</span>
</span><span id="DataProcessor-842"><a href="#DataProcessor-842"><span class="linenos"> 842</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-843"><a href="#DataProcessor-843"><span class="linenos"> 843</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-844"><a href="#DataProcessor-844"><span class="linenos"> 844</span></a>
</span><span id="DataProcessor-845"><a href="#DataProcessor-845"><span class="linenos"> 845</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">asn</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">asn</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">asn_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="DataProcessor-846"><a href="#DataProcessor-846"><span class="linenos"> 846</span></a>
</span><span id="DataProcessor-847"><a href="#DataProcessor-847"><span class="linenos"> 847</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_top_organizations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-848"><a href="#DataProcessor-848"><span class="linenos"> 848</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get top organizations by attack count.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-849"><a href="#DataProcessor-849"><span class="linenos"> 849</span></a>        <span class="n">org_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-850"><a href="#DataProcessor-850"><span class="linenos"> 850</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-851"><a href="#DataProcessor-851"><span class="linenos"> 851</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-852"><a href="#DataProcessor-852"><span class="linenos"> 852</span></a>                <span class="n">org_counts</span><span class="p">[</span>
</span><span id="DataProcessor-853"><a href="#DataProcessor-853"><span class="linenos"> 853</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-854"><a href="#DataProcessor-854"><span class="linenos"> 854</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-855"><a href="#DataProcessor-855"><span class="linenos"> 855</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-856"><a href="#DataProcessor-856"><span class="linenos"> 856</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-857"><a href="#DataProcessor-857"><span class="linenos"> 857</span></a>
</span><span id="DataProcessor-858"><a href="#DataProcessor-858"><span class="linenos"> 858</span></a>        <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">org</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">org_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span id="DataProcessor-859"><a href="#DataProcessor-859"><span class="linenos"> 859</span></a>
</span><span id="DataProcessor-860"><a href="#DataProcessor-860"><span class="linenos"> 860</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_average_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-861"><a href="#DataProcessor-861"><span class="linenos"> 861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate average reputation score.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-862"><a href="#DataProcessor-862"><span class="linenos"> 862</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataProcessor-863"><a href="#DataProcessor-863"><span class="linenos"> 863</span></a>            <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="DataProcessor-864"><a href="#DataProcessor-864"><span class="linenos"> 864</span></a>            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor-865"><a href="#DataProcessor-865"><span class="linenos"> 865</span></a>            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="DataProcessor-866"><a href="#DataProcessor-866"><span class="linenos"> 866</span></a>        <span class="p">]</span>
</span><span id="DataProcessor-867"><a href="#DataProcessor-867"><span class="linenos"> 867</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="k">if</span> <span class="n">scores</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DataProcessor-868"><a href="#DataProcessor-868"><span class="linenos"> 868</span></a>
</span><span id="DataProcessor-869"><a href="#DataProcessor-869"><span class="linenos"> 869</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_geographic_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-870"><a href="#DataProcessor-870"><span class="linenos"> 870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get geographic distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-871"><a href="#DataProcessor-871"><span class="linenos"> 871</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-872"><a href="#DataProcessor-872"><span class="linenos"> 872</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-873"><a href="#DataProcessor-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-874"><a href="#DataProcessor-874"><span class="linenos"> 874</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="DataProcessor-875"><a href="#DataProcessor-875"><span class="linenos"> 875</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-876"><a href="#DataProcessor-876"><span class="linenos"> 876</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-877"><a href="#DataProcessor-877"><span class="linenos"> 877</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-878"><a href="#DataProcessor-878"><span class="linenos"> 878</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-879"><a href="#DataProcessor-879"><span class="linenos"> 879</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="DataProcessor-880"><a href="#DataProcessor-880"><span class="linenos"> 880</span></a>
</span><span id="DataProcessor-881"><a href="#DataProcessor-881"><span class="linenos"> 881</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_port_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-882"><a href="#DataProcessor-882"><span class="linenos"> 882</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get port distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-883"><a href="#DataProcessor-883"><span class="linenos"> 883</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-884"><a href="#DataProcessor-884"><span class="linenos"> 884</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-885"><a href="#DataProcessor-885"><span class="linenos"> 885</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-886"><a href="#DataProcessor-886"><span class="linenos"> 886</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="DataProcessor-887"><a href="#DataProcessor-887"><span class="linenos"> 887</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-888"><a href="#DataProcessor-888"><span class="linenos"> 888</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-889"><a href="#DataProcessor-889"><span class="linenos"> 889</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_port&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-890"><a href="#DataProcessor-890"><span class="linenos"> 890</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-891"><a href="#DataProcessor-891"><span class="linenos"> 891</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="DataProcessor-892"><a href="#DataProcessor-892"><span class="linenos"> 892</span></a>
</span><span id="DataProcessor-893"><a href="#DataProcessor-893"><span class="linenos"> 893</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_asn_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-894"><a href="#DataProcessor-894"><span class="linenos"> 894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ASN distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-895"><a href="#DataProcessor-895"><span class="linenos"> 895</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-896"><a href="#DataProcessor-896"><span class="linenos"> 896</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-897"><a href="#DataProcessor-897"><span class="linenos"> 897</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-898"><a href="#DataProcessor-898"><span class="linenos"> 898</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="DataProcessor-899"><a href="#DataProcessor-899"><span class="linenos"> 899</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asn&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-900"><a href="#DataProcessor-900"><span class="linenos"> 900</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-901"><a href="#DataProcessor-901"><span class="linenos"> 901</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="DataProcessor-902"><a href="#DataProcessor-902"><span class="linenos"> 902</span></a>
</span><span id="DataProcessor-903"><a href="#DataProcessor-903"><span class="linenos"> 903</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_organization_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-904"><a href="#DataProcessor-904"><span class="linenos"> 904</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get organization distribution of attacks.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-905"><a href="#DataProcessor-905"><span class="linenos"> 905</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-906"><a href="#DataProcessor-906"><span class="linenos"> 906</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-907"><a href="#DataProcessor-907"><span class="linenos"> 907</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-908"><a href="#DataProcessor-908"><span class="linenos"> 908</span></a>                <span class="n">distribution</span><span class="p">[</span>
</span><span id="DataProcessor-909"><a href="#DataProcessor-909"><span class="linenos"> 909</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-910"><a href="#DataProcessor-910"><span class="linenos"> 910</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-911"><a href="#DataProcessor-911"><span class="linenos"> 911</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-912"><a href="#DataProcessor-912"><span class="linenos"> 912</span></a>                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-913"><a href="#DataProcessor-913"><span class="linenos"> 913</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="DataProcessor-914"><a href="#DataProcessor-914"><span class="linenos"> 914</span></a>
</span><span id="DataProcessor-915"><a href="#DataProcessor-915"><span class="linenos"> 915</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_reputation_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-916"><a href="#DataProcessor-916"><span class="linenos"> 916</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get reputation score distribution.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-917"><a href="#DataProcessor-917"><span class="linenos"> 917</span></a>        <span class="n">distribution</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-918"><a href="#DataProcessor-918"><span class="linenos"> 918</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-919"><a href="#DataProcessor-919"><span class="linenos"> 919</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-920"><a href="#DataProcessor-920"><span class="linenos"> 920</span></a>            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-921"><a href="#DataProcessor-921"><span class="linenos"> 921</span></a>                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="DataProcessor-922"><a href="#DataProcessor-922"><span class="linenos"> 922</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-923"><a href="#DataProcessor-923"><span class="linenos"> 923</span></a>                <span class="k">elif</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="DataProcessor-924"><a href="#DataProcessor-924"><span class="linenos"> 924</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;medium&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-925"><a href="#DataProcessor-925"><span class="linenos"> 925</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-926"><a href="#DataProcessor-926"><span class="linenos"> 926</span></a>                    <span class="n">distribution</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-927"><a href="#DataProcessor-927"><span class="linenos"> 927</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
</span><span id="DataProcessor-928"><a href="#DataProcessor-928"><span class="linenos"> 928</span></a>
</span><span id="DataProcessor-929"><a href="#DataProcessor-929"><span class="linenos"> 929</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="DataProcessor-930"><a href="#DataProcessor-930"><span class="linenos"> 930</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate timeline of events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-931"><a href="#DataProcessor-931"><span class="linenos"> 931</span></a>        <span class="n">timeline</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor-932"><a href="#DataProcessor-932"><span class="linenos"> 932</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-933"><a href="#DataProcessor-933"><span class="linenos"> 933</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-934"><a href="#DataProcessor-934"><span class="linenos"> 934</span></a>            <span class="k">if</span> <span class="n">timestamp</span><span class="p">:</span>
</span><span id="DataProcessor-935"><a href="#DataProcessor-935"><span class="linenos"> 935</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-936"><a href="#DataProcessor-936"><span class="linenos"> 936</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DataProcessor-937"><a href="#DataProcessor-937"><span class="linenos"> 937</span></a>                        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-938"><a href="#DataProcessor-938"><span class="linenos"> 938</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-939"><a href="#DataProcessor-939"><span class="linenos"> 939</span></a>                        <span class="n">dt</span> <span class="o">=</span> <span class="n">timestamp</span>
</span><span id="DataProcessor-940"><a href="#DataProcessor-940"><span class="linenos"> 940</span></a>                    <span class="n">hour</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:00&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-941"><a href="#DataProcessor-941"><span class="linenos"> 941</span></a>                    <span class="n">timeline</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor-942"><a href="#DataProcessor-942"><span class="linenos"> 942</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="DataProcessor-943"><a href="#DataProcessor-943"><span class="linenos"> 943</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor-944"><a href="#DataProcessor-944"><span class="linenos"> 944</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span>
</span><span id="DataProcessor-945"><a href="#DataProcessor-945"><span class="linenos"> 945</span></a>
</span><span id="DataProcessor-946"><a href="#DataProcessor-946"><span class="linenos"> 946</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-947"><a href="#DataProcessor-947"><span class="linenos"> 947</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze events for patterns and insights.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-948"><a href="#DataProcessor-948"><span class="linenos"> 948</span></a>        <span class="c1"># Filter out unhashable values for Counter</span>
</span><span id="DataProcessor-949"><a href="#DataProcessor-949"><span class="linenos"> 949</span></a>        <span class="n">severity_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-950"><a href="#DataProcessor-950"><span class="linenos"> 950</span></a>        <span class="n">category_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-951"><a href="#DataProcessor-951"><span class="linenos"> 951</span></a>
</span><span id="DataProcessor-952"><a href="#DataProcessor-952"><span class="linenos"> 952</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-953"><a href="#DataProcessor-953"><span class="linenos"> 953</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-954"><a href="#DataProcessor-954"><span class="linenos"> 954</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-955"><a href="#DataProcessor-955"><span class="linenos"> 955</span></a>
</span><span id="DataProcessor-956"><a href="#DataProcessor-956"><span class="linenos"> 956</span></a>            <span class="c1"># Convert to string if it&#39;s not hashable</span>
</span><span id="DataProcessor-957"><a href="#DataProcessor-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="n">severity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-958"><a href="#DataProcessor-958"><span class="linenos"> 958</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-959"><a href="#DataProcessor-959"><span class="linenos"> 959</span></a>                    <span class="n">severity_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">severity</span><span class="p">))</span>
</span><span id="DataProcessor-960"><a href="#DataProcessor-960"><span class="linenos"> 960</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-961"><a href="#DataProcessor-961"><span class="linenos"> 961</span></a>                    <span class="n">severity_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
</span><span id="DataProcessor-962"><a href="#DataProcessor-962"><span class="linenos"> 962</span></a>
</span><span id="DataProcessor-963"><a href="#DataProcessor-963"><span class="linenos"> 963</span></a>            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor-964"><a href="#DataProcessor-964"><span class="linenos"> 964</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-965"><a href="#DataProcessor-965"><span class="linenos"> 965</span></a>                    <span class="n">category_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="p">))</span>
</span><span id="DataProcessor-966"><a href="#DataProcessor-966"><span class="linenos"> 966</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-967"><a href="#DataProcessor-967"><span class="linenos"> 967</span></a>                    <span class="n">category_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="DataProcessor-968"><a href="#DataProcessor-968"><span class="linenos"> 968</span></a>
</span><span id="DataProcessor-969"><a href="#DataProcessor-969"><span class="linenos"> 969</span></a>        <span class="c1"># Extract unique IPs safely</span>
</span><span id="DataProcessor-970"><a href="#DataProcessor-970"><span class="linenos"> 970</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-971"><a href="#DataProcessor-971"><span class="linenos"> 971</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-972"><a href="#DataProcessor-972"><span class="linenos"> 972</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-973"><a href="#DataProcessor-973"><span class="linenos"> 973</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="DataProcessor-974"><a href="#DataProcessor-974"><span class="linenos"> 974</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-975"><a href="#DataProcessor-975"><span class="linenos"> 975</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="DataProcessor-976"><a href="#DataProcessor-976"><span class="linenos"> 976</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-977"><a href="#DataProcessor-977"><span class="linenos"> 977</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="DataProcessor-978"><a href="#DataProcessor-978"><span class="linenos"> 978</span></a>
</span><span id="DataProcessor-979"><a href="#DataProcessor-979"><span class="linenos"> 979</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="DataProcessor-980"><a href="#DataProcessor-980"><span class="linenos"> 980</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-981"><a href="#DataProcessor-981"><span class="linenos"> 981</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">),</span>
</span><span id="DataProcessor-982"><a href="#DataProcessor-982"><span class="linenos"> 982</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor-983"><a href="#DataProcessor-983"><span class="linenos"> 983</span></a>            <span class="s2">&quot;severity_distribution&quot;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">severity_values</span><span class="p">),</span>
</span><span id="DataProcessor-984"><a href="#DataProcessor-984"><span class="linenos"> 984</span></a>            <span class="s2">&quot;category_distribution&quot;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">(</span><span class="n">category_values</span><span class="p">),</span>
</span><span id="DataProcessor-985"><a href="#DataProcessor-985"><span class="linenos"> 985</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-986"><a href="#DataProcessor-986"><span class="linenos"> 986</span></a>
</span><span id="DataProcessor-987"><a href="#DataProcessor-987"><span class="linenos"> 987</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_threat_indicators</span><span class="p">(</span>
</span><span id="DataProcessor-988"><a href="#DataProcessor-988"><span class="linenos"> 988</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="DataProcessor-989"><a href="#DataProcessor-989"><span class="linenos"> 989</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor-990"><a href="#DataProcessor-990"><span class="linenos"> 990</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract threat indicators from events and threat intelligence.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-991"><a href="#DataProcessor-991"><span class="linenos"> 991</span></a>        <span class="n">indicators</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-992"><a href="#DataProcessor-992"><span class="linenos"> 992</span></a>
</span><span id="DataProcessor-993"><a href="#DataProcessor-993"><span class="linenos"> 993</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-994"><a href="#DataProcessor-994"><span class="linenos"> 994</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
</span><span id="DataProcessor-995"><a href="#DataProcessor-995"><span class="linenos"> 995</span></a>                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="DataProcessor-996"><a href="#DataProcessor-996"><span class="linenos"> 996</span></a>                    <span class="p">{</span>
</span><span id="DataProcessor-997"><a href="#DataProcessor-997"><span class="linenos"> 997</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;high_reputation_score&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-998"><a href="#DataProcessor-998"><span class="linenos"> 998</span></a>                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-999"><a href="#DataProcessor-999"><span class="linenos"> 999</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-1000"><a href="#DataProcessor-1000"><span class="linenos">1000</span></a>                        <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-1001"><a href="#DataProcessor-1001"><span class="linenos">1001</span></a>                        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-1002"><a href="#DataProcessor-1002"><span class="linenos">1002</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IP </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">),</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has high reputation score&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1003"><a href="#DataProcessor-1003"><span class="linenos">1003</span></a>                    <span class="p">}</span>
</span><span id="DataProcessor-1004"><a href="#DataProcessor-1004"><span class="linenos">1004</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-1005"><a href="#DataProcessor-1005"><span class="linenos">1005</span></a>
</span><span id="DataProcessor-1006"><a href="#DataProcessor-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="DataProcessor-1007"><a href="#DataProcessor-1007"><span class="linenos">1007</span></a>                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="DataProcessor-1008"><a href="#DataProcessor-1008"><span class="linenos">1008</span></a>                    <span class="p">{</span>
</span><span id="DataProcessor-1009"><a href="#DataProcessor-1009"><span class="linenos">1009</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;high_attack_count&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1010"><a href="#DataProcessor-1010"><span class="linenos">1010</span></a>                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-1011"><a href="#DataProcessor-1011"><span class="linenos">1011</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-1012"><a href="#DataProcessor-1012"><span class="linenos">1012</span></a>                        <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-1013"><a href="#DataProcessor-1013"><span class="linenos">1013</span></a>                        <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor-1014"><a href="#DataProcessor-1014"><span class="linenos">1014</span></a>                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IP </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">),</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_ip&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has high attack count&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1015"><a href="#DataProcessor-1015"><span class="linenos">1015</span></a>                    <span class="p">}</span>
</span><span id="DataProcessor-1016"><a href="#DataProcessor-1016"><span class="linenos">1016</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-1017"><a href="#DataProcessor-1017"><span class="linenos">1017</span></a>
</span><span id="DataProcessor-1018"><a href="#DataProcessor-1018"><span class="linenos">1018</span></a>        <span class="k">return</span> <span class="n">indicators</span>
</span><span id="DataProcessor-1019"><a href="#DataProcessor-1019"><span class="linenos">1019</span></a>
</span><span id="DataProcessor-1020"><a href="#DataProcessor-1020"><span class="linenos">1020</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_attack_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1021"><a href="#DataProcessor-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify attack vectors from events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1022"><a href="#DataProcessor-1022"><span class="linenos">1022</span></a>        <span class="n">vectors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-1023"><a href="#DataProcessor-1023"><span class="linenos">1023</span></a>
</span><span id="DataProcessor-1024"><a href="#DataProcessor-1024"><span class="linenos">1024</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1025"><a href="#DataProcessor-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-1026"><a href="#DataProcessor-1026"><span class="linenos">1026</span></a>                <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor-1027"><a href="#DataProcessor-1027"><span class="linenos">1027</span></a>                    <span class="sa">f</span><span class="s2">&quot;Port </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;destination_port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataProcessor-1028"><a href="#DataProcessor-1028"><span class="linenos">1028</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-1029"><a href="#DataProcessor-1029"><span class="linenos">1029</span></a>
</span><span id="DataProcessor-1030"><a href="#DataProcessor-1030"><span class="linenos">1030</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-1031"><a href="#DataProcessor-1031"><span class="linenos">1031</span></a>                <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor-1032"><a href="#DataProcessor-1032"><span class="linenos">1032</span></a>                    <span class="sa">f</span><span class="s2">&quot;Protocol </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">],</span><span class="w"> </span><span class="nb">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">dict</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataProcessor-1033"><a href="#DataProcessor-1033"><span class="linenos">1033</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-1034"><a href="#DataProcessor-1034"><span class="linenos">1034</span></a>
</span><span id="DataProcessor-1035"><a href="#DataProcessor-1035"><span class="linenos">1035</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-1036"><a href="#DataProcessor-1036"><span class="linenos">1036</span></a>                <span class="c1"># Handle attack_types that might contain unhashable types</span>
</span><span id="DataProcessor-1037"><a href="#DataProcessor-1037"><span class="linenos">1037</span></a>                <span class="n">attack_types</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;attack_types&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-1038"><a href="#DataProcessor-1038"><span class="linenos">1038</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attack_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor-1039"><a href="#DataProcessor-1039"><span class="linenos">1039</span></a>                    <span class="k">for</span> <span class="n">attack_type</span> <span class="ow">in</span> <span class="n">attack_types</span><span class="p">:</span>
</span><span id="DataProcessor-1040"><a href="#DataProcessor-1040"><span class="linenos">1040</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attack_type</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-1041"><a href="#DataProcessor-1041"><span class="linenos">1041</span></a>                            <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attack_type</span><span class="p">))</span>
</span><span id="DataProcessor-1042"><a href="#DataProcessor-1042"><span class="linenos">1042</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1043"><a href="#DataProcessor-1043"><span class="linenos">1043</span></a>                            <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attack_type</span><span class="p">)</span>
</span><span id="DataProcessor-1044"><a href="#DataProcessor-1044"><span class="linenos">1044</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1045"><a href="#DataProcessor-1045"><span class="linenos">1045</span></a>                    <span class="n">vectors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attack_types</span><span class="p">))</span>
</span><span id="DataProcessor-1046"><a href="#DataProcessor-1046"><span class="linenos">1046</span></a>
</span><span id="DataProcessor-1047"><a href="#DataProcessor-1047"><span class="linenos">1047</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>
</span><span id="DataProcessor-1048"><a href="#DataProcessor-1048"><span class="linenos">1048</span></a>
</span><span id="DataProcessor-1049"><a href="#DataProcessor-1049"><span class="linenos">1049</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_affected_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1050"><a href="#DataProcessor-1050"><span class="linenos">1050</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify affected systems from events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1051"><a href="#DataProcessor-1051"><span class="linenos">1051</span></a>        <span class="n">systems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-1052"><a href="#DataProcessor-1052"><span class="linenos">1052</span></a>
</span><span id="DataProcessor-1053"><a href="#DataProcessor-1053"><span class="linenos">1053</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1054"><a href="#DataProcessor-1054"><span class="linenos">1054</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-1055"><a href="#DataProcessor-1055"><span class="linenos">1055</span></a>                <span class="n">systems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor-1056"><a href="#DataProcessor-1056"><span class="linenos">1056</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">])</span>
</span><span id="DataProcessor-1057"><a href="#DataProcessor-1057"><span class="linenos">1057</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor-1058"><a href="#DataProcessor-1058"><span class="linenos">1058</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-1059"><a href="#DataProcessor-1059"><span class="linenos">1059</span></a>                <span class="p">)</span>
</span><span id="DataProcessor-1060"><a href="#DataProcessor-1060"><span class="linenos">1060</span></a>
</span><span id="DataProcessor-1061"><a href="#DataProcessor-1061"><span class="linenos">1061</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span>
</span><span id="DataProcessor-1062"><a href="#DataProcessor-1062"><span class="linenos">1062</span></a>
</span><span id="DataProcessor-1063"><a href="#DataProcessor-1063"><span class="linenos">1063</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_impact</span><span class="p">(</span>
</span><span id="DataProcessor-1064"><a href="#DataProcessor-1064"><span class="linenos">1064</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor-1065"><a href="#DataProcessor-1065"><span class="linenos">1065</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DataProcessor-1066"><a href="#DataProcessor-1066"><span class="linenos">1066</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess the impact of the security incident.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1067"><a href="#DataProcessor-1067"><span class="linenos">1067</span></a>        <span class="n">high_severity_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]])</span>
</span><span id="DataProcessor-1068"><a href="#DataProcessor-1068"><span class="linenos">1068</span></a>        <span class="n">high_reputation_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor-1069"><a href="#DataProcessor-1069"><span class="linenos">1069</span></a>            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">threat_indicators</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;high_reputation_score&quot;</span><span class="p">]</span>
</span><span id="DataProcessor-1070"><a href="#DataProcessor-1070"><span class="linenos">1070</span></a>        <span class="p">)</span>
</span><span id="DataProcessor-1071"><a href="#DataProcessor-1071"><span class="linenos">1071</span></a>
</span><span id="DataProcessor-1072"><a href="#DataProcessor-1072"><span class="linenos">1072</span></a>        <span class="k">if</span> <span class="n">high_severity_count</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">high_reputation_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="DataProcessor-1073"><a href="#DataProcessor-1073"><span class="linenos">1073</span></a>            <span class="k">return</span> <span class="s2">&quot;High - Multiple high-severity events and high-reputation attackers detected&quot;</span>
</span><span id="DataProcessor-1074"><a href="#DataProcessor-1074"><span class="linenos">1074</span></a>        <span class="k">if</span> <span class="n">high_severity_count</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">high_reputation_count</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DataProcessor-1075"><a href="#DataProcessor-1075"><span class="linenos">1075</span></a>            <span class="k">return</span> <span class="s2">&quot;Medium - Several high-severity events or high-reputation attackers detected&quot;</span>
</span><span id="DataProcessor-1076"><a href="#DataProcessor-1076"><span class="linenos">1076</span></a>        <span class="k">return</span> <span class="s2">&quot;Low - Limited high-severity events detected&quot;</span>
</span><span id="DataProcessor-1077"><a href="#DataProcessor-1077"><span class="linenos">1077</span></a>
</span><span id="DataProcessor-1078"><a href="#DataProcessor-1078"><span class="linenos">1078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_recommendations</span><span class="p">(</span>
</span><span id="DataProcessor-1079"><a href="#DataProcessor-1079"><span class="linenos">1079</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">impact</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="DataProcessor-1080"><a href="#DataProcessor-1080"><span class="linenos">1080</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1081"><a href="#DataProcessor-1081"><span class="linenos">1081</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security recommendations.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1082"><a href="#DataProcessor-1082"><span class="linenos">1082</span></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-1083"><a href="#DataProcessor-1083"><span class="linenos">1083</span></a>
</span><span id="DataProcessor-1084"><a href="#DataProcessor-1084"><span class="linenos">1084</span></a>        <span class="c1"># Basic recommendations</span>
</span><span id="DataProcessor-1085"><a href="#DataProcessor-1085"><span class="linenos">1085</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review and update firewall rules to block suspicious IP addresses&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1086"><a href="#DataProcessor-1086"><span class="linenos">1086</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Implement rate limiting for authentication attempts&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1087"><a href="#DataProcessor-1087"><span class="linenos">1087</span></a>        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Enable logging and monitoring for all critical systems&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1088"><a href="#DataProcessor-1088"><span class="linenos">1088</span></a>
</span><span id="DataProcessor-1089"><a href="#DataProcessor-1089"><span class="linenos">1089</span></a>        <span class="c1"># DShield-specific recommendations</span>
</span><span id="DataProcessor-1090"><a href="#DataProcessor-1090"><span class="linenos">1090</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">):</span>
</span><span id="DataProcessor-1091"><a href="#DataProcessor-1091"><span class="linenos">1091</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Block IP addresses with high DShield reputation scores&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1092"><a href="#DataProcessor-1092"><span class="linenos">1092</span></a>
</span><span id="DataProcessor-1093"><a href="#DataProcessor-1093"><span class="linenos">1093</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">):</span>
</span><span id="DataProcessor-1094"><a href="#DataProcessor-1094"><span class="linenos">1094</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="DataProcessor-1095"><a href="#DataProcessor-1095"><span class="linenos">1095</span></a>                <span class="s2">&quot;Implement additional monitoring for IPs with high attack counts&quot;</span>
</span><span id="DataProcessor-1096"><a href="#DataProcessor-1096"><span class="linenos">1096</span></a>            <span class="p">)</span>
</span><span id="DataProcessor-1097"><a href="#DataProcessor-1097"><span class="linenos">1097</span></a>
</span><span id="DataProcessor-1098"><a href="#DataProcessor-1098"><span class="linenos">1098</span></a>        <span class="k">if</span> <span class="n">impact</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
</span><span id="DataProcessor-1099"><a href="#DataProcessor-1099"><span class="linenos">1099</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consider implementing additional security controls&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1100"><a href="#DataProcessor-1100"><span class="linenos">1100</span></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review incident response procedures&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1101"><a href="#DataProcessor-1101"><span class="linenos">1101</span></a>
</span><span id="DataProcessor-1102"><a href="#DataProcessor-1102"><span class="linenos">1102</span></a>        <span class="k">return</span> <span class="n">recommendations</span>
</span><span id="DataProcessor-1103"><a href="#DataProcessor-1103"><span class="linenos">1103</span></a>
</span><span id="DataProcessor-1104"><a href="#DataProcessor-1104"><span class="linenos">1104</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_mitigation_actions</span><span class="p">(</span>
</span><span id="DataProcessor-1105"><a href="#DataProcessor-1105"><span class="linenos">1105</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor-1106"><a href="#DataProcessor-1106"><span class="linenos">1106</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1107"><a href="#DataProcessor-1107"><span class="linenos">1107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate specific mitigation actions.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1108"><a href="#DataProcessor-1108"><span class="linenos">1108</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-1109"><a href="#DataProcessor-1109"><span class="linenos">1109</span></a>
</span><span id="DataProcessor-1110"><a href="#DataProcessor-1110"><span class="linenos">1110</span></a>        <span class="c1"># Immediate actions</span>
</span><span id="DataProcessor-1111"><a href="#DataProcessor-1111"><span class="linenos">1111</span></a>        <span class="n">high_reputation_ips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataProcessor-1112"><a href="#DataProcessor-1112"><span class="linenos">1112</span></a>            <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-1113"><a href="#DataProcessor-1113"><span class="linenos">1113</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">threat_indicators</span>
</span><span id="DataProcessor-1114"><a href="#DataProcessor-1114"><span class="linenos">1114</span></a>            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;high_reputation_score&quot;</span>
</span><span id="DataProcessor-1115"><a href="#DataProcessor-1115"><span class="linenos">1115</span></a>        <span class="p">]</span>
</span><span id="DataProcessor-1116"><a href="#DataProcessor-1116"><span class="linenos">1116</span></a>        <span class="k">if</span> <span class="n">high_reputation_ips</span><span class="p">:</span>
</span><span id="DataProcessor-1117"><a href="#DataProcessor-1117"><span class="linenos">1117</span></a>            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block IP addresses: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">high_reputation_ips</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1118"><a href="#DataProcessor-1118"><span class="linenos">1118</span></a>
</span><span id="DataProcessor-1119"><a href="#DataProcessor-1119"><span class="linenos">1119</span></a>        <span class="c1"># Monitoring actions</span>
</span><span id="DataProcessor-1120"><a href="#DataProcessor-1120"><span class="linenos">1120</span></a>        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Increase monitoring frequency for affected systems&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1121"><a href="#DataProcessor-1121"><span class="linenos">1121</span></a>        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Review and update security policies&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1122"><a href="#DataProcessor-1122"><span class="linenos">1122</span></a>
</span><span id="DataProcessor-1123"><a href="#DataProcessor-1123"><span class="linenos">1123</span></a>        <span class="k">return</span> <span class="n">actions</span>
</span><span id="DataProcessor-1124"><a href="#DataProcessor-1124"><span class="linenos">1124</span></a>
</span><span id="DataProcessor-1125"><a href="#DataProcessor-1125"><span class="linenos">1125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_confidence_level</span><span class="p">(</span>
</span><span id="DataProcessor-1126"><a href="#DataProcessor-1126"><span class="linenos">1126</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="DataProcessor-1127"><a href="#DataProcessor-1127"><span class="linenos">1127</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DataProcessor-1128"><a href="#DataProcessor-1128"><span class="linenos">1128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess confidence level of the analysis.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1129"><a href="#DataProcessor-1129"><span class="linenos">1129</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">threat_intelligence</span><span class="p">:</span>
</span><span id="DataProcessor-1130"><a href="#DataProcessor-1130"><span class="linenos">1130</span></a>            <span class="k">return</span> <span class="s2">&quot;High&quot;</span>
</span><span id="DataProcessor-1131"><a href="#DataProcessor-1131"><span class="linenos">1131</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="DataProcessor-1132"><a href="#DataProcessor-1132"><span class="linenos">1132</span></a>            <span class="k">return</span> <span class="s2">&quot;Medium&quot;</span>
</span><span id="DataProcessor-1133"><a href="#DataProcessor-1133"><span class="linenos">1133</span></a>        <span class="k">return</span> <span class="s2">&quot;Low&quot;</span>
</span><span id="DataProcessor-1134"><a href="#DataProcessor-1134"><span class="linenos">1134</span></a>
</span><span id="DataProcessor-1135"><a href="#DataProcessor-1135"><span class="linenos">1135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1136"><a href="#DataProcessor-1136"><span class="linenos">1136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract tags from events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1137"><a href="#DataProcessor-1137"><span class="linenos">1137</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-1138"><a href="#DataProcessor-1138"><span class="linenos">1138</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1139"><a href="#DataProcessor-1139"><span class="linenos">1139</span></a>            <span class="n">event_tags</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="DataProcessor-1140"><a href="#DataProcessor-1140"><span class="linenos">1140</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_tags</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor-1141"><a href="#DataProcessor-1141"><span class="linenos">1141</span></a>                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">event_tags</span><span class="p">:</span>
</span><span id="DataProcessor-1142"><a href="#DataProcessor-1142"><span class="linenos">1142</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-1143"><a href="#DataProcessor-1143"><span class="linenos">1143</span></a>                        <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="DataProcessor-1144"><a href="#DataProcessor-1144"><span class="linenos">1144</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1145"><a href="#DataProcessor-1145"><span class="linenos">1145</span></a>                        <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="DataProcessor-1146"><a href="#DataProcessor-1146"><span class="linenos">1146</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1147"><a href="#DataProcessor-1147"><span class="linenos">1147</span></a>                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">event_tags</span><span class="p">))</span>
</span><span id="DataProcessor-1148"><a href="#DataProcessor-1148"><span class="linenos">1148</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="DataProcessor-1149"><a href="#DataProcessor-1149"><span class="linenos">1149</span></a>
</span><span id="DataProcessor-1150"><a href="#DataProcessor-1150"><span class="linenos">1150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_executive_summary</span><span class="p">(</span>
</span><span id="DataProcessor-1151"><a href="#DataProcessor-1151"><span class="linenos">1151</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_indicators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor-1152"><a href="#DataProcessor-1152"><span class="linenos">1152</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DataProcessor-1153"><a href="#DataProcessor-1153"><span class="linenos">1153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate executive summary of the security incident.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1154"><a href="#DataProcessor-1154"><span class="linenos">1154</span></a>        <span class="n">total_events</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor-1155"><a href="#DataProcessor-1155"><span class="linenos">1155</span></a>
</span><span id="DataProcessor-1156"><a href="#DataProcessor-1156"><span class="linenos">1156</span></a>        <span class="c1"># Extract unique IPs safely</span>
</span><span id="DataProcessor-1157"><a href="#DataProcessor-1157"><span class="linenos">1157</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-1158"><a href="#DataProcessor-1158"><span class="linenos">1158</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1159"><a href="#DataProcessor-1159"><span class="linenos">1159</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1160"><a href="#DataProcessor-1160"><span class="linenos">1160</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="DataProcessor-1161"><a href="#DataProcessor-1161"><span class="linenos">1161</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-1162"><a href="#DataProcessor-1162"><span class="linenos">1162</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="DataProcessor-1163"><a href="#DataProcessor-1163"><span class="linenos">1163</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1164"><a href="#DataProcessor-1164"><span class="linenos">1164</span></a>                    <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">))</span>
</span><span id="DataProcessor-1165"><a href="#DataProcessor-1165"><span class="linenos">1165</span></a>
</span><span id="DataProcessor-1166"><a href="#DataProcessor-1166"><span class="linenos">1166</span></a>        <span class="n">high_severity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]])</span>
</span><span id="DataProcessor-1167"><a href="#DataProcessor-1167"><span class="linenos">1167</span></a>
</span><span id="DataProcessor-1168"><a href="#DataProcessor-1168"><span class="linenos">1168</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Security incident involving </span><span class="si">{</span><span class="n">total_events</span><span class="si">}</span><span class="s2"> events from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique IP addresses. &quot;</span>
</span><span id="DataProcessor-1169"><a href="#DataProcessor-1169"><span class="linenos">1169</span></a>        <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">high_severity</span><span class="si">}</span><span class="s2"> high-severity events detected. &quot;</span>
</span><span id="DataProcessor-1170"><a href="#DataProcessor-1170"><span class="linenos">1170</span></a>
</span><span id="DataProcessor-1171"><a href="#DataProcessor-1171"><span class="linenos">1171</span></a>        <span class="k">if</span> <span class="n">threat_indicators</span><span class="p">:</span>
</span><span id="DataProcessor-1172"><a href="#DataProcessor-1172"><span class="linenos">1172</span></a>            <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">threat_indicators</span><span class="p">)</span><span class="si">}</span><span class="s2"> threat indicators identified requiring immediate attention.&quot;</span>
</span><span id="DataProcessor-1173"><a href="#DataProcessor-1173"><span class="linenos">1173</span></a>
</span><span id="DataProcessor-1174"><a href="#DataProcessor-1174"><span class="linenos">1174</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="DataProcessor-1175"><a href="#DataProcessor-1175"><span class="linenos">1175</span></a>
</span><span id="DataProcessor-1176"><a href="#DataProcessor-1176"><span class="linenos">1176</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_high_risk_ips</span><span class="p">(</span>
</span><span id="DataProcessor-1177"><a href="#DataProcessor-1177"><span class="linenos">1177</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="DataProcessor-1178"><a href="#DataProcessor-1178"><span class="linenos">1178</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor-1179"><a href="#DataProcessor-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify high-risk IP addresses.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1180"><a href="#DataProcessor-1180"><span class="linenos">1180</span></a>        <span class="n">high_risk_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor-1181"><a href="#DataProcessor-1181"><span class="linenos">1181</span></a>
</span><span id="DataProcessor-1182"><a href="#DataProcessor-1182"><span class="linenos">1182</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1183"><a href="#DataProcessor-1183"><span class="linenos">1183</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1184"><a href="#DataProcessor-1184"><span class="linenos">1184</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="DataProcessor-1185"><a href="#DataProcessor-1185"><span class="linenos">1185</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor-1186"><a href="#DataProcessor-1186"><span class="linenos">1186</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor-1187"><a href="#DataProcessor-1187"><span class="linenos">1187</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1188"><a href="#DataProcessor-1188"><span class="linenos">1188</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor-1189"><a href="#DataProcessor-1189"><span class="linenos">1189</span></a>
</span><span id="DataProcessor-1190"><a href="#DataProcessor-1190"><span class="linenos">1190</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="DataProcessor-1191"><a href="#DataProcessor-1191"><span class="linenos">1191</span></a>                    <span class="n">high_risk_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_ip_str</span><span class="p">)</span>
</span><span id="DataProcessor-1192"><a href="#DataProcessor-1192"><span class="linenos">1192</span></a>
</span><span id="DataProcessor-1193"><a href="#DataProcessor-1193"><span class="linenos">1193</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">high_risk_ips</span><span class="p">)</span>
</span><span id="DataProcessor-1194"><a href="#DataProcessor-1194"><span class="linenos">1194</span></a>
</span><span id="DataProcessor-1195"><a href="#DataProcessor-1195"><span class="linenos">1195</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-1196"><a href="#DataProcessor-1196"><span class="linenos">1196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty security summary.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1197"><a href="#DataProcessor-1197"><span class="linenos">1197</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="DataProcessor-1198"><a href="#DataProcessor-1198"><span class="linenos">1198</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor-1199"><a href="#DataProcessor-1199"><span class="linenos">1199</span></a>            <span class="s2">&quot;time_range_hours&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span><span id="DataProcessor-1200"><a href="#DataProcessor-1200"><span class="linenos">1200</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1201"><a href="#DataProcessor-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;events_by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1202"><a href="#DataProcessor-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;events_by_category&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1203"><a href="#DataProcessor-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;unique_source_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1204"><a href="#DataProcessor-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1205"><a href="#DataProcessor-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;top_source_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1206"><a href="#DataProcessor-1206"><span class="linenos">1206</span></a>            <span class="s2">&quot;top_destination_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1207"><a href="#DataProcessor-1207"><span class="linenos">1207</span></a>            <span class="s2">&quot;high_risk_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1208"><a href="#DataProcessor-1208"><span class="linenos">1208</span></a>            <span class="s2">&quot;threat_intelligence_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1209"><a href="#DataProcessor-1209"><span class="linenos">1209</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1210"><a href="#DataProcessor-1210"><span class="linenos">1210</span></a>            <span class="s2">&quot;timeline&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1211"><a href="#DataProcessor-1211"><span class="linenos">1211</span></a>            <span class="s2">&quot;indices_queried&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1212"><a href="#DataProcessor-1212"><span class="linenos">1212</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1213"><a href="#DataProcessor-1213"><span class="linenos">1213</span></a>            <span class="s2">&quot;dshield_blocks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1214"><a href="#DataProcessor-1214"><span class="linenos">1214</span></a>            <span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1215"><a href="#DataProcessor-1215"><span class="linenos">1215</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1216"><a href="#DataProcessor-1216"><span class="linenos">1216</span></a>            <span class="s2">&quot;geographic_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1217"><a href="#DataProcessor-1217"><span class="linenos">1217</span></a>            <span class="s2">&quot;port_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1218"><a href="#DataProcessor-1218"><span class="linenos">1218</span></a>            <span class="s2">&quot;asn_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1219"><a href="#DataProcessor-1219"><span class="linenos">1219</span></a>            <span class="s2">&quot;organization_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1220"><a href="#DataProcessor-1220"><span class="linenos">1220</span></a>            <span class="s2">&quot;reputation_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1221"><a href="#DataProcessor-1221"><span class="linenos">1221</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-1222"><a href="#DataProcessor-1222"><span class="linenos">1222</span></a>
</span><span id="DataProcessor-1223"><a href="#DataProcessor-1223"><span class="linenos">1223</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_attack_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-1224"><a href="#DataProcessor-1224"><span class="linenos">1224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty attack report.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1225"><a href="#DataProcessor-1225"><span class="linenos">1225</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="DataProcessor-1226"><a href="#DataProcessor-1226"><span class="linenos">1226</span></a>            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
</span><span id="DataProcessor-1227"><a href="#DataProcessor-1227"><span class="linenos">1227</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor-1228"><a href="#DataProcessor-1228"><span class="linenos">1228</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;No Security Events Detected&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1229"><a href="#DataProcessor-1229"><span class="linenos">1229</span></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;No security events were found in the specified time range.&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1230"><a href="#DataProcessor-1230"><span class="linenos">1230</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1231"><a href="#DataProcessor-1231"><span class="linenos">1231</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1232"><a href="#DataProcessor-1232"><span class="linenos">1232</span></a>            <span class="s2">&quot;time_range&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1233"><a href="#DataProcessor-1233"><span class="linenos">1233</span></a>            <span class="s2">&quot;threat_indicators&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1234"><a href="#DataProcessor-1234"><span class="linenos">1234</span></a>            <span class="s2">&quot;high_risk_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1235"><a href="#DataProcessor-1235"><span class="linenos">1235</span></a>            <span class="s2">&quot;attack_vectors&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1236"><a href="#DataProcessor-1236"><span class="linenos">1236</span></a>            <span class="s2">&quot;affected_systems&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1237"><a href="#DataProcessor-1237"><span class="linenos">1237</span></a>            <span class="s2">&quot;impact_assessment&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1238"><a href="#DataProcessor-1238"><span class="linenos">1238</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1239"><a href="#DataProcessor-1239"><span class="linenos">1239</span></a>            <span class="s2">&quot;dshield_reputation&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1240"><a href="#DataProcessor-1240"><span class="linenos">1240</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1241"><a href="#DataProcessor-1241"><span class="linenos">1241</span></a>            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Continue monitoring for security events&quot;</span><span class="p">],</span>
</span><span id="DataProcessor-1242"><a href="#DataProcessor-1242"><span class="linenos">1242</span></a>            <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1243"><a href="#DataProcessor-1243"><span class="linenos">1243</span></a>            <span class="s2">&quot;confidence_level&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span>
</span><span id="DataProcessor-1244"><a href="#DataProcessor-1244"><span class="linenos">1244</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1245"><a href="#DataProcessor-1245"><span class="linenos">1245</span></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor-1246"><a href="#DataProcessor-1246"><span class="linenos">1246</span></a>            <span class="s2">&quot;threat_intelligence&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor-1247"><a href="#DataProcessor-1247"><span class="linenos">1247</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-1248"><a href="#DataProcessor-1248"><span class="linenos">1248</span></a>
</span><span id="DataProcessor-1249"><a href="#DataProcessor-1249"><span class="linenos">1249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_time_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor-1250"><a href="#DataProcessor-1250"><span class="linenos">1250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate time range from events, handling empty sequences.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1251"><a href="#DataProcessor-1251"><span class="linenos">1251</span></a>        <span class="c1"># Extract valid timestamps</span>
</span><span id="DataProcessor-1252"><a href="#DataProcessor-1252"><span class="linenos">1252</span></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor-1253"><a href="#DataProcessor-1253"><span class="linenos">1253</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor-1254"><a href="#DataProcessor-1254"><span class="linenos">1254</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
</span><span id="DataProcessor-1255"><a href="#DataProcessor-1255"><span class="linenos">1255</span></a>            <span class="k">if</span> <span class="n">timestamp</span><span class="p">:</span>
</span><span id="DataProcessor-1256"><a href="#DataProcessor-1256"><span class="linenos">1256</span></a>                <span class="c1"># Handle both string and datetime timestamps</span>
</span><span id="DataProcessor-1257"><a href="#DataProcessor-1257"><span class="linenos">1257</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DataProcessor-1258"><a href="#DataProcessor-1258"><span class="linenos">1258</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor-1259"><a href="#DataProcessor-1259"><span class="linenos">1259</span></a>                        <span class="c1"># Try to parse ISO format timestamps</span>
</span><span id="DataProcessor-1260"><a href="#DataProcessor-1260"><span class="linenos">1260</span></a>                        <span class="k">if</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">):</span>
</span><span id="DataProcessor-1261"><a href="#DataProcessor-1261"><span class="linenos">1261</span></a>                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
</span><span id="DataProcessor-1262"><a href="#DataProcessor-1262"><span class="linenos">1262</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1263"><a href="#DataProcessor-1263"><span class="linenos">1263</span></a>                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="DataProcessor-1264"><a href="#DataProcessor-1264"><span class="linenos">1264</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="DataProcessor-1265"><a href="#DataProcessor-1265"><span class="linenos">1265</span></a>                        <span class="c1"># Skip malformed timestamps</span>
</span><span id="DataProcessor-1266"><a href="#DataProcessor-1266"><span class="linenos">1266</span></a>                        <span class="k">continue</span>
</span><span id="DataProcessor-1267"><a href="#DataProcessor-1267"><span class="linenos">1267</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="DataProcessor-1268"><a href="#DataProcessor-1268"><span class="linenos">1268</span></a>                    <span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="DataProcessor-1269"><a href="#DataProcessor-1269"><span class="linenos">1269</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor-1270"><a href="#DataProcessor-1270"><span class="linenos">1270</span></a>                    <span class="c1"># Skip non-datetime objects</span>
</span><span id="DataProcessor-1271"><a href="#DataProcessor-1271"><span class="linenos">1271</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor-1272"><a href="#DataProcessor-1272"><span class="linenos">1272</span></a>
</span><span id="DataProcessor-1273"><a href="#DataProcessor-1273"><span class="linenos">1273</span></a>        <span class="k">if</span> <span class="n">timestamps</span><span class="p">:</span>
</span><span id="DataProcessor-1274"><a href="#DataProcessor-1274"><span class="linenos">1274</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="DataProcessor-1275"><a href="#DataProcessor-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="DataProcessor-1276"><a href="#DataProcessor-1276"><span class="linenos">1276</span></a>                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="DataProcessor-1277"><a href="#DataProcessor-1277"><span class="linenos">1277</span></a>            <span class="p">}</span>
</span><span id="DataProcessor-1278"><a href="#DataProcessor-1278"><span class="linenos">1278</span></a>        <span class="c1"># Return current time as fallback</span>
</span><span id="DataProcessor-1279"><a href="#DataProcessor-1279"><span class="linenos">1279</span></a>        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="DataProcessor-1280"><a href="#DataProcessor-1280"><span class="linenos">1280</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="DataProcessor-1281"><a href="#DataProcessor-1281"><span class="linenos">1281</span></a>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
</span><span id="DataProcessor-1282"><a href="#DataProcessor-1282"><span class="linenos">1282</span></a>            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
</span><span id="DataProcessor-1283"><a href="#DataProcessor-1283"><span class="linenos">1283</span></a>        <span class="p">}</span>
</span><span id="DataProcessor-1284"><a href="#DataProcessor-1284"><span class="linenos">1284</span></a>
</span><span id="DataProcessor-1285"><a href="#DataProcessor-1285"><span class="linenos">1285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_empty_dshield_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DShieldStatistics</span><span class="p">:</span>
</span><span id="DataProcessor-1286"><a href="#DataProcessor-1286"><span class="linenos">1286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty DShield statistics.&quot;&quot;&quot;</span>
</span><span id="DataProcessor-1287"><a href="#DataProcessor-1287"><span class="linenos">1287</span></a>        <span class="k">return</span> <span class="n">DShieldStatistics</span><span class="p">(</span>
</span><span id="DataProcessor-1288"><a href="#DataProcessor-1288"><span class="linenos">1288</span></a>            <span class="n">time_range_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
</span><span id="DataProcessor-1289"><a href="#DataProcessor-1289"><span class="linenos">1289</span></a>            <span class="n">total_attacks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1290"><a href="#DataProcessor-1290"><span class="linenos">1290</span></a>            <span class="n">unique_attackers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1291"><a href="#DataProcessor-1291"><span class="linenos">1291</span></a>            <span class="n">total_targets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1292"><a href="#DataProcessor-1292"><span class="linenos">1292</span></a>            <span class="n">countries_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1293"><a href="#DataProcessor-1293"><span class="linenos">1293</span></a>            <span class="n">ports_targeted</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1294"><a href="#DataProcessor-1294"><span class="linenos">1294</span></a>            <span class="n">protocols_used</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1295"><a href="#DataProcessor-1295"><span class="linenos">1295</span></a>            <span class="n">asns_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1296"><a href="#DataProcessor-1296"><span class="linenos">1296</span></a>            <span class="n">organizations_attacking</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1297"><a href="#DataProcessor-1297"><span class="linenos">1297</span></a>            <span class="n">high_reputation_ips</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor-1298"><a href="#DataProcessor-1298"><span class="linenos">1298</span></a>            <span class="n">top_countries</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1299"><a href="#DataProcessor-1299"><span class="linenos">1299</span></a>            <span class="n">top_ports</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1300"><a href="#DataProcessor-1300"><span class="linenos">1300</span></a>            <span class="n">top_protocols</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1301"><a href="#DataProcessor-1301"><span class="linenos">1301</span></a>            <span class="n">top_asns</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1302"><a href="#DataProcessor-1302"><span class="linenos">1302</span></a>            <span class="n">top_organizations</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1303"><a href="#DataProcessor-1303"><span class="linenos">1303</span></a>            <span class="n">average_reputation_score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor-1304"><a href="#DataProcessor-1304"><span class="linenos">1304</span></a>            <span class="n">indices_queried</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataProcessor-1305"><a href="#DataProcessor-1305"><span class="linenos">1305</span></a>            <span class="n">query_duration_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor-1306"><a href="#DataProcessor-1306"><span class="linenos">1306</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Process and structure DShield SIEM data for AI analysis.</p>

<p>This class provides methods to normalize, enrich, and summarize DShield SIEM
data for use in AI-driven analytics and reporting. It includes attack pattern
detection, severity/category mapping, and report generation utilities.</p>

<p>Attributes:
    dshield_attack_patterns: Mapping of attack pattern names to keywords
    dshield_severity_mapping: Mapping of severity labels to EventSeverity
    dshield_category_mapping: Mapping of category labels to EventCategory</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>processor = DataProcessor()
      summary = processor.generate_security_summary(events)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="DataProcessor.__init__" class="classattr">
                                        <input id="DataProcessor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="name">DataProcessor</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="DataProcessor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.__init__-81"><a href="#DataProcessor.__init__-81"><span class="linenos"> 81</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor.__init__-82"><a href="#DataProcessor.__init__-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the DataProcessor.</span>
</span><span id="DataProcessor.__init__-83"><a href="#DataProcessor.__init__-83"><span class="linenos"> 83</span></a>
</span><span id="DataProcessor.__init__-84"><a href="#DataProcessor.__init__-84"><span class="linenos"> 84</span></a><span class="sd">        Sets up DShield-specific mappings for attack patterns, severity, and category.</span>
</span><span id="DataProcessor.__init__-85"><a href="#DataProcessor.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor.__init__-86"><a href="#DataProcessor.__init__-86"><span class="linenos"> 86</span></a>        <span class="c1"># DShield-specific attack patterns and signatures</span>
</span><span id="DataProcessor.__init__-87"><a href="#DataProcessor.__init__-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_attack_patterns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor.__init__-88"><a href="#DataProcessor.__init__-88"><span class="linenos"> 88</span></a>            <span class="s2">&quot;brute_force&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor.__init__-89"><a href="#DataProcessor.__init__-89"><span class="linenos"> 89</span></a>                <span class="s2">&quot;failed login&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-90"><a href="#DataProcessor.__init__-90"><span class="linenos"> 90</span></a>                <span class="s2">&quot;authentication failure&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-91"><a href="#DataProcessor.__init__-91"><span class="linenos"> 91</span></a>                <span class="s2">&quot;invalid credentials&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-92"><a href="#DataProcessor.__init__-92"><span class="linenos"> 92</span></a>                <span class="s2">&quot;ssh brute force&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-93"><a href="#DataProcessor.__init__-93"><span class="linenos"> 93</span></a>            <span class="p">],</span>
</span><span id="DataProcessor.__init__-94"><a href="#DataProcessor.__init__-94"><span class="linenos"> 94</span></a>            <span class="s2">&quot;port_scan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;port scan&quot;</span><span class="p">,</span> <span class="s2">&quot;nmap&quot;</span><span class="p">,</span> <span class="s2">&quot;masscan&quot;</span><span class="p">,</span> <span class="s2">&quot;port scanning&quot;</span><span class="p">,</span> <span class="s2">&quot;syn scan&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-95"><a href="#DataProcessor.__init__-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot;sql_injection&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sql injection&quot;</span><span class="p">,</span> <span class="s2">&quot;sql error&quot;</span><span class="p">,</span> <span class="s2">&quot;database error&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql error&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-96"><a href="#DataProcessor.__init__-96"><span class="linenos"> 96</span></a>            <span class="s2">&quot;xss&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cross-site scripting&quot;</span><span class="p">,</span> <span class="s2">&quot;xss&quot;</span><span class="p">,</span> <span class="s2">&quot;script injection&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript injection&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-97"><a href="#DataProcessor.__init__-97"><span class="linenos"> 97</span></a>            <span class="s2">&quot;ddos&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;denial of service&quot;</span><span class="p">,</span> <span class="s2">&quot;ddos&quot;</span><span class="p">,</span> <span class="s2">&quot;flood attack&quot;</span><span class="p">,</span> <span class="s2">&quot;syn flood&quot;</span><span class="p">,</span> <span class="s2">&quot;udp flood&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-98"><a href="#DataProcessor.__init__-98"><span class="linenos"> 98</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;malware&quot;</span><span class="p">,</span> <span class="s2">&quot;virus&quot;</span><span class="p">,</span> <span class="s2">&quot;trojan&quot;</span><span class="p">,</span> <span class="s2">&quot;ransomware&quot;</span><span class="p">,</span> <span class="s2">&quot;botnet&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-99"><a href="#DataProcessor.__init__-99"><span class="linenos"> 99</span></a>            <span class="s2">&quot;phishing&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor.__init__-100"><a href="#DataProcessor.__init__-100"><span class="linenos">100</span></a>                <span class="s2">&quot;phishing&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-101"><a href="#DataProcessor.__init__-101"><span class="linenos">101</span></a>                <span class="s2">&quot;suspicious email&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-102"><a href="#DataProcessor.__init__-102"><span class="linenos">102</span></a>                <span class="s2">&quot;credential harvesting&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-103"><a href="#DataProcessor.__init__-103"><span class="linenos">103</span></a>                <span class="s2">&quot;social engineering&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-104"><a href="#DataProcessor.__init__-104"><span class="linenos">104</span></a>            <span class="p">],</span>
</span><span id="DataProcessor.__init__-105"><a href="#DataProcessor.__init__-105"><span class="linenos">105</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="DataProcessor.__init__-106"><a href="#DataProcessor.__init__-106"><span class="linenos">106</span></a>                <span class="s2">&quot;reconnaissance&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-107"><a href="#DataProcessor.__init__-107"><span class="linenos">107</span></a>                <span class="s2">&quot;information gathering&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-108"><a href="#DataProcessor.__init__-108"><span class="linenos">108</span></a>                <span class="s2">&quot;enumeration&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-109"><a href="#DataProcessor.__init__-109"><span class="linenos">109</span></a>                <span class="s2">&quot;network scan&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-110"><a href="#DataProcessor.__init__-110"><span class="linenos">110</span></a>            <span class="p">],</span>
</span><span id="DataProcessor.__init__-111"><a href="#DataProcessor.__init__-111"><span class="linenos">111</span></a>            <span class="s2">&quot;exploit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;exploit&quot;</span><span class="p">,</span> <span class="s2">&quot;vulnerability&quot;</span><span class="p">,</span> <span class="s2">&quot;cve&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer overflow&quot;</span><span class="p">,</span> <span class="s2">&quot;code injection&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-112"><a href="#DataProcessor.__init__-112"><span class="linenos">112</span></a>            <span class="s2">&quot;backdoor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;backdoor&quot;</span><span class="p">,</span> <span class="s2">&quot;reverse shell&quot;</span><span class="p">,</span> <span class="s2">&quot;command injection&quot;</span><span class="p">,</span> <span class="s2">&quot;remote access&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-113"><a href="#DataProcessor.__init__-113"><span class="linenos">113</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;data theft&quot;</span><span class="p">,</span> <span class="s2">&quot;exfiltration&quot;</span><span class="p">,</span> <span class="s2">&quot;sensitive data&quot;</span><span class="p">,</span> <span class="s2">&quot;confidential&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-114"><a href="#DataProcessor.__init__-114"><span class="linenos">114</span></a>            <span class="s2">&quot;privilege_escalation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;privilege escalation&quot;</span><span class="p">,</span> <span class="s2">&quot;sudo&quot;</span><span class="p">,</span> <span class="s2">&quot;root access&quot;</span><span class="p">,</span> <span class="s2">&quot;admin access&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-115"><a href="#DataProcessor.__init__-115"><span class="linenos">115</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;persistence&quot;</span><span class="p">,</span> <span class="s2">&quot;startup&quot;</span><span class="p">,</span> <span class="s2">&quot;registry&quot;</span><span class="p">,</span> <span class="s2">&quot;cron job&quot;</span><span class="p">,</span> <span class="s2">&quot;scheduled task&quot;</span><span class="p">],</span>
</span><span id="DataProcessor.__init__-116"><a href="#DataProcessor.__init__-116"><span class="linenos">116</span></a>        <span class="p">}</span>
</span><span id="DataProcessor.__init__-117"><a href="#DataProcessor.__init__-117"><span class="linenos">117</span></a>
</span><span id="DataProcessor.__init__-118"><a href="#DataProcessor.__init__-118"><span class="linenos">118</span></a>        <span class="c1"># DShield-specific severity mapping</span>
</span><span id="DataProcessor.__init__-119"><a href="#DataProcessor.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor.__init__-120"><a href="#DataProcessor.__init__-120"><span class="linenos">120</span></a>            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-121"><a href="#DataProcessor.__init__-121"><span class="linenos">121</span></a>            <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-122"><a href="#DataProcessor.__init__-122"><span class="linenos">122</span></a>            <span class="s2">&quot;medium&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-123"><a href="#DataProcessor.__init__-123"><span class="linenos">123</span></a>            <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-124"><a href="#DataProcessor.__init__-124"><span class="linenos">124</span></a>            <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-125"><a href="#DataProcessor.__init__-125"><span class="linenos">125</span></a>            <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-126"><a href="#DataProcessor.__init__-126"><span class="linenos">126</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-127"><a href="#DataProcessor.__init__-127"><span class="linenos">127</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-128"><a href="#DataProcessor.__init__-128"><span class="linenos">128</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-129"><a href="#DataProcessor.__init__-129"><span class="linenos">129</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-130"><a href="#DataProcessor.__init__-130"><span class="linenos">130</span></a>        <span class="p">}</span>
</span><span id="DataProcessor.__init__-131"><a href="#DataProcessor.__init__-131"><span class="linenos">131</span></a>
</span><span id="DataProcessor.__init__-132"><a href="#DataProcessor.__init__-132"><span class="linenos">132</span></a>        <span class="c1"># DShield-specific category mapping</span>
</span><span id="DataProcessor.__init__-133"><a href="#DataProcessor.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dshield_category_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor.__init__-134"><a href="#DataProcessor.__init__-134"><span class="linenos">134</span></a>            <span class="s2">&quot;attack&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ATTACK</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-135"><a href="#DataProcessor.__init__-135"><span class="linenos">135</span></a>            <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">BLOCK</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-136"><a href="#DataProcessor.__init__-136"><span class="linenos">136</span></a>            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">REPUTATION</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-137"><a href="#DataProcessor.__init__-137"><span class="linenos">137</span></a>            <span class="s2">&quot;geographic&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">GEOGRAPHIC</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-138"><a href="#DataProcessor.__init__-138"><span class="linenos">138</span></a>            <span class="s2">&quot;asn&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ASN</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-139"><a href="#DataProcessor.__init__-139"><span class="linenos">139</span></a>            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">ORGANIZATION</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-140"><a href="#DataProcessor.__init__-140"><span class="linenos">140</span></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PORT</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-141"><a href="#DataProcessor.__init__-141"><span class="linenos">141</span></a>            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">PROTOCOL</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-142"><a href="#DataProcessor.__init__-142"><span class="linenos">142</span></a>            <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-143"><a href="#DataProcessor.__init__-143"><span class="linenos">143</span></a>            <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">AUTHENTICATION</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-144"><a href="#DataProcessor.__init__-144"><span class="linenos">144</span></a>            <span class="s2">&quot;malware&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">MALWARE</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-145"><a href="#DataProcessor.__init__-145"><span class="linenos">145</span></a>            <span class="s2">&quot;intrusion&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">INTRUSION</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-146"><a href="#DataProcessor.__init__-146"><span class="linenos">146</span></a>            <span class="s2">&quot;data_exfiltration&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DATA_EXFILTRATION</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-147"><a href="#DataProcessor.__init__-147"><span class="linenos">147</span></a>            <span class="s2">&quot;reconnaissance&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">RECONNAISSANCE</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-148"><a href="#DataProcessor.__init__-148"><span class="linenos">148</span></a>            <span class="s2">&quot;denial_of_service&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">DENIAL_OF_SERVICE</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-149"><a href="#DataProcessor.__init__-149"><span class="linenos">149</span></a>            <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="n">EventCategory</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
</span><span id="DataProcessor.__init__-150"><a href="#DataProcessor.__init__-150"><span class="linenos">150</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the DataProcessor.</p>

<p>Sets up DShield-specific mappings for attack patterns, severity, and category.</p>
</div>


                            </div>
                            <div id="DataProcessor.dshield_attack_patterns" class="classattr">
                                <div class="attr variable">
            <span class="name">dshield_attack_patterns</span>


    </div>
    <a class="headerlink" href="#DataProcessor.dshield_attack_patterns"></a>



                            </div>
                            <div id="DataProcessor.dshield_severity_mapping" class="classattr">
                                <div class="attr variable">
            <span class="name">dshield_severity_mapping</span>


    </div>
    <a class="headerlink" href="#DataProcessor.dshield_severity_mapping"></a>



                            </div>
                            <div id="DataProcessor.dshield_category_mapping" class="classattr">
                                <div class="attr variable">
            <span class="name">dshield_category_mapping</span>


    </div>
    <a class="headerlink" href="#DataProcessor.dshield_category_mapping"></a>



                            </div>
                            <div id="DataProcessor.process_security_events" class="classattr">
                                        <input id="DataProcessor.process_security_events-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">process_security_events</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.process_security_events-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.process_security_events"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.process_security_events-152"><a href="#DataProcessor.process_security_events-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_security_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DataProcessor.process_security_events-153"><a href="#DataProcessor.process_security_events-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process and normalize security events from DShield SIEM.</span>
</span><span id="DataProcessor.process_security_events-154"><a href="#DataProcessor.process_security_events-154"><span class="linenos">154</span></a>
</span><span id="DataProcessor.process_security_events-155"><a href="#DataProcessor.process_security_events-155"><span class="linenos">155</span></a><span class="sd">        Normalizes, enriches, and detects attack patterns in a list of security events.</span>
</span><span id="DataProcessor.process_security_events-156"><a href="#DataProcessor.process_security_events-156"><span class="linenos">156</span></a><span class="sd">        Handles error logging and skips events that cannot be processed.</span>
</span><span id="DataProcessor.process_security_events-157"><a href="#DataProcessor.process_security_events-157"><span class="linenos">157</span></a>
</span><span id="DataProcessor.process_security_events-158"><a href="#DataProcessor.process_security_events-158"><span class="linenos">158</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor.process_security_events-159"><a href="#DataProcessor.process_security_events-159"><span class="linenos">159</span></a><span class="sd">            events: List of raw event dictionaries</span>
</span><span id="DataProcessor.process_security_events-160"><a href="#DataProcessor.process_security_events-160"><span class="linenos">160</span></a>
</span><span id="DataProcessor.process_security_events-161"><a href="#DataProcessor.process_security_events-161"><span class="linenos">161</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor.process_security_events-162"><a href="#DataProcessor.process_security_events-162"><span class="linenos">162</span></a><span class="sd">            List of processed and normalized event dictionaries</span>
</span><span id="DataProcessor.process_security_events-163"><a href="#DataProcessor.process_security_events-163"><span class="linenos">163</span></a>
</span><span id="DataProcessor.process_security_events-164"><a href="#DataProcessor.process_security_events-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor.process_security_events-165"><a href="#DataProcessor.process_security_events-165"><span class="linenos">165</span></a>        <span class="n">processed_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor.process_security_events-166"><a href="#DataProcessor.process_security_events-166"><span class="linenos">166</span></a>
</span><span id="DataProcessor.process_security_events-167"><a href="#DataProcessor.process_security_events-167"><span class="linenos">167</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.process_security_events-168"><a href="#DataProcessor.process_security_events-168"><span class="linenos">168</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor.process_security_events-169"><a href="#DataProcessor.process_security_events-169"><span class="linenos">169</span></a>                <span class="c1"># Skip None events</span>
</span><span id="DataProcessor.process_security_events-170"><a href="#DataProcessor.process_security_events-170"><span class="linenos">170</span></a>                <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataProcessor.process_security_events-171"><a href="#DataProcessor.process_security_events-171"><span class="linenos">171</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor.process_security_events-172"><a href="#DataProcessor.process_security_events-172"><span class="linenos">172</span></a>
</span><span id="DataProcessor.process_security_events-173"><a href="#DataProcessor.process_security_events-173"><span class="linenos">173</span></a>                <span class="c1"># Normalize event data</span>
</span><span id="DataProcessor.process_security_events-174"><a href="#DataProcessor.process_security_events-174"><span class="linenos">174</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DataProcessor.process_security_events-175"><a href="#DataProcessor.process_security_events-175"><span class="linenos">175</span></a>
</span><span id="DataProcessor.process_security_events-176"><a href="#DataProcessor.process_security_events-176"><span class="linenos">176</span></a>                <span class="c1"># Detect attack patterns</span>
</span><span id="DataProcessor.process_security_events-177"><a href="#DataProcessor.process_security_events-177"><span class="linenos">177</span></a>                <span class="n">normalized_event</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span>
</span><span id="DataProcessor.process_security_events-178"><a href="#DataProcessor.process_security_events-178"><span class="linenos">178</span></a>                    <span class="p">[</span><span class="n">normalized_event</span><span class="p">]</span>
</span><span id="DataProcessor.process_security_events-179"><a href="#DataProcessor.process_security_events-179"><span class="linenos">179</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.process_security_events-180"><a href="#DataProcessor.process_security_events-180"><span class="linenos">180</span></a>
</span><span id="DataProcessor.process_security_events-181"><a href="#DataProcessor.process_security_events-181"><span class="linenos">181</span></a>                <span class="c1"># Add DShield-specific enrichments</span>
</span><span id="DataProcessor.process_security_events-182"><a href="#DataProcessor.process_security_events-182"><span class="linenos">182</span></a>                <span class="n">normalized_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_dshield_data</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="DataProcessor.process_security_events-183"><a href="#DataProcessor.process_security_events-183"><span class="linenos">183</span></a>
</span><span id="DataProcessor.process_security_events-184"><a href="#DataProcessor.process_security_events-184"><span class="linenos">184</span></a>                <span class="n">processed_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalized_event</span><span class="p">)</span>
</span><span id="DataProcessor.process_security_events-185"><a href="#DataProcessor.process_security_events-185"><span class="linenos">185</span></a>
</span><span id="DataProcessor.process_security_events-186"><a href="#DataProcessor.process_security_events-186"><span class="linenos">186</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor.process_security_events-187"><a href="#DataProcessor.process_security_events-187"><span class="linenos">187</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor.process_security_events-188"><a href="#DataProcessor.process_security_events-188"><span class="linenos">188</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_security_events-189"><a href="#DataProcessor.process_security_events-189"><span class="linenos">189</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_security_events-190"><a href="#DataProcessor.process_security_events-190"><span class="linenos">190</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor.process_security_events-191"><a href="#DataProcessor.process_security_events-191"><span class="linenos">191</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_security_events-192"><a href="#DataProcessor.process_security_events-192"><span class="linenos">192</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor.process_security_events-193"><a href="#DataProcessor.process_security_events-193"><span class="linenos">193</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_security_events-194"><a href="#DataProcessor.process_security_events-194"><span class="linenos">194</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.process_security_events-195"><a href="#DataProcessor.process_security_events-195"><span class="linenos">195</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_security_events-196"><a href="#DataProcessor.process_security_events-196"><span class="linenos">196</span></a>                        <span class="s2">&quot;Failed to process event&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_security_events-197"><a href="#DataProcessor.process_security_events-197"><span class="linenos">197</span></a>                        <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor.process_security_events-198"><a href="#DataProcessor.process_security_events-198"><span class="linenos">198</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_security_events-199"><a href="#DataProcessor.process_security_events-199"><span class="linenos">199</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_security_events-200"><a href="#DataProcessor.process_security_events-200"><span class="linenos">200</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor.process_security_events-201"><a href="#DataProcessor.process_security_events-201"><span class="linenos">201</span></a>
</span><span id="DataProcessor.process_security_events-202"><a href="#DataProcessor.process_security_events-202"><span class="linenos">202</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="DataProcessor.process_security_events-203"><a href="#DataProcessor.process_security_events-203"><span class="linenos">203</span></a>            <span class="s2">&quot;Processed security events&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_security_events-204"><a href="#DataProcessor.process_security_events-204"><span class="linenos">204</span></a>            <span class="n">total_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.process_security_events-205"><a href="#DataProcessor.process_security_events-205"><span class="linenos">205</span></a>            <span class="n">processed_events</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_events</span><span class="p">),</span>
</span><span id="DataProcessor.process_security_events-206"><a href="#DataProcessor.process_security_events-206"><span class="linenos">206</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.process_security_events-207"><a href="#DataProcessor.process_security_events-207"><span class="linenos">207</span></a>
</span><span id="DataProcessor.process_security_events-208"><a href="#DataProcessor.process_security_events-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="n">processed_events</span>
</span></pre></div>


            <div class="docstring"><p>Process and normalize security events from DShield SIEM.</p>

<p>Normalizes, enriches, and detects attack patterns in a list of security events.
Handles error logging and skips events that cannot be processed.</p>

<p>Args:
    events: List of raw event dictionaries</p>

<p>Returns:
    List of processed and normalized event dictionaries</p>
</div>


                            </div>
                            <div id="DataProcessor.process_dshield_attacks" class="classattr">
                                        <input id="DataProcessor.process_dshield_attacks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">process_dshield_attacks</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">attacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="models.html#DShieldAttack">src.models.DShieldAttack</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.process_dshield_attacks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.process_dshield_attacks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.process_dshield_attacks-210"><a href="#DataProcessor.process_dshield_attacks-210"><span class="linenos">210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_attacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldAttack</span><span class="p">]:</span>
</span><span id="DataProcessor.process_dshield_attacks-211"><a href="#DataProcessor.process_dshield_attacks-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield attack events into structured format.</span>
</span><span id="DataProcessor.process_dshield_attacks-212"><a href="#DataProcessor.process_dshield_attacks-212"><span class="linenos">212</span></a>
</span><span id="DataProcessor.process_dshield_attacks-213"><a href="#DataProcessor.process_dshield_attacks-213"><span class="linenos">213</span></a><span class="sd">        Converts raw attack event dictionaries into DShieldAttack model instances.</span>
</span><span id="DataProcessor.process_dshield_attacks-214"><a href="#DataProcessor.process_dshield_attacks-214"><span class="linenos">214</span></a><span class="sd">        Handles error logging and skips attacks that cannot be processed.</span>
</span><span id="DataProcessor.process_dshield_attacks-215"><a href="#DataProcessor.process_dshield_attacks-215"><span class="linenos">215</span></a>
</span><span id="DataProcessor.process_dshield_attacks-216"><a href="#DataProcessor.process_dshield_attacks-216"><span class="linenos">216</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor.process_dshield_attacks-217"><a href="#DataProcessor.process_dshield_attacks-217"><span class="linenos">217</span></a><span class="sd">            attacks: List of raw attack event dictionaries</span>
</span><span id="DataProcessor.process_dshield_attacks-218"><a href="#DataProcessor.process_dshield_attacks-218"><span class="linenos">218</span></a>
</span><span id="DataProcessor.process_dshield_attacks-219"><a href="#DataProcessor.process_dshield_attacks-219"><span class="linenos">219</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor.process_dshield_attacks-220"><a href="#DataProcessor.process_dshield_attacks-220"><span class="linenos">220</span></a><span class="sd">            List of DShieldAttack model instances</span>
</span><span id="DataProcessor.process_dshield_attacks-221"><a href="#DataProcessor.process_dshield_attacks-221"><span class="linenos">221</span></a>
</span><span id="DataProcessor.process_dshield_attacks-222"><a href="#DataProcessor.process_dshield_attacks-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor.process_dshield_attacks-223"><a href="#DataProcessor.process_dshield_attacks-223"><span class="linenos">223</span></a>        <span class="n">processed_attacks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor.process_dshield_attacks-224"><a href="#DataProcessor.process_dshield_attacks-224"><span class="linenos">224</span></a>
</span><span id="DataProcessor.process_dshield_attacks-225"><a href="#DataProcessor.process_dshield_attacks-225"><span class="linenos">225</span></a>        <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">attacks</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_attacks-226"><a href="#DataProcessor.process_dshield_attacks-226"><span class="linenos">226</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_attacks-227"><a href="#DataProcessor.process_dshield_attacks-227"><span class="linenos">227</span></a>                <span class="c1"># Create DShieldAttack object</span>
</span><span id="DataProcessor.process_dshield_attacks-228"><a href="#DataProcessor.process_dshield_attacks-228"><span class="linenos">228</span></a>                <span class="n">dshield_attack</span> <span class="o">=</span> <span class="n">DShieldAttack</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_attacks-229"><a href="#DataProcessor.process_dshield_attacks-229"><span class="linenos">229</span></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
</span><span id="DataProcessor.process_dshield_attacks-230"><a href="#DataProcessor.process_dshield_attacks-230"><span class="linenos">230</span></a>                    <span class="n">timestamp</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)),</span>
</span><span id="DataProcessor.process_dshield_attacks-231"><a href="#DataProcessor.process_dshield_attacks-231"><span class="linenos">231</span></a>                    <span class="n">source_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-232"><a href="#DataProcessor.process_dshield_attacks-232"><span class="linenos">232</span></a>                    <span class="n">destination_ip</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-233"><a href="#DataProcessor.process_dshield_attacks-233"><span class="linenos">233</span></a>                    <span class="n">source_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-234"><a href="#DataProcessor.process_dshield_attacks-234"><span class="linenos">234</span></a>                    <span class="n">destination_port</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-235"><a href="#DataProcessor.process_dshield_attacks-235"><span class="linenos">235</span></a>                    <span class="n">protocol</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-236"><a href="#DataProcessor.process_dshield_attacks-236"><span class="linenos">236</span></a>                    <span class="n">attack_type</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-237"><a href="#DataProcessor.process_dshield_attacks-237"><span class="linenos">237</span></a>                    <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dshield_severity_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_attacks-238"><a href="#DataProcessor.process_dshield_attacks-238"><span class="linenos">238</span></a>                        <span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-239"><a href="#DataProcessor.process_dshield_attacks-239"><span class="linenos">239</span></a>                        <span class="n">EventSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_attacks-240"><a href="#DataProcessor.process_dshield_attacks-240"><span class="linenos">240</span></a>                    <span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-241"><a href="#DataProcessor.process_dshield_attacks-241"><span class="linenos">241</span></a>                    <span class="n">description</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-242"><a href="#DataProcessor.process_dshield_attacks-242"><span class="linenos">242</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-243"><a href="#DataProcessor.process_dshield_attacks-243"><span class="linenos">243</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-244"><a href="#DataProcessor.process_dshield_attacks-244"><span class="linenos">244</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-245"><a href="#DataProcessor.process_dshield_attacks-245"><span class="linenos">245</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-246"><a href="#DataProcessor.process_dshield_attacks-246"><span class="linenos">246</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-247"><a href="#DataProcessor.process_dshield_attacks-247"><span class="linenos">247</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-248"><a href="#DataProcessor.process_dshield_attacks-248"><span class="linenos">248</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-249"><a href="#DataProcessor.process_dshield_attacks-249"><span class="linenos">249</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_attacks-250"><a href="#DataProcessor.process_dshield_attacks-250"><span class="linenos">250</span></a>                    <span class="n">attack_methods</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_attacks-251"><a href="#DataProcessor.process_dshield_attacks-251"><span class="linenos">251</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor.process_dshield_attacks-252"><a href="#DataProcessor.process_dshield_attacks-252"><span class="linenos">252</span></a>                    <span class="n">indices</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_attacks-253"><a href="#DataProcessor.process_dshield_attacks-253"><span class="linenos">253</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_attacks-254"><a href="#DataProcessor.process_dshield_attacks-254"><span class="linenos">254</span></a>
</span><span id="DataProcessor.process_dshield_attacks-255"><a href="#DataProcessor.process_dshield_attacks-255"><span class="linenos">255</span></a>                <span class="n">processed_attacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attack</span><span class="p">)</span>
</span><span id="DataProcessor.process_dshield_attacks-256"><a href="#DataProcessor.process_dshield_attacks-256"><span class="linenos">256</span></a>
</span><span id="DataProcessor.process_dshield_attacks-257"><a href="#DataProcessor.process_dshield_attacks-257"><span class="linenos">257</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_attacks-258"><a href="#DataProcessor.process_dshield_attacks-258"><span class="linenos">258</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor.process_dshield_attacks-259"><a href="#DataProcessor.process_dshield_attacks-259"><span class="linenos">259</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_attacks-260"><a href="#DataProcessor.process_dshield_attacks-260"><span class="linenos">260</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_attacks-261"><a href="#DataProcessor.process_dshield_attacks-261"><span class="linenos">261</span></a>                        <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-262"><a href="#DataProcessor.process_dshield_attacks-262"><span class="linenos">262</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_attacks-263"><a href="#DataProcessor.process_dshield_attacks-263"><span class="linenos">263</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor.process_dshield_attacks-264"><a href="#DataProcessor.process_dshield_attacks-264"><span class="linenos">264</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_attacks-265"><a href="#DataProcessor.process_dshield_attacks-265"><span class="linenos">265</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_attacks-266"><a href="#DataProcessor.process_dshield_attacks-266"><span class="linenos">266</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_attacks-267"><a href="#DataProcessor.process_dshield_attacks-267"><span class="linenos">267</span></a>                        <span class="s2">&quot;Failed to process DShield attack&quot;</span><span class="p">,</span> <span class="n">attack_id</span><span class="o">=</span><span class="n">attack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="DataProcessor.process_dshield_attacks-268"><a href="#DataProcessor.process_dshield_attacks-268"><span class="linenos">268</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_attacks-269"><a href="#DataProcessor.process_dshield_attacks-269"><span class="linenos">269</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor.process_dshield_attacks-270"><a href="#DataProcessor.process_dshield_attacks-270"><span class="linenos">270</span></a>
</span><span id="DataProcessor.process_dshield_attacks-271"><a href="#DataProcessor.process_dshield_attacks-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="n">processed_attacks</span>
</span></pre></div>


            <div class="docstring"><p>Process DShield attack events into structured format.</p>

<p>Converts raw attack event dictionaries into DShieldAttack model instances.
Handles error logging and skips attacks that cannot be processed.</p>

<p>Args:
    attacks: List of raw attack event dictionaries</p>

<p>Returns:
    List of DShieldAttack model instances</p>
</div>


                            </div>
                            <div id="DataProcessor.process_dshield_reputation" class="classattr">
                                        <input id="DataProcessor.process_dshield_reputation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">process_dshield_reputation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">reputation_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="models.html#DShieldReputation">src.models.DShieldReputation</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.process_dshield_reputation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.process_dshield_reputation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.process_dshield_reputation-273"><a href="#DataProcessor.process_dshield_reputation-273"><span class="linenos">273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_reputation</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_reputation-274"><a href="#DataProcessor.process_dshield_reputation-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">reputation_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor.process_dshield_reputation-275"><a href="#DataProcessor.process_dshield_reputation-275"><span class="linenos">275</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DShieldReputation</span><span class="p">]:</span>
</span><span id="DataProcessor.process_dshield_reputation-276"><a href="#DataProcessor.process_dshield_reputation-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield reputation data into structured format.</span>
</span><span id="DataProcessor.process_dshield_reputation-277"><a href="#DataProcessor.process_dshield_reputation-277"><span class="linenos">277</span></a>
</span><span id="DataProcessor.process_dshield_reputation-278"><a href="#DataProcessor.process_dshield_reputation-278"><span class="linenos">278</span></a><span class="sd">        Converts raw reputation data dictionaries into DShieldReputation model instances.</span>
</span><span id="DataProcessor.process_dshield_reputation-279"><a href="#DataProcessor.process_dshield_reputation-279"><span class="linenos">279</span></a><span class="sd">        Handles error logging and skips entries that cannot be processed.</span>
</span><span id="DataProcessor.process_dshield_reputation-280"><a href="#DataProcessor.process_dshield_reputation-280"><span class="linenos">280</span></a>
</span><span id="DataProcessor.process_dshield_reputation-281"><a href="#DataProcessor.process_dshield_reputation-281"><span class="linenos">281</span></a><span class="sd">        Args:</span>
</span><span id="DataProcessor.process_dshield_reputation-282"><a href="#DataProcessor.process_dshield_reputation-282"><span class="linenos">282</span></a><span class="sd">            reputation_data: List of raw reputation data dictionaries</span>
</span><span id="DataProcessor.process_dshield_reputation-283"><a href="#DataProcessor.process_dshield_reputation-283"><span class="linenos">283</span></a>
</span><span id="DataProcessor.process_dshield_reputation-284"><a href="#DataProcessor.process_dshield_reputation-284"><span class="linenos">284</span></a><span class="sd">        Returns:</span>
</span><span id="DataProcessor.process_dshield_reputation-285"><a href="#DataProcessor.process_dshield_reputation-285"><span class="linenos">285</span></a><span class="sd">            Dictionary mapping IP addresses to DShieldReputation model instances</span>
</span><span id="DataProcessor.process_dshield_reputation-286"><a href="#DataProcessor.process_dshield_reputation-286"><span class="linenos">286</span></a>
</span><span id="DataProcessor.process_dshield_reputation-287"><a href="#DataProcessor.process_dshield_reputation-287"><span class="linenos">287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataProcessor.process_dshield_reputation-288"><a href="#DataProcessor.process_dshield_reputation-288"><span class="linenos">288</span></a>        <span class="n">processed_reputation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataProcessor.process_dshield_reputation-289"><a href="#DataProcessor.process_dshield_reputation-289"><span class="linenos">289</span></a>
</span><span id="DataProcessor.process_dshield_reputation-290"><a href="#DataProcessor.process_dshield_reputation-290"><span class="linenos">290</span></a>        <span class="k">for</span> <span class="n">rep_data</span> <span class="ow">in</span> <span class="n">reputation_data</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_reputation-291"><a href="#DataProcessor.process_dshield_reputation-291"><span class="linenos">291</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_reputation-292"><a href="#DataProcessor.process_dshield_reputation-292"><span class="linenos">292</span></a>                <span class="n">ip_address</span> <span class="o">=</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ip_address&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.process_dshield_reputation-293"><a href="#DataProcessor.process_dshield_reputation-293"><span class="linenos">293</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_address</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_reputation-294"><a href="#DataProcessor.process_dshield_reputation-294"><span class="linenos">294</span></a>                    <span class="k">continue</span>
</span><span id="DataProcessor.process_dshield_reputation-295"><a href="#DataProcessor.process_dshield_reputation-295"><span class="linenos">295</span></a>
</span><span id="DataProcessor.process_dshield_reputation-296"><a href="#DataProcessor.process_dshield_reputation-296"><span class="linenos">296</span></a>                <span class="c1"># Create DShieldReputation object</span>
</span><span id="DataProcessor.process_dshield_reputation-297"><a href="#DataProcessor.process_dshield_reputation-297"><span class="linenos">297</span></a>                <span class="n">dshield_rep</span> <span class="o">=</span> <span class="n">DShieldReputation</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_reputation-298"><a href="#DataProcessor.process_dshield_reputation-298"><span class="linenos">298</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">ip_address</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_reputation-299"><a href="#DataProcessor.process_dshield_reputation-299"><span class="linenos">299</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-300"><a href="#DataProcessor.process_dshield_reputation-300"><span class="linenos">300</span></a>                    <span class="n">threat_level</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threat_level&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-301"><a href="#DataProcessor.process_dshield_reputation-301"><span class="linenos">301</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-302"><a href="#DataProcessor.process_dshield_reputation-302"><span class="linenos">302</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-303"><a href="#DataProcessor.process_dshield_reputation-303"><span class="linenos">303</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-304"><a href="#DataProcessor.process_dshield_reputation-304"><span class="linenos">304</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-305"><a href="#DataProcessor.process_dshield_reputation-305"><span class="linenos">305</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-306"><a href="#DataProcessor.process_dshield_reputation-306"><span class="linenos">306</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_reputation-307"><a href="#DataProcessor.process_dshield_reputation-307"><span class="linenos">307</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_reputation-308"><a href="#DataProcessor.process_dshield_reputation-308"><span class="linenos">308</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-309"><a href="#DataProcessor.process_dshield_reputation-309"><span class="linenos">309</span></a>                    <span class="n">port_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-310"><a href="#DataProcessor.process_dshield_reputation-310"><span class="linenos">310</span></a>                    <span class="n">service_count</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;service_count&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-311"><a href="#DataProcessor.process_dshield_reputation-311"><span class="linenos">311</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor.process_dshield_reputation-312"><a href="#DataProcessor.process_dshield_reputation-312"><span class="linenos">312</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_reputation-313"><a href="#DataProcessor.process_dshield_reputation-313"><span class="linenos">313</span></a>
</span><span id="DataProcessor.process_dshield_reputation-314"><a href="#DataProcessor.process_dshield_reputation-314"><span class="linenos">314</span></a>                <span class="n">processed_reputation</span><span class="p">[</span><span class="n">ip_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">dshield_rep</span>
</span><span id="DataProcessor.process_dshield_reputation-315"><a href="#DataProcessor.process_dshield_reputation-315"><span class="linenos">315</span></a>
</span><span id="DataProcessor.process_dshield_reputation-316"><a href="#DataProcessor.process_dshield_reputation-316"><span class="linenos">316</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_reputation-317"><a href="#DataProcessor.process_dshield_reputation-317"><span class="linenos">317</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor.process_dshield_reputation-318"><a href="#DataProcessor.process_dshield_reputation-318"><span class="linenos">318</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_reputation-319"><a href="#DataProcessor.process_dshield_reputation-319"><span class="linenos">319</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_reputation-320"><a href="#DataProcessor.process_dshield_reputation-320"><span class="linenos">320</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-321"><a href="#DataProcessor.process_dshield_reputation-321"><span class="linenos">321</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-322"><a href="#DataProcessor.process_dshield_reputation-322"><span class="linenos">322</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor.process_dshield_reputation-323"><a href="#DataProcessor.process_dshield_reputation-323"><span class="linenos">323</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_reputation-324"><a href="#DataProcessor.process_dshield_reputation-324"><span class="linenos">324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_reputation-325"><a href="#DataProcessor.process_dshield_reputation-325"><span class="linenos">325</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_reputation-326"><a href="#DataProcessor.process_dshield_reputation-326"><span class="linenos">326</span></a>                        <span class="s2">&quot;Failed to process DShield reputation&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_reputation-327"><a href="#DataProcessor.process_dshield_reputation-327"><span class="linenos">327</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">rep_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-328"><a href="#DataProcessor.process_dshield_reputation-328"><span class="linenos">328</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_reputation-329"><a href="#DataProcessor.process_dshield_reputation-329"><span class="linenos">329</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_reputation-330"><a href="#DataProcessor.process_dshield_reputation-330"><span class="linenos">330</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor.process_dshield_reputation-331"><a href="#DataProcessor.process_dshield_reputation-331"><span class="linenos">331</span></a>
</span><span id="DataProcessor.process_dshield_reputation-332"><a href="#DataProcessor.process_dshield_reputation-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="n">processed_reputation</span>
</span></pre></div>


            <div class="docstring"><p>Process DShield reputation data into structured format.</p>

<p>Converts raw reputation data dictionaries into DShieldReputation model instances.
Handles error logging and skips entries that cannot be processed.</p>

<p>Args:
    reputation_data: List of raw reputation data dictionaries</p>

<p>Returns:
    Dictionary mapping IP addresses to DShieldReputation model instances</p>
</div>


                            </div>
                            <div id="DataProcessor.process_dshield_top_attackers" class="classattr">
                                        <input id="DataProcessor.process_dshield_top_attackers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">process_dshield_top_attackers</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">attackers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="models.html#DShieldTopAttacker">src.models.DShieldTopAttacker</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.process_dshield_top_attackers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.process_dshield_top_attackers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.process_dshield_top_attackers-334"><a href="#DataProcessor.process_dshield_top_attackers-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_top_attackers-335"><a href="#DataProcessor.process_dshield_top_attackers-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">attackers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="DataProcessor.process_dshield_top_attackers-336"><a href="#DataProcessor.process_dshield_top_attackers-336"><span class="linenos">336</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DShieldTopAttacker</span><span class="p">]:</span>
</span><span id="DataProcessor.process_dshield_top_attackers-337"><a href="#DataProcessor.process_dshield_top_attackers-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process DShield top attackers data into structured format.&quot;&quot;&quot;</span>
</span><span id="DataProcessor.process_dshield_top_attackers-338"><a href="#DataProcessor.process_dshield_top_attackers-338"><span class="linenos">338</span></a>        <span class="n">processed_attackers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataProcessor.process_dshield_top_attackers-339"><a href="#DataProcessor.process_dshield_top_attackers-339"><span class="linenos">339</span></a>
</span><span id="DataProcessor.process_dshield_top_attackers-340"><a href="#DataProcessor.process_dshield_top_attackers-340"><span class="linenos">340</span></a>        <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">attackers</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_top_attackers-341"><a href="#DataProcessor.process_dshield_top_attackers-341"><span class="linenos">341</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_top_attackers-342"><a href="#DataProcessor.process_dshield_top_attackers-342"><span class="linenos">342</span></a>                <span class="c1"># Create DShieldTopAttacker object</span>
</span><span id="DataProcessor.process_dshield_top_attackers-343"><a href="#DataProcessor.process_dshield_top_attackers-343"><span class="linenos">343</span></a>                <span class="n">dshield_attacker</span> <span class="o">=</span> <span class="n">DShieldTopAttacker</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_top_attackers-344"><a href="#DataProcessor.process_dshield_top_attackers-344"><span class="linenos">344</span></a>                    <span class="n">ip_address</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-345"><a href="#DataProcessor.process_dshield_top_attackers-345"><span class="linenos">345</span></a>                    <span class="n">attack_count</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-346"><a href="#DataProcessor.process_dshield_top_attackers-346"><span class="linenos">346</span></a>                    <span class="n">country</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-347"><a href="#DataProcessor.process_dshield_top_attackers-347"><span class="linenos">347</span></a>                    <span class="n">asn</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-348"><a href="#DataProcessor.process_dshield_top_attackers-348"><span class="linenos">348</span></a>                    <span class="n">organization</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-349"><a href="#DataProcessor.process_dshield_top_attackers-349"><span class="linenos">349</span></a>                    <span class="n">reputation_score</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-350"><a href="#DataProcessor.process_dshield_top_attackers-350"><span class="linenos">350</span></a>                    <span class="n">first_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-351"><a href="#DataProcessor.process_dshield_top_attackers-351"><span class="linenos">351</span></a>                    <span class="n">last_seen</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_seen&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-352"><a href="#DataProcessor.process_dshield_top_attackers-352"><span class="linenos">352</span></a>                    <span class="n">attack_types</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_types&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-353"><a href="#DataProcessor.process_dshield_top_attackers-353"><span class="linenos">353</span></a>                    <span class="n">tags</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-354"><a href="#DataProcessor.process_dshield_top_attackers-354"><span class="linenos">354</span></a>                    <span class="n">target_ports</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_ports&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-355"><a href="#DataProcessor.process_dshield_top_attackers-355"><span class="linenos">355</span></a>                    <span class="n">target_services</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_services&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-356"><a href="#DataProcessor.process_dshield_top_attackers-356"><span class="linenos">356</span></a>                    <span class="n">raw_data</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-357"><a href="#DataProcessor.process_dshield_top_attackers-357"><span class="linenos">357</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_top_attackers-358"><a href="#DataProcessor.process_dshield_top_attackers-358"><span class="linenos">358</span></a>
</span><span id="DataProcessor.process_dshield_top_attackers-359"><a href="#DataProcessor.process_dshield_top_attackers-359"><span class="linenos">359</span></a>                <span class="n">processed_attackers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dshield_attacker</span><span class="p">)</span>
</span><span id="DataProcessor.process_dshield_top_attackers-360"><a href="#DataProcessor.process_dshield_top_attackers-360"><span class="linenos">360</span></a>
</span><span id="DataProcessor.process_dshield_top_attackers-361"><a href="#DataProcessor.process_dshield_top_attackers-361"><span class="linenos">361</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_top_attackers-362"><a href="#DataProcessor.process_dshield_top_attackers-362"><span class="linenos">362</span></a>                <span class="k">if</span> <span class="n">_is_debug_mode</span><span class="p">():</span>
</span><span id="DataProcessor.process_dshield_top_attackers-363"><a href="#DataProcessor.process_dshield_top_attackers-363"><span class="linenos">363</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_top_attackers-364"><a href="#DataProcessor.process_dshield_top_attackers-364"><span class="linenos">364</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_top_attackers-365"><a href="#DataProcessor.process_dshield_top_attackers-365"><span class="linenos">365</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-366"><a href="#DataProcessor.process_dshield_top_attackers-366"><span class="linenos">366</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-367"><a href="#DataProcessor.process_dshield_top_attackers-367"><span class="linenos">367</span></a>                        <span class="n">stack_trace</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-368"><a href="#DataProcessor.process_dshield_top_attackers-368"><span class="linenos">368</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_top_attackers-369"><a href="#DataProcessor.process_dshield_top_attackers-369"><span class="linenos">369</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.process_dshield_top_attackers-370"><a href="#DataProcessor.process_dshield_top_attackers-370"><span class="linenos">370</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="DataProcessor.process_dshield_top_attackers-371"><a href="#DataProcessor.process_dshield_top_attackers-371"><span class="linenos">371</span></a>                        <span class="s2">&quot;Failed to process DShield top attacker&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.process_dshield_top_attackers-372"><a href="#DataProcessor.process_dshield_top_attackers-372"><span class="linenos">372</span></a>                        <span class="n">ip</span><span class="o">=</span><span class="n">attacker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-373"><a href="#DataProcessor.process_dshield_top_attackers-373"><span class="linenos">373</span></a>                        <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="DataProcessor.process_dshield_top_attackers-374"><a href="#DataProcessor.process_dshield_top_attackers-374"><span class="linenos">374</span></a>                    <span class="p">)</span>
</span><span id="DataProcessor.process_dshield_top_attackers-375"><a href="#DataProcessor.process_dshield_top_attackers-375"><span class="linenos">375</span></a>                <span class="k">continue</span>
</span><span id="DataProcessor.process_dshield_top_attackers-376"><a href="#DataProcessor.process_dshield_top_attackers-376"><span class="linenos">376</span></a>
</span><span id="DataProcessor.process_dshield_top_attackers-377"><a href="#DataProcessor.process_dshield_top_attackers-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">processed_attackers</span>
</span></pre></div>


            <div class="docstring"><p>Process DShield top attackers data into structured format.</p>
</div>


                            </div>
                            <div id="DataProcessor.generate_dshield_summary" class="classattr">
                                        <input id="DataProcessor.generate_dshield_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">generate_dshield_summary</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="models.html#DShieldStatistics">src.models.DShieldStatistics</a></span>:</span></span>

                <label class="view-source-button" for="DataProcessor.generate_dshield_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.generate_dshield_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.generate_dshield_summary-379"><a href="#DataProcessor.generate_dshield_summary-379"><span class="linenos">379</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dshield_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">DShieldStatistics</span><span class="p">:</span>
</span><span id="DataProcessor.generate_dshield_summary-380"><a href="#DataProcessor.generate_dshield_summary-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DShield-specific security summary.&quot;&quot;&quot;</span>
</span><span id="DataProcessor.generate_dshield_summary-381"><a href="#DataProcessor.generate_dshield_summary-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.generate_dshield_summary-382"><a href="#DataProcessor.generate_dshield_summary-382"><span class="linenos">382</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_dshield_statistics</span><span class="p">()</span>
</span><span id="DataProcessor.generate_dshield_summary-383"><a href="#DataProcessor.generate_dshield_summary-383"><span class="linenos">383</span></a>
</span><span id="DataProcessor.generate_dshield_summary-384"><a href="#DataProcessor.generate_dshield_summary-384"><span class="linenos">384</span></a>        <span class="c1"># Extract DShield-specific data</span>
</span><span id="DataProcessor.generate_dshield_summary-385"><a href="#DataProcessor.generate_dshield_summary-385"><span class="linenos">385</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.generate_dshield_summary-386"><a href="#DataProcessor.generate_dshield_summary-386"><span class="linenos">386</span></a>
</span><span id="DataProcessor.generate_dshield_summary-387"><a href="#DataProcessor.generate_dshield_summary-387"><span class="linenos">387</span></a>        <span class="c1"># Compile statistics</span>
</span><span id="DataProcessor.generate_dshield_summary-388"><a href="#DataProcessor.generate_dshield_summary-388"><span class="linenos">388</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">DShieldStatistics</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-389"><a href="#DataProcessor.generate_dshield_summary-389"><span class="linenos">389</span></a>            <span class="n">time_range_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="DataProcessor.generate_dshield_summary-390"><a href="#DataProcessor.generate_dshield_summary-390"><span class="linenos">390</span></a>            <span class="n">total_attacks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dshield_attacks</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-391"><a href="#DataProcessor.generate_dshield_summary-391"><span class="linenos">391</span></a>            <span class="n">unique_attackers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-392"><a href="#DataProcessor.generate_dshield_summary-392"><span class="linenos">392</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-393"><a href="#DataProcessor.generate_dshield_summary-393"><span class="linenos">393</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-394"><a href="#DataProcessor.generate_dshield_summary-394"><span class="linenos">394</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-395"><a href="#DataProcessor.generate_dshield_summary-395"><span class="linenos">395</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-396"><a href="#DataProcessor.generate_dshield_summary-396"><span class="linenos">396</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="DataProcessor.generate_dshield_summary-397"><a href="#DataProcessor.generate_dshield_summary-397"><span class="linenos">397</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-398"><a href="#DataProcessor.generate_dshield_summary-398"><span class="linenos">398</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-399"><a href="#DataProcessor.generate_dshield_summary-399"><span class="linenos">399</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-400"><a href="#DataProcessor.generate_dshield_summary-400"><span class="linenos">400</span></a>            <span class="n">total_targets</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-401"><a href="#DataProcessor.generate_dshield_summary-401"><span class="linenos">401</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-402"><a href="#DataProcessor.generate_dshield_summary-402"><span class="linenos">402</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-403"><a href="#DataProcessor.generate_dshield_summary-403"><span class="linenos">403</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-404"><a href="#DataProcessor.generate_dshield_summary-404"><span class="linenos">404</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-405"><a href="#DataProcessor.generate_dshield_summary-405"><span class="linenos">405</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dshield_attacks</span>
</span><span id="DataProcessor.generate_dshield_summary-406"><a href="#DataProcessor.generate_dshield_summary-406"><span class="linenos">406</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-407"><a href="#DataProcessor.generate_dshield_summary-407"><span class="linenos">407</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-408"><a href="#DataProcessor.generate_dshield_summary-408"><span class="linenos">408</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-409"><a href="#DataProcessor.generate_dshield_summary-409"><span class="linenos">409</span></a>            <span class="n">countries_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-410"><a href="#DataProcessor.generate_dshield_summary-410"><span class="linenos">410</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-411"><a href="#DataProcessor.generate_dshield_summary-411"><span class="linenos">411</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-412"><a href="#DataProcessor.generate_dshield_summary-412"><span class="linenos">412</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-413"><a href="#DataProcessor.generate_dshield_summary-413"><span class="linenos">413</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-414"><a href="#DataProcessor.generate_dshield_summary-414"><span class="linenos">414</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_dshield_summary-415"><a href="#DataProcessor.generate_dshield_summary-415"><span class="linenos">415</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-416"><a href="#DataProcessor.generate_dshield_summary-416"><span class="linenos">416</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-417"><a href="#DataProcessor.generate_dshield_summary-417"><span class="linenos">417</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-418"><a href="#DataProcessor.generate_dshield_summary-418"><span class="linenos">418</span></a>            <span class="n">ports_targeted</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-419"><a href="#DataProcessor.generate_dshield_summary-419"><span class="linenos">419</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-420"><a href="#DataProcessor.generate_dshield_summary-420"><span class="linenos">420</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-421"><a href="#DataProcessor.generate_dshield_summary-421"><span class="linenos">421</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-422"><a href="#DataProcessor.generate_dshield_summary-422"><span class="linenos">422</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-423"><a href="#DataProcessor.generate_dshield_summary-423"><span class="linenos">423</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_dshield_summary-424"><a href="#DataProcessor.generate_dshield_summary-424"><span class="linenos">424</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_port&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-425"><a href="#DataProcessor.generate_dshield_summary-425"><span class="linenos">425</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-426"><a href="#DataProcessor.generate_dshield_summary-426"><span class="linenos">426</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-427"><a href="#DataProcessor.generate_dshield_summary-427"><span class="linenos">427</span></a>            <span class="n">protocols_used</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-428"><a href="#DataProcessor.generate_dshield_summary-428"><span class="linenos">428</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-429"><a href="#DataProcessor.generate_dshield_summary-429"><span class="linenos">429</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-430"><a href="#DataProcessor.generate_dshield_summary-430"><span class="linenos">430</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-431"><a href="#DataProcessor.generate_dshield_summary-431"><span class="linenos">431</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-432"><a href="#DataProcessor.generate_dshield_summary-432"><span class="linenos">432</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_dshield_summary-433"><a href="#DataProcessor.generate_dshield_summary-433"><span class="linenos">433</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-434"><a href="#DataProcessor.generate_dshield_summary-434"><span class="linenos">434</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-435"><a href="#DataProcessor.generate_dshield_summary-435"><span class="linenos">435</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-436"><a href="#DataProcessor.generate_dshield_summary-436"><span class="linenos">436</span></a>            <span class="n">asns_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-437"><a href="#DataProcessor.generate_dshield_summary-437"><span class="linenos">437</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-438"><a href="#DataProcessor.generate_dshield_summary-438"><span class="linenos">438</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-439"><a href="#DataProcessor.generate_dshield_summary-439"><span class="linenos">439</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_dshield_summary-440"><a href="#DataProcessor.generate_dshield_summary-440"><span class="linenos">440</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asn&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-441"><a href="#DataProcessor.generate_dshield_summary-441"><span class="linenos">441</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-442"><a href="#DataProcessor.generate_dshield_summary-442"><span class="linenos">442</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-443"><a href="#DataProcessor.generate_dshield_summary-443"><span class="linenos">443</span></a>            <span class="n">organizations_attacking</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-444"><a href="#DataProcessor.generate_dshield_summary-444"><span class="linenos">444</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_dshield_summary-445"><a href="#DataProcessor.generate_dshield_summary-445"><span class="linenos">445</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_dshield_summary-446"><a href="#DataProcessor.generate_dshield_summary-446"><span class="linenos">446</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-447"><a href="#DataProcessor.generate_dshield_summary-447"><span class="linenos">447</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-448"><a href="#DataProcessor.generate_dshield_summary-448"><span class="linenos">448</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_dshield_summary-449"><a href="#DataProcessor.generate_dshield_summary-449"><span class="linenos">449</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-450"><a href="#DataProcessor.generate_dshield_summary-450"><span class="linenos">450</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-451"><a href="#DataProcessor.generate_dshield_summary-451"><span class="linenos">451</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-452"><a href="#DataProcessor.generate_dshield_summary-452"><span class="linenos">452</span></a>            <span class="n">high_reputation_ips</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation_score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">]),</span>
</span><span id="DataProcessor.generate_dshield_summary-453"><a href="#DataProcessor.generate_dshield_summary-453"><span class="linenos">453</span></a>            <span class="n">top_countries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_countries</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-454"><a href="#DataProcessor.generate_dshield_summary-454"><span class="linenos">454</span></a>            <span class="n">top_ports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_ports</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-455"><a href="#DataProcessor.generate_dshield_summary-455"><span class="linenos">455</span></a>            <span class="n">top_protocols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_protocols</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-456"><a href="#DataProcessor.generate_dshield_summary-456"><span class="linenos">456</span></a>            <span class="n">top_asns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_asns</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-457"><a href="#DataProcessor.generate_dshield_summary-457"><span class="linenos">457</span></a>            <span class="n">top_organizations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_top_organizations</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-458"><a href="#DataProcessor.generate_dshield_summary-458"><span class="linenos">458</span></a>            <span class="n">average_reputation_score</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_average_reputation</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_dshield_summary-459"><a href="#DataProcessor.generate_dshield_summary-459"><span class="linenos">459</span></a>            <span class="n">indices_queried</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="p">[]))),</span>
</span><span id="DataProcessor.generate_dshield_summary-460"><a href="#DataProcessor.generate_dshield_summary-460"><span class="linenos">460</span></a>            <span class="n">query_duration_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: Calculate actual query duration</span>
</span><span id="DataProcessor.generate_dshield_summary-461"><a href="#DataProcessor.generate_dshield_summary-461"><span class="linenos">461</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.generate_dshield_summary-462"><a href="#DataProcessor.generate_dshield_summary-462"><span class="linenos">462</span></a>
</span><span id="DataProcessor.generate_dshield_summary-463"><a href="#DataProcessor.generate_dshield_summary-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Generate DShield-specific security summary.</p>
</div>


                            </div>
                            <div id="DataProcessor.generate_security_summary" class="classattr">
                                        <input id="DataProcessor.generate_security_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">generate_security_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.generate_security_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.generate_security_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.generate_security_summary-465"><a href="#DataProcessor.generate_security_summary-465"><span class="linenos">465</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_security_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor.generate_security_summary-466"><a href="#DataProcessor.generate_security_summary-466"><span class="linenos">466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security summary statistics with DShield enrichment.&quot;&quot;&quot;</span>
</span><span id="DataProcessor.generate_security_summary-467"><a href="#DataProcessor.generate_security_summary-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-468"><a href="#DataProcessor.generate_security_summary-468"><span class="linenos">468</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_summary</span><span class="p">()</span>
</span><span id="DataProcessor.generate_security_summary-469"><a href="#DataProcessor.generate_security_summary-469"><span class="linenos">469</span></a>
</span><span id="DataProcessor.generate_security_summary-470"><a href="#DataProcessor.generate_security_summary-470"><span class="linenos">470</span></a>        <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor.generate_security_summary-471"><a href="#DataProcessor.generate_security_summary-471"><span class="linenos">471</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor.generate_security_summary-472"><a href="#DataProcessor.generate_security_summary-472"><span class="linenos">472</span></a>            <span class="s2">&quot;time_range_hours&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># Default, should be configurable</span>
</span><span id="DataProcessor.generate_security_summary-473"><a href="#DataProcessor.generate_security_summary-473"><span class="linenos">473</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_security_summary-474"><a href="#DataProcessor.generate_security_summary-474"><span class="linenos">474</span></a>            <span class="s2">&quot;events_by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-475"><a href="#DataProcessor.generate_security_summary-475"><span class="linenos">475</span></a>            <span class="s2">&quot;events_by_category&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-476"><a href="#DataProcessor.generate_security_summary-476"><span class="linenos">476</span></a>            <span class="s2">&quot;unique_source_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-477"><a href="#DataProcessor.generate_security_summary-477"><span class="linenos">477</span></a>            <span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-478"><a href="#DataProcessor.generate_security_summary-478"><span class="linenos">478</span></a>            <span class="s2">&quot;top_source_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor.generate_security_summary-479"><a href="#DataProcessor.generate_security_summary-479"><span class="linenos">479</span></a>            <span class="s2">&quot;top_destination_ips&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor.generate_security_summary-480"><a href="#DataProcessor.generate_security_summary-480"><span class="linenos">480</span></a>            <span class="s2">&quot;high_risk_events&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-481"><a href="#DataProcessor.generate_security_summary-481"><span class="linenos">481</span></a>            <span class="s2">&quot;threat_intelligence_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-482"><a href="#DataProcessor.generate_security_summary-482"><span class="linenos">482</span></a>            <span class="s2">&quot;attack_patterns&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-483"><a href="#DataProcessor.generate_security_summary-483"><span class="linenos">483</span></a>            <span class="s2">&quot;timeline&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-484"><a href="#DataProcessor.generate_security_summary-484"><span class="linenos">484</span></a>            <span class="s2">&quot;indices_queried&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor.generate_security_summary-485"><a href="#DataProcessor.generate_security_summary-485"><span class="linenos">485</span></a>            <span class="c1"># DShield-specific statistics</span>
</span><span id="DataProcessor.generate_security_summary-486"><a href="#DataProcessor.generate_security_summary-486"><span class="linenos">486</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-487"><a href="#DataProcessor.generate_security_summary-487"><span class="linenos">487</span></a>            <span class="s2">&quot;dshield_blocks&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-488"><a href="#DataProcessor.generate_security_summary-488"><span class="linenos">488</span></a>            <span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DataProcessor.generate_security_summary-489"><a href="#DataProcessor.generate_security_summary-489"><span class="linenos">489</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="DataProcessor.generate_security_summary-490"><a href="#DataProcessor.generate_security_summary-490"><span class="linenos">490</span></a>            <span class="s2">&quot;geographic_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-491"><a href="#DataProcessor.generate_security_summary-491"><span class="linenos">491</span></a>            <span class="s2">&quot;port_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-492"><a href="#DataProcessor.generate_security_summary-492"><span class="linenos">492</span></a>            <span class="s2">&quot;asn_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-493"><a href="#DataProcessor.generate_security_summary-493"><span class="linenos">493</span></a>            <span class="s2">&quot;organization_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-494"><a href="#DataProcessor.generate_security_summary-494"><span class="linenos">494</span></a>            <span class="s2">&quot;reputation_distribution&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="DataProcessor.generate_security_summary-495"><a href="#DataProcessor.generate_security_summary-495"><span class="linenos">495</span></a>        <span class="p">}</span>
</span><span id="DataProcessor.generate_security_summary-496"><a href="#DataProcessor.generate_security_summary-496"><span class="linenos">496</span></a>
</span><span id="DataProcessor.generate_security_summary-497"><a href="#DataProcessor.generate_security_summary-497"><span class="linenos">497</span></a>        <span class="c1"># Extract unique IPs</span>
</span><span id="DataProcessor.generate_security_summary-498"><a href="#DataProcessor.generate_security_summary-498"><span class="linenos">498</span></a>        <span class="n">source_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor.generate_security_summary-499"><a href="#DataProcessor.generate_security_summary-499"><span class="linenos">499</span></a>        <span class="n">destination_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor.generate_security_summary-500"><a href="#DataProcessor.generate_security_summary-500"><span class="linenos">500</span></a>        <span class="n">ip_event_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="DataProcessor.generate_security_summary-501"><a href="#DataProcessor.generate_security_summary-501"><span class="linenos">501</span></a>
</span><span id="DataProcessor.generate_security_summary-502"><a href="#DataProcessor.generate_security_summary-502"><span class="linenos">502</span></a>        <span class="c1"># Process events</span>
</span><span id="DataProcessor.generate_security_summary-503"><a href="#DataProcessor.generate_security_summary-503"><span class="linenos">503</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-504"><a href="#DataProcessor.generate_security_summary-504"><span class="linenos">504</span></a>            <span class="c1"># Count by severity</span>
</span><span id="DataProcessor.generate_security_summary-505"><a href="#DataProcessor.generate_security_summary-505"><span class="linenos">505</span></a>            <span class="n">severity</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-506"><a href="#DataProcessor.generate_security_summary-506"><span class="linenos">506</span></a>            <span class="c1"># Ensure severity is hashable</span>
</span><span id="DataProcessor.generate_security_summary-507"><a href="#DataProcessor.generate_security_summary-507"><span class="linenos">507</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-508"><a href="#DataProcessor.generate_security_summary-508"><span class="linenos">508</span></a>                <span class="n">severity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-509"><a href="#DataProcessor.generate_security_summary-509"><span class="linenos">509</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">][</span><span class="n">severity</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataProcessor.generate_security_summary-510"><a href="#DataProcessor.generate_security_summary-510"><span class="linenos">510</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_severity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-511"><a href="#DataProcessor.generate_security_summary-511"><span class="linenos">511</span></a>            <span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-512"><a href="#DataProcessor.generate_security_summary-512"><span class="linenos">512</span></a>
</span><span id="DataProcessor.generate_security_summary-513"><a href="#DataProcessor.generate_security_summary-513"><span class="linenos">513</span></a>            <span class="c1"># Count by category</span>
</span><span id="DataProcessor.generate_security_summary-514"><a href="#DataProcessor.generate_security_summary-514"><span class="linenos">514</span></a>            <span class="n">category</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-515"><a href="#DataProcessor.generate_security_summary-515"><span class="linenos">515</span></a>            <span class="c1"># Ensure category is hashable</span>
</span><span id="DataProcessor.generate_security_summary-516"><a href="#DataProcessor.generate_security_summary-516"><span class="linenos">516</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-517"><a href="#DataProcessor.generate_security_summary-517"><span class="linenos">517</span></a>                <span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-518"><a href="#DataProcessor.generate_security_summary-518"><span class="linenos">518</span></a>            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataProcessor.generate_security_summary-519"><a href="#DataProcessor.generate_security_summary-519"><span class="linenos">519</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;events_by_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-520"><a href="#DataProcessor.generate_security_summary-520"><span class="linenos">520</span></a>            <span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-521"><a href="#DataProcessor.generate_security_summary-521"><span class="linenos">521</span></a>
</span><span id="DataProcessor.generate_security_summary-522"><a href="#DataProcessor.generate_security_summary-522"><span class="linenos">522</span></a>            <span class="c1"># Track IPs - ensure they are hashable</span>
</span><span id="DataProcessor.generate_security_summary-523"><a href="#DataProcessor.generate_security_summary-523"><span class="linenos">523</span></a>            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-524"><a href="#DataProcessor.generate_security_summary-524"><span class="linenos">524</span></a>            <span class="k">if</span> <span class="n">source_ip</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-525"><a href="#DataProcessor.generate_security_summary-525"><span class="linenos">525</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-526"><a href="#DataProcessor.generate_security_summary-526"><span class="linenos">526</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-527"><a href="#DataProcessor.generate_security_summary-527"><span class="linenos">527</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-528"><a href="#DataProcessor.generate_security_summary-528"><span class="linenos">528</span></a>                    <span class="n">source_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_ip</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-529"><a href="#DataProcessor.generate_security_summary-529"><span class="linenos">529</span></a>                <span class="n">source_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_ip_str</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-530"><a href="#DataProcessor.generate_security_summary-530"><span class="linenos">530</span></a>                <span class="n">ip_event_counts</span><span class="p">[</span><span class="n">source_ip_str</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-531"><a href="#DataProcessor.generate_security_summary-531"><span class="linenos">531</span></a>
</span><span id="DataProcessor.generate_security_summary-532"><a href="#DataProcessor.generate_security_summary-532"><span class="linenos">532</span></a>            <span class="n">destination_ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-533"><a href="#DataProcessor.generate_security_summary-533"><span class="linenos">533</span></a>            <span class="k">if</span> <span class="n">destination_ip</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-534"><a href="#DataProcessor.generate_security_summary-534"><span class="linenos">534</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-535"><a href="#DataProcessor.generate_security_summary-535"><span class="linenos">535</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-536"><a href="#DataProcessor.generate_security_summary-536"><span class="linenos">536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-537"><a href="#DataProcessor.generate_security_summary-537"><span class="linenos">537</span></a>                    <span class="n">destination_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_ip</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-538"><a href="#DataProcessor.generate_security_summary-538"><span class="linenos">538</span></a>                <span class="n">destination_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">destination_ip_str</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-539"><a href="#DataProcessor.generate_security_summary-539"><span class="linenos">539</span></a>
</span><span id="DataProcessor.generate_security_summary-540"><a href="#DataProcessor.generate_security_summary-540"><span class="linenos">540</span></a>            <span class="c1"># Count high-risk events</span>
</span><span id="DataProcessor.generate_security_summary-541"><a href="#DataProcessor.generate_security_summary-541"><span class="linenos">541</span></a>            <span class="k">if</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">]:</span>
</span><span id="DataProcessor.generate_security_summary-542"><a href="#DataProcessor.generate_security_summary-542"><span class="linenos">542</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;high_risk_events&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-543"><a href="#DataProcessor.generate_security_summary-543"><span class="linenos">543</span></a>
</span><span id="DataProcessor.generate_security_summary-544"><a href="#DataProcessor.generate_security_summary-544"><span class="linenos">544</span></a>            <span class="c1"># DShield-specific counting</span>
</span><span id="DataProcessor.generate_security_summary-545"><a href="#DataProcessor.generate_security_summary-545"><span class="linenos">545</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-546"><a href="#DataProcessor.generate_security_summary-546"><span class="linenos">546</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_attacks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-547"><a href="#DataProcessor.generate_security_summary-547"><span class="linenos">547</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-548"><a href="#DataProcessor.generate_security_summary-548"><span class="linenos">548</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_blocks&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-549"><a href="#DataProcessor.generate_security_summary-549"><span class="linenos">549</span></a>            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-550"><a href="#DataProcessor.generate_security_summary-550"><span class="linenos">550</span></a>                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;dshield_reputation_hits&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DataProcessor.generate_security_summary-551"><a href="#DataProcessor.generate_security_summary-551"><span class="linenos">551</span></a>
</span><span id="DataProcessor.generate_security_summary-552"><a href="#DataProcessor.generate_security_summary-552"><span class="linenos">552</span></a>            <span class="c1"># Track indices</span>
</span><span id="DataProcessor.generate_security_summary-553"><a href="#DataProcessor.generate_security_summary-553"><span class="linenos">553</span></a>            <span class="k">if</span> <span class="s2">&quot;indices&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-554"><a href="#DataProcessor.generate_security_summary-554"><span class="linenos">554</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.generate_security_summary-555"><a href="#DataProcessor.generate_security_summary-555"><span class="linenos">555</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-556"><a href="#DataProcessor.generate_security_summary-556"><span class="linenos">556</span></a>                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-557"><a href="#DataProcessor.generate_security_summary-557"><span class="linenos">557</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataProcessor.generate_security_summary-558"><a href="#DataProcessor.generate_security_summary-558"><span class="linenos">558</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="DataProcessor.generate_security_summary-559"><a href="#DataProcessor.generate_security_summary-559"><span class="linenos">559</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-560"><a href="#DataProcessor.generate_security_summary-560"><span class="linenos">560</span></a>                            <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="DataProcessor.generate_security_summary-561"><a href="#DataProcessor.generate_security_summary-561"><span class="linenos">561</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataProcessor.generate_security_summary-562"><a href="#DataProcessor.generate_security_summary-562"><span class="linenos">562</span></a>                    <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
</span><span id="DataProcessor.generate_security_summary-563"><a href="#DataProcessor.generate_security_summary-563"><span class="linenos">563</span></a>
</span><span id="DataProcessor.generate_security_summary-564"><a href="#DataProcessor.generate_security_summary-564"><span class="linenos">564</span></a>        <span class="c1"># Update summary with IP statistics</span>
</span><span id="DataProcessor.generate_security_summary-565"><a href="#DataProcessor.generate_security_summary-565"><span class="linenos">565</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_ips</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-566"><a href="#DataProcessor.generate_security_summary-566"><span class="linenos">566</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;unique_destination_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">destination_ips</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-567"><a href="#DataProcessor.generate_security_summary-567"><span class="linenos">567</span></a>
</span><span id="DataProcessor.generate_security_summary-568"><a href="#DataProcessor.generate_security_summary-568"><span class="linenos">568</span></a>        <span class="c1"># Get top source IPs</span>
</span><span id="DataProcessor.generate_security_summary-569"><a href="#DataProcessor.generate_security_summary-569"><span class="linenos">569</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;top_source_ips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataProcessor.generate_security_summary-570"><a href="#DataProcessor.generate_security_summary-570"><span class="linenos">570</span></a>            <span class="p">{</span><span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_event_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-571"><a href="#DataProcessor.generate_security_summary-571"><span class="linenos">571</span></a>        <span class="p">]</span>
</span><span id="DataProcessor.generate_security_summary-572"><a href="#DataProcessor.generate_security_summary-572"><span class="linenos">572</span></a>
</span><span id="DataProcessor.generate_security_summary-573"><a href="#DataProcessor.generate_security_summary-573"><span class="linenos">573</span></a>        <span class="c1"># Generate DShield-specific distributions</span>
</span><span id="DataProcessor.generate_security_summary-574"><a href="#DataProcessor.generate_security_summary-574"><span class="linenos">574</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;geographic_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geographic_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-575"><a href="#DataProcessor.generate_security_summary-575"><span class="linenos">575</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;port_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_port_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-576"><a href="#DataProcessor.generate_security_summary-576"><span class="linenos">576</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;asn_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_asn_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-577"><a href="#DataProcessor.generate_security_summary-577"><span class="linenos">577</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;organization_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_organization_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-578"><a href="#DataProcessor.generate_security_summary-578"><span class="linenos">578</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;reputation_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reputation_distribution</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-579"><a href="#DataProcessor.generate_security_summary-579"><span class="linenos">579</span></a>
</span><span id="DataProcessor.generate_security_summary-580"><a href="#DataProcessor.generate_security_summary-580"><span class="linenos">580</span></a>        <span class="c1"># Generate timeline</span>
</span><span id="DataProcessor.generate_security_summary-581"><a href="#DataProcessor.generate_security_summary-581"><span class="linenos">581</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;timeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_timeline</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-582"><a href="#DataProcessor.generate_security_summary-582"><span class="linenos">582</span></a>
</span><span id="DataProcessor.generate_security_summary-583"><a href="#DataProcessor.generate_security_summary-583"><span class="linenos">583</span></a>        <span class="c1"># Detect attack patterns</span>
</span><span id="DataProcessor.generate_security_summary-584"><a href="#DataProcessor.generate_security_summary-584"><span class="linenos">584</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;attack_patterns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_attack_patterns</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_security_summary-585"><a href="#DataProcessor.generate_security_summary-585"><span class="linenos">585</span></a>
</span><span id="DataProcessor.generate_security_summary-586"><a href="#DataProcessor.generate_security_summary-586"><span class="linenos">586</span></a>        <span class="c1"># Remove duplicates from indices</span>
</span><span id="DataProcessor.generate_security_summary-587"><a href="#DataProcessor.generate_security_summary-587"><span class="linenos">587</span></a>        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s2">&quot;indices_queried&quot;</span><span class="p">]))</span>
</span><span id="DataProcessor.generate_security_summary-588"><a href="#DataProcessor.generate_security_summary-588"><span class="linenos">588</span></a>
</span><span id="DataProcessor.generate_security_summary-589"><a href="#DataProcessor.generate_security_summary-589"><span class="linenos">589</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span></pre></div>


            <div class="docstring"><p>Generate security summary statistics with DShield enrichment.</p>
</div>


                            </div>
                            <div id="DataProcessor.generate_attack_report" class="classattr">
                                        <input id="DataProcessor.generate_attack_report-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">generate_attack_report</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.generate_attack_report-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.generate_attack_report"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.generate_attack_report-591"><a href="#DataProcessor.generate_attack_report-591"><span class="linenos">591</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_attack_report</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-592"><a href="#DataProcessor.generate_attack_report-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-593"><a href="#DataProcessor.generate_attack_report-593"><span class="linenos">593</span></a>        <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="DataProcessor.generate_attack_report-594"><a href="#DataProcessor.generate_attack_report-594"><span class="linenos">594</span></a>        <span class="n">threat_intelligence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-595"><a href="#DataProcessor.generate_attack_report-595"><span class="linenos">595</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DataProcessor.generate_attack_report-596"><a href="#DataProcessor.generate_attack_report-596"><span class="linenos">596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate structured attack report with DShield data.&quot;&quot;&quot;</span>
</span><span id="DataProcessor.generate_attack_report-597"><a href="#DataProcessor.generate_attack_report-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.generate_attack_report-598"><a href="#DataProcessor.generate_attack_report-598"><span class="linenos">598</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_attack_report</span><span class="p">()</span>
</span><span id="DataProcessor.generate_attack_report-599"><a href="#DataProcessor.generate_attack_report-599"><span class="linenos">599</span></a>
</span><span id="DataProcessor.generate_attack_report-600"><a href="#DataProcessor.generate_attack_report-600"><span class="linenos">600</span></a>        <span class="n">threat_intelligence</span> <span class="o">=</span> <span class="n">threat_intelligence</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="DataProcessor.generate_attack_report-601"><a href="#DataProcessor.generate_attack_report-601"><span class="linenos">601</span></a>
</span><span id="DataProcessor.generate_attack_report-602"><a href="#DataProcessor.generate_attack_report-602"><span class="linenos">602</span></a>        <span class="c1"># Generate report ID</span>
</span><span id="DataProcessor.generate_attack_report-603"><a href="#DataProcessor.generate_attack_report-603"><span class="linenos">603</span></a>        <span class="n">report_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DataProcessor.generate_attack_report-604"><a href="#DataProcessor.generate_attack_report-604"><span class="linenos">604</span></a>
</span><span id="DataProcessor.generate_attack_report-605"><a href="#DataProcessor.generate_attack_report-605"><span class="linenos">605</span></a>        <span class="c1"># Analyze events</span>
</span><span id="DataProcessor.generate_attack_report-606"><a href="#DataProcessor.generate_attack_report-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-607"><a href="#DataProcessor.generate_attack_report-607"><span class="linenos">607</span></a>
</span><span id="DataProcessor.generate_attack_report-608"><a href="#DataProcessor.generate_attack_report-608"><span class="linenos">608</span></a>        <span class="c1"># Extract threat indicators</span>
</span><span id="DataProcessor.generate_attack_report-609"><a href="#DataProcessor.generate_attack_report-609"><span class="linenos">609</span></a>        <span class="n">threat_indicators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_threat_indicators</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-610"><a href="#DataProcessor.generate_attack_report-610"><span class="linenos">610</span></a>
</span><span id="DataProcessor.generate_attack_report-611"><a href="#DataProcessor.generate_attack_report-611"><span class="linenos">611</span></a>        <span class="c1"># Identify attack vectors</span>
</span><span id="DataProcessor.generate_attack_report-612"><a href="#DataProcessor.generate_attack_report-612"><span class="linenos">612</span></a>        <span class="n">attack_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_attack_vectors</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-613"><a href="#DataProcessor.generate_attack_report-613"><span class="linenos">613</span></a>
</span><span id="DataProcessor.generate_attack_report-614"><a href="#DataProcessor.generate_attack_report-614"><span class="linenos">614</span></a>        <span class="c1"># Determine affected systems</span>
</span><span id="DataProcessor.generate_attack_report-615"><a href="#DataProcessor.generate_attack_report-615"><span class="linenos">615</span></a>        <span class="n">affected_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_affected_systems</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-616"><a href="#DataProcessor.generate_attack_report-616"><span class="linenos">616</span></a>
</span><span id="DataProcessor.generate_attack_report-617"><a href="#DataProcessor.generate_attack_report-617"><span class="linenos">617</span></a>        <span class="c1"># Assess impact</span>
</span><span id="DataProcessor.generate_attack_report-618"><a href="#DataProcessor.generate_attack_report-618"><span class="linenos">618</span></a>        <span class="n">impact_assessment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_impact</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-619"><a href="#DataProcessor.generate_attack_report-619"><span class="linenos">619</span></a>
</span><span id="DataProcessor.generate_attack_report-620"><a href="#DataProcessor.generate_attack_report-620"><span class="linenos">620</span></a>        <span class="c1"># Generate recommendations</span>
</span><span id="DataProcessor.generate_attack_report-621"><a href="#DataProcessor.generate_attack_report-621"><span class="linenos">621</span></a>        <span class="n">recommendations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-622"><a href="#DataProcessor.generate_attack_report-622"><span class="linenos">622</span></a>            <span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">,</span> <span class="n">impact_assessment</span>
</span><span id="DataProcessor.generate_attack_report-623"><a href="#DataProcessor.generate_attack_report-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-624"><a href="#DataProcessor.generate_attack_report-624"><span class="linenos">624</span></a>
</span><span id="DataProcessor.generate_attack_report-625"><a href="#DataProcessor.generate_attack_report-625"><span class="linenos">625</span></a>        <span class="c1"># Process DShield-specific data</span>
</span><span id="DataProcessor.generate_attack_report-626"><a href="#DataProcessor.generate_attack_report-626"><span class="linenos">626</span></a>        <span class="n">dshield_attacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_attacks</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-627"><a href="#DataProcessor.generate_attack_report-627"><span class="linenos">627</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;attack&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.generate_attack_report-628"><a href="#DataProcessor.generate_attack_report-628"><span class="linenos">628</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-629"><a href="#DataProcessor.generate_attack_report-629"><span class="linenos">629</span></a>        <span class="n">dshield_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_reputation</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-630"><a href="#DataProcessor.generate_attack_report-630"><span class="linenos">630</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;reputation&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.generate_attack_report-631"><a href="#DataProcessor.generate_attack_report-631"><span class="linenos">631</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-632"><a href="#DataProcessor.generate_attack_report-632"><span class="linenos">632</span></a>        <span class="n">top_attackers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dshield_top_attackers</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-633"><a href="#DataProcessor.generate_attack_report-633"><span class="linenos">633</span></a>            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attack_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="DataProcessor.generate_attack_report-634"><a href="#DataProcessor.generate_attack_report-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-635"><a href="#DataProcessor.generate_attack_report-635"><span class="linenos">635</span></a>
</span><span id="DataProcessor.generate_attack_report-636"><a href="#DataProcessor.generate_attack_report-636"><span class="linenos">636</span></a>        <span class="c1"># Create attack report</span>
</span><span id="DataProcessor.generate_attack_report-637"><a href="#DataProcessor.generate_attack_report-637"><span class="linenos">637</span></a>        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataProcessor.generate_attack_report-638"><a href="#DataProcessor.generate_attack_report-638"><span class="linenos">638</span></a>            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-639"><a href="#DataProcessor.generate_attack_report-639"><span class="linenos">639</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="DataProcessor.generate_attack_report-640"><a href="#DataProcessor.generate_attack_report-640"><span class="linenos">640</span></a>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Security Incident Report - </span><span class="si">{</span><span class="n">report_id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-641"><a href="#DataProcessor.generate_attack_report-641"><span class="linenos">641</span></a>            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_executive_summary</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-642"><a href="#DataProcessor.generate_attack_report-642"><span class="linenos">642</span></a>            <span class="s2">&quot;total_events&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-643"><a href="#DataProcessor.generate_attack_report-643"><span class="linenos">643</span></a>            <span class="s2">&quot;unique_ips&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-644"><a href="#DataProcessor.generate_attack_report-644"><span class="linenos">644</span></a>                <span class="nb">set</span><span class="p">(</span>
</span><span id="DataProcessor.generate_attack_report-645"><a href="#DataProcessor.generate_attack_report-645"><span class="linenos">645</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">))</span>
</span><span id="DataProcessor.generate_attack_report-646"><a href="#DataProcessor.generate_attack_report-646"><span class="linenos">646</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">),</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-647"><a href="#DataProcessor.generate_attack_report-647"><span class="linenos">647</span></a>                    <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-648"><a href="#DataProcessor.generate_attack_report-648"><span class="linenos">648</span></a>                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span>
</span><span id="DataProcessor.generate_attack_report-649"><a href="#DataProcessor.generate_attack_report-649"><span class="linenos">649</span></a>                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-650"><a href="#DataProcessor.generate_attack_report-650"><span class="linenos">650</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.generate_attack_report-651"><a href="#DataProcessor.generate_attack_report-651"><span class="linenos">651</span></a>            <span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-652"><a href="#DataProcessor.generate_attack_report-652"><span class="linenos">652</span></a>            <span class="s2">&quot;time_range&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_time_range</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-653"><a href="#DataProcessor.generate_attack_report-653"><span class="linenos">653</span></a>            <span class="s2">&quot;threat_indicators&quot;</span><span class="p">:</span> <span class="n">threat_indicators</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-654"><a href="#DataProcessor.generate_attack_report-654"><span class="linenos">654</span></a>            <span class="s2">&quot;high_risk_ips&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_high_risk_ips</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-655"><a href="#DataProcessor.generate_attack_report-655"><span class="linenos">655</span></a>            <span class="s2">&quot;attack_vectors&quot;</span><span class="p">:</span> <span class="n">attack_vectors</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-656"><a href="#DataProcessor.generate_attack_report-656"><span class="linenos">656</span></a>            <span class="s2">&quot;affected_systems&quot;</span><span class="p">:</span> <span class="n">affected_systems</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-657"><a href="#DataProcessor.generate_attack_report-657"><span class="linenos">657</span></a>            <span class="s2">&quot;impact_assessment&quot;</span><span class="p">:</span> <span class="n">impact_assessment</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-658"><a href="#DataProcessor.generate_attack_report-658"><span class="linenos">658</span></a>            <span class="s2">&quot;dshield_attacks&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attack</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attack</span> <span class="ow">in</span> <span class="n">dshield_attacks</span><span class="p">],</span>
</span><span id="DataProcessor.generate_attack_report-659"><a href="#DataProcessor.generate_attack_report-659"><span class="linenos">659</span></a>            <span class="s2">&quot;dshield_reputation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">rep</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">dshield_reputation</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="DataProcessor.generate_attack_report-660"><a href="#DataProcessor.generate_attack_report-660"><span class="linenos">660</span></a>            <span class="s2">&quot;top_attackers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">attacker</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">attacker</span> <span class="ow">in</span> <span class="n">top_attackers</span><span class="p">],</span>
</span><span id="DataProcessor.generate_attack_report-661"><a href="#DataProcessor.generate_attack_report-661"><span class="linenos">661</span></a>            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="n">recommendations</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-662"><a href="#DataProcessor.generate_attack_report-662"><span class="linenos">662</span></a>            <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_mitigation_actions</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_indicators</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-663"><a href="#DataProcessor.generate_attack_report-663"><span class="linenos">663</span></a>            <span class="s2">&quot;confidence_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_confidence_level</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">threat_intelligence</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-664"><a href="#DataProcessor.generate_attack_report-664"><span class="linenos">664</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_tags</span><span class="p">(</span><span class="n">events</span><span class="p">),</span>
</span><span id="DataProcessor.generate_attack_report-665"><a href="#DataProcessor.generate_attack_report-665"><span class="linenos">665</span></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="n">events</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-666"><a href="#DataProcessor.generate_attack_report-666"><span class="linenos">666</span></a>            <span class="s2">&quot;threat_intelligence&quot;</span><span class="p">:</span> <span class="n">threat_intelligence</span><span class="p">,</span>
</span><span id="DataProcessor.generate_attack_report-667"><a href="#DataProcessor.generate_attack_report-667"><span class="linenos">667</span></a>        <span class="p">}</span>
</span><span id="DataProcessor.generate_attack_report-668"><a href="#DataProcessor.generate_attack_report-668"><span class="linenos">668</span></a>
</span><span id="DataProcessor.generate_attack_report-669"><a href="#DataProcessor.generate_attack_report-669"><span class="linenos">669</span></a>        <span class="k">return</span> <span class="n">report</span>
</span></pre></div>


            <div class="docstring"><p>Generate structured attack report with DShield data.</p>
</div>


                            </div>
                            <div id="DataProcessor.extract_unique_ips" class="classattr">
                                        <input id="DataProcessor.extract_unique_ips-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">extract_unique_ips</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataProcessor.extract_unique_ips-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataProcessor.extract_unique_ips"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataProcessor.extract_unique_ips-671"><a href="#DataProcessor.extract_unique_ips-671"><span class="linenos">671</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_unique_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DataProcessor.extract_unique_ips-672"><a href="#DataProcessor.extract_unique_ips-672"><span class="linenos">672</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract unique IP addresses from events.&quot;&quot;&quot;</span>
</span><span id="DataProcessor.extract_unique_ips-673"><a href="#DataProcessor.extract_unique_ips-673"><span class="linenos">673</span></a>        <span class="n">unique_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DataProcessor.extract_unique_ips-674"><a href="#DataProcessor.extract_unique_ips-674"><span class="linenos">674</span></a>
</span><span id="DataProcessor.extract_unique_ips-675"><a href="#DataProcessor.extract_unique_ips-675"><span class="linenos">675</span></a>        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="DataProcessor.extract_unique_ips-676"><a href="#DataProcessor.extract_unique_ips-676"><span class="linenos">676</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_ip&quot;</span><span class="p">):</span>
</span><span id="DataProcessor.extract_unique_ips-677"><a href="#DataProcessor.extract_unique_ips-677"><span class="linenos">677</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor.extract_unique_ips-678"><a href="#DataProcessor.extract_unique_ips-678"><span class="linenos">678</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">])</span>
</span><span id="DataProcessor.extract_unique_ips-679"><a href="#DataProcessor.extract_unique_ips-679"><span class="linenos">679</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.extract_unique_ips-680"><a href="#DataProcessor.extract_unique_ips-680"><span class="linenos">680</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;source_ip&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.extract_unique_ips-681"><a href="#DataProcessor.extract_unique_ips-681"><span class="linenos">681</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.extract_unique_ips-682"><a href="#DataProcessor.extract_unique_ips-682"><span class="linenos">682</span></a>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">):</span>
</span><span id="DataProcessor.extract_unique_ips-683"><a href="#DataProcessor.extract_unique_ips-683"><span class="linenos">683</span></a>                <span class="n">unique_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="DataProcessor.extract_unique_ips-684"><a href="#DataProcessor.extract_unique_ips-684"><span class="linenos">684</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">])</span>
</span><span id="DataProcessor.extract_unique_ips-685"><a href="#DataProcessor.extract_unique_ips-685"><span class="linenos">685</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="DataProcessor.extract_unique_ips-686"><a href="#DataProcessor.extract_unique_ips-686"><span class="linenos">686</span></a>                    <span class="k">else</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;destination_ip&quot;</span><span class="p">]</span>
</span><span id="DataProcessor.extract_unique_ips-687"><a href="#DataProcessor.extract_unique_ips-687"><span class="linenos">687</span></a>                <span class="p">)</span>
</span><span id="DataProcessor.extract_unique_ips-688"><a href="#DataProcessor.extract_unique_ips-688"><span class="linenos">688</span></a>
</span><span id="DataProcessor.extract_unique_ips-689"><a href="#DataProcessor.extract_unique_ips-689"><span class="linenos">689</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_ips</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract unique IP addresses from events.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>
