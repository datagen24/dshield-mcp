<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>src.mcp_error_handler API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../src.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;src</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="class" href="#CircuitBreakerState">CircuitBreakerState</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#CircuitBreakerState.CLOSED">CLOSED</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerState.OPEN">OPEN</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerState.HALF_OPEN">HALF_OPEN</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CircuitBreakerConfig">CircuitBreakerConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CircuitBreakerConfig.__init__">CircuitBreakerConfig</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerConfig.failure_threshold">failure_threshold</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerConfig.recovery_timeout">recovery_timeout</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerConfig.expected_exception">expected_exception</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreakerConfig.success_threshold">success_threshold</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ErrorHandlingConfig">ErrorHandlingConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ErrorHandlingConfig.__init__">ErrorHandlingConfig</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorHandlingConfig.timeouts">timeouts</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorHandlingConfig.retry_settings">retry_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorHandlingConfig.logging">logging</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorHandlingConfig.circuit_breaker">circuit_breaker</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorHandlingConfig.error_aggregation">error_aggregation</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MCPErrorHandler">MCPErrorHandler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MCPErrorHandler.__init__">MCPErrorHandler</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.PARSE_ERROR">PARSE_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.INVALID_REQUEST">INVALID_REQUEST</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.METHOD_NOT_FOUND">METHOD_NOT_FOUND</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.INVALID_PARAMS">INVALID_PARAMS</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.INTERNAL_ERROR">INTERNAL_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.RESOURCE_NOT_FOUND">RESOURCE_NOT_FOUND</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.RESOURCE_ACCESS_DENIED">RESOURCE_ACCESS_DENIED</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.RESOURCE_UNAVAILABLE">RESOURCE_UNAVAILABLE</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.TOOL_UNAVAILABLE">TOOL_UNAVAILABLE</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.TIMEOUT_ERROR">TIMEOUT_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.VALIDATION_ERROR">VALIDATION_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.EXTERNAL_SERVICE_ERROR">EXTERNAL_SERVICE_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.RATE_LIMIT_ERROR">RATE_LIMIT_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.SECURITY_ERROR">SECURITY_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.SCHEMA_VALIDATION_ERROR">SCHEMA_VALIDATION_ERROR</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.logger">logger</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.error_aggregator">error_aggregator</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.schema_validator">schema_validator</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.api_key_rate_limiter">api_key_rate_limiter</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.connection_rate_limiter">connection_rate_limiter</a>
                        </li>
                        <li>
                                <a class="variable" href="#MCPErrorHandler.global_rate_limiter">global_rate_limiter</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_error">create_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_parse_error">create_parse_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_invalid_request_error">create_invalid_request_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_method_not_found_error">create_method_not_found_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_invalid_params_error">create_invalid_params_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_internal_error">create_internal_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_validation_error">create_validation_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_timeout_error">create_timeout_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_resource_error">create_resource_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_external_service_error">create_external_service_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_rate_limit_error">create_rate_limit_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_security_error">create_security_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_schema_validation_error">create_schema_validation_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.validate_message_security">validate_message_security</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.validate_tool_exists">validate_tool_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.validate_arguments">validate_arguments</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.execute_with_timeout">execute_with_timeout</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.execute_with_retry">execute_with_retry</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.get_error_summary">get_error_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_resource_not_found_error">create_resource_not_found_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_resource_access_denied_error">create_resource_access_denied_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_resource_unavailable_error">create_resource_unavailable_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_circuit_breaker_open_error">create_circuit_breaker_open_error</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_validation_error_with_context">create_validation_error_with_context</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.create_timeout_error_with_context">create_timeout_error_with_context</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.get_enhanced_error_summary">get_enhanced_error_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.get_error_analytics">get_error_analytics</a>
                        </li>
                        <li>
                                <a class="function" href="#MCPErrorHandler.get_circuit_breaker_status">get_circuit_breaker_status</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CircuitBreaker">CircuitBreaker</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CircuitBreaker.__init__">CircuitBreaker</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.service_name">service_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.state">state</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.failure_count">failure_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.success_count">success_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.last_failure_time">last_failure_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#CircuitBreaker.logger">logger</a>
                        </li>
                        <li>
                                <a class="function" href="#CircuitBreaker.can_execute">can_execute</a>
                        </li>
                        <li>
                                <a class="function" href="#CircuitBreaker.on_success">on_success</a>
                        </li>
                        <li>
                                <a class="function" href="#CircuitBreaker.on_failure">on_failure</a>
                        </li>
                        <li>
                                <a class="function" href="#CircuitBreaker.get_status">get_status</a>
                        </li>
                        <li>
                                <a class="function" href="#CircuitBreaker.execute">execute</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ErrorAggregator">ErrorAggregator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ErrorAggregator.__init__">ErrorAggregator</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorAggregator.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorAggregator.error_counts">error_counts</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorAggregator.error_history">error_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#ErrorAggregator.logger">logger</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorAggregator.record_error">record_error</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorAggregator.get_error_summary">get_error_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorAggregator.get_error_trends">get_error_trends</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorAggregator.reset">reset</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../src.html">src</a><wbr>.mcp_error_handler    </h1>

                        <div class="docstring"><p>MCP Error Handler for DShield MCP Server.</p>

<p>This module provides centralized error handling for all MCP operations,
ensuring proper JSON-RPC error responses with correct error codes,
timeout handling, retry logic, and comprehensive error context capture.</p>

<p>The error handler follows the JSON-RPC 2.0 specification and provides
user-friendly error messages while maintaining detailed logging for
debugging and troubleshooting.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>error_handler = MCPErrorHandler(config)
      error_response = error_handler.create_validation_error("tool_name", validation_error)
      timeout_response = error_handler.create_timeout_error("tool_name", 30)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>

                        <input id="mod-mcp_error_handler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-mcp_error_handler-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">&quot;&quot;&quot;MCP Error Handler for DShield MCP Server.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">This module provides centralized error handling for all MCP operations,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">ensuring proper JSON-RPC error responses with correct error codes,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">timeout handling, retry logic, and comprehensive error context capture.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">The error handler follows the JSON-RPC 2.0 specification and provides</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">user-friendly error messages while maintaining detailed logging for</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">debugging and troubleshooting.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">Example:</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">    &gt;&gt;&gt; error_handler = MCPErrorHandler(config)</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">    &gt;&gt;&gt; error_response = error_handler.create_validation_error(&quot;tool_name&quot;, validation_error)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">    &gt;&gt;&gt; timeout_response = error_handler.create_timeout_error(&quot;tool_name&quot;, 30)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">UTC</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">structlog</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.security.mcp_schema_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPSchemaValidator</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.security.rate_limiter</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="n">APIKeyRateLimiter</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>    <span class="n">ConnectionRateLimiter</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">GlobalRateLimiter</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreakerState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker states.&quot;&quot;&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="n">CLOSED</span> <span class="o">=</span> <span class="s2">&quot;closed&quot;</span>  <span class="c1"># Normal operation</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="n">OPEN</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>  <span class="c1"># Failing, reject requests</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="n">HALF_OPEN</span> <span class="o">=</span> <span class="s2">&quot;half_open&quot;</span>  <span class="c1"># Testing if service recovered</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="nd">@dataclass</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreakerConfig</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for circuit breaker behavior.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Attributes:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        failure_threshold: Number of failures before opening circuit</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        recovery_timeout: Time to wait before attempting recovery</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        expected_exception: Exception types that count as failures</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        success_threshold: Number of successes needed to close circuit</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="n">failure_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="n">recovery_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span>  <span class="c1"># seconds</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="n">expected_exception</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>    <span class="n">success_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="nd">@dataclass</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandlingConfig</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for error handling behavior.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">    Attributes:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        timeouts: Timeout settings for different operations</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        retry_settings: Retry configuration for transient failures</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        logging: Logging configuration for error handling</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        circuit_breaker: Circuit breaker configuration</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        error_aggregation: Error aggregation settings</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="n">timeouts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>            <span class="s2">&quot;elasticsearch_operations&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>            <span class="s2">&quot;dshield_api_calls&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>            <span class="s2">&quot;latex_compilation&quot;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>            <span class="s2">&quot;tool_execution&quot;</span><span class="p">:</span> <span class="mf">120.0</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="p">}</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="n">retry_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="s2">&quot;base_delay&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="s2">&quot;max_delay&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="s2">&quot;exponential_base&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="p">}</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>    <span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="n">logging</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>            <span class="s2">&quot;include_stack_traces&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="s2">&quot;include_request_context&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="s2">&quot;include_user_parameters&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="s2">&quot;log_level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="p">}</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="n">circuit_breaker</span><span class="p">:</span> <span class="n">CircuitBreakerConfig</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">CircuitBreakerConfig</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">error_aggregation</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># 5 minutes</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>            <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="p">}</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MCPErrorHandler</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles JSON-RPC error responses for MCP server.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    This class provides comprehensive error handling for all MCP operations,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">    including proper error code generation, timeout handling, retry logic,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">    and detailed error logging for debugging and troubleshooting.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">    The error handler follows the JSON-RPC 2.0 specification and ensures</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">    that all error responses are properly formatted and contain actionable</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">    information for users while maintaining detailed logging for developers.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">    Attributes:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        config: Error handling configuration</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="c1"># Standard JSON-RPC 2.0 error codes</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="n">PARSE_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32700</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="n">INVALID_REQUEST</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32600</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    <span class="n">METHOD_NOT_FOUND</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32601</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="n">INVALID_PARAMS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32602</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="n">INTERNAL_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32603</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="c1"># Server-defined error codes (starting at -32000)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="n">RESOURCE_NOT_FOUND</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32001</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>    <span class="n">RESOURCE_ACCESS_DENIED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32002</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="n">RESOURCE_UNAVAILABLE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32003</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="n">TOOL_UNAVAILABLE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32004</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="n">TIMEOUT_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32005</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="n">VALIDATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32006</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>    <span class="n">EXTERNAL_SERVICE_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32007</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>    <span class="n">RATE_LIMIT_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32008</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="n">SECURITY_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32009</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="n">SCHEMA_VALIDATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32010</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ErrorHandlingConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the MCP error handler.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        Args:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">            config: Error handling configuration. If None, uses default values.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">ErrorHandlingConfig</span><span class="p">()</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="c1"># Initialize error aggregator for Phase 3 features</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span> <span class="o">=</span> <span class="n">ErrorAggregator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="c1"># Initialize security components</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span> <span class="o">=</span> <span class="n">MCPSchemaValidator</span><span class="p">()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span> <span class="o">=</span> <span class="n">APIKeyRateLimiter</span><span class="p">()</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span> <span class="o">=</span> <span class="n">ConnectionRateLimiter</span><span class="p">()</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span> <span class="o">=</span> <span class="n">GlobalRateLimiter</span><span class="p">()</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="c1"># Validate configuration</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">()</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the error handling configuration.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        Raises:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">            ValueError: If configuration values are invalid.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_retries must be non-negative&quot;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;base_delay&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;base_delay must be positive&quot;</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_delay&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_delay must be positive&quot;</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;exponential_base&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;exponential_base must be greater than 1&quot;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">for</span> <span class="n">operation</span><span class="p">,</span> <span class="n">timeout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;timeout for </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> must be positive&quot;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_error</span><span class="p">(</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a properly formatted JSON-RPC error response.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">        Args:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">            code: JSON-RPC error code</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">            message: Human-readable error message</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">            data: Additional error data (optional)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">            request_id: Request ID for correlation (optional)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        Returns:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">            Dictionary containing the JSON-RPC error response.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Example:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">            &gt;&gt;&gt; error = error_handler.create_error(</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">            ...     MCPErrorHandler.INVALID_PARAMS,</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">            ...     &quot;Invalid parameters provided&quot;,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">            ...     {&quot;field&quot;: &quot;time_range&quot;, &quot;issue&quot;: &quot;must be positive&quot;}</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">            ... )</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="n">error_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="p">},</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="p">}</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="k">if</span> <span class="n">request_id</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="c1"># Log error to stderr for debugging</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">request_id</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="c1"># Record error with aggregator for Phase 3 analytics</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="n">error_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>            <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="p">}</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;error_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">record_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="k">return</span> <span class="n">error_response</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_error_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a human-readable error type from error code.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        Args:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">            code: JSON-RPC error code</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        Returns:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">            String representation of error type.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>        <span class="n">error_type_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">:</span> <span class="s2">&quot;parse_error&quot;</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">:</span> <span class="s2">&quot;invalid_request&quot;</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">:</span> <span class="s2">&quot;method_not_found&quot;</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">:</span> <span class="s2">&quot;invalid_params&quot;</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">:</span> <span class="s2">&quot;internal_error&quot;</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">:</span> <span class="s2">&quot;resource_not_found&quot;</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">:</span> <span class="s2">&quot;resource_access_denied&quot;</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">:</span> <span class="s2">&quot;resource_unavailable&quot;</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TOOL_UNAVAILABLE</span><span class="p">:</span> <span class="s2">&quot;tool_unavailable&quot;</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">:</span> <span class="s2">&quot;timeout_error&quot;</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">:</span> <span class="s2">&quot;validation_error&quot;</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">:</span> <span class="s2">&quot;external_service_error&quot;</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">:</span> <span class="s2">&quot;rate_limit_error&quot;</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>        <span class="p">}</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="k">return</span> <span class="n">error_type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;unknown_error&quot;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_parse_error</span><span class="p">(</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Parse error&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a parse error response.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        Args:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">            message: Error message</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        Returns:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            Parse error response.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_request_error</span><span class="p">(</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid request&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid request error response.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        Args:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">            message: Error message</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        Returns:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">            Invalid request error response.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_method_not_found_error</span><span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a method not found error response.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        Args:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">            method: Method name that was not found</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        Returns:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">            Method not found error response.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">}</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_params_error</span><span class="p">(</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid parameters error response.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">        Args:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">            message: Error message</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">        Returns:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">            Invalid parameters error response.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_internal_error</span><span class="p">(</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an internal error response.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        Args:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">            message: Error message</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">        Returns:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">            Internal error response.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error</span><span class="p">(</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        Args:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        Returns:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">            Validation error response.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid parameters for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">(),</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please check the tool schema and provide valid parameters&quot;</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="p">}</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error</span><span class="p">(</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        Args:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">            timeout_seconds: Timeout value in seconds</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">        Returns:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">            Timeout error response.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; execution timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try reducing the scope of your request or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="p">}</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_error</span><span class="p">(</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource-related error response.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        Args:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">            resource_uri: URI of the resource that caused the error</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">            error_type: Type of resource error</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">            message: Error message</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        Returns:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">            Resource error response.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;not_found&quot;</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;access_denied&quot;</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;unavailable&quot;</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and your permissions&quot;</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>            <span class="p">}</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_external_service_error</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an external service error response.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        Args:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">            service_name: Name of the external service</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">            error_message: Error message from the service</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        Returns:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">            External service error response.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;External service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The service may be temporarily unavailable. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            <span class="p">}</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_rate_limit_error</span><span class="p">(</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="n">retry_after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a rate limit error response.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        Args:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">            service_name: Name of the service that rate limited the request</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">            retry_after: Suggested retry delay in seconds</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        Returns:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">            Rate limit error response.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please wait before making additional requests&quot;</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="p">}</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="k">if</span> <span class="n">retry_after</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;retry_after_seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retry_after</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;suggestion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Please wait </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds before retrying&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_security_error</span><span class="p">(</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a security error response.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        Args:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            message: Security error message</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        Returns:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">            Security error response.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;security_violation&quot;</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="p">}</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SECURITY_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_schema_validation_error</span><span class="p">(</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a schema validation error response.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        Args:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">            message: Schema validation error message</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        Returns:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">            Schema validation error response.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;schema_validation_failed&quot;</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="p">}</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEMA_VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_message_security</span><span class="p">(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_key_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate message security including schema validation and rate limiting.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        Args:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">            message: Raw JSON message string</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">            connection_id: Connection ID for rate limiting</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">            api_key_id: API key ID for rate limiting</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Returns:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">            Error response if validation fails, None if valid</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="c1"># Global rate limiting</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">():</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">()</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="c1"># Connection rate limiting</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">connection_id</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">connection_id</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;connection&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="c1"># API key rate limiting</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="k">if</span> <span class="n">api_key_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="c1"># Schema validation</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="n">parsed_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span><span class="o">.</span><span class="n">validate_complete_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="k">if</span> <span class="n">parsed_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_schema_validation_error</span><span class="p">(</span><span class="s2">&quot;Invalid message format or content&quot;</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">available_tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that a tool exists before execution.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        Args:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">            tool_name: Name of the tool to validate</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">            available_tools: List of available tool names</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        Raises:</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">            ValueError: If the tool does not exist.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_tools</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found. Available tools: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_tools</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>            <span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_arguments</span><span class="p">(</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate arguments against a tool schema.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        Args:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">            arguments: Arguments to validate</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">            schema: Tool schema for validation</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        Raises:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">            ValidationError: If arguments are invalid.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="c1"># This is a placeholder for schema validation</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="c1"># In a full implementation, you would use a JSON schema validator</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="c1"># For now, we&#39;ll do basic validation</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments must be a dictionary, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="c1"># Log validation attempt</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating arguments&quot;</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_timeout</span><span class="p">(</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">coro</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with timeout protection.</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">        Args:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">            coro: Coroutine to execute</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">            timeout_seconds: Timeout in seconds (uses default if None)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        Returns:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        Raises:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">            asyncio.TimeoutError: If the operation times out.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">if</span> <span class="n">timeout_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution&quot;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="s2">&quot;Executing operation with timeout&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="s2">&quot;Operation timed out&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="k">raise</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_retry</span><span class="p">(</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="n">base_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="n">max_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="n">exponential_base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with retry logic and exponential backoff.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Args:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">            coro_factory: Coroutine factory function or callable that returns a coroutine</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">            max_retries: Maximum number of retries (uses config default if None)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            base_delay: Base delay between retries (uses config default if None)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">            max_delay: Maximum delay between retries (uses config default if None)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">            exponential_base: Exponential backoff multiplier (uses config default if None)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        Returns:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        Raises:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">            Exception: If all retries are exhausted.</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>            <span class="n">max_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="n">base_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="n">base_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;base_delay&quot;</span><span class="p">]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">if</span> <span class="n">max_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="n">max_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_delay&quot;</span><span class="p">]</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="k">if</span> <span class="n">exponential_base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="n">exponential_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;exponential_base&quot;</span><span class="p">]</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">last_exception</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                        <span class="s2">&quot;Retrying operation&quot;</span><span class="p">,</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                        <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                    <span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="c1"># Create a new coroutine for each attempt</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                        <span class="s2">&quot;Operation succeeded on retry&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                    <span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">last_exception</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                        <span class="s2">&quot;Operation failed after all retries&quot;</span><span class="p">,</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                        <span class="n">final_error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                    <span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                    <span class="k">raise</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                <span class="c1"># Calculate delay with exponential backoff</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="n">exponential_base</span><span class="o">**</span><span class="n">attempt</span><span class="p">),</span> <span class="n">max_delay</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                    <span class="s2">&quot;Operation failed, retrying&quot;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                    <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                    <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                    <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>                    <span class="n">delay_seconds</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                    <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>                <span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="c1"># This should never be reached, but just in case</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="n">last_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="k">raise</span> <span class="n">last_exception</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Retry operation failed without exception&quot;</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log_error</span><span class="p">(</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log error information to stderr for debugging.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        Args:</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">            code: Error code</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            message: Error message</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">            request_id: Request ID for correlation</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="n">log_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>            <span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="p">}</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="n">log_data</span><span class="p">[</span><span class="s2">&quot;error_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="c1"># Log to stderr for debugging</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="n">error_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">log_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[MCP ERROR] </span><span class="si">{</span><span class="n">error_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="c1"># Also log to structured logger</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;MCP error occurred&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_data</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error handling configuration.</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        Returns:</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">            Dictionary containing error handling configuration summary.</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="s2">&quot;timeouts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="s2">&quot;retry_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">,</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="p">,</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="s2">&quot;error_codes&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                    <span class="s2">&quot;PARSE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                    <span class="s2">&quot;INVALID_REQUEST&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                    <span class="s2">&quot;METHOD_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                    <span class="s2">&quot;INVALID_PARAMS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                    <span class="s2">&quot;INTERNAL_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="p">},</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                <span class="s2">&quot;server_defined&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                    <span class="s2">&quot;RESOURCE_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                    <span class="s2">&quot;RESOURCE_ACCESS_DENIED&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="s2">&quot;RESOURCE_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                    <span class="s2">&quot;TOOL_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOOL_UNAVAILABLE</span><span class="p">,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                    <span class="s2">&quot;TIMEOUT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="s2">&quot;VALIDATION_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                    <span class="s2">&quot;EXTERNAL_SERVICE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                    <span class="s2">&quot;RATE_LIMIT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="p">},</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="p">},</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="p">}</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="c1"># Phase 3: Advanced Error Handling Features</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_not_found_error</span><span class="p">(</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource not found error response.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        Args:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            resource_uri: URI of the resource that was not found</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        Returns:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            Resource not found error response.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and ensure it exists&quot;</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>            <span class="p">}</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_access_denied_error</span><span class="p">(</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource access denied error response.</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        Args:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">            resource_uri: URI of the resource that access was denied to</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">            reason: Reason for access denial</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        Returns:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">            Resource access denied error response.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check your permissions and authentication&quot;</span><span class="p">,</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="p">}</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="sa">f</span><span class="s2">&quot;Access denied to resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_unavailable_error</span><span class="p">(</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Resource temporarily unavailable&quot;</span><span class="p">,</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource unavailable error response.</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        Args:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">            resource_uri: URI of the resource that is unavailable</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">            reason: Reason for unavailability</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">        Returns:</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">            Resource unavailable error response.</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try again later or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="p">}</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; unavailable: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_circuit_breaker_open_error</span><span class="p">(</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a circuit breaker open error response.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        Args:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">            service_name: Name of the service with open circuit breaker</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">        Returns:</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">            Circuit breaker open error response.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Service is temporarily unavailable due to repeated failures. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="p">}</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; circuit breaker is open&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error_with_context</span><span class="p">(</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response with additional context.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        Args:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">            context: Additional context about the validation failure</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">        Returns:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">            Enhanced validation error response.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">()],</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the input parameters and ensure they match the expected schema&quot;</span><span class="p">,</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="p">}</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation failed for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error_with_context</span><span class="p">(</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">operation_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response with operation context.</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">            timeout_seconds: Timeout value that was exceeded</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">            operation_context: Context about the operation that timed out</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">            data: Additional error data</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        Returns:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">            Enhanced timeout error response.</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;operation_context&quot;</span><span class="p">:</span> <span class="n">operation_context</span><span class="p">,</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The operation may be taking longer than expected. Try reducing the scope or increasing the timeout.&quot;</span><span class="p">,</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="p">}</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_enhanced_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an enhanced summary including Phase 3 features.</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        Returns:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">            Dictionary containing comprehensive error handling configuration and capabilities.</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="n">base_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">()</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">base_summary</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="p">{</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                <span class="s2">&quot;phase_3_features&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                    <span class="s2">&quot;circuit_breaker&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                        <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                            <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                            <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                            <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                        <span class="p">},</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                    <span class="p">},</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                    <span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">],</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                        <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">],</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                        <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                            <span class="s2">&quot;max_errors_per_window&quot;</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                        <span class="p">],</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                    <span class="p">},</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                    <span class="s2">&quot;enhanced_resource_handling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                    <span class="s2">&quot;context_aware_errors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                <span class="p">},</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="p">}</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="k">return</span> <span class="n">base_summary</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_analytics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error analytics and patterns from the aggregator.</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">        Args:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        Returns:</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">            Dictionary containing error analytics and patterns.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;disabled&quot;</span><span class="p">}</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="s2">&quot;error_summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">),</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="s2">&quot;error_trends&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_trends</span><span class="p">(),</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>            <span class="s2">&quot;aggregation_config&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">,</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="p">}</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_circuit_breaker_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get circuit breaker status for a specific service.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        Args:</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">            service_name: Name of the service to check</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        Returns:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">            Circuit breaker status or None if not found.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="c1"># This would be implemented when circuit breakers are added to specific services</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="c1"># For now, return None to indicate no circuit breaker exists</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreaker</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker implementation for external service calls.</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">    This class implements the circuit breaker pattern to prevent cascading failures</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">    when external services are experiencing issues. It tracks failures and</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">    automatically opens the circuit when the failure threshold is reached.</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">    Attributes:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">        config: Circuit breaker configuration</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">        state: Current circuit breaker state</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        failure_count: Number of consecutive failures</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">        success_count: Number of consecutive successes</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        last_failure_time: Timestamp of last failure</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">CircuitBreakerConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the circuit breaker.</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">        Args:</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">            service_name: Name of the service being protected</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">            config: Circuit breaker configuration</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">CircuitBreakerConfig</span><span class="p">()</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">can_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the circuit breaker allows execution.</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        Returns:</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">            True if execution is allowed, False otherwise.</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_attempt_reset</span><span class="p">():</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_half_open</span><span class="p">()</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="c1"># HALF_OPEN state - allow limited execution</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a successful operation.&quot;&quot;&quot;</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">:</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_closed</span><span class="p">()</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker closed&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>            <span class="c1"># Reset failure count on success</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a failed operation.</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">        Args:</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">            exception: The exception that occurred</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">expected_exception</span><span class="p">):</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">:</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_open</span><span class="p">()</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                    <span class="s2">&quot;Circuit breaker opened&quot;</span><span class="p">,</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>                    <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                    <span class="n">failure_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                <span class="p">)</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_attempt_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if enough time has passed to attempt reset.</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        Returns:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">            True if reset should be attempted.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">time_since_failure</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="k">return</span> <span class="n">time_since_failure</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recovery_timeout</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_half_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to half-open state.&quot;&quot;&quot;</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker set to half-open&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to open state.&quot;&quot;&quot;</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Circuit breaker opened&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to closed state.&quot;&quot;&quot;</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current status of the circuit breaker.</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        Returns:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">            Dictionary containing circuit breaker status.</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>            <span class="s2">&quot;failure_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="s2">&quot;success_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span><span class="p">,</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            <span class="s2">&quot;last_failure_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>                <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>                <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>            <span class="p">},</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="p">}</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">error_handler</span><span class="p">:</span> <span class="s2">&quot;MCPErrorHandler&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with circuit breaker protection.</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        Args:</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">            coro_factory: Coroutine factory function or callable</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">            error_handler: MCPErrorHandler instance for error responses</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        Returns:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        Raises:</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">            Exception: If the circuit breaker is open or execution fails.</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_execute</span><span class="p">():</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker is open for service &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_success</span><span class="p">()</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="k">raise</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ErrorAggregator</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Error aggregation and analytics for monitoring and debugging.</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">    This class tracks error patterns, frequencies, and trends to help</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">    identify systemic issues and provide insights for debugging.</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">    Attributes:</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        config: Error aggregation configuration</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        error_counts: Count of errors by type and time window</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">        error_history: Recent error history for analysis</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the error aggregator.</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        Args:</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">            config: Error aggregation configuration</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># 5 minutes</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="p">}</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="p">:</span> <span class="n">deque</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;history_size&quot;</span><span class="p">])</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record an error occurrence.</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">        Args:</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">            error_code: JSON-RPC error code</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">            error_type: Type of error (e.g., &#39;timeout&#39;, &#39;validation&#39;, &#39;external_service&#39;)</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">            context: Additional context about the error</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="k">return</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="c1"># Record error count</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="c1"># Record error history</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="n">error_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="n">error_code</span><span class="p">,</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>        <span class="p">}</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_record</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>        <span class="c1"># Check if we&#39;re exceeding error thresholds</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_error_thresholds</span><span class="p">(</span><span class="n">error_type</span><span class="p">)</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_error_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if error thresholds are exceeded and log warnings.</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">        Args:</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">            error_type: Type of error to check</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">])</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">error_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">recent_errors</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">error_type</span><span class="p">])</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="k">if</span> <span class="n">error_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">]:</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                <span class="s2">&quot;Error threshold exceeded&quot;</span><span class="p">,</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                <span class="n">error_type</span><span class="o">=</span><span class="n">error_type</span><span class="p">,</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                <span class="n">count</span><span class="o">=</span><span class="n">error_count</span><span class="p">,</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                <span class="n">threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">],</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>            <span class="p">)</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_recent_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get errors from the recent time window.</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a><span class="sd">        Args:</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">            window_seconds: Time window in seconds</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="sd">        Returns:</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a><span class="sd">            List of recent errors</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="n">cutoff_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cutoff_time</span><span class="p">]</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error patterns.</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">        Args:</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">        Returns:</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">            Dictionary containing error summary and patterns.</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="k">if</span> <span class="n">window_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>            <span class="n">window_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="c1"># Group errors by type and code</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        <span class="n">error_summary</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="p">)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>            <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Keep only first 5 examples</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                    <span class="p">{</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                        <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                    <span class="p">}</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                <span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>            <span class="s2">&quot;window_seconds&quot;</span><span class="p">:</span> <span class="n">window_seconds</span><span class="p">,</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="s2">&quot;error_patterns&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">error_summary</span><span class="p">),</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>            <span class="s2">&quot;most_common_errors&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                <span class="n">error_summary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">],</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>            <span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>  <span class="c1"># Top 10 most common errors</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>        <span class="p">}</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error trends over a longer time period.</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">        Args:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">            hours: Number of hours to analyze</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">        Returns:</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">            Dictionary containing error trends and patterns.</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>        <span class="n">window_seconds</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="c1"># Group errors by hour</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="n">hourly_errors</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>            <span class="n">hour_key</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>            <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hour_key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>        <span class="c1"># Calculate trend</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hourly_errors</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>            <span class="n">hours_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hourly_errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>            <span class="n">first_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>            <span class="n">last_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>            <span class="k">if</span> <span class="n">first_hour_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="p">((</span><span class="n">last_hour_count</span> <span class="o">-</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>            <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>            <span class="s2">&quot;analysis_period_hours&quot;</span><span class="p">:</span> <span class="n">hours</span><span class="p">,</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>            <span class="s2">&quot;hourly_breakdown&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> <span class="n">c</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hourly_errors</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="s2">&quot;trend_percentage&quot;</span><span class="p">:</span> <span class="n">trend_percentage</span><span class="p">,</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>            <span class="s2">&quot;trend_description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_describe_trend</span><span class="p">(</span><span class="n">trend_percentage</span><span class="p">),</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="p">}</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_describe_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trend_percentage</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Describe the error trend in human-readable terms.</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">        Args:</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">            trend_percentage: Percentage change in error rate</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">        Returns:</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">            Human-readable trend description.</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>            <span class="k">return</span> <span class="s2">&quot;Significantly increasing&quot;</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>            <span class="k">return</span> <span class="s2">&quot;Moderately increasing&quot;</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>            <span class="k">return</span> <span class="s2">&quot;Stable&quot;</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">20</span><span class="p">:</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>            <span class="k">return</span> <span class="s2">&quot;Moderately decreasing&quot;</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="k">return</span> <span class="s2">&quot;Significantly decreasing&quot;</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all error tracking data.&quot;&quot;&quot;</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error aggregator reset&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<input id="logger-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="logger-view-value"></label><span class="default_value">&lt;BoundLoggerLazyProxy(logger=None, wrapper_class=None, processors=None, context_class=None, initial_values={}, logger_factory_args=(&#39;<a href="">src.mcp_error_handler</a>&#39;,))&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
    

                </section>
                <section id="CircuitBreakerState">
                            <input id="CircuitBreakerState-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CircuitBreakerState</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="CircuitBreakerState-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreakerState"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreakerState-42"><a href="#CircuitBreakerState-42"><span class="linenos">42</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreakerState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="CircuitBreakerState-43"><a href="#CircuitBreakerState-43"><span class="linenos">43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker states.&quot;&quot;&quot;</span>
</span><span id="CircuitBreakerState-44"><a href="#CircuitBreakerState-44"><span class="linenos">44</span></a>
</span><span id="CircuitBreakerState-45"><a href="#CircuitBreakerState-45"><span class="linenos">45</span></a>    <span class="n">CLOSED</span> <span class="o">=</span> <span class="s2">&quot;closed&quot;</span>  <span class="c1"># Normal operation</span>
</span><span id="CircuitBreakerState-46"><a href="#CircuitBreakerState-46"><span class="linenos">46</span></a>    <span class="n">OPEN</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>  <span class="c1"># Failing, reject requests</span>
</span><span id="CircuitBreakerState-47"><a href="#CircuitBreakerState-47"><span class="linenos">47</span></a>    <span class="n">HALF_OPEN</span> <span class="o">=</span> <span class="s2">&quot;half_open&quot;</span>  <span class="c1"># Testing if service recovered</span>
</span></pre></div>


            <div class="docstring"><p>Circuit breaker states.</p>
</div>


                            <div id="CircuitBreakerState.CLOSED" class="classattr">
                                <div class="attr variable">
            <span class="name">CLOSED</span>        =
<span class="default_value">&lt;<a href="#CircuitBreakerState.CLOSED">CircuitBreakerState.CLOSED</a>: &#39;closed&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerState.CLOSED"></a>
    
    

                            </div>
                            <div id="CircuitBreakerState.OPEN" class="classattr">
                                <div class="attr variable">
            <span class="name">OPEN</span>        =
<span class="default_value">&lt;<a href="#CircuitBreakerState.OPEN">CircuitBreakerState.OPEN</a>: &#39;open&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerState.OPEN"></a>
    
    

                            </div>
                            <div id="CircuitBreakerState.HALF_OPEN" class="classattr">
                                <div class="attr variable">
            <span class="name">HALF_OPEN</span>        =
<span class="default_value">&lt;<a href="#CircuitBreakerState.HALF_OPEN">CircuitBreakerState.HALF_OPEN</a>: &#39;half_open&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerState.HALF_OPEN"></a>
    
    

                            </div>
                </section>
                <section id="CircuitBreakerConfig">
                            <input id="CircuitBreakerConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">CircuitBreakerConfig</span>:

                <label class="view-source-button" for="CircuitBreakerConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreakerConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreakerConfig-50"><a href="#CircuitBreakerConfig-50"><span class="linenos">50</span></a><span class="nd">@dataclass</span>
</span><span id="CircuitBreakerConfig-51"><a href="#CircuitBreakerConfig-51"><span class="linenos">51</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreakerConfig</span><span class="p">:</span>
</span><span id="CircuitBreakerConfig-52"><a href="#CircuitBreakerConfig-52"><span class="linenos">52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for circuit breaker behavior.</span>
</span><span id="CircuitBreakerConfig-53"><a href="#CircuitBreakerConfig-53"><span class="linenos">53</span></a>
</span><span id="CircuitBreakerConfig-54"><a href="#CircuitBreakerConfig-54"><span class="linenos">54</span></a><span class="sd">    Attributes:</span>
</span><span id="CircuitBreakerConfig-55"><a href="#CircuitBreakerConfig-55"><span class="linenos">55</span></a><span class="sd">        failure_threshold: Number of failures before opening circuit</span>
</span><span id="CircuitBreakerConfig-56"><a href="#CircuitBreakerConfig-56"><span class="linenos">56</span></a><span class="sd">        recovery_timeout: Time to wait before attempting recovery</span>
</span><span id="CircuitBreakerConfig-57"><a href="#CircuitBreakerConfig-57"><span class="linenos">57</span></a><span class="sd">        expected_exception: Exception types that count as failures</span>
</span><span id="CircuitBreakerConfig-58"><a href="#CircuitBreakerConfig-58"><span class="linenos">58</span></a><span class="sd">        success_threshold: Number of successes needed to close circuit</span>
</span><span id="CircuitBreakerConfig-59"><a href="#CircuitBreakerConfig-59"><span class="linenos">59</span></a>
</span><span id="CircuitBreakerConfig-60"><a href="#CircuitBreakerConfig-60"><span class="linenos">60</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CircuitBreakerConfig-61"><a href="#CircuitBreakerConfig-61"><span class="linenos">61</span></a>
</span><span id="CircuitBreakerConfig-62"><a href="#CircuitBreakerConfig-62"><span class="linenos">62</span></a>    <span class="n">failure_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="CircuitBreakerConfig-63"><a href="#CircuitBreakerConfig-63"><span class="linenos">63</span></a>    <span class="n">recovery_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span>  <span class="c1"># seconds</span>
</span><span id="CircuitBreakerConfig-64"><a href="#CircuitBreakerConfig-64"><span class="linenos">64</span></a>    <span class="n">expected_exception</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,)</span>
</span><span id="CircuitBreakerConfig-65"><a href="#CircuitBreakerConfig-65"><span class="linenos">65</span></a>    <span class="n">success_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>Configuration for circuit breaker behavior.</p>

<p>Attributes:
    failure_threshold: Number of failures before opening circuit
    recovery_timeout: Time to wait before attempting recovery
    expected_exception: Exception types that count as failures
    success_threshold: Number of successes needed to close circuit</p>
</div>


                            <div id="CircuitBreakerConfig.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">CircuitBreakerConfig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">failure_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">recovery_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span>,</span><span class="param">	expected_exception: tuple[type[Exception], ...] = (&lt;class &#x27;Exception&#x27;&gt;,),</span><span class="param">	<span class="n">success_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerConfig.__init__"></a>
    
    

                            </div>
                            <div id="CircuitBreakerConfig.failure_threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">failure_threshold</span><span class="annotation">: int</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerConfig.failure_threshold"></a>
    
    

                            </div>
                            <div id="CircuitBreakerConfig.recovery_timeout" class="classattr">
                                <div class="attr variable">
            <span class="name">recovery_timeout</span><span class="annotation">: float</span>        =
<span class="default_value">60.0</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerConfig.recovery_timeout"></a>
    
    

                            </div>
                            <div id="CircuitBreakerConfig.expected_exception" class="classattr">
                                <div class="attr variable">
            <span class="name">expected_exception</span><span class="annotation">: tuple[type[Exception], ...]</span>        =
<span class="default_value">(&lt;class &#39;Exception&#39;&gt;,)</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerConfig.expected_exception"></a>
    
    

                            </div>
                            <div id="CircuitBreakerConfig.success_threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">success_threshold</span><span class="annotation">: int</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreakerConfig.success_threshold"></a>
    
    

                            </div>
                </section>
                <section id="ErrorHandlingConfig">
                            <input id="ErrorHandlingConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">ErrorHandlingConfig</span>:

                <label class="view-source-button" for="ErrorHandlingConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorHandlingConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorHandlingConfig-68"><a href="#ErrorHandlingConfig-68"><span class="linenos"> 68</span></a><span class="nd">@dataclass</span>
</span><span id="ErrorHandlingConfig-69"><a href="#ErrorHandlingConfig-69"><span class="linenos"> 69</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandlingConfig</span><span class="p">:</span>
</span><span id="ErrorHandlingConfig-70"><a href="#ErrorHandlingConfig-70"><span class="linenos"> 70</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for error handling behavior.</span>
</span><span id="ErrorHandlingConfig-71"><a href="#ErrorHandlingConfig-71"><span class="linenos"> 71</span></a>
</span><span id="ErrorHandlingConfig-72"><a href="#ErrorHandlingConfig-72"><span class="linenos"> 72</span></a><span class="sd">    Attributes:</span>
</span><span id="ErrorHandlingConfig-73"><a href="#ErrorHandlingConfig-73"><span class="linenos"> 73</span></a><span class="sd">        timeouts: Timeout settings for different operations</span>
</span><span id="ErrorHandlingConfig-74"><a href="#ErrorHandlingConfig-74"><span class="linenos"> 74</span></a><span class="sd">        retry_settings: Retry configuration for transient failures</span>
</span><span id="ErrorHandlingConfig-75"><a href="#ErrorHandlingConfig-75"><span class="linenos"> 75</span></a><span class="sd">        logging: Logging configuration for error handling</span>
</span><span id="ErrorHandlingConfig-76"><a href="#ErrorHandlingConfig-76"><span class="linenos"> 76</span></a><span class="sd">        circuit_breaker: Circuit breaker configuration</span>
</span><span id="ErrorHandlingConfig-77"><a href="#ErrorHandlingConfig-77"><span class="linenos"> 77</span></a><span class="sd">        error_aggregation: Error aggregation settings</span>
</span><span id="ErrorHandlingConfig-78"><a href="#ErrorHandlingConfig-78"><span class="linenos"> 78</span></a>
</span><span id="ErrorHandlingConfig-79"><a href="#ErrorHandlingConfig-79"><span class="linenos"> 79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ErrorHandlingConfig-80"><a href="#ErrorHandlingConfig-80"><span class="linenos"> 80</span></a>
</span><span id="ErrorHandlingConfig-81"><a href="#ErrorHandlingConfig-81"><span class="linenos"> 81</span></a>    <span class="n">timeouts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="ErrorHandlingConfig-82"><a href="#ErrorHandlingConfig-82"><span class="linenos"> 82</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ErrorHandlingConfig-83"><a href="#ErrorHandlingConfig-83"><span class="linenos"> 83</span></a>            <span class="s2">&quot;elasticsearch_operations&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-84"><a href="#ErrorHandlingConfig-84"><span class="linenos"> 84</span></a>            <span class="s2">&quot;dshield_api_calls&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-85"><a href="#ErrorHandlingConfig-85"><span class="linenos"> 85</span></a>            <span class="s2">&quot;latex_compilation&quot;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-86"><a href="#ErrorHandlingConfig-86"><span class="linenos"> 86</span></a>            <span class="s2">&quot;tool_execution&quot;</span><span class="p">:</span> <span class="mf">120.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-87"><a href="#ErrorHandlingConfig-87"><span class="linenos"> 87</span></a>        <span class="p">}</span>
</span><span id="ErrorHandlingConfig-88"><a href="#ErrorHandlingConfig-88"><span class="linenos"> 88</span></a>    <span class="p">)</span>
</span><span id="ErrorHandlingConfig-89"><a href="#ErrorHandlingConfig-89"><span class="linenos"> 89</span></a>
</span><span id="ErrorHandlingConfig-90"><a href="#ErrorHandlingConfig-90"><span class="linenos"> 90</span></a>    <span class="n">retry_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="ErrorHandlingConfig-91"><a href="#ErrorHandlingConfig-91"><span class="linenos"> 91</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ErrorHandlingConfig-92"><a href="#ErrorHandlingConfig-92"><span class="linenos"> 92</span></a>            <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-93"><a href="#ErrorHandlingConfig-93"><span class="linenos"> 93</span></a>            <span class="s2">&quot;base_delay&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-94"><a href="#ErrorHandlingConfig-94"><span class="linenos"> 94</span></a>            <span class="s2">&quot;max_delay&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-95"><a href="#ErrorHandlingConfig-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot;exponential_base&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-96"><a href="#ErrorHandlingConfig-96"><span class="linenos"> 96</span></a>        <span class="p">}</span>
</span><span id="ErrorHandlingConfig-97"><a href="#ErrorHandlingConfig-97"><span class="linenos"> 97</span></a>    <span class="p">)</span>
</span><span id="ErrorHandlingConfig-98"><a href="#ErrorHandlingConfig-98"><span class="linenos"> 98</span></a>
</span><span id="ErrorHandlingConfig-99"><a href="#ErrorHandlingConfig-99"><span class="linenos"> 99</span></a>    <span class="n">logging</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="ErrorHandlingConfig-100"><a href="#ErrorHandlingConfig-100"><span class="linenos">100</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ErrorHandlingConfig-101"><a href="#ErrorHandlingConfig-101"><span class="linenos">101</span></a>            <span class="s2">&quot;include_stack_traces&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-102"><a href="#ErrorHandlingConfig-102"><span class="linenos">102</span></a>            <span class="s2">&quot;include_request_context&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-103"><a href="#ErrorHandlingConfig-103"><span class="linenos">103</span></a>            <span class="s2">&quot;include_user_parameters&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-104"><a href="#ErrorHandlingConfig-104"><span class="linenos">104</span></a>            <span class="s2">&quot;log_level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-105"><a href="#ErrorHandlingConfig-105"><span class="linenos">105</span></a>        <span class="p">}</span>
</span><span id="ErrorHandlingConfig-106"><a href="#ErrorHandlingConfig-106"><span class="linenos">106</span></a>    <span class="p">)</span>
</span><span id="ErrorHandlingConfig-107"><a href="#ErrorHandlingConfig-107"><span class="linenos">107</span></a>
</span><span id="ErrorHandlingConfig-108"><a href="#ErrorHandlingConfig-108"><span class="linenos">108</span></a>    <span class="n">circuit_breaker</span><span class="p">:</span> <span class="n">CircuitBreakerConfig</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">CircuitBreakerConfig</span><span class="p">)</span>
</span><span id="ErrorHandlingConfig-109"><a href="#ErrorHandlingConfig-109"><span class="linenos">109</span></a>
</span><span id="ErrorHandlingConfig-110"><a href="#ErrorHandlingConfig-110"><span class="linenos">110</span></a>    <span class="n">error_aggregation</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="ErrorHandlingConfig-111"><a href="#ErrorHandlingConfig-111"><span class="linenos">111</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ErrorHandlingConfig-112"><a href="#ErrorHandlingConfig-112"><span class="linenos">112</span></a>            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-113"><a href="#ErrorHandlingConfig-113"><span class="linenos">113</span></a>            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># 5 minutes</span>
</span><span id="ErrorHandlingConfig-114"><a href="#ErrorHandlingConfig-114"><span class="linenos">114</span></a>            <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-115"><a href="#ErrorHandlingConfig-115"><span class="linenos">115</span></a>            <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="ErrorHandlingConfig-116"><a href="#ErrorHandlingConfig-116"><span class="linenos">116</span></a>        <span class="p">}</span>
</span><span id="ErrorHandlingConfig-117"><a href="#ErrorHandlingConfig-117"><span class="linenos">117</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Configuration for error handling behavior.</p>

<p>Attributes:
    timeouts: Timeout settings for different operations
    retry_settings: Retry configuration for transient failures
    logging: Logging configuration for error handling
    circuit_breaker: Circuit breaker configuration
    error_aggregation: Error aggregation settings</p>
</div>


                            <div id="ErrorHandlingConfig.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">ErrorHandlingConfig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">timeouts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">retry_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">logging</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">circuit_breaker</span><span class="p">:</span> <span class="n"><a href="#CircuitBreakerConfig">CircuitBreakerConfig</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">error_aggregation</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.__init__"></a>
    
    

                            </div>
                            <div id="ErrorHandlingConfig.timeouts" class="classattr">
                                <div class="attr variable">
            <span class="name">timeouts</span><span class="annotation">: dict[str, float]</span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.timeouts"></a>
    
    

                            </div>
                            <div id="ErrorHandlingConfig.retry_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">retry_settings</span><span class="annotation">: dict[str, typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.retry_settings"></a>
    
    

                            </div>
                            <div id="ErrorHandlingConfig.logging" class="classattr">
                                <div class="attr variable">
            <span class="name">logging</span><span class="annotation">: dict[str, typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.logging"></a>
    
    

                            </div>
                            <div id="ErrorHandlingConfig.circuit_breaker" class="classattr">
                                <div class="attr variable">
            <span class="name">circuit_breaker</span><span class="annotation">: <a href="#CircuitBreakerConfig">CircuitBreakerConfig</a></span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.circuit_breaker"></a>
    
    

                            </div>
                            <div id="ErrorHandlingConfig.error_aggregation" class="classattr">
                                <div class="attr variable">
            <span class="name">error_aggregation</span><span class="annotation">: dict[str, typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#ErrorHandlingConfig.error_aggregation"></a>
    
    

                            </div>
                </section>
                <section id="MCPErrorHandler">
                            <input id="MCPErrorHandler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MCPErrorHandler</span>:

                <label class="view-source-button" for="MCPErrorHandler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler-120"><a href="#MCPErrorHandler-120"><span class="linenos"> 120</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MCPErrorHandler</span><span class="p">:</span>
</span><span id="MCPErrorHandler-121"><a href="#MCPErrorHandler-121"><span class="linenos"> 121</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles JSON-RPC error responses for MCP server.</span>
</span><span id="MCPErrorHandler-122"><a href="#MCPErrorHandler-122"><span class="linenos"> 122</span></a>
</span><span id="MCPErrorHandler-123"><a href="#MCPErrorHandler-123"><span class="linenos"> 123</span></a><span class="sd">    This class provides comprehensive error handling for all MCP operations,</span>
</span><span id="MCPErrorHandler-124"><a href="#MCPErrorHandler-124"><span class="linenos"> 124</span></a><span class="sd">    including proper error code generation, timeout handling, retry logic,</span>
</span><span id="MCPErrorHandler-125"><a href="#MCPErrorHandler-125"><span class="linenos"> 125</span></a><span class="sd">    and detailed error logging for debugging and troubleshooting.</span>
</span><span id="MCPErrorHandler-126"><a href="#MCPErrorHandler-126"><span class="linenos"> 126</span></a>
</span><span id="MCPErrorHandler-127"><a href="#MCPErrorHandler-127"><span class="linenos"> 127</span></a><span class="sd">    The error handler follows the JSON-RPC 2.0 specification and ensures</span>
</span><span id="MCPErrorHandler-128"><a href="#MCPErrorHandler-128"><span class="linenos"> 128</span></a><span class="sd">    that all error responses are properly formatted and contain actionable</span>
</span><span id="MCPErrorHandler-129"><a href="#MCPErrorHandler-129"><span class="linenos"> 129</span></a><span class="sd">    information for users while maintaining detailed logging for developers.</span>
</span><span id="MCPErrorHandler-130"><a href="#MCPErrorHandler-130"><span class="linenos"> 130</span></a>
</span><span id="MCPErrorHandler-131"><a href="#MCPErrorHandler-131"><span class="linenos"> 131</span></a><span class="sd">    Attributes:</span>
</span><span id="MCPErrorHandler-132"><a href="#MCPErrorHandler-132"><span class="linenos"> 132</span></a><span class="sd">        config: Error handling configuration</span>
</span><span id="MCPErrorHandler-133"><a href="#MCPErrorHandler-133"><span class="linenos"> 133</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="MCPErrorHandler-134"><a href="#MCPErrorHandler-134"><span class="linenos"> 134</span></a>
</span><span id="MCPErrorHandler-135"><a href="#MCPErrorHandler-135"><span class="linenos"> 135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-136"><a href="#MCPErrorHandler-136"><span class="linenos"> 136</span></a>
</span><span id="MCPErrorHandler-137"><a href="#MCPErrorHandler-137"><span class="linenos"> 137</span></a>    <span class="c1"># Standard JSON-RPC 2.0 error codes</span>
</span><span id="MCPErrorHandler-138"><a href="#MCPErrorHandler-138"><span class="linenos"> 138</span></a>    <span class="n">PARSE_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32700</span>
</span><span id="MCPErrorHandler-139"><a href="#MCPErrorHandler-139"><span class="linenos"> 139</span></a>    <span class="n">INVALID_REQUEST</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32600</span>
</span><span id="MCPErrorHandler-140"><a href="#MCPErrorHandler-140"><span class="linenos"> 140</span></a>    <span class="n">METHOD_NOT_FOUND</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32601</span>
</span><span id="MCPErrorHandler-141"><a href="#MCPErrorHandler-141"><span class="linenos"> 141</span></a>    <span class="n">INVALID_PARAMS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32602</span>
</span><span id="MCPErrorHandler-142"><a href="#MCPErrorHandler-142"><span class="linenos"> 142</span></a>    <span class="n">INTERNAL_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32603</span>
</span><span id="MCPErrorHandler-143"><a href="#MCPErrorHandler-143"><span class="linenos"> 143</span></a>
</span><span id="MCPErrorHandler-144"><a href="#MCPErrorHandler-144"><span class="linenos"> 144</span></a>    <span class="c1"># Server-defined error codes (starting at -32000)</span>
</span><span id="MCPErrorHandler-145"><a href="#MCPErrorHandler-145"><span class="linenos"> 145</span></a>    <span class="n">RESOURCE_NOT_FOUND</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32001</span>
</span><span id="MCPErrorHandler-146"><a href="#MCPErrorHandler-146"><span class="linenos"> 146</span></a>    <span class="n">RESOURCE_ACCESS_DENIED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32002</span>
</span><span id="MCPErrorHandler-147"><a href="#MCPErrorHandler-147"><span class="linenos"> 147</span></a>    <span class="n">RESOURCE_UNAVAILABLE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32003</span>
</span><span id="MCPErrorHandler-148"><a href="#MCPErrorHandler-148"><span class="linenos"> 148</span></a>    <span class="n">TOOL_UNAVAILABLE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32004</span>
</span><span id="MCPErrorHandler-149"><a href="#MCPErrorHandler-149"><span class="linenos"> 149</span></a>    <span class="n">TIMEOUT_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32005</span>
</span><span id="MCPErrorHandler-150"><a href="#MCPErrorHandler-150"><span class="linenos"> 150</span></a>    <span class="n">VALIDATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32006</span>
</span><span id="MCPErrorHandler-151"><a href="#MCPErrorHandler-151"><span class="linenos"> 151</span></a>    <span class="n">EXTERNAL_SERVICE_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32007</span>
</span><span id="MCPErrorHandler-152"><a href="#MCPErrorHandler-152"><span class="linenos"> 152</span></a>    <span class="n">RATE_LIMIT_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32008</span>
</span><span id="MCPErrorHandler-153"><a href="#MCPErrorHandler-153"><span class="linenos"> 153</span></a>    <span class="n">SECURITY_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32009</span>
</span><span id="MCPErrorHandler-154"><a href="#MCPErrorHandler-154"><span class="linenos"> 154</span></a>    <span class="n">SCHEMA_VALIDATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32010</span>
</span><span id="MCPErrorHandler-155"><a href="#MCPErrorHandler-155"><span class="linenos"> 155</span></a>
</span><span id="MCPErrorHandler-156"><a href="#MCPErrorHandler-156"><span class="linenos"> 156</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ErrorHandlingConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-157"><a href="#MCPErrorHandler-157"><span class="linenos"> 157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the MCP error handler.</span>
</span><span id="MCPErrorHandler-158"><a href="#MCPErrorHandler-158"><span class="linenos"> 158</span></a>
</span><span id="MCPErrorHandler-159"><a href="#MCPErrorHandler-159"><span class="linenos"> 159</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-160"><a href="#MCPErrorHandler-160"><span class="linenos"> 160</span></a><span class="sd">            config: Error handling configuration. If None, uses default values.</span>
</span><span id="MCPErrorHandler-161"><a href="#MCPErrorHandler-161"><span class="linenos"> 161</span></a>
</span><span id="MCPErrorHandler-162"><a href="#MCPErrorHandler-162"><span class="linenos"> 162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-163"><a href="#MCPErrorHandler-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">ErrorHandlingConfig</span><span class="p">()</span>
</span><span id="MCPErrorHandler-164"><a href="#MCPErrorHandler-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="MCPErrorHandler-165"><a href="#MCPErrorHandler-165"><span class="linenos"> 165</span></a>
</span><span id="MCPErrorHandler-166"><a href="#MCPErrorHandler-166"><span class="linenos"> 166</span></a>        <span class="c1"># Initialize error aggregator for Phase 3 features</span>
</span><span id="MCPErrorHandler-167"><a href="#MCPErrorHandler-167"><span class="linenos"> 167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span> <span class="o">=</span> <span class="n">ErrorAggregator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">)</span>
</span><span id="MCPErrorHandler-168"><a href="#MCPErrorHandler-168"><span class="linenos"> 168</span></a>
</span><span id="MCPErrorHandler-169"><a href="#MCPErrorHandler-169"><span class="linenos"> 169</span></a>        <span class="c1"># Initialize security components</span>
</span><span id="MCPErrorHandler-170"><a href="#MCPErrorHandler-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span> <span class="o">=</span> <span class="n">MCPSchemaValidator</span><span class="p">()</span>
</span><span id="MCPErrorHandler-171"><a href="#MCPErrorHandler-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span> <span class="o">=</span> <span class="n">APIKeyRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler-172"><a href="#MCPErrorHandler-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span> <span class="o">=</span> <span class="n">ConnectionRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler-173"><a href="#MCPErrorHandler-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span> <span class="o">=</span> <span class="n">GlobalRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler-174"><a href="#MCPErrorHandler-174"><span class="linenos"> 174</span></a>
</span><span id="MCPErrorHandler-175"><a href="#MCPErrorHandler-175"><span class="linenos"> 175</span></a>        <span class="c1"># Validate configuration</span>
</span><span id="MCPErrorHandler-176"><a href="#MCPErrorHandler-176"><span class="linenos"> 176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">()</span>
</span><span id="MCPErrorHandler-177"><a href="#MCPErrorHandler-177"><span class="linenos"> 177</span></a>
</span><span id="MCPErrorHandler-178"><a href="#MCPErrorHandler-178"><span class="linenos"> 178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-179"><a href="#MCPErrorHandler-179"><span class="linenos"> 179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the error handling configuration.</span>
</span><span id="MCPErrorHandler-180"><a href="#MCPErrorHandler-180"><span class="linenos"> 180</span></a>
</span><span id="MCPErrorHandler-181"><a href="#MCPErrorHandler-181"><span class="linenos"> 181</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler-182"><a href="#MCPErrorHandler-182"><span class="linenos"> 182</span></a><span class="sd">            ValueError: If configuration values are invalid.</span>
</span><span id="MCPErrorHandler-183"><a href="#MCPErrorHandler-183"><span class="linenos"> 183</span></a>
</span><span id="MCPErrorHandler-184"><a href="#MCPErrorHandler-184"><span class="linenos"> 184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-185"><a href="#MCPErrorHandler-185"><span class="linenos"> 185</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-186"><a href="#MCPErrorHandler-186"><span class="linenos"> 186</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_retries must be non-negative&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-187"><a href="#MCPErrorHandler-187"><span class="linenos"> 187</span></a>
</span><span id="MCPErrorHandler-188"><a href="#MCPErrorHandler-188"><span class="linenos"> 188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;base_delay&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-189"><a href="#MCPErrorHandler-189"><span class="linenos"> 189</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;base_delay must be positive&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-190"><a href="#MCPErrorHandler-190"><span class="linenos"> 190</span></a>
</span><span id="MCPErrorHandler-191"><a href="#MCPErrorHandler-191"><span class="linenos"> 191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_delay&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-192"><a href="#MCPErrorHandler-192"><span class="linenos"> 192</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_delay must be positive&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-193"><a href="#MCPErrorHandler-193"><span class="linenos"> 193</span></a>
</span><span id="MCPErrorHandler-194"><a href="#MCPErrorHandler-194"><span class="linenos"> 194</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;exponential_base&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MCPErrorHandler-195"><a href="#MCPErrorHandler-195"><span class="linenos"> 195</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;exponential_base must be greater than 1&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-196"><a href="#MCPErrorHandler-196"><span class="linenos"> 196</span></a>
</span><span id="MCPErrorHandler-197"><a href="#MCPErrorHandler-197"><span class="linenos"> 197</span></a>        <span class="k">for</span> <span class="n">operation</span><span class="p">,</span> <span class="n">timeout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MCPErrorHandler-198"><a href="#MCPErrorHandler-198"><span class="linenos"> 198</span></a>            <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-199"><a href="#MCPErrorHandler-199"><span class="linenos"> 199</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;timeout for </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> must be positive&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-200"><a href="#MCPErrorHandler-200"><span class="linenos"> 200</span></a>
</span><span id="MCPErrorHandler-201"><a href="#MCPErrorHandler-201"><span class="linenos"> 201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-202"><a href="#MCPErrorHandler-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-203"><a href="#MCPErrorHandler-203"><span class="linenos"> 203</span></a>        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MCPErrorHandler-204"><a href="#MCPErrorHandler-204"><span class="linenos"> 204</span></a>        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-205"><a href="#MCPErrorHandler-205"><span class="linenos"> 205</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-206"><a href="#MCPErrorHandler-206"><span class="linenos"> 206</span></a>        <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-207"><a href="#MCPErrorHandler-207"><span class="linenos"> 207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-208"><a href="#MCPErrorHandler-208"><span class="linenos"> 208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a properly formatted JSON-RPC error response.</span>
</span><span id="MCPErrorHandler-209"><a href="#MCPErrorHandler-209"><span class="linenos"> 209</span></a>
</span><span id="MCPErrorHandler-210"><a href="#MCPErrorHandler-210"><span class="linenos"> 210</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-211"><a href="#MCPErrorHandler-211"><span class="linenos"> 211</span></a><span class="sd">            code: JSON-RPC error code</span>
</span><span id="MCPErrorHandler-212"><a href="#MCPErrorHandler-212"><span class="linenos"> 212</span></a><span class="sd">            message: Human-readable error message</span>
</span><span id="MCPErrorHandler-213"><a href="#MCPErrorHandler-213"><span class="linenos"> 213</span></a><span class="sd">            data: Additional error data (optional)</span>
</span><span id="MCPErrorHandler-214"><a href="#MCPErrorHandler-214"><span class="linenos"> 214</span></a><span class="sd">            request_id: Request ID for correlation (optional)</span>
</span><span id="MCPErrorHandler-215"><a href="#MCPErrorHandler-215"><span class="linenos"> 215</span></a>
</span><span id="MCPErrorHandler-216"><a href="#MCPErrorHandler-216"><span class="linenos"> 216</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-217"><a href="#MCPErrorHandler-217"><span class="linenos"> 217</span></a><span class="sd">            Dictionary containing the JSON-RPC error response.</span>
</span><span id="MCPErrorHandler-218"><a href="#MCPErrorHandler-218"><span class="linenos"> 218</span></a>
</span><span id="MCPErrorHandler-219"><a href="#MCPErrorHandler-219"><span class="linenos"> 219</span></a><span class="sd">        Example:</span>
</span><span id="MCPErrorHandler-220"><a href="#MCPErrorHandler-220"><span class="linenos"> 220</span></a><span class="sd">            &gt;&gt;&gt; error = error_handler.create_error(</span>
</span><span id="MCPErrorHandler-221"><a href="#MCPErrorHandler-221"><span class="linenos"> 221</span></a><span class="sd">            ...     MCPErrorHandler.INVALID_PARAMS,</span>
</span><span id="MCPErrorHandler-222"><a href="#MCPErrorHandler-222"><span class="linenos"> 222</span></a><span class="sd">            ...     &quot;Invalid parameters provided&quot;,</span>
</span><span id="MCPErrorHandler-223"><a href="#MCPErrorHandler-223"><span class="linenos"> 223</span></a><span class="sd">            ...     {&quot;field&quot;: &quot;time_range&quot;, &quot;issue&quot;: &quot;must be positive&quot;}</span>
</span><span id="MCPErrorHandler-224"><a href="#MCPErrorHandler-224"><span class="linenos"> 224</span></a><span class="sd">            ... )</span>
</span><span id="MCPErrorHandler-225"><a href="#MCPErrorHandler-225"><span class="linenos"> 225</span></a>
</span><span id="MCPErrorHandler-226"><a href="#MCPErrorHandler-226"><span class="linenos"> 226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-227"><a href="#MCPErrorHandler-227"><span class="linenos"> 227</span></a>        <span class="n">error_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-228"><a href="#MCPErrorHandler-228"><span class="linenos"> 228</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-229"><a href="#MCPErrorHandler-229"><span class="linenos"> 229</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-230"><a href="#MCPErrorHandler-230"><span class="linenos"> 230</span></a>                <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
</span><span id="MCPErrorHandler-231"><a href="#MCPErrorHandler-231"><span class="linenos"> 231</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="MCPErrorHandler-232"><a href="#MCPErrorHandler-232"><span class="linenos"> 232</span></a>            <span class="p">},</span>
</span><span id="MCPErrorHandler-233"><a href="#MCPErrorHandler-233"><span class="linenos"> 233</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler-234"><a href="#MCPErrorHandler-234"><span class="linenos"> 234</span></a>
</span><span id="MCPErrorHandler-235"><a href="#MCPErrorHandler-235"><span class="linenos"> 235</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-236"><a href="#MCPErrorHandler-236"><span class="linenos"> 236</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-237"><a href="#MCPErrorHandler-237"><span class="linenos"> 237</span></a>
</span><span id="MCPErrorHandler-238"><a href="#MCPErrorHandler-238"><span class="linenos"> 238</span></a>        <span class="k">if</span> <span class="n">request_id</span><span class="p">:</span>
</span><span id="MCPErrorHandler-239"><a href="#MCPErrorHandler-239"><span class="linenos"> 239</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="MCPErrorHandler-240"><a href="#MCPErrorHandler-240"><span class="linenos"> 240</span></a>
</span><span id="MCPErrorHandler-241"><a href="#MCPErrorHandler-241"><span class="linenos"> 241</span></a>        <span class="c1"># Log error to stderr for debugging</span>
</span><span id="MCPErrorHandler-242"><a href="#MCPErrorHandler-242"><span class="linenos"> 242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">request_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler-243"><a href="#MCPErrorHandler-243"><span class="linenos"> 243</span></a>
</span><span id="MCPErrorHandler-244"><a href="#MCPErrorHandler-244"><span class="linenos"> 244</span></a>        <span class="c1"># Record error with aggregator for Phase 3 analytics</span>
</span><span id="MCPErrorHandler-245"><a href="#MCPErrorHandler-245"><span class="linenos"> 245</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-246"><a href="#MCPErrorHandler-246"><span class="linenos"> 246</span></a>            <span class="n">error_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MCPErrorHandler-247"><a href="#MCPErrorHandler-247"><span class="linenos"> 247</span></a>            <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-248"><a href="#MCPErrorHandler-248"><span class="linenos"> 248</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="MCPErrorHandler-249"><a href="#MCPErrorHandler-249"><span class="linenos"> 249</span></a>                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
</span><span id="MCPErrorHandler-250"><a href="#MCPErrorHandler-250"><span class="linenos"> 250</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-251"><a href="#MCPErrorHandler-251"><span class="linenos"> 251</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-252"><a href="#MCPErrorHandler-252"><span class="linenos"> 252</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-253"><a href="#MCPErrorHandler-253"><span class="linenos"> 253</span></a>                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;error_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-254"><a href="#MCPErrorHandler-254"><span class="linenos"> 254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">record_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="MCPErrorHandler-255"><a href="#MCPErrorHandler-255"><span class="linenos"> 255</span></a>
</span><span id="MCPErrorHandler-256"><a href="#MCPErrorHandler-256"><span class="linenos"> 256</span></a>        <span class="k">return</span> <span class="n">error_response</span>
</span><span id="MCPErrorHandler-257"><a href="#MCPErrorHandler-257"><span class="linenos"> 257</span></a>
</span><span id="MCPErrorHandler-258"><a href="#MCPErrorHandler-258"><span class="linenos"> 258</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_error_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MCPErrorHandler-259"><a href="#MCPErrorHandler-259"><span class="linenos"> 259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a human-readable error type from error code.</span>
</span><span id="MCPErrorHandler-260"><a href="#MCPErrorHandler-260"><span class="linenos"> 260</span></a>
</span><span id="MCPErrorHandler-261"><a href="#MCPErrorHandler-261"><span class="linenos"> 261</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-262"><a href="#MCPErrorHandler-262"><span class="linenos"> 262</span></a><span class="sd">            code: JSON-RPC error code</span>
</span><span id="MCPErrorHandler-263"><a href="#MCPErrorHandler-263"><span class="linenos"> 263</span></a>
</span><span id="MCPErrorHandler-264"><a href="#MCPErrorHandler-264"><span class="linenos"> 264</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-265"><a href="#MCPErrorHandler-265"><span class="linenos"> 265</span></a><span class="sd">            String representation of error type.</span>
</span><span id="MCPErrorHandler-266"><a href="#MCPErrorHandler-266"><span class="linenos"> 266</span></a>
</span><span id="MCPErrorHandler-267"><a href="#MCPErrorHandler-267"><span class="linenos"> 267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-268"><a href="#MCPErrorHandler-268"><span class="linenos"> 268</span></a>        <span class="n">error_type_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-269"><a href="#MCPErrorHandler-269"><span class="linenos"> 269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">:</span> <span class="s2">&quot;parse_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-270"><a href="#MCPErrorHandler-270"><span class="linenos"> 270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">:</span> <span class="s2">&quot;invalid_request&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-271"><a href="#MCPErrorHandler-271"><span class="linenos"> 271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">:</span> <span class="s2">&quot;method_not_found&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-272"><a href="#MCPErrorHandler-272"><span class="linenos"> 272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">:</span> <span class="s2">&quot;invalid_params&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-273"><a href="#MCPErrorHandler-273"><span class="linenos"> 273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">:</span> <span class="s2">&quot;internal_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-274"><a href="#MCPErrorHandler-274"><span class="linenos"> 274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">:</span> <span class="s2">&quot;resource_not_found&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-275"><a href="#MCPErrorHandler-275"><span class="linenos"> 275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">:</span> <span class="s2">&quot;resource_access_denied&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-276"><a href="#MCPErrorHandler-276"><span class="linenos"> 276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">:</span> <span class="s2">&quot;resource_unavailable&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-277"><a href="#MCPErrorHandler-277"><span class="linenos"> 277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TOOL_UNAVAILABLE</span><span class="p">:</span> <span class="s2">&quot;tool_unavailable&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-278"><a href="#MCPErrorHandler-278"><span class="linenos"> 278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">:</span> <span class="s2">&quot;timeout_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-279"><a href="#MCPErrorHandler-279"><span class="linenos"> 279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">:</span> <span class="s2">&quot;validation_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-280"><a href="#MCPErrorHandler-280"><span class="linenos"> 280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">:</span> <span class="s2">&quot;external_service_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-281"><a href="#MCPErrorHandler-281"><span class="linenos"> 281</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">:</span> <span class="s2">&quot;rate_limit_error&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-282"><a href="#MCPErrorHandler-282"><span class="linenos"> 282</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler-283"><a href="#MCPErrorHandler-283"><span class="linenos"> 283</span></a>
</span><span id="MCPErrorHandler-284"><a href="#MCPErrorHandler-284"><span class="linenos"> 284</span></a>        <span class="k">return</span> <span class="n">error_type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;unknown_error&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-285"><a href="#MCPErrorHandler-285"><span class="linenos"> 285</span></a>
</span><span id="MCPErrorHandler-286"><a href="#MCPErrorHandler-286"><span class="linenos"> 286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_parse_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-287"><a href="#MCPErrorHandler-287"><span class="linenos"> 287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Parse error&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-288"><a href="#MCPErrorHandler-288"><span class="linenos"> 288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-289"><a href="#MCPErrorHandler-289"><span class="linenos"> 289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a parse error response.</span>
</span><span id="MCPErrorHandler-290"><a href="#MCPErrorHandler-290"><span class="linenos"> 290</span></a>
</span><span id="MCPErrorHandler-291"><a href="#MCPErrorHandler-291"><span class="linenos"> 291</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-292"><a href="#MCPErrorHandler-292"><span class="linenos"> 292</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-293"><a href="#MCPErrorHandler-293"><span class="linenos"> 293</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-294"><a href="#MCPErrorHandler-294"><span class="linenos"> 294</span></a>
</span><span id="MCPErrorHandler-295"><a href="#MCPErrorHandler-295"><span class="linenos"> 295</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-296"><a href="#MCPErrorHandler-296"><span class="linenos"> 296</span></a><span class="sd">            Parse error response.</span>
</span><span id="MCPErrorHandler-297"><a href="#MCPErrorHandler-297"><span class="linenos"> 297</span></a>
</span><span id="MCPErrorHandler-298"><a href="#MCPErrorHandler-298"><span class="linenos"> 298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-299"><a href="#MCPErrorHandler-299"><span class="linenos"> 299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-300"><a href="#MCPErrorHandler-300"><span class="linenos"> 300</span></a>
</span><span id="MCPErrorHandler-301"><a href="#MCPErrorHandler-301"><span class="linenos"> 301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_request_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-302"><a href="#MCPErrorHandler-302"><span class="linenos"> 302</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid request&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-303"><a href="#MCPErrorHandler-303"><span class="linenos"> 303</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-304"><a href="#MCPErrorHandler-304"><span class="linenos"> 304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid request error response.</span>
</span><span id="MCPErrorHandler-305"><a href="#MCPErrorHandler-305"><span class="linenos"> 305</span></a>
</span><span id="MCPErrorHandler-306"><a href="#MCPErrorHandler-306"><span class="linenos"> 306</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-307"><a href="#MCPErrorHandler-307"><span class="linenos"> 307</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-308"><a href="#MCPErrorHandler-308"><span class="linenos"> 308</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-309"><a href="#MCPErrorHandler-309"><span class="linenos"> 309</span></a>
</span><span id="MCPErrorHandler-310"><a href="#MCPErrorHandler-310"><span class="linenos"> 310</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-311"><a href="#MCPErrorHandler-311"><span class="linenos"> 311</span></a><span class="sd">            Invalid request error response.</span>
</span><span id="MCPErrorHandler-312"><a href="#MCPErrorHandler-312"><span class="linenos"> 312</span></a>
</span><span id="MCPErrorHandler-313"><a href="#MCPErrorHandler-313"><span class="linenos"> 313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-314"><a href="#MCPErrorHandler-314"><span class="linenos"> 314</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-315"><a href="#MCPErrorHandler-315"><span class="linenos"> 315</span></a>
</span><span id="MCPErrorHandler-316"><a href="#MCPErrorHandler-316"><span class="linenos"> 316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_method_not_found_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-317"><a href="#MCPErrorHandler-317"><span class="linenos"> 317</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-318"><a href="#MCPErrorHandler-318"><span class="linenos"> 318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-319"><a href="#MCPErrorHandler-319"><span class="linenos"> 319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a method not found error response.</span>
</span><span id="MCPErrorHandler-320"><a href="#MCPErrorHandler-320"><span class="linenos"> 320</span></a>
</span><span id="MCPErrorHandler-321"><a href="#MCPErrorHandler-321"><span class="linenos"> 321</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-322"><a href="#MCPErrorHandler-322"><span class="linenos"> 322</span></a><span class="sd">            method: Method name that was not found</span>
</span><span id="MCPErrorHandler-323"><a href="#MCPErrorHandler-323"><span class="linenos"> 323</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-324"><a href="#MCPErrorHandler-324"><span class="linenos"> 324</span></a>
</span><span id="MCPErrorHandler-325"><a href="#MCPErrorHandler-325"><span class="linenos"> 325</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-326"><a href="#MCPErrorHandler-326"><span class="linenos"> 326</span></a><span class="sd">            Method not found error response.</span>
</span><span id="MCPErrorHandler-327"><a href="#MCPErrorHandler-327"><span class="linenos"> 327</span></a>
</span><span id="MCPErrorHandler-328"><a href="#MCPErrorHandler-328"><span class="linenos"> 328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-329"><a href="#MCPErrorHandler-329"><span class="linenos"> 329</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="MCPErrorHandler-330"><a href="#MCPErrorHandler-330"><span class="linenos"> 330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-331"><a href="#MCPErrorHandler-331"><span class="linenos"> 331</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">}</span>
</span><span id="MCPErrorHandler-332"><a href="#MCPErrorHandler-332"><span class="linenos"> 332</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-333"><a href="#MCPErrorHandler-333"><span class="linenos"> 333</span></a>
</span><span id="MCPErrorHandler-334"><a href="#MCPErrorHandler-334"><span class="linenos"> 334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_params_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-335"><a href="#MCPErrorHandler-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-336"><a href="#MCPErrorHandler-336"><span class="linenos"> 336</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-337"><a href="#MCPErrorHandler-337"><span class="linenos"> 337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid parameters error response.</span>
</span><span id="MCPErrorHandler-338"><a href="#MCPErrorHandler-338"><span class="linenos"> 338</span></a>
</span><span id="MCPErrorHandler-339"><a href="#MCPErrorHandler-339"><span class="linenos"> 339</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-340"><a href="#MCPErrorHandler-340"><span class="linenos"> 340</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-341"><a href="#MCPErrorHandler-341"><span class="linenos"> 341</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-342"><a href="#MCPErrorHandler-342"><span class="linenos"> 342</span></a>
</span><span id="MCPErrorHandler-343"><a href="#MCPErrorHandler-343"><span class="linenos"> 343</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-344"><a href="#MCPErrorHandler-344"><span class="linenos"> 344</span></a><span class="sd">            Invalid parameters error response.</span>
</span><span id="MCPErrorHandler-345"><a href="#MCPErrorHandler-345"><span class="linenos"> 345</span></a>
</span><span id="MCPErrorHandler-346"><a href="#MCPErrorHandler-346"><span class="linenos"> 346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-347"><a href="#MCPErrorHandler-347"><span class="linenos"> 347</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-348"><a href="#MCPErrorHandler-348"><span class="linenos"> 348</span></a>
</span><span id="MCPErrorHandler-349"><a href="#MCPErrorHandler-349"><span class="linenos"> 349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_internal_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-350"><a href="#MCPErrorHandler-350"><span class="linenos"> 350</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-351"><a href="#MCPErrorHandler-351"><span class="linenos"> 351</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-352"><a href="#MCPErrorHandler-352"><span class="linenos"> 352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an internal error response.</span>
</span><span id="MCPErrorHandler-353"><a href="#MCPErrorHandler-353"><span class="linenos"> 353</span></a>
</span><span id="MCPErrorHandler-354"><a href="#MCPErrorHandler-354"><span class="linenos"> 354</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-355"><a href="#MCPErrorHandler-355"><span class="linenos"> 355</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-356"><a href="#MCPErrorHandler-356"><span class="linenos"> 356</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-357"><a href="#MCPErrorHandler-357"><span class="linenos"> 357</span></a>
</span><span id="MCPErrorHandler-358"><a href="#MCPErrorHandler-358"><span class="linenos"> 358</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-359"><a href="#MCPErrorHandler-359"><span class="linenos"> 359</span></a><span class="sd">            Internal error response.</span>
</span><span id="MCPErrorHandler-360"><a href="#MCPErrorHandler-360"><span class="linenos"> 360</span></a>
</span><span id="MCPErrorHandler-361"><a href="#MCPErrorHandler-361"><span class="linenos"> 361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-362"><a href="#MCPErrorHandler-362"><span class="linenos"> 362</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-363"><a href="#MCPErrorHandler-363"><span class="linenos"> 363</span></a>
</span><span id="MCPErrorHandler-364"><a href="#MCPErrorHandler-364"><span class="linenos"> 364</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-365"><a href="#MCPErrorHandler-365"><span class="linenos"> 365</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-366"><a href="#MCPErrorHandler-366"><span class="linenos"> 366</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-367"><a href="#MCPErrorHandler-367"><span class="linenos"> 367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response.</span>
</span><span id="MCPErrorHandler-368"><a href="#MCPErrorHandler-368"><span class="linenos"> 368</span></a>
</span><span id="MCPErrorHandler-369"><a href="#MCPErrorHandler-369"><span class="linenos"> 369</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-370"><a href="#MCPErrorHandler-370"><span class="linenos"> 370</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="MCPErrorHandler-371"><a href="#MCPErrorHandler-371"><span class="linenos"> 371</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="MCPErrorHandler-372"><a href="#MCPErrorHandler-372"><span class="linenos"> 372</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-373"><a href="#MCPErrorHandler-373"><span class="linenos"> 373</span></a>
</span><span id="MCPErrorHandler-374"><a href="#MCPErrorHandler-374"><span class="linenos"> 374</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-375"><a href="#MCPErrorHandler-375"><span class="linenos"> 375</span></a><span class="sd">            Validation error response.</span>
</span><span id="MCPErrorHandler-376"><a href="#MCPErrorHandler-376"><span class="linenos"> 376</span></a>
</span><span id="MCPErrorHandler-377"><a href="#MCPErrorHandler-377"><span class="linenos"> 377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-378"><a href="#MCPErrorHandler-378"><span class="linenos"> 378</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid parameters for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="MCPErrorHandler-379"><a href="#MCPErrorHandler-379"><span class="linenos"> 379</span></a>
</span><span id="MCPErrorHandler-380"><a href="#MCPErrorHandler-380"><span class="linenos"> 380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-381"><a href="#MCPErrorHandler-381"><span class="linenos"> 381</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-382"><a href="#MCPErrorHandler-382"><span class="linenos"> 382</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-383"><a href="#MCPErrorHandler-383"><span class="linenos"> 383</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-384"><a href="#MCPErrorHandler-384"><span class="linenos"> 384</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please check the tool schema and provide valid parameters&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-385"><a href="#MCPErrorHandler-385"><span class="linenos"> 385</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-386"><a href="#MCPErrorHandler-386"><span class="linenos"> 386</span></a>
</span><span id="MCPErrorHandler-387"><a href="#MCPErrorHandler-387"><span class="linenos"> 387</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-388"><a href="#MCPErrorHandler-388"><span class="linenos"> 388</span></a>
</span><span id="MCPErrorHandler-389"><a href="#MCPErrorHandler-389"><span class="linenos"> 389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-390"><a href="#MCPErrorHandler-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-391"><a href="#MCPErrorHandler-391"><span class="linenos"> 391</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-392"><a href="#MCPErrorHandler-392"><span class="linenos"> 392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response.</span>
</span><span id="MCPErrorHandler-393"><a href="#MCPErrorHandler-393"><span class="linenos"> 393</span></a>
</span><span id="MCPErrorHandler-394"><a href="#MCPErrorHandler-394"><span class="linenos"> 394</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-395"><a href="#MCPErrorHandler-395"><span class="linenos"> 395</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="MCPErrorHandler-396"><a href="#MCPErrorHandler-396"><span class="linenos"> 396</span></a><span class="sd">            timeout_seconds: Timeout value in seconds</span>
</span><span id="MCPErrorHandler-397"><a href="#MCPErrorHandler-397"><span class="linenos"> 397</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-398"><a href="#MCPErrorHandler-398"><span class="linenos"> 398</span></a>
</span><span id="MCPErrorHandler-399"><a href="#MCPErrorHandler-399"><span class="linenos"> 399</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-400"><a href="#MCPErrorHandler-400"><span class="linenos"> 400</span></a><span class="sd">            Timeout error response.</span>
</span><span id="MCPErrorHandler-401"><a href="#MCPErrorHandler-401"><span class="linenos"> 401</span></a>
</span><span id="MCPErrorHandler-402"><a href="#MCPErrorHandler-402"><span class="linenos"> 402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-403"><a href="#MCPErrorHandler-403"><span class="linenos"> 403</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; execution timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
</span><span id="MCPErrorHandler-404"><a href="#MCPErrorHandler-404"><span class="linenos"> 404</span></a>
</span><span id="MCPErrorHandler-405"><a href="#MCPErrorHandler-405"><span class="linenos"> 405</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-406"><a href="#MCPErrorHandler-406"><span class="linenos"> 406</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-407"><a href="#MCPErrorHandler-407"><span class="linenos"> 407</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-408"><a href="#MCPErrorHandler-408"><span class="linenos"> 408</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="MCPErrorHandler-409"><a href="#MCPErrorHandler-409"><span class="linenos"> 409</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try reducing the scope of your request or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-410"><a href="#MCPErrorHandler-410"><span class="linenos"> 410</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-411"><a href="#MCPErrorHandler-411"><span class="linenos"> 411</span></a>
</span><span id="MCPErrorHandler-412"><a href="#MCPErrorHandler-412"><span class="linenos"> 412</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-413"><a href="#MCPErrorHandler-413"><span class="linenos"> 413</span></a>
</span><span id="MCPErrorHandler-414"><a href="#MCPErrorHandler-414"><span class="linenos"> 414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-415"><a href="#MCPErrorHandler-415"><span class="linenos"> 415</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-416"><a href="#MCPErrorHandler-416"><span class="linenos"> 416</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-417"><a href="#MCPErrorHandler-417"><span class="linenos"> 417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource-related error response.</span>
</span><span id="MCPErrorHandler-418"><a href="#MCPErrorHandler-418"><span class="linenos"> 418</span></a>
</span><span id="MCPErrorHandler-419"><a href="#MCPErrorHandler-419"><span class="linenos"> 419</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-420"><a href="#MCPErrorHandler-420"><span class="linenos"> 420</span></a><span class="sd">            resource_uri: URI of the resource that caused the error</span>
</span><span id="MCPErrorHandler-421"><a href="#MCPErrorHandler-421"><span class="linenos"> 421</span></a><span class="sd">            error_type: Type of resource error</span>
</span><span id="MCPErrorHandler-422"><a href="#MCPErrorHandler-422"><span class="linenos"> 422</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-423"><a href="#MCPErrorHandler-423"><span class="linenos"> 423</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-424"><a href="#MCPErrorHandler-424"><span class="linenos"> 424</span></a>
</span><span id="MCPErrorHandler-425"><a href="#MCPErrorHandler-425"><span class="linenos"> 425</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-426"><a href="#MCPErrorHandler-426"><span class="linenos"> 426</span></a><span class="sd">            Resource error response.</span>
</span><span id="MCPErrorHandler-427"><a href="#MCPErrorHandler-427"><span class="linenos"> 427</span></a>
</span><span id="MCPErrorHandler-428"><a href="#MCPErrorHandler-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-429"><a href="#MCPErrorHandler-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;not_found&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler-430"><a href="#MCPErrorHandler-430"><span class="linenos"> 430</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span>
</span><span id="MCPErrorHandler-431"><a href="#MCPErrorHandler-431"><span class="linenos"> 431</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;access_denied&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler-432"><a href="#MCPErrorHandler-432"><span class="linenos"> 432</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span>
</span><span id="MCPErrorHandler-433"><a href="#MCPErrorHandler-433"><span class="linenos"> 433</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;unavailable&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler-434"><a href="#MCPErrorHandler-434"><span class="linenos"> 434</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span>
</span><span id="MCPErrorHandler-435"><a href="#MCPErrorHandler-435"><span class="linenos"> 435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler-436"><a href="#MCPErrorHandler-436"><span class="linenos"> 436</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span>
</span><span id="MCPErrorHandler-437"><a href="#MCPErrorHandler-437"><span class="linenos"> 437</span></a>
</span><span id="MCPErrorHandler-438"><a href="#MCPErrorHandler-438"><span class="linenos"> 438</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-439"><a href="#MCPErrorHandler-439"><span class="linenos"> 439</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-440"><a href="#MCPErrorHandler-440"><span class="linenos"> 440</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler-441"><a href="#MCPErrorHandler-441"><span class="linenos"> 441</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="MCPErrorHandler-442"><a href="#MCPErrorHandler-442"><span class="linenos"> 442</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and your permissions&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-443"><a href="#MCPErrorHandler-443"><span class="linenos"> 443</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-444"><a href="#MCPErrorHandler-444"><span class="linenos"> 444</span></a>
</span><span id="MCPErrorHandler-445"><a href="#MCPErrorHandler-445"><span class="linenos"> 445</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-446"><a href="#MCPErrorHandler-446"><span class="linenos"> 446</span></a>
</span><span id="MCPErrorHandler-447"><a href="#MCPErrorHandler-447"><span class="linenos"> 447</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_external_service_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-448"><a href="#MCPErrorHandler-448"><span class="linenos"> 448</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-449"><a href="#MCPErrorHandler-449"><span class="linenos"> 449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-450"><a href="#MCPErrorHandler-450"><span class="linenos"> 450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an external service error response.</span>
</span><span id="MCPErrorHandler-451"><a href="#MCPErrorHandler-451"><span class="linenos"> 451</span></a>
</span><span id="MCPErrorHandler-452"><a href="#MCPErrorHandler-452"><span class="linenos"> 452</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-453"><a href="#MCPErrorHandler-453"><span class="linenos"> 453</span></a><span class="sd">            service_name: Name of the external service</span>
</span><span id="MCPErrorHandler-454"><a href="#MCPErrorHandler-454"><span class="linenos"> 454</span></a><span class="sd">            error_message: Error message from the service</span>
</span><span id="MCPErrorHandler-455"><a href="#MCPErrorHandler-455"><span class="linenos"> 455</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-456"><a href="#MCPErrorHandler-456"><span class="linenos"> 456</span></a>
</span><span id="MCPErrorHandler-457"><a href="#MCPErrorHandler-457"><span class="linenos"> 457</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-458"><a href="#MCPErrorHandler-458"><span class="linenos"> 458</span></a><span class="sd">            External service error response.</span>
</span><span id="MCPErrorHandler-459"><a href="#MCPErrorHandler-459"><span class="linenos"> 459</span></a>
</span><span id="MCPErrorHandler-460"><a href="#MCPErrorHandler-460"><span class="linenos"> 460</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-461"><a href="#MCPErrorHandler-461"><span class="linenos"> 461</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;External service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MCPErrorHandler-462"><a href="#MCPErrorHandler-462"><span class="linenos"> 462</span></a>
</span><span id="MCPErrorHandler-463"><a href="#MCPErrorHandler-463"><span class="linenos"> 463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-464"><a href="#MCPErrorHandler-464"><span class="linenos"> 464</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-465"><a href="#MCPErrorHandler-465"><span class="linenos"> 465</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-466"><a href="#MCPErrorHandler-466"><span class="linenos"> 466</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The service may be temporarily unavailable. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-467"><a href="#MCPErrorHandler-467"><span class="linenos"> 467</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-468"><a href="#MCPErrorHandler-468"><span class="linenos"> 468</span></a>
</span><span id="MCPErrorHandler-469"><a href="#MCPErrorHandler-469"><span class="linenos"> 469</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-470"><a href="#MCPErrorHandler-470"><span class="linenos"> 470</span></a>
</span><span id="MCPErrorHandler-471"><a href="#MCPErrorHandler-471"><span class="linenos"> 471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_rate_limit_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-472"><a href="#MCPErrorHandler-472"><span class="linenos"> 472</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-473"><a href="#MCPErrorHandler-473"><span class="linenos"> 473</span></a>        <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-474"><a href="#MCPErrorHandler-474"><span class="linenos"> 474</span></a>        <span class="n">retry_after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-475"><a href="#MCPErrorHandler-475"><span class="linenos"> 475</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-476"><a href="#MCPErrorHandler-476"><span class="linenos"> 476</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-477"><a href="#MCPErrorHandler-477"><span class="linenos"> 477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a rate limit error response.</span>
</span><span id="MCPErrorHandler-478"><a href="#MCPErrorHandler-478"><span class="linenos"> 478</span></a>
</span><span id="MCPErrorHandler-479"><a href="#MCPErrorHandler-479"><span class="linenos"> 479</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-480"><a href="#MCPErrorHandler-480"><span class="linenos"> 480</span></a><span class="sd">            service_name: Name of the service that rate limited the request</span>
</span><span id="MCPErrorHandler-481"><a href="#MCPErrorHandler-481"><span class="linenos"> 481</span></a><span class="sd">            retry_after: Suggested retry delay in seconds</span>
</span><span id="MCPErrorHandler-482"><a href="#MCPErrorHandler-482"><span class="linenos"> 482</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-483"><a href="#MCPErrorHandler-483"><span class="linenos"> 483</span></a>
</span><span id="MCPErrorHandler-484"><a href="#MCPErrorHandler-484"><span class="linenos"> 484</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-485"><a href="#MCPErrorHandler-485"><span class="linenos"> 485</span></a><span class="sd">            Rate limit error response.</span>
</span><span id="MCPErrorHandler-486"><a href="#MCPErrorHandler-486"><span class="linenos"> 486</span></a>
</span><span id="MCPErrorHandler-487"><a href="#MCPErrorHandler-487"><span class="linenos"> 487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-488"><a href="#MCPErrorHandler-488"><span class="linenos"> 488</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="MCPErrorHandler-489"><a href="#MCPErrorHandler-489"><span class="linenos"> 489</span></a>
</span><span id="MCPErrorHandler-490"><a href="#MCPErrorHandler-490"><span class="linenos"> 490</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-491"><a href="#MCPErrorHandler-491"><span class="linenos"> 491</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-492"><a href="#MCPErrorHandler-492"><span class="linenos"> 492</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-493"><a href="#MCPErrorHandler-493"><span class="linenos"> 493</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please wait before making additional requests&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-494"><a href="#MCPErrorHandler-494"><span class="linenos"> 494</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-495"><a href="#MCPErrorHandler-495"><span class="linenos"> 495</span></a>
</span><span id="MCPErrorHandler-496"><a href="#MCPErrorHandler-496"><span class="linenos"> 496</span></a>            <span class="k">if</span> <span class="n">retry_after</span><span class="p">:</span>
</span><span id="MCPErrorHandler-497"><a href="#MCPErrorHandler-497"><span class="linenos"> 497</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;retry_after_seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retry_after</span>
</span><span id="MCPErrorHandler-498"><a href="#MCPErrorHandler-498"><span class="linenos"> 498</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;suggestion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Please wait </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds before retrying&quot;</span>
</span><span id="MCPErrorHandler-499"><a href="#MCPErrorHandler-499"><span class="linenos"> 499</span></a>
</span><span id="MCPErrorHandler-500"><a href="#MCPErrorHandler-500"><span class="linenos"> 500</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-501"><a href="#MCPErrorHandler-501"><span class="linenos"> 501</span></a>
</span><span id="MCPErrorHandler-502"><a href="#MCPErrorHandler-502"><span class="linenos"> 502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_security_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-503"><a href="#MCPErrorHandler-503"><span class="linenos"> 503</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-504"><a href="#MCPErrorHandler-504"><span class="linenos"> 504</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-505"><a href="#MCPErrorHandler-505"><span class="linenos"> 505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a security error response.</span>
</span><span id="MCPErrorHandler-506"><a href="#MCPErrorHandler-506"><span class="linenos"> 506</span></a>
</span><span id="MCPErrorHandler-507"><a href="#MCPErrorHandler-507"><span class="linenos"> 507</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-508"><a href="#MCPErrorHandler-508"><span class="linenos"> 508</span></a><span class="sd">            message: Security error message</span>
</span><span id="MCPErrorHandler-509"><a href="#MCPErrorHandler-509"><span class="linenos"> 509</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-510"><a href="#MCPErrorHandler-510"><span class="linenos"> 510</span></a>
</span><span id="MCPErrorHandler-511"><a href="#MCPErrorHandler-511"><span class="linenos"> 511</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-512"><a href="#MCPErrorHandler-512"><span class="linenos"> 512</span></a><span class="sd">            Security error response.</span>
</span><span id="MCPErrorHandler-513"><a href="#MCPErrorHandler-513"><span class="linenos"> 513</span></a>
</span><span id="MCPErrorHandler-514"><a href="#MCPErrorHandler-514"><span class="linenos"> 514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-515"><a href="#MCPErrorHandler-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-516"><a href="#MCPErrorHandler-516"><span class="linenos"> 516</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-517"><a href="#MCPErrorHandler-517"><span class="linenos"> 517</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;security_violation&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-518"><a href="#MCPErrorHandler-518"><span class="linenos"> 518</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-519"><a href="#MCPErrorHandler-519"><span class="linenos"> 519</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-520"><a href="#MCPErrorHandler-520"><span class="linenos"> 520</span></a>
</span><span id="MCPErrorHandler-521"><a href="#MCPErrorHandler-521"><span class="linenos"> 521</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SECURITY_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-522"><a href="#MCPErrorHandler-522"><span class="linenos"> 522</span></a>
</span><span id="MCPErrorHandler-523"><a href="#MCPErrorHandler-523"><span class="linenos"> 523</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_schema_validation_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-524"><a href="#MCPErrorHandler-524"><span class="linenos"> 524</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-525"><a href="#MCPErrorHandler-525"><span class="linenos"> 525</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-526"><a href="#MCPErrorHandler-526"><span class="linenos"> 526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a schema validation error response.</span>
</span><span id="MCPErrorHandler-527"><a href="#MCPErrorHandler-527"><span class="linenos"> 527</span></a>
</span><span id="MCPErrorHandler-528"><a href="#MCPErrorHandler-528"><span class="linenos"> 528</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-529"><a href="#MCPErrorHandler-529"><span class="linenos"> 529</span></a><span class="sd">            message: Schema validation error message</span>
</span><span id="MCPErrorHandler-530"><a href="#MCPErrorHandler-530"><span class="linenos"> 530</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-531"><a href="#MCPErrorHandler-531"><span class="linenos"> 531</span></a>
</span><span id="MCPErrorHandler-532"><a href="#MCPErrorHandler-532"><span class="linenos"> 532</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-533"><a href="#MCPErrorHandler-533"><span class="linenos"> 533</span></a><span class="sd">            Schema validation error response.</span>
</span><span id="MCPErrorHandler-534"><a href="#MCPErrorHandler-534"><span class="linenos"> 534</span></a>
</span><span id="MCPErrorHandler-535"><a href="#MCPErrorHandler-535"><span class="linenos"> 535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-536"><a href="#MCPErrorHandler-536"><span class="linenos"> 536</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-537"><a href="#MCPErrorHandler-537"><span class="linenos"> 537</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-538"><a href="#MCPErrorHandler-538"><span class="linenos"> 538</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;schema_validation_failed&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-539"><a href="#MCPErrorHandler-539"><span class="linenos"> 539</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-540"><a href="#MCPErrorHandler-540"><span class="linenos"> 540</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-541"><a href="#MCPErrorHandler-541"><span class="linenos"> 541</span></a>
</span><span id="MCPErrorHandler-542"><a href="#MCPErrorHandler-542"><span class="linenos"> 542</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEMA_VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-543"><a href="#MCPErrorHandler-543"><span class="linenos"> 543</span></a>
</span><span id="MCPErrorHandler-544"><a href="#MCPErrorHandler-544"><span class="linenos"> 544</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_message_security</span><span class="p">(</span>
</span><span id="MCPErrorHandler-545"><a href="#MCPErrorHandler-545"><span class="linenos"> 545</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_key_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-546"><a href="#MCPErrorHandler-546"><span class="linenos"> 546</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-547"><a href="#MCPErrorHandler-547"><span class="linenos"> 547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate message security including schema validation and rate limiting.</span>
</span><span id="MCPErrorHandler-548"><a href="#MCPErrorHandler-548"><span class="linenos"> 548</span></a>
</span><span id="MCPErrorHandler-549"><a href="#MCPErrorHandler-549"><span class="linenos"> 549</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-550"><a href="#MCPErrorHandler-550"><span class="linenos"> 550</span></a><span class="sd">            message: Raw JSON message string</span>
</span><span id="MCPErrorHandler-551"><a href="#MCPErrorHandler-551"><span class="linenos"> 551</span></a><span class="sd">            connection_id: Connection ID for rate limiting</span>
</span><span id="MCPErrorHandler-552"><a href="#MCPErrorHandler-552"><span class="linenos"> 552</span></a><span class="sd">            api_key_id: API key ID for rate limiting</span>
</span><span id="MCPErrorHandler-553"><a href="#MCPErrorHandler-553"><span class="linenos"> 553</span></a>
</span><span id="MCPErrorHandler-554"><a href="#MCPErrorHandler-554"><span class="linenos"> 554</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-555"><a href="#MCPErrorHandler-555"><span class="linenos"> 555</span></a><span class="sd">            Error response if validation fails, None if valid</span>
</span><span id="MCPErrorHandler-556"><a href="#MCPErrorHandler-556"><span class="linenos"> 556</span></a>
</span><span id="MCPErrorHandler-557"><a href="#MCPErrorHandler-557"><span class="linenos"> 557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-558"><a href="#MCPErrorHandler-558"><span class="linenos"> 558</span></a>        <span class="c1"># Global rate limiting</span>
</span><span id="MCPErrorHandler-559"><a href="#MCPErrorHandler-559"><span class="linenos"> 559</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">():</span>
</span><span id="MCPErrorHandler-560"><a href="#MCPErrorHandler-560"><span class="linenos"> 560</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">()</span>
</span><span id="MCPErrorHandler-561"><a href="#MCPErrorHandler-561"><span class="linenos"> 561</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler-562"><a href="#MCPErrorHandler-562"><span class="linenos"> 562</span></a>
</span><span id="MCPErrorHandler-563"><a href="#MCPErrorHandler-563"><span class="linenos"> 563</span></a>        <span class="c1"># Connection rate limiting</span>
</span><span id="MCPErrorHandler-564"><a href="#MCPErrorHandler-564"><span class="linenos"> 564</span></a>        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">connection_id</span><span class="p">):</span>
</span><span id="MCPErrorHandler-565"><a href="#MCPErrorHandler-565"><span class="linenos"> 565</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">connection_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler-566"><a href="#MCPErrorHandler-566"><span class="linenos"> 566</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;connection&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler-567"><a href="#MCPErrorHandler-567"><span class="linenos"> 567</span></a>
</span><span id="MCPErrorHandler-568"><a href="#MCPErrorHandler-568"><span class="linenos"> 568</span></a>        <span class="c1"># API key rate limiting</span>
</span><span id="MCPErrorHandler-569"><a href="#MCPErrorHandler-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="n">api_key_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">):</span>
</span><span id="MCPErrorHandler-570"><a href="#MCPErrorHandler-570"><span class="linenos"> 570</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler-571"><a href="#MCPErrorHandler-571"><span class="linenos"> 571</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler-572"><a href="#MCPErrorHandler-572"><span class="linenos"> 572</span></a>
</span><span id="MCPErrorHandler-573"><a href="#MCPErrorHandler-573"><span class="linenos"> 573</span></a>        <span class="c1"># Schema validation</span>
</span><span id="MCPErrorHandler-574"><a href="#MCPErrorHandler-574"><span class="linenos"> 574</span></a>        <span class="n">parsed_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span><span class="o">.</span><span class="n">validate_complete_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MCPErrorHandler-575"><a href="#MCPErrorHandler-575"><span class="linenos"> 575</span></a>        <span class="k">if</span> <span class="n">parsed_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-576"><a href="#MCPErrorHandler-576"><span class="linenos"> 576</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_schema_validation_error</span><span class="p">(</span><span class="s2">&quot;Invalid message format or content&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-577"><a href="#MCPErrorHandler-577"><span class="linenos"> 577</span></a>
</span><span id="MCPErrorHandler-578"><a href="#MCPErrorHandler-578"><span class="linenos"> 578</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-579"><a href="#MCPErrorHandler-579"><span class="linenos"> 579</span></a>
</span><span id="MCPErrorHandler-580"><a href="#MCPErrorHandler-580"><span class="linenos"> 580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">available_tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-581"><a href="#MCPErrorHandler-581"><span class="linenos"> 581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that a tool exists before execution.</span>
</span><span id="MCPErrorHandler-582"><a href="#MCPErrorHandler-582"><span class="linenos"> 582</span></a>
</span><span id="MCPErrorHandler-583"><a href="#MCPErrorHandler-583"><span class="linenos"> 583</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-584"><a href="#MCPErrorHandler-584"><span class="linenos"> 584</span></a><span class="sd">            tool_name: Name of the tool to validate</span>
</span><span id="MCPErrorHandler-585"><a href="#MCPErrorHandler-585"><span class="linenos"> 585</span></a><span class="sd">            available_tools: List of available tool names</span>
</span><span id="MCPErrorHandler-586"><a href="#MCPErrorHandler-586"><span class="linenos"> 586</span></a>
</span><span id="MCPErrorHandler-587"><a href="#MCPErrorHandler-587"><span class="linenos"> 587</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler-588"><a href="#MCPErrorHandler-588"><span class="linenos"> 588</span></a><span class="sd">            ValueError: If the tool does not exist.</span>
</span><span id="MCPErrorHandler-589"><a href="#MCPErrorHandler-589"><span class="linenos"> 589</span></a>
</span><span id="MCPErrorHandler-590"><a href="#MCPErrorHandler-590"><span class="linenos"> 590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-591"><a href="#MCPErrorHandler-591"><span class="linenos"> 591</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_tools</span><span class="p">:</span>
</span><span id="MCPErrorHandler-592"><a href="#MCPErrorHandler-592"><span class="linenos"> 592</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MCPErrorHandler-593"><a href="#MCPErrorHandler-593"><span class="linenos"> 593</span></a>                <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found. Available tools: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_tools</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MCPErrorHandler-594"><a href="#MCPErrorHandler-594"><span class="linenos"> 594</span></a>            <span class="p">)</span>
</span><span id="MCPErrorHandler-595"><a href="#MCPErrorHandler-595"><span class="linenos"> 595</span></a>
</span><span id="MCPErrorHandler-596"><a href="#MCPErrorHandler-596"><span class="linenos"> 596</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_arguments</span><span class="p">(</span>
</span><span id="MCPErrorHandler-597"><a href="#MCPErrorHandler-597"><span class="linenos"> 597</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="MCPErrorHandler-598"><a href="#MCPErrorHandler-598"><span class="linenos"> 598</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-599"><a href="#MCPErrorHandler-599"><span class="linenos"> 599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate arguments against a tool schema.</span>
</span><span id="MCPErrorHandler-600"><a href="#MCPErrorHandler-600"><span class="linenos"> 600</span></a>
</span><span id="MCPErrorHandler-601"><a href="#MCPErrorHandler-601"><span class="linenos"> 601</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-602"><a href="#MCPErrorHandler-602"><span class="linenos"> 602</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="MCPErrorHandler-603"><a href="#MCPErrorHandler-603"><span class="linenos"> 603</span></a><span class="sd">            arguments: Arguments to validate</span>
</span><span id="MCPErrorHandler-604"><a href="#MCPErrorHandler-604"><span class="linenos"> 604</span></a><span class="sd">            schema: Tool schema for validation</span>
</span><span id="MCPErrorHandler-605"><a href="#MCPErrorHandler-605"><span class="linenos"> 605</span></a>
</span><span id="MCPErrorHandler-606"><a href="#MCPErrorHandler-606"><span class="linenos"> 606</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler-607"><a href="#MCPErrorHandler-607"><span class="linenos"> 607</span></a><span class="sd">            ValidationError: If arguments are invalid.</span>
</span><span id="MCPErrorHandler-608"><a href="#MCPErrorHandler-608"><span class="linenos"> 608</span></a>
</span><span id="MCPErrorHandler-609"><a href="#MCPErrorHandler-609"><span class="linenos"> 609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-610"><a href="#MCPErrorHandler-610"><span class="linenos"> 610</span></a>        <span class="c1"># This is a placeholder for schema validation</span>
</span><span id="MCPErrorHandler-611"><a href="#MCPErrorHandler-611"><span class="linenos"> 611</span></a>        <span class="c1"># In a full implementation, you would use a JSON schema validator</span>
</span><span id="MCPErrorHandler-612"><a href="#MCPErrorHandler-612"><span class="linenos"> 612</span></a>        <span class="c1"># For now, we&#39;ll do basic validation</span>
</span><span id="MCPErrorHandler-613"><a href="#MCPErrorHandler-613"><span class="linenos"> 613</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MCPErrorHandler-614"><a href="#MCPErrorHandler-614"><span class="linenos"> 614</span></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments must be a dictionary, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-615"><a href="#MCPErrorHandler-615"><span class="linenos"> 615</span></a>
</span><span id="MCPErrorHandler-616"><a href="#MCPErrorHandler-616"><span class="linenos"> 616</span></a>        <span class="c1"># Log validation attempt</span>
</span><span id="MCPErrorHandler-617"><a href="#MCPErrorHandler-617"><span class="linenos"> 617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating arguments&quot;</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="MCPErrorHandler-618"><a href="#MCPErrorHandler-618"><span class="linenos"> 618</span></a>
</span><span id="MCPErrorHandler-619"><a href="#MCPErrorHandler-619"><span class="linenos"> 619</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_timeout</span><span class="p">(</span>
</span><span id="MCPErrorHandler-620"><a href="#MCPErrorHandler-620"><span class="linenos"> 620</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-621"><a href="#MCPErrorHandler-621"><span class="linenos"> 621</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-622"><a href="#MCPErrorHandler-622"><span class="linenos"> 622</span></a>        <span class="n">coro</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="MCPErrorHandler-623"><a href="#MCPErrorHandler-623"><span class="linenos"> 623</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-624"><a href="#MCPErrorHandler-624"><span class="linenos"> 624</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MCPErrorHandler-625"><a href="#MCPErrorHandler-625"><span class="linenos"> 625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with timeout protection.</span>
</span><span id="MCPErrorHandler-626"><a href="#MCPErrorHandler-626"><span class="linenos"> 626</span></a>
</span><span id="MCPErrorHandler-627"><a href="#MCPErrorHandler-627"><span class="linenos"> 627</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-628"><a href="#MCPErrorHandler-628"><span class="linenos"> 628</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="MCPErrorHandler-629"><a href="#MCPErrorHandler-629"><span class="linenos"> 629</span></a><span class="sd">            coro: Coroutine to execute</span>
</span><span id="MCPErrorHandler-630"><a href="#MCPErrorHandler-630"><span class="linenos"> 630</span></a><span class="sd">            timeout_seconds: Timeout in seconds (uses default if None)</span>
</span><span id="MCPErrorHandler-631"><a href="#MCPErrorHandler-631"><span class="linenos"> 631</span></a>
</span><span id="MCPErrorHandler-632"><a href="#MCPErrorHandler-632"><span class="linenos"> 632</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-633"><a href="#MCPErrorHandler-633"><span class="linenos"> 633</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="MCPErrorHandler-634"><a href="#MCPErrorHandler-634"><span class="linenos"> 634</span></a>
</span><span id="MCPErrorHandler-635"><a href="#MCPErrorHandler-635"><span class="linenos"> 635</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler-636"><a href="#MCPErrorHandler-636"><span class="linenos"> 636</span></a><span class="sd">            asyncio.TimeoutError: If the operation times out.</span>
</span><span id="MCPErrorHandler-637"><a href="#MCPErrorHandler-637"><span class="linenos"> 637</span></a>
</span><span id="MCPErrorHandler-638"><a href="#MCPErrorHandler-638"><span class="linenos"> 638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-639"><a href="#MCPErrorHandler-639"><span class="linenos"> 639</span></a>        <span class="k">if</span> <span class="n">timeout_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-640"><a href="#MCPErrorHandler-640"><span class="linenos"> 640</span></a>            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution&quot;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">)</span>
</span><span id="MCPErrorHandler-641"><a href="#MCPErrorHandler-641"><span class="linenos"> 641</span></a>
</span><span id="MCPErrorHandler-642"><a href="#MCPErrorHandler-642"><span class="linenos"> 642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="MCPErrorHandler-643"><a href="#MCPErrorHandler-643"><span class="linenos"> 643</span></a>            <span class="s2">&quot;Executing operation with timeout&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="MCPErrorHandler-644"><a href="#MCPErrorHandler-644"><span class="linenos"> 644</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-645"><a href="#MCPErrorHandler-645"><span class="linenos"> 645</span></a>
</span><span id="MCPErrorHandler-646"><a href="#MCPErrorHandler-646"><span class="linenos"> 646</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MCPErrorHandler-647"><a href="#MCPErrorHandler-647"><span class="linenos"> 647</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">)</span>
</span><span id="MCPErrorHandler-648"><a href="#MCPErrorHandler-648"><span class="linenos"> 648</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="MCPErrorHandler-649"><a href="#MCPErrorHandler-649"><span class="linenos"> 649</span></a>        <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
</span><span id="MCPErrorHandler-650"><a href="#MCPErrorHandler-650"><span class="linenos"> 650</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="MCPErrorHandler-651"><a href="#MCPErrorHandler-651"><span class="linenos"> 651</span></a>                <span class="s2">&quot;Operation timed out&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="MCPErrorHandler-652"><a href="#MCPErrorHandler-652"><span class="linenos"> 652</span></a>            <span class="p">)</span>
</span><span id="MCPErrorHandler-653"><a href="#MCPErrorHandler-653"><span class="linenos"> 653</span></a>            <span class="k">raise</span>
</span><span id="MCPErrorHandler-654"><a href="#MCPErrorHandler-654"><span class="linenos"> 654</span></a>
</span><span id="MCPErrorHandler-655"><a href="#MCPErrorHandler-655"><span class="linenos"> 655</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_retry</span><span class="p">(</span>
</span><span id="MCPErrorHandler-656"><a href="#MCPErrorHandler-656"><span class="linenos"> 656</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-657"><a href="#MCPErrorHandler-657"><span class="linenos"> 657</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-658"><a href="#MCPErrorHandler-658"><span class="linenos"> 658</span></a>        <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="MCPErrorHandler-659"><a href="#MCPErrorHandler-659"><span class="linenos"> 659</span></a>        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-660"><a href="#MCPErrorHandler-660"><span class="linenos"> 660</span></a>        <span class="n">base_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-661"><a href="#MCPErrorHandler-661"><span class="linenos"> 661</span></a>        <span class="n">max_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-662"><a href="#MCPErrorHandler-662"><span class="linenos"> 662</span></a>        <span class="n">exponential_base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-663"><a href="#MCPErrorHandler-663"><span class="linenos"> 663</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MCPErrorHandler-664"><a href="#MCPErrorHandler-664"><span class="linenos"> 664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with retry logic and exponential backoff.</span>
</span><span id="MCPErrorHandler-665"><a href="#MCPErrorHandler-665"><span class="linenos"> 665</span></a>
</span><span id="MCPErrorHandler-666"><a href="#MCPErrorHandler-666"><span class="linenos"> 666</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-667"><a href="#MCPErrorHandler-667"><span class="linenos"> 667</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="MCPErrorHandler-668"><a href="#MCPErrorHandler-668"><span class="linenos"> 668</span></a><span class="sd">            coro_factory: Coroutine factory function or callable that returns a coroutine</span>
</span><span id="MCPErrorHandler-669"><a href="#MCPErrorHandler-669"><span class="linenos"> 669</span></a><span class="sd">            max_retries: Maximum number of retries (uses config default if None)</span>
</span><span id="MCPErrorHandler-670"><a href="#MCPErrorHandler-670"><span class="linenos"> 670</span></a><span class="sd">            base_delay: Base delay between retries (uses config default if None)</span>
</span><span id="MCPErrorHandler-671"><a href="#MCPErrorHandler-671"><span class="linenos"> 671</span></a><span class="sd">            max_delay: Maximum delay between retries (uses config default if None)</span>
</span><span id="MCPErrorHandler-672"><a href="#MCPErrorHandler-672"><span class="linenos"> 672</span></a><span class="sd">            exponential_base: Exponential backoff multiplier (uses config default if None)</span>
</span><span id="MCPErrorHandler-673"><a href="#MCPErrorHandler-673"><span class="linenos"> 673</span></a>
</span><span id="MCPErrorHandler-674"><a href="#MCPErrorHandler-674"><span class="linenos"> 674</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-675"><a href="#MCPErrorHandler-675"><span class="linenos"> 675</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="MCPErrorHandler-676"><a href="#MCPErrorHandler-676"><span class="linenos"> 676</span></a>
</span><span id="MCPErrorHandler-677"><a href="#MCPErrorHandler-677"><span class="linenos"> 677</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler-678"><a href="#MCPErrorHandler-678"><span class="linenos"> 678</span></a><span class="sd">            Exception: If all retries are exhausted.</span>
</span><span id="MCPErrorHandler-679"><a href="#MCPErrorHandler-679"><span class="linenos"> 679</span></a>
</span><span id="MCPErrorHandler-680"><a href="#MCPErrorHandler-680"><span class="linenos"> 680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-681"><a href="#MCPErrorHandler-681"><span class="linenos"> 681</span></a>        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-682"><a href="#MCPErrorHandler-682"><span class="linenos"> 682</span></a>            <span class="n">max_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler-683"><a href="#MCPErrorHandler-683"><span class="linenos"> 683</span></a>        <span class="k">if</span> <span class="n">base_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-684"><a href="#MCPErrorHandler-684"><span class="linenos"> 684</span></a>            <span class="n">base_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;base_delay&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler-685"><a href="#MCPErrorHandler-685"><span class="linenos"> 685</span></a>        <span class="k">if</span> <span class="n">max_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-686"><a href="#MCPErrorHandler-686"><span class="linenos"> 686</span></a>            <span class="n">max_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_delay&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler-687"><a href="#MCPErrorHandler-687"><span class="linenos"> 687</span></a>        <span class="k">if</span> <span class="n">exponential_base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-688"><a href="#MCPErrorHandler-688"><span class="linenos"> 688</span></a>            <span class="n">exponential_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;exponential_base&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler-689"><a href="#MCPErrorHandler-689"><span class="linenos"> 689</span></a>
</span><span id="MCPErrorHandler-690"><a href="#MCPErrorHandler-690"><span class="linenos"> 690</span></a>        <span class="n">last_exception</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-691"><a href="#MCPErrorHandler-691"><span class="linenos"> 691</span></a>
</span><span id="MCPErrorHandler-692"><a href="#MCPErrorHandler-692"><span class="linenos"> 692</span></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MCPErrorHandler-693"><a href="#MCPErrorHandler-693"><span class="linenos"> 693</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MCPErrorHandler-694"><a href="#MCPErrorHandler-694"><span class="linenos"> 694</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-695"><a href="#MCPErrorHandler-695"><span class="linenos"> 695</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MCPErrorHandler-696"><a href="#MCPErrorHandler-696"><span class="linenos"> 696</span></a>                        <span class="s2">&quot;Retrying operation&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-697"><a href="#MCPErrorHandler-697"><span class="linenos"> 697</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler-698"><a href="#MCPErrorHandler-698"><span class="linenos"> 698</span></a>                        <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="p">,</span>
</span><span id="MCPErrorHandler-699"><a href="#MCPErrorHandler-699"><span class="linenos"> 699</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler-700"><a href="#MCPErrorHandler-700"><span class="linenos"> 700</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler-701"><a href="#MCPErrorHandler-701"><span class="linenos"> 701</span></a>
</span><span id="MCPErrorHandler-702"><a href="#MCPErrorHandler-702"><span class="linenos"> 702</span></a>                <span class="c1"># Create a new coroutine for each attempt</span>
</span><span id="MCPErrorHandler-703"><a href="#MCPErrorHandler-703"><span class="linenos"> 703</span></a>                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="MCPErrorHandler-704"><a href="#MCPErrorHandler-704"><span class="linenos"> 704</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="MCPErrorHandler-705"><a href="#MCPErrorHandler-705"><span class="linenos"> 705</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler-706"><a href="#MCPErrorHandler-706"><span class="linenos"> 706</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="MCPErrorHandler-707"><a href="#MCPErrorHandler-707"><span class="linenos"> 707</span></a>
</span><span id="MCPErrorHandler-708"><a href="#MCPErrorHandler-708"><span class="linenos"> 708</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="MCPErrorHandler-709"><a href="#MCPErrorHandler-709"><span class="linenos"> 709</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler-710"><a href="#MCPErrorHandler-710"><span class="linenos"> 710</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MCPErrorHandler-711"><a href="#MCPErrorHandler-711"><span class="linenos"> 711</span></a>                        <span class="s2">&quot;Operation succeeded on retry&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span>
</span><span id="MCPErrorHandler-712"><a href="#MCPErrorHandler-712"><span class="linenos"> 712</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler-713"><a href="#MCPErrorHandler-713"><span class="linenos"> 713</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="MCPErrorHandler-714"><a href="#MCPErrorHandler-714"><span class="linenos"> 714</span></a>
</span><span id="MCPErrorHandler-715"><a href="#MCPErrorHandler-715"><span class="linenos"> 715</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MCPErrorHandler-716"><a href="#MCPErrorHandler-716"><span class="linenos"> 716</span></a>                <span class="n">last_exception</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="MCPErrorHandler-717"><a href="#MCPErrorHandler-717"><span class="linenos"> 717</span></a>
</span><span id="MCPErrorHandler-718"><a href="#MCPErrorHandler-718"><span class="linenos"> 718</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
</span><span id="MCPErrorHandler-719"><a href="#MCPErrorHandler-719"><span class="linenos"> 719</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-720"><a href="#MCPErrorHandler-720"><span class="linenos"> 720</span></a>                        <span class="s2">&quot;Operation failed after all retries&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-721"><a href="#MCPErrorHandler-721"><span class="linenos"> 721</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler-722"><a href="#MCPErrorHandler-722"><span class="linenos"> 722</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler-723"><a href="#MCPErrorHandler-723"><span class="linenos"> 723</span></a>                        <span class="n">final_error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="MCPErrorHandler-724"><a href="#MCPErrorHandler-724"><span class="linenos"> 724</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler-725"><a href="#MCPErrorHandler-725"><span class="linenos"> 725</span></a>                    <span class="k">raise</span>
</span><span id="MCPErrorHandler-726"><a href="#MCPErrorHandler-726"><span class="linenos"> 726</span></a>
</span><span id="MCPErrorHandler-727"><a href="#MCPErrorHandler-727"><span class="linenos"> 727</span></a>                <span class="c1"># Calculate delay with exponential backoff</span>
</span><span id="MCPErrorHandler-728"><a href="#MCPErrorHandler-728"><span class="linenos"> 728</span></a>                <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="n">exponential_base</span><span class="o">**</span><span class="n">attempt</span><span class="p">),</span> <span class="n">max_delay</span><span class="p">)</span>
</span><span id="MCPErrorHandler-729"><a href="#MCPErrorHandler-729"><span class="linenos"> 729</span></a>
</span><span id="MCPErrorHandler-730"><a href="#MCPErrorHandler-730"><span class="linenos"> 730</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="MCPErrorHandler-731"><a href="#MCPErrorHandler-731"><span class="linenos"> 731</span></a>                    <span class="s2">&quot;Operation failed, retrying&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-732"><a href="#MCPErrorHandler-732"><span class="linenos"> 732</span></a>                    <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler-733"><a href="#MCPErrorHandler-733"><span class="linenos"> 733</span></a>                    <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MCPErrorHandler-734"><a href="#MCPErrorHandler-734"><span class="linenos"> 734</span></a>                    <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler-735"><a href="#MCPErrorHandler-735"><span class="linenos"> 735</span></a>                    <span class="n">delay_seconds</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
</span><span id="MCPErrorHandler-736"><a href="#MCPErrorHandler-736"><span class="linenos"> 736</span></a>                    <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="MCPErrorHandler-737"><a href="#MCPErrorHandler-737"><span class="linenos"> 737</span></a>                <span class="p">)</span>
</span><span id="MCPErrorHandler-738"><a href="#MCPErrorHandler-738"><span class="linenos"> 738</span></a>
</span><span id="MCPErrorHandler-739"><a href="#MCPErrorHandler-739"><span class="linenos"> 739</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</span><span id="MCPErrorHandler-740"><a href="#MCPErrorHandler-740"><span class="linenos"> 740</span></a>
</span><span id="MCPErrorHandler-741"><a href="#MCPErrorHandler-741"><span class="linenos"> 741</span></a>        <span class="c1"># This should never be reached, but just in case</span>
</span><span id="MCPErrorHandler-742"><a href="#MCPErrorHandler-742"><span class="linenos"> 742</span></a>        <span class="k">if</span> <span class="n">last_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-743"><a href="#MCPErrorHandler-743"><span class="linenos"> 743</span></a>            <span class="k">raise</span> <span class="n">last_exception</span>
</span><span id="MCPErrorHandler-744"><a href="#MCPErrorHandler-744"><span class="linenos"> 744</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler-745"><a href="#MCPErrorHandler-745"><span class="linenos"> 745</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Retry operation failed without exception&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler-746"><a href="#MCPErrorHandler-746"><span class="linenos"> 746</span></a>
</span><span id="MCPErrorHandler-747"><a href="#MCPErrorHandler-747"><span class="linenos"> 747</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-748"><a href="#MCPErrorHandler-748"><span class="linenos"> 748</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-749"><a href="#MCPErrorHandler-749"><span class="linenos"> 749</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-750"><a href="#MCPErrorHandler-750"><span class="linenos"> 750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log error information to stderr for debugging.</span>
</span><span id="MCPErrorHandler-751"><a href="#MCPErrorHandler-751"><span class="linenos"> 751</span></a>
</span><span id="MCPErrorHandler-752"><a href="#MCPErrorHandler-752"><span class="linenos"> 752</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-753"><a href="#MCPErrorHandler-753"><span class="linenos"> 753</span></a><span class="sd">            code: Error code</span>
</span><span id="MCPErrorHandler-754"><a href="#MCPErrorHandler-754"><span class="linenos"> 754</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler-755"><a href="#MCPErrorHandler-755"><span class="linenos"> 755</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-756"><a href="#MCPErrorHandler-756"><span class="linenos"> 756</span></a><span class="sd">            request_id: Request ID for correlation</span>
</span><span id="MCPErrorHandler-757"><a href="#MCPErrorHandler-757"><span class="linenos"> 757</span></a>
</span><span id="MCPErrorHandler-758"><a href="#MCPErrorHandler-758"><span class="linenos"> 758</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-759"><a href="#MCPErrorHandler-759"><span class="linenos"> 759</span></a>        <span class="n">log_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-760"><a href="#MCPErrorHandler-760"><span class="linenos"> 760</span></a>            <span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
</span><span id="MCPErrorHandler-761"><a href="#MCPErrorHandler-761"><span class="linenos"> 761</span></a>            <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="MCPErrorHandler-762"><a href="#MCPErrorHandler-762"><span class="linenos"> 762</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-763"><a href="#MCPErrorHandler-763"><span class="linenos"> 763</span></a>            <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
</span><span id="MCPErrorHandler-764"><a href="#MCPErrorHandler-764"><span class="linenos"> 764</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler-765"><a href="#MCPErrorHandler-765"><span class="linenos"> 765</span></a>
</span><span id="MCPErrorHandler-766"><a href="#MCPErrorHandler-766"><span class="linenos"> 766</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-767"><a href="#MCPErrorHandler-767"><span class="linenos"> 767</span></a>            <span class="n">log_data</span><span class="p">[</span><span class="s2">&quot;error_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-768"><a href="#MCPErrorHandler-768"><span class="linenos"> 768</span></a>
</span><span id="MCPErrorHandler-769"><a href="#MCPErrorHandler-769"><span class="linenos"> 769</span></a>        <span class="c1"># Log to stderr for debugging</span>
</span><span id="MCPErrorHandler-770"><a href="#MCPErrorHandler-770"><span class="linenos"> 770</span></a>        <span class="n">error_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">log_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="MCPErrorHandler-771"><a href="#MCPErrorHandler-771"><span class="linenos"> 771</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[MCP ERROR] </span><span class="si">{</span><span class="n">error_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="MCPErrorHandler-772"><a href="#MCPErrorHandler-772"><span class="linenos"> 772</span></a>
</span><span id="MCPErrorHandler-773"><a href="#MCPErrorHandler-773"><span class="linenos"> 773</span></a>        <span class="c1"># Also log to structured logger</span>
</span><span id="MCPErrorHandler-774"><a href="#MCPErrorHandler-774"><span class="linenos"> 774</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;MCP error occurred&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_data</span><span class="p">)</span>
</span><span id="MCPErrorHandler-775"><a href="#MCPErrorHandler-775"><span class="linenos"> 775</span></a>
</span><span id="MCPErrorHandler-776"><a href="#MCPErrorHandler-776"><span class="linenos"> 776</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-777"><a href="#MCPErrorHandler-777"><span class="linenos"> 777</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error handling configuration.</span>
</span><span id="MCPErrorHandler-778"><a href="#MCPErrorHandler-778"><span class="linenos"> 778</span></a>
</span><span id="MCPErrorHandler-779"><a href="#MCPErrorHandler-779"><span class="linenos"> 779</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-780"><a href="#MCPErrorHandler-780"><span class="linenos"> 780</span></a><span class="sd">            Dictionary containing error handling configuration summary.</span>
</span><span id="MCPErrorHandler-781"><a href="#MCPErrorHandler-781"><span class="linenos"> 781</span></a>
</span><span id="MCPErrorHandler-782"><a href="#MCPErrorHandler-782"><span class="linenos"> 782</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-783"><a href="#MCPErrorHandler-783"><span class="linenos"> 783</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-784"><a href="#MCPErrorHandler-784"><span class="linenos"> 784</span></a>            <span class="s2">&quot;timeouts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="p">,</span>
</span><span id="MCPErrorHandler-785"><a href="#MCPErrorHandler-785"><span class="linenos"> 785</span></a>            <span class="s2">&quot;retry_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">,</span>
</span><span id="MCPErrorHandler-786"><a href="#MCPErrorHandler-786"><span class="linenos"> 786</span></a>            <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="p">,</span>
</span><span id="MCPErrorHandler-787"><a href="#MCPErrorHandler-787"><span class="linenos"> 787</span></a>            <span class="s2">&quot;error_codes&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-788"><a href="#MCPErrorHandler-788"><span class="linenos"> 788</span></a>                <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-789"><a href="#MCPErrorHandler-789"><span class="linenos"> 789</span></a>                    <span class="s2">&quot;PARSE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-790"><a href="#MCPErrorHandler-790"><span class="linenos"> 790</span></a>                    <span class="s2">&quot;INVALID_REQUEST&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span>
</span><span id="MCPErrorHandler-791"><a href="#MCPErrorHandler-791"><span class="linenos"> 791</span></a>                    <span class="s2">&quot;METHOD_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span>
</span><span id="MCPErrorHandler-792"><a href="#MCPErrorHandler-792"><span class="linenos"> 792</span></a>                    <span class="s2">&quot;INVALID_PARAMS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span>
</span><span id="MCPErrorHandler-793"><a href="#MCPErrorHandler-793"><span class="linenos"> 793</span></a>                    <span class="s2">&quot;INTERNAL_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-794"><a href="#MCPErrorHandler-794"><span class="linenos"> 794</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler-795"><a href="#MCPErrorHandler-795"><span class="linenos"> 795</span></a>                <span class="s2">&quot;server_defined&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-796"><a href="#MCPErrorHandler-796"><span class="linenos"> 796</span></a>                    <span class="s2">&quot;RESOURCE_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span>
</span><span id="MCPErrorHandler-797"><a href="#MCPErrorHandler-797"><span class="linenos"> 797</span></a>                    <span class="s2">&quot;RESOURCE_ACCESS_DENIED&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="MCPErrorHandler-798"><a href="#MCPErrorHandler-798"><span class="linenos"> 798</span></a>                    <span class="s2">&quot;RESOURCE_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span>
</span><span id="MCPErrorHandler-799"><a href="#MCPErrorHandler-799"><span class="linenos"> 799</span></a>                    <span class="s2">&quot;TOOL_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOOL_UNAVAILABLE</span><span class="p">,</span>
</span><span id="MCPErrorHandler-800"><a href="#MCPErrorHandler-800"><span class="linenos"> 800</span></a>                    <span class="s2">&quot;TIMEOUT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-801"><a href="#MCPErrorHandler-801"><span class="linenos"> 801</span></a>                    <span class="s2">&quot;VALIDATION_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-802"><a href="#MCPErrorHandler-802"><span class="linenos"> 802</span></a>                    <span class="s2">&quot;EXTERNAL_SERVICE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-803"><a href="#MCPErrorHandler-803"><span class="linenos"> 803</span></a>                    <span class="s2">&quot;RATE_LIMIT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-804"><a href="#MCPErrorHandler-804"><span class="linenos"> 804</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler-805"><a href="#MCPErrorHandler-805"><span class="linenos"> 805</span></a>            <span class="p">},</span>
</span><span id="MCPErrorHandler-806"><a href="#MCPErrorHandler-806"><span class="linenos"> 806</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler-807"><a href="#MCPErrorHandler-807"><span class="linenos"> 807</span></a>
</span><span id="MCPErrorHandler-808"><a href="#MCPErrorHandler-808"><span class="linenos"> 808</span></a>    <span class="c1"># Phase 3: Advanced Error Handling Features</span>
</span><span id="MCPErrorHandler-809"><a href="#MCPErrorHandler-809"><span class="linenos"> 809</span></a>
</span><span id="MCPErrorHandler-810"><a href="#MCPErrorHandler-810"><span class="linenos"> 810</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_not_found_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-811"><a href="#MCPErrorHandler-811"><span class="linenos"> 811</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-812"><a href="#MCPErrorHandler-812"><span class="linenos"> 812</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-813"><a href="#MCPErrorHandler-813"><span class="linenos"> 813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource not found error response.</span>
</span><span id="MCPErrorHandler-814"><a href="#MCPErrorHandler-814"><span class="linenos"> 814</span></a>
</span><span id="MCPErrorHandler-815"><a href="#MCPErrorHandler-815"><span class="linenos"> 815</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-816"><a href="#MCPErrorHandler-816"><span class="linenos"> 816</span></a><span class="sd">            resource_uri: URI of the resource that was not found</span>
</span><span id="MCPErrorHandler-817"><a href="#MCPErrorHandler-817"><span class="linenos"> 817</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-818"><a href="#MCPErrorHandler-818"><span class="linenos"> 818</span></a>
</span><span id="MCPErrorHandler-819"><a href="#MCPErrorHandler-819"><span class="linenos"> 819</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-820"><a href="#MCPErrorHandler-820"><span class="linenos"> 820</span></a><span class="sd">            Resource not found error response.</span>
</span><span id="MCPErrorHandler-821"><a href="#MCPErrorHandler-821"><span class="linenos"> 821</span></a>
</span><span id="MCPErrorHandler-822"><a href="#MCPErrorHandler-822"><span class="linenos"> 822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-823"><a href="#MCPErrorHandler-823"><span class="linenos"> 823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-824"><a href="#MCPErrorHandler-824"><span class="linenos"> 824</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-825"><a href="#MCPErrorHandler-825"><span class="linenos"> 825</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler-826"><a href="#MCPErrorHandler-826"><span class="linenos"> 826</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and ensure it exists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-827"><a href="#MCPErrorHandler-827"><span class="linenos"> 827</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-828"><a href="#MCPErrorHandler-828"><span class="linenos"> 828</span></a>
</span><span id="MCPErrorHandler-829"><a href="#MCPErrorHandler-829"><span class="linenos"> 829</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-830"><a href="#MCPErrorHandler-830"><span class="linenos"> 830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-831"><a href="#MCPErrorHandler-831"><span class="linenos"> 831</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-832"><a href="#MCPErrorHandler-832"><span class="linenos"> 832</span></a>
</span><span id="MCPErrorHandler-833"><a href="#MCPErrorHandler-833"><span class="linenos"> 833</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_access_denied_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-834"><a href="#MCPErrorHandler-834"><span class="linenos"> 834</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-835"><a href="#MCPErrorHandler-835"><span class="linenos"> 835</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-836"><a href="#MCPErrorHandler-836"><span class="linenos"> 836</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-837"><a href="#MCPErrorHandler-837"><span class="linenos"> 837</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-838"><a href="#MCPErrorHandler-838"><span class="linenos"> 838</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-839"><a href="#MCPErrorHandler-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource access denied error response.</span>
</span><span id="MCPErrorHandler-840"><a href="#MCPErrorHandler-840"><span class="linenos"> 840</span></a>
</span><span id="MCPErrorHandler-841"><a href="#MCPErrorHandler-841"><span class="linenos"> 841</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-842"><a href="#MCPErrorHandler-842"><span class="linenos"> 842</span></a><span class="sd">            resource_uri: URI of the resource that access was denied to</span>
</span><span id="MCPErrorHandler-843"><a href="#MCPErrorHandler-843"><span class="linenos"> 843</span></a><span class="sd">            reason: Reason for access denial</span>
</span><span id="MCPErrorHandler-844"><a href="#MCPErrorHandler-844"><span class="linenos"> 844</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-845"><a href="#MCPErrorHandler-845"><span class="linenos"> 845</span></a>
</span><span id="MCPErrorHandler-846"><a href="#MCPErrorHandler-846"><span class="linenos"> 846</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-847"><a href="#MCPErrorHandler-847"><span class="linenos"> 847</span></a><span class="sd">            Resource access denied error response.</span>
</span><span id="MCPErrorHandler-848"><a href="#MCPErrorHandler-848"><span class="linenos"> 848</span></a>
</span><span id="MCPErrorHandler-849"><a href="#MCPErrorHandler-849"><span class="linenos"> 849</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-850"><a href="#MCPErrorHandler-850"><span class="linenos"> 850</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-851"><a href="#MCPErrorHandler-851"><span class="linenos"> 851</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-852"><a href="#MCPErrorHandler-852"><span class="linenos"> 852</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler-853"><a href="#MCPErrorHandler-853"><span class="linenos"> 853</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="MCPErrorHandler-854"><a href="#MCPErrorHandler-854"><span class="linenos"> 854</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check your permissions and authentication&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-855"><a href="#MCPErrorHandler-855"><span class="linenos"> 855</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-856"><a href="#MCPErrorHandler-856"><span class="linenos"> 856</span></a>
</span><span id="MCPErrorHandler-857"><a href="#MCPErrorHandler-857"><span class="linenos"> 857</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-858"><a href="#MCPErrorHandler-858"><span class="linenos"> 858</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="MCPErrorHandler-859"><a href="#MCPErrorHandler-859"><span class="linenos"> 859</span></a>            <span class="sa">f</span><span class="s2">&quot;Access denied to resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-860"><a href="#MCPErrorHandler-860"><span class="linenos"> 860</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="MCPErrorHandler-861"><a href="#MCPErrorHandler-861"><span class="linenos"> 861</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-862"><a href="#MCPErrorHandler-862"><span class="linenos"> 862</span></a>
</span><span id="MCPErrorHandler-863"><a href="#MCPErrorHandler-863"><span class="linenos"> 863</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_unavailable_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-864"><a href="#MCPErrorHandler-864"><span class="linenos"> 864</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-865"><a href="#MCPErrorHandler-865"><span class="linenos"> 865</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-866"><a href="#MCPErrorHandler-866"><span class="linenos"> 866</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Resource temporarily unavailable&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-867"><a href="#MCPErrorHandler-867"><span class="linenos"> 867</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-868"><a href="#MCPErrorHandler-868"><span class="linenos"> 868</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-869"><a href="#MCPErrorHandler-869"><span class="linenos"> 869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource unavailable error response.</span>
</span><span id="MCPErrorHandler-870"><a href="#MCPErrorHandler-870"><span class="linenos"> 870</span></a>
</span><span id="MCPErrorHandler-871"><a href="#MCPErrorHandler-871"><span class="linenos"> 871</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-872"><a href="#MCPErrorHandler-872"><span class="linenos"> 872</span></a><span class="sd">            resource_uri: URI of the resource that is unavailable</span>
</span><span id="MCPErrorHandler-873"><a href="#MCPErrorHandler-873"><span class="linenos"> 873</span></a><span class="sd">            reason: Reason for unavailability</span>
</span><span id="MCPErrorHandler-874"><a href="#MCPErrorHandler-874"><span class="linenos"> 874</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-875"><a href="#MCPErrorHandler-875"><span class="linenos"> 875</span></a>
</span><span id="MCPErrorHandler-876"><a href="#MCPErrorHandler-876"><span class="linenos"> 876</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-877"><a href="#MCPErrorHandler-877"><span class="linenos"> 877</span></a><span class="sd">            Resource unavailable error response.</span>
</span><span id="MCPErrorHandler-878"><a href="#MCPErrorHandler-878"><span class="linenos"> 878</span></a>
</span><span id="MCPErrorHandler-879"><a href="#MCPErrorHandler-879"><span class="linenos"> 879</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-880"><a href="#MCPErrorHandler-880"><span class="linenos"> 880</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-881"><a href="#MCPErrorHandler-881"><span class="linenos"> 881</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-882"><a href="#MCPErrorHandler-882"><span class="linenos"> 882</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler-883"><a href="#MCPErrorHandler-883"><span class="linenos"> 883</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="MCPErrorHandler-884"><a href="#MCPErrorHandler-884"><span class="linenos"> 884</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try again later or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-885"><a href="#MCPErrorHandler-885"><span class="linenos"> 885</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-886"><a href="#MCPErrorHandler-886"><span class="linenos"> 886</span></a>
</span><span id="MCPErrorHandler-887"><a href="#MCPErrorHandler-887"><span class="linenos"> 887</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-888"><a href="#MCPErrorHandler-888"><span class="linenos"> 888</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; unavailable: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-889"><a href="#MCPErrorHandler-889"><span class="linenos"> 889</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-890"><a href="#MCPErrorHandler-890"><span class="linenos"> 890</span></a>
</span><span id="MCPErrorHandler-891"><a href="#MCPErrorHandler-891"><span class="linenos"> 891</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_circuit_breaker_open_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-892"><a href="#MCPErrorHandler-892"><span class="linenos"> 892</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler-893"><a href="#MCPErrorHandler-893"><span class="linenos"> 893</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-894"><a href="#MCPErrorHandler-894"><span class="linenos"> 894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a circuit breaker open error response.</span>
</span><span id="MCPErrorHandler-895"><a href="#MCPErrorHandler-895"><span class="linenos"> 895</span></a>
</span><span id="MCPErrorHandler-896"><a href="#MCPErrorHandler-896"><span class="linenos"> 896</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-897"><a href="#MCPErrorHandler-897"><span class="linenos"> 897</span></a><span class="sd">            service_name: Name of the service with open circuit breaker</span>
</span><span id="MCPErrorHandler-898"><a href="#MCPErrorHandler-898"><span class="linenos"> 898</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-899"><a href="#MCPErrorHandler-899"><span class="linenos"> 899</span></a>
</span><span id="MCPErrorHandler-900"><a href="#MCPErrorHandler-900"><span class="linenos"> 900</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-901"><a href="#MCPErrorHandler-901"><span class="linenos"> 901</span></a><span class="sd">            Circuit breaker open error response.</span>
</span><span id="MCPErrorHandler-902"><a href="#MCPErrorHandler-902"><span class="linenos"> 902</span></a>
</span><span id="MCPErrorHandler-903"><a href="#MCPErrorHandler-903"><span class="linenos"> 903</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-904"><a href="#MCPErrorHandler-904"><span class="linenos"> 904</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-905"><a href="#MCPErrorHandler-905"><span class="linenos"> 905</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-906"><a href="#MCPErrorHandler-906"><span class="linenos"> 906</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-907"><a href="#MCPErrorHandler-907"><span class="linenos"> 907</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Service is temporarily unavailable due to repeated failures. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-908"><a href="#MCPErrorHandler-908"><span class="linenos"> 908</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-909"><a href="#MCPErrorHandler-909"><span class="linenos"> 909</span></a>
</span><span id="MCPErrorHandler-910"><a href="#MCPErrorHandler-910"><span class="linenos"> 910</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-911"><a href="#MCPErrorHandler-911"><span class="linenos"> 911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; circuit breaker is open&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-912"><a href="#MCPErrorHandler-912"><span class="linenos"> 912</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-913"><a href="#MCPErrorHandler-913"><span class="linenos"> 913</span></a>
</span><span id="MCPErrorHandler-914"><a href="#MCPErrorHandler-914"><span class="linenos"> 914</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error_with_context</span><span class="p">(</span>
</span><span id="MCPErrorHandler-915"><a href="#MCPErrorHandler-915"><span class="linenos"> 915</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-916"><a href="#MCPErrorHandler-916"><span class="linenos"> 916</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-917"><a href="#MCPErrorHandler-917"><span class="linenos"> 917</span></a>        <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span>
</span><span id="MCPErrorHandler-918"><a href="#MCPErrorHandler-918"><span class="linenos"> 918</span></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="MCPErrorHandler-919"><a href="#MCPErrorHandler-919"><span class="linenos"> 919</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-920"><a href="#MCPErrorHandler-920"><span class="linenos"> 920</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-921"><a href="#MCPErrorHandler-921"><span class="linenos"> 921</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response with additional context.</span>
</span><span id="MCPErrorHandler-922"><a href="#MCPErrorHandler-922"><span class="linenos"> 922</span></a>
</span><span id="MCPErrorHandler-923"><a href="#MCPErrorHandler-923"><span class="linenos"> 923</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-924"><a href="#MCPErrorHandler-924"><span class="linenos"> 924</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="MCPErrorHandler-925"><a href="#MCPErrorHandler-925"><span class="linenos"> 925</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="MCPErrorHandler-926"><a href="#MCPErrorHandler-926"><span class="linenos"> 926</span></a><span class="sd">            context: Additional context about the validation failure</span>
</span><span id="MCPErrorHandler-927"><a href="#MCPErrorHandler-927"><span class="linenos"> 927</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-928"><a href="#MCPErrorHandler-928"><span class="linenos"> 928</span></a>
</span><span id="MCPErrorHandler-929"><a href="#MCPErrorHandler-929"><span class="linenos"> 929</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-930"><a href="#MCPErrorHandler-930"><span class="linenos"> 930</span></a><span class="sd">            Enhanced validation error response.</span>
</span><span id="MCPErrorHandler-931"><a href="#MCPErrorHandler-931"><span class="linenos"> 931</span></a>
</span><span id="MCPErrorHandler-932"><a href="#MCPErrorHandler-932"><span class="linenos"> 932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-933"><a href="#MCPErrorHandler-933"><span class="linenos"> 933</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-934"><a href="#MCPErrorHandler-934"><span class="linenos"> 934</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-935"><a href="#MCPErrorHandler-935"><span class="linenos"> 935</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-936"><a href="#MCPErrorHandler-936"><span class="linenos"> 936</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">()],</span>
</span><span id="MCPErrorHandler-937"><a href="#MCPErrorHandler-937"><span class="linenos"> 937</span></a>                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="MCPErrorHandler-938"><a href="#MCPErrorHandler-938"><span class="linenos"> 938</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the input parameters and ensure they match the expected schema&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-939"><a href="#MCPErrorHandler-939"><span class="linenos"> 939</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-940"><a href="#MCPErrorHandler-940"><span class="linenos"> 940</span></a>
</span><span id="MCPErrorHandler-941"><a href="#MCPErrorHandler-941"><span class="linenos"> 941</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-942"><a href="#MCPErrorHandler-942"><span class="linenos"> 942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation failed for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler-943"><a href="#MCPErrorHandler-943"><span class="linenos"> 943</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-944"><a href="#MCPErrorHandler-944"><span class="linenos"> 944</span></a>
</span><span id="MCPErrorHandler-945"><a href="#MCPErrorHandler-945"><span class="linenos"> 945</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error_with_context</span><span class="p">(</span>
</span><span id="MCPErrorHandler-946"><a href="#MCPErrorHandler-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler-947"><a href="#MCPErrorHandler-947"><span class="linenos"> 947</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler-948"><a href="#MCPErrorHandler-948"><span class="linenos"> 948</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="MCPErrorHandler-949"><a href="#MCPErrorHandler-949"><span class="linenos"> 949</span></a>        <span class="n">operation_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="MCPErrorHandler-950"><a href="#MCPErrorHandler-950"><span class="linenos"> 950</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler-951"><a href="#MCPErrorHandler-951"><span class="linenos"> 951</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-952"><a href="#MCPErrorHandler-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response with operation context.</span>
</span><span id="MCPErrorHandler-953"><a href="#MCPErrorHandler-953"><span class="linenos"> 953</span></a>
</span><span id="MCPErrorHandler-954"><a href="#MCPErrorHandler-954"><span class="linenos"> 954</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-955"><a href="#MCPErrorHandler-955"><span class="linenos"> 955</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="MCPErrorHandler-956"><a href="#MCPErrorHandler-956"><span class="linenos"> 956</span></a><span class="sd">            timeout_seconds: Timeout value that was exceeded</span>
</span><span id="MCPErrorHandler-957"><a href="#MCPErrorHandler-957"><span class="linenos"> 957</span></a><span class="sd">            operation_context: Context about the operation that timed out</span>
</span><span id="MCPErrorHandler-958"><a href="#MCPErrorHandler-958"><span class="linenos"> 958</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler-959"><a href="#MCPErrorHandler-959"><span class="linenos"> 959</span></a>
</span><span id="MCPErrorHandler-960"><a href="#MCPErrorHandler-960"><span class="linenos"> 960</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-961"><a href="#MCPErrorHandler-961"><span class="linenos"> 961</span></a><span class="sd">            Enhanced timeout error response.</span>
</span><span id="MCPErrorHandler-962"><a href="#MCPErrorHandler-962"><span class="linenos"> 962</span></a>
</span><span id="MCPErrorHandler-963"><a href="#MCPErrorHandler-963"><span class="linenos"> 963</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-964"><a href="#MCPErrorHandler-964"><span class="linenos"> 964</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler-965"><a href="#MCPErrorHandler-965"><span class="linenos"> 965</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-966"><a href="#MCPErrorHandler-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler-967"><a href="#MCPErrorHandler-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="MCPErrorHandler-968"><a href="#MCPErrorHandler-968"><span class="linenos"> 968</span></a>                <span class="s2">&quot;operation_context&quot;</span><span class="p">:</span> <span class="n">operation_context</span><span class="p">,</span>
</span><span id="MCPErrorHandler-969"><a href="#MCPErrorHandler-969"><span class="linenos"> 969</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The operation may be taking longer than expected. Try reducing the scope or increasing the timeout.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-970"><a href="#MCPErrorHandler-970"><span class="linenos"> 970</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-971"><a href="#MCPErrorHandler-971"><span class="linenos"> 971</span></a>
</span><span id="MCPErrorHandler-972"><a href="#MCPErrorHandler-972"><span class="linenos"> 972</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler-973"><a href="#MCPErrorHandler-973"><span class="linenos"> 973</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler-974"><a href="#MCPErrorHandler-974"><span class="linenos"> 974</span></a>            <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler-975"><a href="#MCPErrorHandler-975"><span class="linenos"> 975</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="MCPErrorHandler-976"><a href="#MCPErrorHandler-976"><span class="linenos"> 976</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-977"><a href="#MCPErrorHandler-977"><span class="linenos"> 977</span></a>
</span><span id="MCPErrorHandler-978"><a href="#MCPErrorHandler-978"><span class="linenos"> 978</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_enhanced_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-979"><a href="#MCPErrorHandler-979"><span class="linenos"> 979</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an enhanced summary including Phase 3 features.</span>
</span><span id="MCPErrorHandler-980"><a href="#MCPErrorHandler-980"><span class="linenos"> 980</span></a>
</span><span id="MCPErrorHandler-981"><a href="#MCPErrorHandler-981"><span class="linenos"> 981</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-982"><a href="#MCPErrorHandler-982"><span class="linenos"> 982</span></a><span class="sd">            Dictionary containing comprehensive error handling configuration and capabilities.</span>
</span><span id="MCPErrorHandler-983"><a href="#MCPErrorHandler-983"><span class="linenos"> 983</span></a>
</span><span id="MCPErrorHandler-984"><a href="#MCPErrorHandler-984"><span class="linenos"> 984</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-985"><a href="#MCPErrorHandler-985"><span class="linenos"> 985</span></a>        <span class="n">base_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">()</span>
</span><span id="MCPErrorHandler-986"><a href="#MCPErrorHandler-986"><span class="linenos"> 986</span></a>        <span class="n">base_summary</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="MCPErrorHandler-987"><a href="#MCPErrorHandler-987"><span class="linenos"> 987</span></a>            <span class="p">{</span>
</span><span id="MCPErrorHandler-988"><a href="#MCPErrorHandler-988"><span class="linenos"> 988</span></a>                <span class="s2">&quot;phase_3_features&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-989"><a href="#MCPErrorHandler-989"><span class="linenos"> 989</span></a>                    <span class="s2">&quot;circuit_breaker&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-990"><a href="#MCPErrorHandler-990"><span class="linenos"> 990</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler-991"><a href="#MCPErrorHandler-991"><span class="linenos"> 991</span></a>                        <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-992"><a href="#MCPErrorHandler-992"><span class="linenos"> 992</span></a>                            <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="MCPErrorHandler-993"><a href="#MCPErrorHandler-993"><span class="linenos"> 993</span></a>                            <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="MCPErrorHandler-994"><a href="#MCPErrorHandler-994"><span class="linenos"> 994</span></a>                            <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="MCPErrorHandler-995"><a href="#MCPErrorHandler-995"><span class="linenos"> 995</span></a>                        <span class="p">},</span>
</span><span id="MCPErrorHandler-996"><a href="#MCPErrorHandler-996"><span class="linenos"> 996</span></a>                    <span class="p">},</span>
</span><span id="MCPErrorHandler-997"><a href="#MCPErrorHandler-997"><span class="linenos"> 997</span></a>                    <span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-998"><a href="#MCPErrorHandler-998"><span class="linenos"> 998</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">],</span>
</span><span id="MCPErrorHandler-999"><a href="#MCPErrorHandler-999"><span class="linenos"> 999</span></a>                        <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">],</span>
</span><span id="MCPErrorHandler-1000"><a href="#MCPErrorHandler-1000"><span class="linenos">1000</span></a>                        <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span>
</span><span id="MCPErrorHandler-1001"><a href="#MCPErrorHandler-1001"><span class="linenos">1001</span></a>                            <span class="s2">&quot;max_errors_per_window&quot;</span>
</span><span id="MCPErrorHandler-1002"><a href="#MCPErrorHandler-1002"><span class="linenos">1002</span></a>                        <span class="p">],</span>
</span><span id="MCPErrorHandler-1003"><a href="#MCPErrorHandler-1003"><span class="linenos">1003</span></a>                    <span class="p">},</span>
</span><span id="MCPErrorHandler-1004"><a href="#MCPErrorHandler-1004"><span class="linenos">1004</span></a>                    <span class="s2">&quot;enhanced_resource_handling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler-1005"><a href="#MCPErrorHandler-1005"><span class="linenos">1005</span></a>                    <span class="s2">&quot;context_aware_errors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler-1006"><a href="#MCPErrorHandler-1006"><span class="linenos">1006</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler-1007"><a href="#MCPErrorHandler-1007"><span class="linenos">1007</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler-1008"><a href="#MCPErrorHandler-1008"><span class="linenos">1008</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler-1009"><a href="#MCPErrorHandler-1009"><span class="linenos">1009</span></a>        <span class="k">return</span> <span class="n">base_summary</span>
</span><span id="MCPErrorHandler-1010"><a href="#MCPErrorHandler-1010"><span class="linenos">1010</span></a>
</span><span id="MCPErrorHandler-1011"><a href="#MCPErrorHandler-1011"><span class="linenos">1011</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_analytics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-1012"><a href="#MCPErrorHandler-1012"><span class="linenos">1012</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error analytics and patterns from the aggregator.</span>
</span><span id="MCPErrorHandler-1013"><a href="#MCPErrorHandler-1013"><span class="linenos">1013</span></a>
</span><span id="MCPErrorHandler-1014"><a href="#MCPErrorHandler-1014"><span class="linenos">1014</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-1015"><a href="#MCPErrorHandler-1015"><span class="linenos">1015</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="MCPErrorHandler-1016"><a href="#MCPErrorHandler-1016"><span class="linenos">1016</span></a>
</span><span id="MCPErrorHandler-1017"><a href="#MCPErrorHandler-1017"><span class="linenos">1017</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-1018"><a href="#MCPErrorHandler-1018"><span class="linenos">1018</span></a><span class="sd">            Dictionary containing error analytics and patterns.</span>
</span><span id="MCPErrorHandler-1019"><a href="#MCPErrorHandler-1019"><span class="linenos">1019</span></a>
</span><span id="MCPErrorHandler-1020"><a href="#MCPErrorHandler-1020"><span class="linenos">1020</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-1021"><a href="#MCPErrorHandler-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="MCPErrorHandler-1022"><a href="#MCPErrorHandler-1022"><span class="linenos">1022</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;disabled&quot;</span><span class="p">}</span>
</span><span id="MCPErrorHandler-1023"><a href="#MCPErrorHandler-1023"><span class="linenos">1023</span></a>
</span><span id="MCPErrorHandler-1024"><a href="#MCPErrorHandler-1024"><span class="linenos">1024</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MCPErrorHandler-1025"><a href="#MCPErrorHandler-1025"><span class="linenos">1025</span></a>            <span class="s2">&quot;error_summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">),</span>
</span><span id="MCPErrorHandler-1026"><a href="#MCPErrorHandler-1026"><span class="linenos">1026</span></a>            <span class="s2">&quot;error_trends&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_trends</span><span class="p">(),</span>
</span><span id="MCPErrorHandler-1027"><a href="#MCPErrorHandler-1027"><span class="linenos">1027</span></a>            <span class="s2">&quot;aggregation_config&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">,</span>
</span><span id="MCPErrorHandler-1028"><a href="#MCPErrorHandler-1028"><span class="linenos">1028</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler-1029"><a href="#MCPErrorHandler-1029"><span class="linenos">1029</span></a>
</span><span id="MCPErrorHandler-1030"><a href="#MCPErrorHandler-1030"><span class="linenos">1030</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_circuit_breaker_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler-1031"><a href="#MCPErrorHandler-1031"><span class="linenos">1031</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get circuit breaker status for a specific service.</span>
</span><span id="MCPErrorHandler-1032"><a href="#MCPErrorHandler-1032"><span class="linenos">1032</span></a>
</span><span id="MCPErrorHandler-1033"><a href="#MCPErrorHandler-1033"><span class="linenos">1033</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler-1034"><a href="#MCPErrorHandler-1034"><span class="linenos">1034</span></a><span class="sd">            service_name: Name of the service to check</span>
</span><span id="MCPErrorHandler-1035"><a href="#MCPErrorHandler-1035"><span class="linenos">1035</span></a>
</span><span id="MCPErrorHandler-1036"><a href="#MCPErrorHandler-1036"><span class="linenos">1036</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler-1037"><a href="#MCPErrorHandler-1037"><span class="linenos">1037</span></a><span class="sd">            Circuit breaker status or None if not found.</span>
</span><span id="MCPErrorHandler-1038"><a href="#MCPErrorHandler-1038"><span class="linenos">1038</span></a>
</span><span id="MCPErrorHandler-1039"><a href="#MCPErrorHandler-1039"><span class="linenos">1039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler-1040"><a href="#MCPErrorHandler-1040"><span class="linenos">1040</span></a>        <span class="c1"># This would be implemented when circuit breakers are added to specific services</span>
</span><span id="MCPErrorHandler-1041"><a href="#MCPErrorHandler-1041"><span class="linenos">1041</span></a>        <span class="c1"># For now, return None to indicate no circuit breaker exists</span>
</span><span id="MCPErrorHandler-1042"><a href="#MCPErrorHandler-1042"><span class="linenos">1042</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Handles JSON-RPC error responses for MCP server.</p>

<p>This class provides comprehensive error handling for all MCP operations,
including proper error code generation, timeout handling, retry logic,
and detailed error logging for debugging and troubleshooting.</p>

<p>The error handler follows the JSON-RPC 2.0 specification and ensures
that all error responses are properly formatted and contain actionable
information for users while maintaining detailed logging for developers.</p>

<p>Attributes:
    config: Error handling configuration
    logger: Structured logger instance</p>
</div>


                            <div id="MCPErrorHandler.__init__" class="classattr">
                                        <input id="MCPErrorHandler.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MCPErrorHandler</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config</span><span class="p">:</span> <span class="n"><a href="#ErrorHandlingConfig">ErrorHandlingConfig</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MCPErrorHandler.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.__init__-156"><a href="#MCPErrorHandler.__init__-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ErrorHandlingConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.__init__-157"><a href="#MCPErrorHandler.__init__-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the MCP error handler.</span>
</span><span id="MCPErrorHandler.__init__-158"><a href="#MCPErrorHandler.__init__-158"><span class="linenos">158</span></a>
</span><span id="MCPErrorHandler.__init__-159"><a href="#MCPErrorHandler.__init__-159"><span class="linenos">159</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.__init__-160"><a href="#MCPErrorHandler.__init__-160"><span class="linenos">160</span></a><span class="sd">            config: Error handling configuration. If None, uses default values.</span>
</span><span id="MCPErrorHandler.__init__-161"><a href="#MCPErrorHandler.__init__-161"><span class="linenos">161</span></a>
</span><span id="MCPErrorHandler.__init__-162"><a href="#MCPErrorHandler.__init__-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.__init__-163"><a href="#MCPErrorHandler.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">ErrorHandlingConfig</span><span class="p">()</span>
</span><span id="MCPErrorHandler.__init__-164"><a href="#MCPErrorHandler.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="MCPErrorHandler.__init__-165"><a href="#MCPErrorHandler.__init__-165"><span class="linenos">165</span></a>
</span><span id="MCPErrorHandler.__init__-166"><a href="#MCPErrorHandler.__init__-166"><span class="linenos">166</span></a>        <span class="c1"># Initialize error aggregator for Phase 3 features</span>
</span><span id="MCPErrorHandler.__init__-167"><a href="#MCPErrorHandler.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span> <span class="o">=</span> <span class="n">ErrorAggregator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">)</span>
</span><span id="MCPErrorHandler.__init__-168"><a href="#MCPErrorHandler.__init__-168"><span class="linenos">168</span></a>
</span><span id="MCPErrorHandler.__init__-169"><a href="#MCPErrorHandler.__init__-169"><span class="linenos">169</span></a>        <span class="c1"># Initialize security components</span>
</span><span id="MCPErrorHandler.__init__-170"><a href="#MCPErrorHandler.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span> <span class="o">=</span> <span class="n">MCPSchemaValidator</span><span class="p">()</span>
</span><span id="MCPErrorHandler.__init__-171"><a href="#MCPErrorHandler.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span> <span class="o">=</span> <span class="n">APIKeyRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler.__init__-172"><a href="#MCPErrorHandler.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span> <span class="o">=</span> <span class="n">ConnectionRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler.__init__-173"><a href="#MCPErrorHandler.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span> <span class="o">=</span> <span class="n">GlobalRateLimiter</span><span class="p">()</span>
</span><span id="MCPErrorHandler.__init__-174"><a href="#MCPErrorHandler.__init__-174"><span class="linenos">174</span></a>
</span><span id="MCPErrorHandler.__init__-175"><a href="#MCPErrorHandler.__init__-175"><span class="linenos">175</span></a>        <span class="c1"># Validate configuration</span>
</span><span id="MCPErrorHandler.__init__-176"><a href="#MCPErrorHandler.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the MCP error handler.</p>

<p>Args:
    config: Error handling configuration. If None, uses default values.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.PARSE_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">PARSE_ERROR</span>        =
<span class="default_value">-32700</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.PARSE_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.INVALID_REQUEST" class="classattr">
                                <div class="attr variable">
            <span class="name">INVALID_REQUEST</span>        =
<span class="default_value">-32600</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.INVALID_REQUEST"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.METHOD_NOT_FOUND" class="classattr">
                                <div class="attr variable">
            <span class="name">METHOD_NOT_FOUND</span>        =
<span class="default_value">-32601</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.METHOD_NOT_FOUND"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.INVALID_PARAMS" class="classattr">
                                <div class="attr variable">
            <span class="name">INVALID_PARAMS</span>        =
<span class="default_value">-32602</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.INVALID_PARAMS"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.INTERNAL_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">INTERNAL_ERROR</span>        =
<span class="default_value">-32603</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.INTERNAL_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.RESOURCE_NOT_FOUND" class="classattr">
                                <div class="attr variable">
            <span class="name">RESOURCE_NOT_FOUND</span>        =
<span class="default_value">-32001</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.RESOURCE_NOT_FOUND"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.RESOURCE_ACCESS_DENIED" class="classattr">
                                <div class="attr variable">
            <span class="name">RESOURCE_ACCESS_DENIED</span>        =
<span class="default_value">-32002</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.RESOURCE_ACCESS_DENIED"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.RESOURCE_UNAVAILABLE" class="classattr">
                                <div class="attr variable">
            <span class="name">RESOURCE_UNAVAILABLE</span>        =
<span class="default_value">-32003</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.RESOURCE_UNAVAILABLE"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.TOOL_UNAVAILABLE" class="classattr">
                                <div class="attr variable">
            <span class="name">TOOL_UNAVAILABLE</span>        =
<span class="default_value">-32004</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.TOOL_UNAVAILABLE"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.TIMEOUT_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">TIMEOUT_ERROR</span>        =
<span class="default_value">-32005</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.TIMEOUT_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.VALIDATION_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">VALIDATION_ERROR</span>        =
<span class="default_value">-32006</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.VALIDATION_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.EXTERNAL_SERVICE_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">EXTERNAL_SERVICE_ERROR</span>        =
<span class="default_value">-32007</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.EXTERNAL_SERVICE_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.RATE_LIMIT_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">RATE_LIMIT_ERROR</span>        =
<span class="default_value">-32008</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.RATE_LIMIT_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.SECURITY_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">SECURITY_ERROR</span>        =
<span class="default_value">-32009</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.SECURITY_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.SCHEMA_VALIDATION_ERROR" class="classattr">
                                <div class="attr variable">
            <span class="name">SCHEMA_VALIDATION_ERROR</span>        =
<span class="default_value">-32010</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.SCHEMA_VALIDATION_ERROR"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.config"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.logger"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.error_aggregator" class="classattr">
                                <div class="attr variable">
            <span class="name">error_aggregator</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.error_aggregator"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.schema_validator" class="classattr">
                                <div class="attr variable">
            <span class="name">schema_validator</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.schema_validator"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.api_key_rate_limiter" class="classattr">
                                <div class="attr variable">
            <span class="name">api_key_rate_limiter</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.api_key_rate_limiter"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.connection_rate_limiter" class="classattr">
                                <div class="attr variable">
            <span class="name">connection_rate_limiter</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.connection_rate_limiter"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.global_rate_limiter" class="classattr">
                                <div class="attr variable">
            <span class="name">global_rate_limiter</span>

        
    </div>
    <a class="headerlink" href="#MCPErrorHandler.global_rate_limiter"></a>
    
    

                            </div>
                            <div id="MCPErrorHandler.create_error" class="classattr">
                                        <input id="MCPErrorHandler.create_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">code</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_error-201"><a href="#MCPErrorHandler.create_error-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_error-202"><a href="#MCPErrorHandler.create_error-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-203"><a href="#MCPErrorHandler.create_error-203"><span class="linenos">203</span></a>        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-204"><a href="#MCPErrorHandler.create_error-204"><span class="linenos">204</span></a>        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-205"><a href="#MCPErrorHandler.create_error-205"><span class="linenos">205</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-206"><a href="#MCPErrorHandler.create_error-206"><span class="linenos">206</span></a>        <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-207"><a href="#MCPErrorHandler.create_error-207"><span class="linenos">207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_error-208"><a href="#MCPErrorHandler.create_error-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a properly formatted JSON-RPC error response.</span>
</span><span id="MCPErrorHandler.create_error-209"><a href="#MCPErrorHandler.create_error-209"><span class="linenos">209</span></a>
</span><span id="MCPErrorHandler.create_error-210"><a href="#MCPErrorHandler.create_error-210"><span class="linenos">210</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_error-211"><a href="#MCPErrorHandler.create_error-211"><span class="linenos">211</span></a><span class="sd">            code: JSON-RPC error code</span>
</span><span id="MCPErrorHandler.create_error-212"><a href="#MCPErrorHandler.create_error-212"><span class="linenos">212</span></a><span class="sd">            message: Human-readable error message</span>
</span><span id="MCPErrorHandler.create_error-213"><a href="#MCPErrorHandler.create_error-213"><span class="linenos">213</span></a><span class="sd">            data: Additional error data (optional)</span>
</span><span id="MCPErrorHandler.create_error-214"><a href="#MCPErrorHandler.create_error-214"><span class="linenos">214</span></a><span class="sd">            request_id: Request ID for correlation (optional)</span>
</span><span id="MCPErrorHandler.create_error-215"><a href="#MCPErrorHandler.create_error-215"><span class="linenos">215</span></a>
</span><span id="MCPErrorHandler.create_error-216"><a href="#MCPErrorHandler.create_error-216"><span class="linenos">216</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_error-217"><a href="#MCPErrorHandler.create_error-217"><span class="linenos">217</span></a><span class="sd">            Dictionary containing the JSON-RPC error response.</span>
</span><span id="MCPErrorHandler.create_error-218"><a href="#MCPErrorHandler.create_error-218"><span class="linenos">218</span></a>
</span><span id="MCPErrorHandler.create_error-219"><a href="#MCPErrorHandler.create_error-219"><span class="linenos">219</span></a><span class="sd">        Example:</span>
</span><span id="MCPErrorHandler.create_error-220"><a href="#MCPErrorHandler.create_error-220"><span class="linenos">220</span></a><span class="sd">            &gt;&gt;&gt; error = error_handler.create_error(</span>
</span><span id="MCPErrorHandler.create_error-221"><a href="#MCPErrorHandler.create_error-221"><span class="linenos">221</span></a><span class="sd">            ...     MCPErrorHandler.INVALID_PARAMS,</span>
</span><span id="MCPErrorHandler.create_error-222"><a href="#MCPErrorHandler.create_error-222"><span class="linenos">222</span></a><span class="sd">            ...     &quot;Invalid parameters provided&quot;,</span>
</span><span id="MCPErrorHandler.create_error-223"><a href="#MCPErrorHandler.create_error-223"><span class="linenos">223</span></a><span class="sd">            ...     {&quot;field&quot;: &quot;time_range&quot;, &quot;issue&quot;: &quot;must be positive&quot;}</span>
</span><span id="MCPErrorHandler.create_error-224"><a href="#MCPErrorHandler.create_error-224"><span class="linenos">224</span></a><span class="sd">            ... )</span>
</span><span id="MCPErrorHandler.create_error-225"><a href="#MCPErrorHandler.create_error-225"><span class="linenos">225</span></a>
</span><span id="MCPErrorHandler.create_error-226"><a href="#MCPErrorHandler.create_error-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_error-227"><a href="#MCPErrorHandler.create_error-227"><span class="linenos">227</span></a>        <span class="n">error_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_error-228"><a href="#MCPErrorHandler.create_error-228"><span class="linenos">228</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-229"><a href="#MCPErrorHandler.create_error-229"><span class="linenos">229</span></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_error-230"><a href="#MCPErrorHandler.create_error-230"><span class="linenos">230</span></a>                <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-231"><a href="#MCPErrorHandler.create_error-231"><span class="linenos">231</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-232"><a href="#MCPErrorHandler.create_error-232"><span class="linenos">232</span></a>            <span class="p">},</span>
</span><span id="MCPErrorHandler.create_error-233"><a href="#MCPErrorHandler.create_error-233"><span class="linenos">233</span></a>        <span class="p">}</span>
</span><span id="MCPErrorHandler.create_error-234"><a href="#MCPErrorHandler.create_error-234"><span class="linenos">234</span></a>
</span><span id="MCPErrorHandler.create_error-235"><a href="#MCPErrorHandler.create_error-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_error-236"><a href="#MCPErrorHandler.create_error-236"><span class="linenos">236</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_error-237"><a href="#MCPErrorHandler.create_error-237"><span class="linenos">237</span></a>
</span><span id="MCPErrorHandler.create_error-238"><a href="#MCPErrorHandler.create_error-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">request_id</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_error-239"><a href="#MCPErrorHandler.create_error-239"><span class="linenos">239</span></a>            <span class="n">error_response</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="MCPErrorHandler.create_error-240"><a href="#MCPErrorHandler.create_error-240"><span class="linenos">240</span></a>
</span><span id="MCPErrorHandler.create_error-241"><a href="#MCPErrorHandler.create_error-241"><span class="linenos">241</span></a>        <span class="c1"># Log error to stderr for debugging</span>
</span><span id="MCPErrorHandler.create_error-242"><a href="#MCPErrorHandler.create_error-242"><span class="linenos">242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">request_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler.create_error-243"><a href="#MCPErrorHandler.create_error-243"><span class="linenos">243</span></a>
</span><span id="MCPErrorHandler.create_error-244"><a href="#MCPErrorHandler.create_error-244"><span class="linenos">244</span></a>        <span class="c1"># Record error with aggregator for Phase 3 analytics</span>
</span><span id="MCPErrorHandler.create_error-245"><a href="#MCPErrorHandler.create_error-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_error-246"><a href="#MCPErrorHandler.create_error-246"><span class="linenos">246</span></a>            <span class="n">error_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span><span id="MCPErrorHandler.create_error-247"><a href="#MCPErrorHandler.create_error-247"><span class="linenos">247</span></a>            <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_error-248"><a href="#MCPErrorHandler.create_error-248"><span class="linenos">248</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-249"><a href="#MCPErrorHandler.create_error-249"><span class="linenos">249</span></a>                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_error-250"><a href="#MCPErrorHandler.create_error-250"><span class="linenos">250</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler.create_error-251"><a href="#MCPErrorHandler.create_error-251"><span class="linenos">251</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_error-252"><a href="#MCPErrorHandler.create_error-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_error-253"><a href="#MCPErrorHandler.create_error-253"><span class="linenos">253</span></a>                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;error_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_error-254"><a href="#MCPErrorHandler.create_error-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">record_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="MCPErrorHandler.create_error-255"><a href="#MCPErrorHandler.create_error-255"><span class="linenos">255</span></a>
</span><span id="MCPErrorHandler.create_error-256"><a href="#MCPErrorHandler.create_error-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="n">error_response</span>
</span></pre></div>


            <div class="docstring"><p>Create a properly formatted JSON-RPC error response.</p>

<p>Args:
    code: JSON-RPC error code
    message: Human-readable error message
    data: Additional error data (optional)
    request_id: Request ID for correlation (optional)</p>

<p>Returns:
    Dictionary containing the JSON-RPC error response.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>error = error_handler.create_error(
          ...     <a href="#MCPErrorHandler.INVALID_PARAMS">MCPErrorHandler.INVALID_PARAMS</a>,
          ...     "Invalid parameters provided",
          ...     {"field": "time_range", "issue": "must be positive"}
          ... )</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_parse_error" class="classattr">
                                        <input id="MCPErrorHandler.create_parse_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_parse_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Parse error&#39;</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_parse_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_parse_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_parse_error-286"><a href="#MCPErrorHandler.create_parse_error-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_parse_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_parse_error-287"><a href="#MCPErrorHandler.create_parse_error-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Parse error&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_parse_error-288"><a href="#MCPErrorHandler.create_parse_error-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_parse_error-289"><a href="#MCPErrorHandler.create_parse_error-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a parse error response.</span>
</span><span id="MCPErrorHandler.create_parse_error-290"><a href="#MCPErrorHandler.create_parse_error-290"><span class="linenos">290</span></a>
</span><span id="MCPErrorHandler.create_parse_error-291"><a href="#MCPErrorHandler.create_parse_error-291"><span class="linenos">291</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_parse_error-292"><a href="#MCPErrorHandler.create_parse_error-292"><span class="linenos">292</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler.create_parse_error-293"><a href="#MCPErrorHandler.create_parse_error-293"><span class="linenos">293</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_parse_error-294"><a href="#MCPErrorHandler.create_parse_error-294"><span class="linenos">294</span></a>
</span><span id="MCPErrorHandler.create_parse_error-295"><a href="#MCPErrorHandler.create_parse_error-295"><span class="linenos">295</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_parse_error-296"><a href="#MCPErrorHandler.create_parse_error-296"><span class="linenos">296</span></a><span class="sd">            Parse error response.</span>
</span><span id="MCPErrorHandler.create_parse_error-297"><a href="#MCPErrorHandler.create_parse_error-297"><span class="linenos">297</span></a>
</span><span id="MCPErrorHandler.create_parse_error-298"><a href="#MCPErrorHandler.create_parse_error-298"><span class="linenos">298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_parse_error-299"><a href="#MCPErrorHandler.create_parse_error-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a parse error response.</p>

<p>Args:
    message: Error message
    data: Additional error data</p>

<p>Returns:
    Parse error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_invalid_request_error" class="classattr">
                                        <input id="MCPErrorHandler.create_invalid_request_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_invalid_request_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Invalid request&#39;</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_invalid_request_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_invalid_request_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_invalid_request_error-301"><a href="#MCPErrorHandler.create_invalid_request_error-301"><span class="linenos">301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_request_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-302"><a href="#MCPErrorHandler.create_invalid_request_error-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid request&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-303"><a href="#MCPErrorHandler.create_invalid_request_error-303"><span class="linenos">303</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-304"><a href="#MCPErrorHandler.create_invalid_request_error-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid request error response.</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-305"><a href="#MCPErrorHandler.create_invalid_request_error-305"><span class="linenos">305</span></a>
</span><span id="MCPErrorHandler.create_invalid_request_error-306"><a href="#MCPErrorHandler.create_invalid_request_error-306"><span class="linenos">306</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-307"><a href="#MCPErrorHandler.create_invalid_request_error-307"><span class="linenos">307</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-308"><a href="#MCPErrorHandler.create_invalid_request_error-308"><span class="linenos">308</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-309"><a href="#MCPErrorHandler.create_invalid_request_error-309"><span class="linenos">309</span></a>
</span><span id="MCPErrorHandler.create_invalid_request_error-310"><a href="#MCPErrorHandler.create_invalid_request_error-310"><span class="linenos">310</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-311"><a href="#MCPErrorHandler.create_invalid_request_error-311"><span class="linenos">311</span></a><span class="sd">            Invalid request error response.</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-312"><a href="#MCPErrorHandler.create_invalid_request_error-312"><span class="linenos">312</span></a>
</span><span id="MCPErrorHandler.create_invalid_request_error-313"><a href="#MCPErrorHandler.create_invalid_request_error-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_invalid_request_error-314"><a href="#MCPErrorHandler.create_invalid_request_error-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an invalid request error response.</p>

<p>Args:
    message: Error message
    data: Additional error data</p>

<p>Returns:
    Invalid request error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_method_not_found_error" class="classattr">
                                        <input id="MCPErrorHandler.create_method_not_found_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_method_not_found_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_method_not_found_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_method_not_found_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_method_not_found_error-316"><a href="#MCPErrorHandler.create_method_not_found_error-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_method_not_found_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-317"><a href="#MCPErrorHandler.create_method_not_found_error-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-318"><a href="#MCPErrorHandler.create_method_not_found_error-318"><span class="linenos">318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-319"><a href="#MCPErrorHandler.create_method_not_found_error-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a method not found error response.</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-320"><a href="#MCPErrorHandler.create_method_not_found_error-320"><span class="linenos">320</span></a>
</span><span id="MCPErrorHandler.create_method_not_found_error-321"><a href="#MCPErrorHandler.create_method_not_found_error-321"><span class="linenos">321</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-322"><a href="#MCPErrorHandler.create_method_not_found_error-322"><span class="linenos">322</span></a><span class="sd">            method: Method name that was not found</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-323"><a href="#MCPErrorHandler.create_method_not_found_error-323"><span class="linenos">323</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-324"><a href="#MCPErrorHandler.create_method_not_found_error-324"><span class="linenos">324</span></a>
</span><span id="MCPErrorHandler.create_method_not_found_error-325"><a href="#MCPErrorHandler.create_method_not_found_error-325"><span class="linenos">325</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-326"><a href="#MCPErrorHandler.create_method_not_found_error-326"><span class="linenos">326</span></a><span class="sd">            Method not found error response.</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-327"><a href="#MCPErrorHandler.create_method_not_found_error-327"><span class="linenos">327</span></a>
</span><span id="MCPErrorHandler.create_method_not_found_error-328"><a href="#MCPErrorHandler.create_method_not_found_error-328"><span class="linenos">328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-329"><a href="#MCPErrorHandler.create_method_not_found_error-329"><span class="linenos">329</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-330"><a href="#MCPErrorHandler.create_method_not_found_error-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-331"><a href="#MCPErrorHandler.create_method_not_found_error-331"><span class="linenos">331</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">}</span>
</span><span id="MCPErrorHandler.create_method_not_found_error-332"><a href="#MCPErrorHandler.create_method_not_found_error-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a method not found error response.</p>

<p>Args:
    method: Method name that was not found
    data: Additional error data</p>

<p>Returns:
    Method not found error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_invalid_params_error" class="classattr">
                                        <input id="MCPErrorHandler.create_invalid_params_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_invalid_params_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_invalid_params_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_invalid_params_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_invalid_params_error-334"><a href="#MCPErrorHandler.create_invalid_params_error-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_invalid_params_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-335"><a href="#MCPErrorHandler.create_invalid_params_error-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-336"><a href="#MCPErrorHandler.create_invalid_params_error-336"><span class="linenos">336</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-337"><a href="#MCPErrorHandler.create_invalid_params_error-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an invalid parameters error response.</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-338"><a href="#MCPErrorHandler.create_invalid_params_error-338"><span class="linenos">338</span></a>
</span><span id="MCPErrorHandler.create_invalid_params_error-339"><a href="#MCPErrorHandler.create_invalid_params_error-339"><span class="linenos">339</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-340"><a href="#MCPErrorHandler.create_invalid_params_error-340"><span class="linenos">340</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-341"><a href="#MCPErrorHandler.create_invalid_params_error-341"><span class="linenos">341</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-342"><a href="#MCPErrorHandler.create_invalid_params_error-342"><span class="linenos">342</span></a>
</span><span id="MCPErrorHandler.create_invalid_params_error-343"><a href="#MCPErrorHandler.create_invalid_params_error-343"><span class="linenos">343</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-344"><a href="#MCPErrorHandler.create_invalid_params_error-344"><span class="linenos">344</span></a><span class="sd">            Invalid parameters error response.</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-345"><a href="#MCPErrorHandler.create_invalid_params_error-345"><span class="linenos">345</span></a>
</span><span id="MCPErrorHandler.create_invalid_params_error-346"><a href="#MCPErrorHandler.create_invalid_params_error-346"><span class="linenos">346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_invalid_params_error-347"><a href="#MCPErrorHandler.create_invalid_params_error-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an invalid parameters error response.</p>

<p>Args:
    message: Error message
    data: Additional error data</p>

<p>Returns:
    Invalid parameters error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_internal_error" class="classattr">
                                        <input id="MCPErrorHandler.create_internal_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_internal_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_internal_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_internal_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_internal_error-349"><a href="#MCPErrorHandler.create_internal_error-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_internal_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_internal_error-350"><a href="#MCPErrorHandler.create_internal_error-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_internal_error-351"><a href="#MCPErrorHandler.create_internal_error-351"><span class="linenos">351</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_internal_error-352"><a href="#MCPErrorHandler.create_internal_error-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an internal error response.</span>
</span><span id="MCPErrorHandler.create_internal_error-353"><a href="#MCPErrorHandler.create_internal_error-353"><span class="linenos">353</span></a>
</span><span id="MCPErrorHandler.create_internal_error-354"><a href="#MCPErrorHandler.create_internal_error-354"><span class="linenos">354</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_internal_error-355"><a href="#MCPErrorHandler.create_internal_error-355"><span class="linenos">355</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler.create_internal_error-356"><a href="#MCPErrorHandler.create_internal_error-356"><span class="linenos">356</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_internal_error-357"><a href="#MCPErrorHandler.create_internal_error-357"><span class="linenos">357</span></a>
</span><span id="MCPErrorHandler.create_internal_error-358"><a href="#MCPErrorHandler.create_internal_error-358"><span class="linenos">358</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_internal_error-359"><a href="#MCPErrorHandler.create_internal_error-359"><span class="linenos">359</span></a><span class="sd">            Internal error response.</span>
</span><span id="MCPErrorHandler.create_internal_error-360"><a href="#MCPErrorHandler.create_internal_error-360"><span class="linenos">360</span></a>
</span><span id="MCPErrorHandler.create_internal_error-361"><a href="#MCPErrorHandler.create_internal_error-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_internal_error-362"><a href="#MCPErrorHandler.create_internal_error-362"><span class="linenos">362</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an internal error response.</p>

<p>Args:
    message: Error message
    data: Additional error data</p>

<p>Returns:
    Internal error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_validation_error" class="classattr">
                                        <input id="MCPErrorHandler.create_validation_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_validation_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">validation_error</span><span class="p">:</span> <span class="n">pydantic_core</span><span class="o">.</span><span class="n">_pydantic_core</span><span class="o">.</span><span class="n">ValidationError</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_validation_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_validation_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_validation_error-364"><a href="#MCPErrorHandler.create_validation_error-364"><span class="linenos">364</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_validation_error-365"><a href="#MCPErrorHandler.create_validation_error-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_validation_error-366"><a href="#MCPErrorHandler.create_validation_error-366"><span class="linenos">366</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_validation_error-367"><a href="#MCPErrorHandler.create_validation_error-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response.</span>
</span><span id="MCPErrorHandler.create_validation_error-368"><a href="#MCPErrorHandler.create_validation_error-368"><span class="linenos">368</span></a>
</span><span id="MCPErrorHandler.create_validation_error-369"><a href="#MCPErrorHandler.create_validation_error-369"><span class="linenos">369</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_validation_error-370"><a href="#MCPErrorHandler.create_validation_error-370"><span class="linenos">370</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="MCPErrorHandler.create_validation_error-371"><a href="#MCPErrorHandler.create_validation_error-371"><span class="linenos">371</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="MCPErrorHandler.create_validation_error-372"><a href="#MCPErrorHandler.create_validation_error-372"><span class="linenos">372</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_validation_error-373"><a href="#MCPErrorHandler.create_validation_error-373"><span class="linenos">373</span></a>
</span><span id="MCPErrorHandler.create_validation_error-374"><a href="#MCPErrorHandler.create_validation_error-374"><span class="linenos">374</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_validation_error-375"><a href="#MCPErrorHandler.create_validation_error-375"><span class="linenos">375</span></a><span class="sd">            Validation error response.</span>
</span><span id="MCPErrorHandler.create_validation_error-376"><a href="#MCPErrorHandler.create_validation_error-376"><span class="linenos">376</span></a>
</span><span id="MCPErrorHandler.create_validation_error-377"><a href="#MCPErrorHandler.create_validation_error-377"><span class="linenos">377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_validation_error-378"><a href="#MCPErrorHandler.create_validation_error-378"><span class="linenos">378</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid parameters for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="MCPErrorHandler.create_validation_error-379"><a href="#MCPErrorHandler.create_validation_error-379"><span class="linenos">379</span></a>
</span><span id="MCPErrorHandler.create_validation_error-380"><a href="#MCPErrorHandler.create_validation_error-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_validation_error-381"><a href="#MCPErrorHandler.create_validation_error-381"><span class="linenos">381</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_validation_error-382"><a href="#MCPErrorHandler.create_validation_error-382"><span class="linenos">382</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error-383"><a href="#MCPErrorHandler.create_validation_error-383"><span class="linenos">383</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">(),</span>
</span><span id="MCPErrorHandler.create_validation_error-384"><a href="#MCPErrorHandler.create_validation_error-384"><span class="linenos">384</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please check the tool schema and provide valid parameters&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error-385"><a href="#MCPErrorHandler.create_validation_error-385"><span class="linenos">385</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_validation_error-386"><a href="#MCPErrorHandler.create_validation_error-386"><span class="linenos">386</span></a>
</span><span id="MCPErrorHandler.create_validation_error-387"><a href="#MCPErrorHandler.create_validation_error-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a validation error response.</p>

<p>Args:
    tool_name: Name of the tool that failed validation
    validation_error: Pydantic validation error
    data: Additional error data</p>

<p>Returns:
    Validation error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_timeout_error" class="classattr">
                                        <input id="MCPErrorHandler.create_timeout_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_timeout_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_timeout_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_timeout_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_timeout_error-389"><a href="#MCPErrorHandler.create_timeout_error-389"><span class="linenos">389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_timeout_error-390"><a href="#MCPErrorHandler.create_timeout_error-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_timeout_error-391"><a href="#MCPErrorHandler.create_timeout_error-391"><span class="linenos">391</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_timeout_error-392"><a href="#MCPErrorHandler.create_timeout_error-392"><span class="linenos">392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response.</span>
</span><span id="MCPErrorHandler.create_timeout_error-393"><a href="#MCPErrorHandler.create_timeout_error-393"><span class="linenos">393</span></a>
</span><span id="MCPErrorHandler.create_timeout_error-394"><a href="#MCPErrorHandler.create_timeout_error-394"><span class="linenos">394</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_timeout_error-395"><a href="#MCPErrorHandler.create_timeout_error-395"><span class="linenos">395</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="MCPErrorHandler.create_timeout_error-396"><a href="#MCPErrorHandler.create_timeout_error-396"><span class="linenos">396</span></a><span class="sd">            timeout_seconds: Timeout value in seconds</span>
</span><span id="MCPErrorHandler.create_timeout_error-397"><a href="#MCPErrorHandler.create_timeout_error-397"><span class="linenos">397</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_timeout_error-398"><a href="#MCPErrorHandler.create_timeout_error-398"><span class="linenos">398</span></a>
</span><span id="MCPErrorHandler.create_timeout_error-399"><a href="#MCPErrorHandler.create_timeout_error-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_timeout_error-400"><a href="#MCPErrorHandler.create_timeout_error-400"><span class="linenos">400</span></a><span class="sd">            Timeout error response.</span>
</span><span id="MCPErrorHandler.create_timeout_error-401"><a href="#MCPErrorHandler.create_timeout_error-401"><span class="linenos">401</span></a>
</span><span id="MCPErrorHandler.create_timeout_error-402"><a href="#MCPErrorHandler.create_timeout_error-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_timeout_error-403"><a href="#MCPErrorHandler.create_timeout_error-403"><span class="linenos">403</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; execution timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
</span><span id="MCPErrorHandler.create_timeout_error-404"><a href="#MCPErrorHandler.create_timeout_error-404"><span class="linenos">404</span></a>
</span><span id="MCPErrorHandler.create_timeout_error-405"><a href="#MCPErrorHandler.create_timeout_error-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_timeout_error-406"><a href="#MCPErrorHandler.create_timeout_error-406"><span class="linenos">406</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_timeout_error-407"><a href="#MCPErrorHandler.create_timeout_error-407"><span class="linenos">407</span></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error-408"><a href="#MCPErrorHandler.create_timeout_error-408"><span class="linenos">408</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error-409"><a href="#MCPErrorHandler.create_timeout_error-409"><span class="linenos">409</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try reducing the scope of your request or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error-410"><a href="#MCPErrorHandler.create_timeout_error-410"><span class="linenos">410</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_timeout_error-411"><a href="#MCPErrorHandler.create_timeout_error-411"><span class="linenos">411</span></a>
</span><span id="MCPErrorHandler.create_timeout_error-412"><a href="#MCPErrorHandler.create_timeout_error-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a timeout error response.</p>

<p>Args:
    tool_name: Name of the tool that timed out
    timeout_seconds: Timeout value in seconds
    data: Additional error data</p>

<p>Returns:
    Timeout error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_resource_error" class="classattr">
                                        <input id="MCPErrorHandler.create_resource_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_resource_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_resource_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_resource_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_resource_error-414"><a href="#MCPErrorHandler.create_resource_error-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_error-415"><a href="#MCPErrorHandler.create_resource_error-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_resource_error-416"><a href="#MCPErrorHandler.create_resource_error-416"><span class="linenos">416</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_resource_error-417"><a href="#MCPErrorHandler.create_resource_error-417"><span class="linenos">417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource-related error response.</span>
</span><span id="MCPErrorHandler.create_resource_error-418"><a href="#MCPErrorHandler.create_resource_error-418"><span class="linenos">418</span></a>
</span><span id="MCPErrorHandler.create_resource_error-419"><a href="#MCPErrorHandler.create_resource_error-419"><span class="linenos">419</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_resource_error-420"><a href="#MCPErrorHandler.create_resource_error-420"><span class="linenos">420</span></a><span class="sd">            resource_uri: URI of the resource that caused the error</span>
</span><span id="MCPErrorHandler.create_resource_error-421"><a href="#MCPErrorHandler.create_resource_error-421"><span class="linenos">421</span></a><span class="sd">            error_type: Type of resource error</span>
</span><span id="MCPErrorHandler.create_resource_error-422"><a href="#MCPErrorHandler.create_resource_error-422"><span class="linenos">422</span></a><span class="sd">            message: Error message</span>
</span><span id="MCPErrorHandler.create_resource_error-423"><a href="#MCPErrorHandler.create_resource_error-423"><span class="linenos">423</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_resource_error-424"><a href="#MCPErrorHandler.create_resource_error-424"><span class="linenos">424</span></a>
</span><span id="MCPErrorHandler.create_resource_error-425"><a href="#MCPErrorHandler.create_resource_error-425"><span class="linenos">425</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_resource_error-426"><a href="#MCPErrorHandler.create_resource_error-426"><span class="linenos">426</span></a><span class="sd">            Resource error response.</span>
</span><span id="MCPErrorHandler.create_resource_error-427"><a href="#MCPErrorHandler.create_resource_error-427"><span class="linenos">427</span></a>
</span><span id="MCPErrorHandler.create_resource_error-428"><a href="#MCPErrorHandler.create_resource_error-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_resource_error-429"><a href="#MCPErrorHandler.create_resource_error-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;not_found&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_error-430"><a href="#MCPErrorHandler.create_resource_error-430"><span class="linenos">430</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span>
</span><span id="MCPErrorHandler.create_resource_error-431"><a href="#MCPErrorHandler.create_resource_error-431"><span class="linenos">431</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;access_denied&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_error-432"><a href="#MCPErrorHandler.create_resource_error-432"><span class="linenos">432</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span>
</span><span id="MCPErrorHandler.create_resource_error-433"><a href="#MCPErrorHandler.create_resource_error-433"><span class="linenos">433</span></a>        <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;unavailable&quot;</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_error-434"><a href="#MCPErrorHandler.create_resource_error-434"><span class="linenos">434</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span>
</span><span id="MCPErrorHandler.create_resource_error-435"><a href="#MCPErrorHandler.create_resource_error-435"><span class="linenos">435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_error-436"><a href="#MCPErrorHandler.create_resource_error-436"><span class="linenos">436</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span>
</span><span id="MCPErrorHandler.create_resource_error-437"><a href="#MCPErrorHandler.create_resource_error-437"><span class="linenos">437</span></a>
</span><span id="MCPErrorHandler.create_resource_error-438"><a href="#MCPErrorHandler.create_resource_error-438"><span class="linenos">438</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_error-439"><a href="#MCPErrorHandler.create_resource_error-439"><span class="linenos">439</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_resource_error-440"><a href="#MCPErrorHandler.create_resource_error-440"><span class="linenos">440</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_error-441"><a href="#MCPErrorHandler.create_resource_error-441"><span class="linenos">441</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_error-442"><a href="#MCPErrorHandler.create_resource_error-442"><span class="linenos">442</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and your permissions&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_error-443"><a href="#MCPErrorHandler.create_resource_error-443"><span class="linenos">443</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_resource_error-444"><a href="#MCPErrorHandler.create_resource_error-444"><span class="linenos">444</span></a>
</span><span id="MCPErrorHandler.create_resource_error-445"><a href="#MCPErrorHandler.create_resource_error-445"><span class="linenos">445</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a resource-related error response.</p>

<p>Args:
    resource_uri: URI of the resource that caused the error
    error_type: Type of resource error
    message: Error message
    data: Additional error data</p>

<p>Returns:
    Resource error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_external_service_error" class="classattr">
                                        <input id="MCPErrorHandler.create_external_service_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_external_service_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_external_service_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_external_service_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_external_service_error-447"><a href="#MCPErrorHandler.create_external_service_error-447"><span class="linenos">447</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_external_service_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_external_service_error-448"><a href="#MCPErrorHandler.create_external_service_error-448"><span class="linenos">448</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_external_service_error-449"><a href="#MCPErrorHandler.create_external_service_error-449"><span class="linenos">449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_external_service_error-450"><a href="#MCPErrorHandler.create_external_service_error-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an external service error response.</span>
</span><span id="MCPErrorHandler.create_external_service_error-451"><a href="#MCPErrorHandler.create_external_service_error-451"><span class="linenos">451</span></a>
</span><span id="MCPErrorHandler.create_external_service_error-452"><a href="#MCPErrorHandler.create_external_service_error-452"><span class="linenos">452</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_external_service_error-453"><a href="#MCPErrorHandler.create_external_service_error-453"><span class="linenos">453</span></a><span class="sd">            service_name: Name of the external service</span>
</span><span id="MCPErrorHandler.create_external_service_error-454"><a href="#MCPErrorHandler.create_external_service_error-454"><span class="linenos">454</span></a><span class="sd">            error_message: Error message from the service</span>
</span><span id="MCPErrorHandler.create_external_service_error-455"><a href="#MCPErrorHandler.create_external_service_error-455"><span class="linenos">455</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_external_service_error-456"><a href="#MCPErrorHandler.create_external_service_error-456"><span class="linenos">456</span></a>
</span><span id="MCPErrorHandler.create_external_service_error-457"><a href="#MCPErrorHandler.create_external_service_error-457"><span class="linenos">457</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_external_service_error-458"><a href="#MCPErrorHandler.create_external_service_error-458"><span class="linenos">458</span></a><span class="sd">            External service error response.</span>
</span><span id="MCPErrorHandler.create_external_service_error-459"><a href="#MCPErrorHandler.create_external_service_error-459"><span class="linenos">459</span></a>
</span><span id="MCPErrorHandler.create_external_service_error-460"><a href="#MCPErrorHandler.create_external_service_error-460"><span class="linenos">460</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_external_service_error-461"><a href="#MCPErrorHandler.create_external_service_error-461"><span class="linenos">461</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;External service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MCPErrorHandler.create_external_service_error-462"><a href="#MCPErrorHandler.create_external_service_error-462"><span class="linenos">462</span></a>
</span><span id="MCPErrorHandler.create_external_service_error-463"><a href="#MCPErrorHandler.create_external_service_error-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_external_service_error-464"><a href="#MCPErrorHandler.create_external_service_error-464"><span class="linenos">464</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_external_service_error-465"><a href="#MCPErrorHandler.create_external_service_error-465"><span class="linenos">465</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_external_service_error-466"><a href="#MCPErrorHandler.create_external_service_error-466"><span class="linenos">466</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The service may be temporarily unavailable. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_external_service_error-467"><a href="#MCPErrorHandler.create_external_service_error-467"><span class="linenos">467</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_external_service_error-468"><a href="#MCPErrorHandler.create_external_service_error-468"><span class="linenos">468</span></a>
</span><span id="MCPErrorHandler.create_external_service_error-469"><a href="#MCPErrorHandler.create_external_service_error-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an external service error response.</p>

<p>Args:
    service_name: Name of the external service
    error_message: Error message from the service
    data: Additional error data</p>

<p>Returns:
    External service error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_rate_limit_error" class="classattr">
                                        <input id="MCPErrorHandler.create_rate_limit_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_rate_limit_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">retry_after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_rate_limit_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_rate_limit_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_rate_limit_error-471"><a href="#MCPErrorHandler.create_rate_limit_error-471"><span class="linenos">471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_rate_limit_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-472"><a href="#MCPErrorHandler.create_rate_limit_error-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-473"><a href="#MCPErrorHandler.create_rate_limit_error-473"><span class="linenos">473</span></a>        <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-474"><a href="#MCPErrorHandler.create_rate_limit_error-474"><span class="linenos">474</span></a>        <span class="n">retry_after</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-475"><a href="#MCPErrorHandler.create_rate_limit_error-475"><span class="linenos">475</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-476"><a href="#MCPErrorHandler.create_rate_limit_error-476"><span class="linenos">476</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-477"><a href="#MCPErrorHandler.create_rate_limit_error-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a rate limit error response.</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-478"><a href="#MCPErrorHandler.create_rate_limit_error-478"><span class="linenos">478</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-479"><a href="#MCPErrorHandler.create_rate_limit_error-479"><span class="linenos">479</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-480"><a href="#MCPErrorHandler.create_rate_limit_error-480"><span class="linenos">480</span></a><span class="sd">            service_name: Name of the service that rate limited the request</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-481"><a href="#MCPErrorHandler.create_rate_limit_error-481"><span class="linenos">481</span></a><span class="sd">            retry_after: Suggested retry delay in seconds</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-482"><a href="#MCPErrorHandler.create_rate_limit_error-482"><span class="linenos">482</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-483"><a href="#MCPErrorHandler.create_rate_limit_error-483"><span class="linenos">483</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-484"><a href="#MCPErrorHandler.create_rate_limit_error-484"><span class="linenos">484</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-485"><a href="#MCPErrorHandler.create_rate_limit_error-485"><span class="linenos">485</span></a><span class="sd">            Rate limit error response.</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-486"><a href="#MCPErrorHandler.create_rate_limit_error-486"><span class="linenos">486</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-487"><a href="#MCPErrorHandler.create_rate_limit_error-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-488"><a href="#MCPErrorHandler.create_rate_limit_error-488"><span class="linenos">488</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-489"><a href="#MCPErrorHandler.create_rate_limit_error-489"><span class="linenos">489</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-490"><a href="#MCPErrorHandler.create_rate_limit_error-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-491"><a href="#MCPErrorHandler.create_rate_limit_error-491"><span class="linenos">491</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-492"><a href="#MCPErrorHandler.create_rate_limit_error-492"><span class="linenos">492</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-493"><a href="#MCPErrorHandler.create_rate_limit_error-493"><span class="linenos">493</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Please wait before making additional requests&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-494"><a href="#MCPErrorHandler.create_rate_limit_error-494"><span class="linenos">494</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-495"><a href="#MCPErrorHandler.create_rate_limit_error-495"><span class="linenos">495</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-496"><a href="#MCPErrorHandler.create_rate_limit_error-496"><span class="linenos">496</span></a>            <span class="k">if</span> <span class="n">retry_after</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-497"><a href="#MCPErrorHandler.create_rate_limit_error-497"><span class="linenos">497</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;retry_after_seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retry_after</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-498"><a href="#MCPErrorHandler.create_rate_limit_error-498"><span class="linenos">498</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;suggestion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Please wait </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds before retrying&quot;</span>
</span><span id="MCPErrorHandler.create_rate_limit_error-499"><a href="#MCPErrorHandler.create_rate_limit_error-499"><span class="linenos">499</span></a>
</span><span id="MCPErrorHandler.create_rate_limit_error-500"><a href="#MCPErrorHandler.create_rate_limit_error-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a rate limit error response.</p>

<p>Args:
    service_name: Name of the service that rate limited the request
    retry_after: Suggested retry delay in seconds
    data: Additional error data</p>

<p>Returns:
    Rate limit error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_security_error" class="classattr">
                                        <input id="MCPErrorHandler.create_security_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_security_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_security_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_security_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_security_error-502"><a href="#MCPErrorHandler.create_security_error-502"><span class="linenos">502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_security_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_security_error-503"><a href="#MCPErrorHandler.create_security_error-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_security_error-504"><a href="#MCPErrorHandler.create_security_error-504"><span class="linenos">504</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_security_error-505"><a href="#MCPErrorHandler.create_security_error-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a security error response.</span>
</span><span id="MCPErrorHandler.create_security_error-506"><a href="#MCPErrorHandler.create_security_error-506"><span class="linenos">506</span></a>
</span><span id="MCPErrorHandler.create_security_error-507"><a href="#MCPErrorHandler.create_security_error-507"><span class="linenos">507</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_security_error-508"><a href="#MCPErrorHandler.create_security_error-508"><span class="linenos">508</span></a><span class="sd">            message: Security error message</span>
</span><span id="MCPErrorHandler.create_security_error-509"><a href="#MCPErrorHandler.create_security_error-509"><span class="linenos">509</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_security_error-510"><a href="#MCPErrorHandler.create_security_error-510"><span class="linenos">510</span></a>
</span><span id="MCPErrorHandler.create_security_error-511"><a href="#MCPErrorHandler.create_security_error-511"><span class="linenos">511</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_security_error-512"><a href="#MCPErrorHandler.create_security_error-512"><span class="linenos">512</span></a><span class="sd">            Security error response.</span>
</span><span id="MCPErrorHandler.create_security_error-513"><a href="#MCPErrorHandler.create_security_error-513"><span class="linenos">513</span></a>
</span><span id="MCPErrorHandler.create_security_error-514"><a href="#MCPErrorHandler.create_security_error-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_security_error-515"><a href="#MCPErrorHandler.create_security_error-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_security_error-516"><a href="#MCPErrorHandler.create_security_error-516"><span class="linenos">516</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_security_error-517"><a href="#MCPErrorHandler.create_security_error-517"><span class="linenos">517</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;security_violation&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_security_error-518"><a href="#MCPErrorHandler.create_security_error-518"><span class="linenos">518</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler.create_security_error-519"><a href="#MCPErrorHandler.create_security_error-519"><span class="linenos">519</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_security_error-520"><a href="#MCPErrorHandler.create_security_error-520"><span class="linenos">520</span></a>
</span><span id="MCPErrorHandler.create_security_error-521"><a href="#MCPErrorHandler.create_security_error-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SECURITY_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a security error response.</p>

<p>Args:
    message: Security error message
    data: Additional error data</p>

<p>Returns:
    Security error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_schema_validation_error" class="classattr">
                                        <input id="MCPErrorHandler.create_schema_validation_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_schema_validation_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_schema_validation_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_schema_validation_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_schema_validation_error-523"><a href="#MCPErrorHandler.create_schema_validation_error-523"><span class="linenos">523</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_schema_validation_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-524"><a href="#MCPErrorHandler.create_schema_validation_error-524"><span class="linenos">524</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-525"><a href="#MCPErrorHandler.create_schema_validation_error-525"><span class="linenos">525</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-526"><a href="#MCPErrorHandler.create_schema_validation_error-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a schema validation error response.</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-527"><a href="#MCPErrorHandler.create_schema_validation_error-527"><span class="linenos">527</span></a>
</span><span id="MCPErrorHandler.create_schema_validation_error-528"><a href="#MCPErrorHandler.create_schema_validation_error-528"><span class="linenos">528</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-529"><a href="#MCPErrorHandler.create_schema_validation_error-529"><span class="linenos">529</span></a><span class="sd">            message: Schema validation error message</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-530"><a href="#MCPErrorHandler.create_schema_validation_error-530"><span class="linenos">530</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-531"><a href="#MCPErrorHandler.create_schema_validation_error-531"><span class="linenos">531</span></a>
</span><span id="MCPErrorHandler.create_schema_validation_error-532"><a href="#MCPErrorHandler.create_schema_validation_error-532"><span class="linenos">532</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-533"><a href="#MCPErrorHandler.create_schema_validation_error-533"><span class="linenos">533</span></a><span class="sd">            Schema validation error response.</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-534"><a href="#MCPErrorHandler.create_schema_validation_error-534"><span class="linenos">534</span></a>
</span><span id="MCPErrorHandler.create_schema_validation_error-535"><a href="#MCPErrorHandler.create_schema_validation_error-535"><span class="linenos">535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-536"><a href="#MCPErrorHandler.create_schema_validation_error-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-537"><a href="#MCPErrorHandler.create_schema_validation_error-537"><span class="linenos">537</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-538"><a href="#MCPErrorHandler.create_schema_validation_error-538"><span class="linenos">538</span></a>                <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="s2">&quot;schema_validation_failed&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-539"><a href="#MCPErrorHandler.create_schema_validation_error-539"><span class="linenos">539</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-540"><a href="#MCPErrorHandler.create_schema_validation_error-540"><span class="linenos">540</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_schema_validation_error-541"><a href="#MCPErrorHandler.create_schema_validation_error-541"><span class="linenos">541</span></a>
</span><span id="MCPErrorHandler.create_schema_validation_error-542"><a href="#MCPErrorHandler.create_schema_validation_error-542"><span class="linenos">542</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEMA_VALIDATION_ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a schema validation error response.</p>

<p>Args:
    message: Schema validation error message
    data: Additional error data</p>

<p>Returns:
    Schema validation error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.validate_message_security" class="classattr">
                                        <input id="MCPErrorHandler.validate_message_security-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">validate_message_security</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">message</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">api_key_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.validate_message_security-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.validate_message_security"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.validate_message_security-544"><a href="#MCPErrorHandler.validate_message_security-544"><span class="linenos">544</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_message_security</span><span class="p">(</span>
</span><span id="MCPErrorHandler.validate_message_security-545"><a href="#MCPErrorHandler.validate_message_security-545"><span class="linenos">545</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">api_key_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.validate_message_security-546"><a href="#MCPErrorHandler.validate_message_security-546"><span class="linenos">546</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.validate_message_security-547"><a href="#MCPErrorHandler.validate_message_security-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate message security including schema validation and rate limiting.</span>
</span><span id="MCPErrorHandler.validate_message_security-548"><a href="#MCPErrorHandler.validate_message_security-548"><span class="linenos">548</span></a>
</span><span id="MCPErrorHandler.validate_message_security-549"><a href="#MCPErrorHandler.validate_message_security-549"><span class="linenos">549</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.validate_message_security-550"><a href="#MCPErrorHandler.validate_message_security-550"><span class="linenos">550</span></a><span class="sd">            message: Raw JSON message string</span>
</span><span id="MCPErrorHandler.validate_message_security-551"><a href="#MCPErrorHandler.validate_message_security-551"><span class="linenos">551</span></a><span class="sd">            connection_id: Connection ID for rate limiting</span>
</span><span id="MCPErrorHandler.validate_message_security-552"><a href="#MCPErrorHandler.validate_message_security-552"><span class="linenos">552</span></a><span class="sd">            api_key_id: API key ID for rate limiting</span>
</span><span id="MCPErrorHandler.validate_message_security-553"><a href="#MCPErrorHandler.validate_message_security-553"><span class="linenos">553</span></a>
</span><span id="MCPErrorHandler.validate_message_security-554"><a href="#MCPErrorHandler.validate_message_security-554"><span class="linenos">554</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.validate_message_security-555"><a href="#MCPErrorHandler.validate_message_security-555"><span class="linenos">555</span></a><span class="sd">            Error response if validation fails, None if valid</span>
</span><span id="MCPErrorHandler.validate_message_security-556"><a href="#MCPErrorHandler.validate_message_security-556"><span class="linenos">556</span></a>
</span><span id="MCPErrorHandler.validate_message_security-557"><a href="#MCPErrorHandler.validate_message_security-557"><span class="linenos">557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.validate_message_security-558"><a href="#MCPErrorHandler.validate_message_security-558"><span class="linenos">558</span></a>        <span class="c1"># Global rate limiting</span>
</span><span id="MCPErrorHandler.validate_message_security-559"><a href="#MCPErrorHandler.validate_message_security-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">():</span>
</span><span id="MCPErrorHandler.validate_message_security-560"><a href="#MCPErrorHandler.validate_message_security-560"><span class="linenos">560</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">()</span>
</span><span id="MCPErrorHandler.validate_message_security-561"><a href="#MCPErrorHandler.validate_message_security-561"><span class="linenos">561</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-562"><a href="#MCPErrorHandler.validate_message_security-562"><span class="linenos">562</span></a>
</span><span id="MCPErrorHandler.validate_message_security-563"><a href="#MCPErrorHandler.validate_message_security-563"><span class="linenos">563</span></a>        <span class="c1"># Connection rate limiting</span>
</span><span id="MCPErrorHandler.validate_message_security-564"><a href="#MCPErrorHandler.validate_message_security-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">connection_id</span><span class="p">):</span>
</span><span id="MCPErrorHandler.validate_message_security-565"><a href="#MCPErrorHandler.validate_message_security-565"><span class="linenos">565</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">connection_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-566"><a href="#MCPErrorHandler.validate_message_security-566"><span class="linenos">566</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;connection&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-567"><a href="#MCPErrorHandler.validate_message_security-567"><span class="linenos">567</span></a>
</span><span id="MCPErrorHandler.validate_message_security-568"><a href="#MCPErrorHandler.validate_message_security-568"><span class="linenos">568</span></a>        <span class="c1"># API key rate limiting</span>
</span><span id="MCPErrorHandler.validate_message_security-569"><a href="#MCPErrorHandler.validate_message_security-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="n">api_key_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">is_allowed</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">):</span>
</span><span id="MCPErrorHandler.validate_message_security-570"><a href="#MCPErrorHandler.validate_message_security-570"><span class="linenos">570</span></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key_rate_limiter</span><span class="o">.</span><span class="n">get_wait_time</span><span class="p">(</span><span class="n">api_key_id</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-571"><a href="#MCPErrorHandler.validate_message_security-571"><span class="linenos">571</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate_limit_error</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="n">retry_after</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-572"><a href="#MCPErrorHandler.validate_message_security-572"><span class="linenos">572</span></a>
</span><span id="MCPErrorHandler.validate_message_security-573"><a href="#MCPErrorHandler.validate_message_security-573"><span class="linenos">573</span></a>        <span class="c1"># Schema validation</span>
</span><span id="MCPErrorHandler.validate_message_security-574"><a href="#MCPErrorHandler.validate_message_security-574"><span class="linenos">574</span></a>        <span class="n">parsed_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_validator</span><span class="o">.</span><span class="n">validate_complete_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-575"><a href="#MCPErrorHandler.validate_message_security-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">parsed_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.validate_message_security-576"><a href="#MCPErrorHandler.validate_message_security-576"><span class="linenos">576</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_schema_validation_error</span><span class="p">(</span><span class="s2">&quot;Invalid message format or content&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_message_security-577"><a href="#MCPErrorHandler.validate_message_security-577"><span class="linenos">577</span></a>
</span><span id="MCPErrorHandler.validate_message_security-578"><a href="#MCPErrorHandler.validate_message_security-578"><span class="linenos">578</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Validate message security including schema validation and rate limiting.</p>

<p>Args:
    message: Raw JSON message string
    connection_id: Connection ID for rate limiting
    api_key_id: API key ID for rate limiting</p>

<p>Returns:
    Error response if validation fails, None if valid</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.validate_tool_exists" class="classattr">
                                        <input id="MCPErrorHandler.validate_tool_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_tool_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">available_tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.validate_tool_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.validate_tool_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.validate_tool_exists-580"><a href="#MCPErrorHandler.validate_tool_exists-580"><span class="linenos">580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">available_tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.validate_tool_exists-581"><a href="#MCPErrorHandler.validate_tool_exists-581"><span class="linenos">581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that a tool exists before execution.</span>
</span><span id="MCPErrorHandler.validate_tool_exists-582"><a href="#MCPErrorHandler.validate_tool_exists-582"><span class="linenos">582</span></a>
</span><span id="MCPErrorHandler.validate_tool_exists-583"><a href="#MCPErrorHandler.validate_tool_exists-583"><span class="linenos">583</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.validate_tool_exists-584"><a href="#MCPErrorHandler.validate_tool_exists-584"><span class="linenos">584</span></a><span class="sd">            tool_name: Name of the tool to validate</span>
</span><span id="MCPErrorHandler.validate_tool_exists-585"><a href="#MCPErrorHandler.validate_tool_exists-585"><span class="linenos">585</span></a><span class="sd">            available_tools: List of available tool names</span>
</span><span id="MCPErrorHandler.validate_tool_exists-586"><a href="#MCPErrorHandler.validate_tool_exists-586"><span class="linenos">586</span></a>
</span><span id="MCPErrorHandler.validate_tool_exists-587"><a href="#MCPErrorHandler.validate_tool_exists-587"><span class="linenos">587</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler.validate_tool_exists-588"><a href="#MCPErrorHandler.validate_tool_exists-588"><span class="linenos">588</span></a><span class="sd">            ValueError: If the tool does not exist.</span>
</span><span id="MCPErrorHandler.validate_tool_exists-589"><a href="#MCPErrorHandler.validate_tool_exists-589"><span class="linenos">589</span></a>
</span><span id="MCPErrorHandler.validate_tool_exists-590"><a href="#MCPErrorHandler.validate_tool_exists-590"><span class="linenos">590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.validate_tool_exists-591"><a href="#MCPErrorHandler.validate_tool_exists-591"><span class="linenos">591</span></a>        <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_tools</span><span class="p">:</span>
</span><span id="MCPErrorHandler.validate_tool_exists-592"><a href="#MCPErrorHandler.validate_tool_exists-592"><span class="linenos">592</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MCPErrorHandler.validate_tool_exists-593"><a href="#MCPErrorHandler.validate_tool_exists-593"><span class="linenos">593</span></a>                <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found. Available tools: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_tools</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MCPErrorHandler.validate_tool_exists-594"><a href="#MCPErrorHandler.validate_tool_exists-594"><span class="linenos">594</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate that a tool exists before execution.</p>

<p>Args:
    tool_name: Name of the tool to validate
    available_tools: List of available tool names</p>

<p>Raises:
    ValueError: If the tool does not exist.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.validate_arguments" class="classattr">
                                        <input id="MCPErrorHandler.validate_arguments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_arguments</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.validate_arguments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.validate_arguments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.validate_arguments-596"><a href="#MCPErrorHandler.validate_arguments-596"><span class="linenos">596</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_arguments</span><span class="p">(</span>
</span><span id="MCPErrorHandler.validate_arguments-597"><a href="#MCPErrorHandler.validate_arguments-597"><span class="linenos">597</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="MCPErrorHandler.validate_arguments-598"><a href="#MCPErrorHandler.validate_arguments-598"><span class="linenos">598</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.validate_arguments-599"><a href="#MCPErrorHandler.validate_arguments-599"><span class="linenos">599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate arguments against a tool schema.</span>
</span><span id="MCPErrorHandler.validate_arguments-600"><a href="#MCPErrorHandler.validate_arguments-600"><span class="linenos">600</span></a>
</span><span id="MCPErrorHandler.validate_arguments-601"><a href="#MCPErrorHandler.validate_arguments-601"><span class="linenos">601</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.validate_arguments-602"><a href="#MCPErrorHandler.validate_arguments-602"><span class="linenos">602</span></a><span class="sd">            tool_name: Name of the tool</span>
</span><span id="MCPErrorHandler.validate_arguments-603"><a href="#MCPErrorHandler.validate_arguments-603"><span class="linenos">603</span></a><span class="sd">            arguments: Arguments to validate</span>
</span><span id="MCPErrorHandler.validate_arguments-604"><a href="#MCPErrorHandler.validate_arguments-604"><span class="linenos">604</span></a><span class="sd">            schema: Tool schema for validation</span>
</span><span id="MCPErrorHandler.validate_arguments-605"><a href="#MCPErrorHandler.validate_arguments-605"><span class="linenos">605</span></a>
</span><span id="MCPErrorHandler.validate_arguments-606"><a href="#MCPErrorHandler.validate_arguments-606"><span class="linenos">606</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler.validate_arguments-607"><a href="#MCPErrorHandler.validate_arguments-607"><span class="linenos">607</span></a><span class="sd">            ValidationError: If arguments are invalid.</span>
</span><span id="MCPErrorHandler.validate_arguments-608"><a href="#MCPErrorHandler.validate_arguments-608"><span class="linenos">608</span></a>
</span><span id="MCPErrorHandler.validate_arguments-609"><a href="#MCPErrorHandler.validate_arguments-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.validate_arguments-610"><a href="#MCPErrorHandler.validate_arguments-610"><span class="linenos">610</span></a>        <span class="c1"># This is a placeholder for schema validation</span>
</span><span id="MCPErrorHandler.validate_arguments-611"><a href="#MCPErrorHandler.validate_arguments-611"><span class="linenos">611</span></a>        <span class="c1"># In a full implementation, you would use a JSON schema validator</span>
</span><span id="MCPErrorHandler.validate_arguments-612"><a href="#MCPErrorHandler.validate_arguments-612"><span class="linenos">612</span></a>        <span class="c1"># For now, we&#39;ll do basic validation</span>
</span><span id="MCPErrorHandler.validate_arguments-613"><a href="#MCPErrorHandler.validate_arguments-613"><span class="linenos">613</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MCPErrorHandler.validate_arguments-614"><a href="#MCPErrorHandler.validate_arguments-614"><span class="linenos">614</span></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments must be a dictionary, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MCPErrorHandler.validate_arguments-615"><a href="#MCPErrorHandler.validate_arguments-615"><span class="linenos">615</span></a>
</span><span id="MCPErrorHandler.validate_arguments-616"><a href="#MCPErrorHandler.validate_arguments-616"><span class="linenos">616</span></a>        <span class="c1"># Log validation attempt</span>
</span><span id="MCPErrorHandler.validate_arguments-617"><a href="#MCPErrorHandler.validate_arguments-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating arguments&quot;</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate arguments against a tool schema.</p>

<p>Args:
    tool_name: Name of the tool
    arguments: Arguments to validate
    schema: Tool schema for validation</p>

<p>Raises:
    ValidationError: If arguments are invalid.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.execute_with_timeout" class="classattr">
                                        <input id="MCPErrorHandler.execute_with_timeout-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">execute_with_timeout</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">operation</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">coro</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.execute_with_timeout-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.execute_with_timeout"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.execute_with_timeout-619"><a href="#MCPErrorHandler.execute_with_timeout-619"><span class="linenos">619</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_timeout</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_timeout-620"><a href="#MCPErrorHandler.execute_with_timeout-620"><span class="linenos">620</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_timeout-621"><a href="#MCPErrorHandler.execute_with_timeout-621"><span class="linenos">621</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_timeout-622"><a href="#MCPErrorHandler.execute_with_timeout-622"><span class="linenos">622</span></a>        <span class="n">coro</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_timeout-623"><a href="#MCPErrorHandler.execute_with_timeout-623"><span class="linenos">623</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_timeout-624"><a href="#MCPErrorHandler.execute_with_timeout-624"><span class="linenos">624</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-625"><a href="#MCPErrorHandler.execute_with_timeout-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with timeout protection.</span>
</span><span id="MCPErrorHandler.execute_with_timeout-626"><a href="#MCPErrorHandler.execute_with_timeout-626"><span class="linenos">626</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-627"><a href="#MCPErrorHandler.execute_with_timeout-627"><span class="linenos">627</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-628"><a href="#MCPErrorHandler.execute_with_timeout-628"><span class="linenos">628</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="MCPErrorHandler.execute_with_timeout-629"><a href="#MCPErrorHandler.execute_with_timeout-629"><span class="linenos">629</span></a><span class="sd">            coro: Coroutine to execute</span>
</span><span id="MCPErrorHandler.execute_with_timeout-630"><a href="#MCPErrorHandler.execute_with_timeout-630"><span class="linenos">630</span></a><span class="sd">            timeout_seconds: Timeout in seconds (uses default if None)</span>
</span><span id="MCPErrorHandler.execute_with_timeout-631"><a href="#MCPErrorHandler.execute_with_timeout-631"><span class="linenos">631</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-632"><a href="#MCPErrorHandler.execute_with_timeout-632"><span class="linenos">632</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-633"><a href="#MCPErrorHandler.execute_with_timeout-633"><span class="linenos">633</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="MCPErrorHandler.execute_with_timeout-634"><a href="#MCPErrorHandler.execute_with_timeout-634"><span class="linenos">634</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-635"><a href="#MCPErrorHandler.execute_with_timeout-635"><span class="linenos">635</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-636"><a href="#MCPErrorHandler.execute_with_timeout-636"><span class="linenos">636</span></a><span class="sd">            asyncio.TimeoutError: If the operation times out.</span>
</span><span id="MCPErrorHandler.execute_with_timeout-637"><a href="#MCPErrorHandler.execute_with_timeout-637"><span class="linenos">637</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-638"><a href="#MCPErrorHandler.execute_with_timeout-638"><span class="linenos">638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.execute_with_timeout-639"><a href="#MCPErrorHandler.execute_with_timeout-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="n">timeout_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-640"><a href="#MCPErrorHandler.execute_with_timeout-640"><span class="linenos">640</span></a>            <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_execution&quot;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_timeout-641"><a href="#MCPErrorHandler.execute_with_timeout-641"><span class="linenos">641</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-642"><a href="#MCPErrorHandler.execute_with_timeout-642"><span class="linenos">642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_timeout-643"><a href="#MCPErrorHandler.execute_with_timeout-643"><span class="linenos">643</span></a>            <span class="s2">&quot;Executing operation with timeout&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="MCPErrorHandler.execute_with_timeout-644"><a href="#MCPErrorHandler.execute_with_timeout-644"><span class="linenos">644</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_timeout-645"><a href="#MCPErrorHandler.execute_with_timeout-645"><span class="linenos">645</span></a>
</span><span id="MCPErrorHandler.execute_with_timeout-646"><a href="#MCPErrorHandler.execute_with_timeout-646"><span class="linenos">646</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-647"><a href="#MCPErrorHandler.execute_with_timeout-647"><span class="linenos">647</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_timeout-648"><a href="#MCPErrorHandler.execute_with_timeout-648"><span class="linenos">648</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="MCPErrorHandler.execute_with_timeout-649"><a href="#MCPErrorHandler.execute_with_timeout-649"><span class="linenos">649</span></a>        <span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_timeout-650"><a href="#MCPErrorHandler.execute_with_timeout-650"><span class="linenos">650</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_timeout-651"><a href="#MCPErrorHandler.execute_with_timeout-651"><span class="linenos">651</span></a>                <span class="s2">&quot;Operation timed out&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">timeout_seconds</span>
</span><span id="MCPErrorHandler.execute_with_timeout-652"><a href="#MCPErrorHandler.execute_with_timeout-652"><span class="linenos">652</span></a>            <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_timeout-653"><a href="#MCPErrorHandler.execute_with_timeout-653"><span class="linenos">653</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Execute a coroutine with timeout protection.</p>

<p>Args:
    operation: Name of the operation for logging
    coro: Coroutine to execute
    timeout_seconds: Timeout in seconds (uses default if None)</p>

<p>Returns:
    Result of the coroutine execution.</p>

<p>Raises:
    asyncio.TimeoutError: If the operation times out.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.execute_with_retry" class="classattr">
                                        <input id="MCPErrorHandler.execute_with_retry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">execute_with_retry</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">operation</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">base_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exponential_base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.execute_with_retry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.execute_with_retry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.execute_with_retry-655"><a href="#MCPErrorHandler.execute_with_retry-655"><span class="linenos">655</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_retry</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_retry-656"><a href="#MCPErrorHandler.execute_with_retry-656"><span class="linenos">656</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-657"><a href="#MCPErrorHandler.execute_with_retry-657"><span class="linenos">657</span></a>        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-658"><a href="#MCPErrorHandler.execute_with_retry-658"><span class="linenos">658</span></a>        <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-659"><a href="#MCPErrorHandler.execute_with_retry-659"><span class="linenos">659</span></a>        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-660"><a href="#MCPErrorHandler.execute_with_retry-660"><span class="linenos">660</span></a>        <span class="n">base_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-661"><a href="#MCPErrorHandler.execute_with_retry-661"><span class="linenos">661</span></a>        <span class="n">max_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-662"><a href="#MCPErrorHandler.execute_with_retry-662"><span class="linenos">662</span></a>        <span class="n">exponential_base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-663"><a href="#MCPErrorHandler.execute_with_retry-663"><span class="linenos">663</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-664"><a href="#MCPErrorHandler.execute_with_retry-664"><span class="linenos">664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with retry logic and exponential backoff.</span>
</span><span id="MCPErrorHandler.execute_with_retry-665"><a href="#MCPErrorHandler.execute_with_retry-665"><span class="linenos">665</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-666"><a href="#MCPErrorHandler.execute_with_retry-666"><span class="linenos">666</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.execute_with_retry-667"><a href="#MCPErrorHandler.execute_with_retry-667"><span class="linenos">667</span></a><span class="sd">            operation: Name of the operation for logging</span>
</span><span id="MCPErrorHandler.execute_with_retry-668"><a href="#MCPErrorHandler.execute_with_retry-668"><span class="linenos">668</span></a><span class="sd">            coro_factory: Coroutine factory function or callable that returns a coroutine</span>
</span><span id="MCPErrorHandler.execute_with_retry-669"><a href="#MCPErrorHandler.execute_with_retry-669"><span class="linenos">669</span></a><span class="sd">            max_retries: Maximum number of retries (uses config default if None)</span>
</span><span id="MCPErrorHandler.execute_with_retry-670"><a href="#MCPErrorHandler.execute_with_retry-670"><span class="linenos">670</span></a><span class="sd">            base_delay: Base delay between retries (uses config default if None)</span>
</span><span id="MCPErrorHandler.execute_with_retry-671"><a href="#MCPErrorHandler.execute_with_retry-671"><span class="linenos">671</span></a><span class="sd">            max_delay: Maximum delay between retries (uses config default if None)</span>
</span><span id="MCPErrorHandler.execute_with_retry-672"><a href="#MCPErrorHandler.execute_with_retry-672"><span class="linenos">672</span></a><span class="sd">            exponential_base: Exponential backoff multiplier (uses config default if None)</span>
</span><span id="MCPErrorHandler.execute_with_retry-673"><a href="#MCPErrorHandler.execute_with_retry-673"><span class="linenos">673</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-674"><a href="#MCPErrorHandler.execute_with_retry-674"><span class="linenos">674</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.execute_with_retry-675"><a href="#MCPErrorHandler.execute_with_retry-675"><span class="linenos">675</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="MCPErrorHandler.execute_with_retry-676"><a href="#MCPErrorHandler.execute_with_retry-676"><span class="linenos">676</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-677"><a href="#MCPErrorHandler.execute_with_retry-677"><span class="linenos">677</span></a><span class="sd">        Raises:</span>
</span><span id="MCPErrorHandler.execute_with_retry-678"><a href="#MCPErrorHandler.execute_with_retry-678"><span class="linenos">678</span></a><span class="sd">            Exception: If all retries are exhausted.</span>
</span><span id="MCPErrorHandler.execute_with_retry-679"><a href="#MCPErrorHandler.execute_with_retry-679"><span class="linenos">679</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-680"><a href="#MCPErrorHandler.execute_with_retry-680"><span class="linenos">680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.execute_with_retry-681"><a href="#MCPErrorHandler.execute_with_retry-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-682"><a href="#MCPErrorHandler.execute_with_retry-682"><span class="linenos">682</span></a>            <span class="n">max_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_retries&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler.execute_with_retry-683"><a href="#MCPErrorHandler.execute_with_retry-683"><span class="linenos">683</span></a>        <span class="k">if</span> <span class="n">base_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-684"><a href="#MCPErrorHandler.execute_with_retry-684"><span class="linenos">684</span></a>            <span class="n">base_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;base_delay&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler.execute_with_retry-685"><a href="#MCPErrorHandler.execute_with_retry-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="n">max_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-686"><a href="#MCPErrorHandler.execute_with_retry-686"><span class="linenos">686</span></a>            <span class="n">max_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;max_delay&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler.execute_with_retry-687"><a href="#MCPErrorHandler.execute_with_retry-687"><span class="linenos">687</span></a>        <span class="k">if</span> <span class="n">exponential_base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-688"><a href="#MCPErrorHandler.execute_with_retry-688"><span class="linenos">688</span></a>            <span class="n">exponential_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">[</span><span class="s2">&quot;exponential_base&quot;</span><span class="p">]</span>
</span><span id="MCPErrorHandler.execute_with_retry-689"><a href="#MCPErrorHandler.execute_with_retry-689"><span class="linenos">689</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-690"><a href="#MCPErrorHandler.execute_with_retry-690"><span class="linenos">690</span></a>        <span class="n">last_exception</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.execute_with_retry-691"><a href="#MCPErrorHandler.execute_with_retry-691"><span class="linenos">691</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-692"><a href="#MCPErrorHandler.execute_with_retry-692"><span class="linenos">692</span></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MCPErrorHandler.execute_with_retry-693"><a href="#MCPErrorHandler.execute_with_retry-693"><span class="linenos">693</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-694"><a href="#MCPErrorHandler.execute_with_retry-694"><span class="linenos">694</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-695"><a href="#MCPErrorHandler.execute_with_retry-695"><span class="linenos">695</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_retry-696"><a href="#MCPErrorHandler.execute_with_retry-696"><span class="linenos">696</span></a>                        <span class="s2">&quot;Retrying operation&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-697"><a href="#MCPErrorHandler.execute_with_retry-697"><span class="linenos">697</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-698"><a href="#MCPErrorHandler.execute_with_retry-698"><span class="linenos">698</span></a>                        <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-699"><a href="#MCPErrorHandler.execute_with_retry-699"><span class="linenos">699</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-700"><a href="#MCPErrorHandler.execute_with_retry-700"><span class="linenos">700</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-701"><a href="#MCPErrorHandler.execute_with_retry-701"><span class="linenos">701</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-702"><a href="#MCPErrorHandler.execute_with_retry-702"><span class="linenos">702</span></a>                <span class="c1"># Create a new coroutine for each attempt</span>
</span><span id="MCPErrorHandler.execute_with_retry-703"><a href="#MCPErrorHandler.execute_with_retry-703"><span class="linenos">703</span></a>                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="MCPErrorHandler.execute_with_retry-704"><a href="#MCPErrorHandler.execute_with_retry-704"><span class="linenos">704</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="MCPErrorHandler.execute_with_retry-705"><a href="#MCPErrorHandler.execute_with_retry-705"><span class="linenos">705</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-706"><a href="#MCPErrorHandler.execute_with_retry-706"><span class="linenos">706</span></a>                    <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="MCPErrorHandler.execute_with_retry-707"><a href="#MCPErrorHandler.execute_with_retry-707"><span class="linenos">707</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-708"><a href="#MCPErrorHandler.execute_with_retry-708"><span class="linenos">708</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="MCPErrorHandler.execute_with_retry-709"><a href="#MCPErrorHandler.execute_with_retry-709"><span class="linenos">709</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-710"><a href="#MCPErrorHandler.execute_with_retry-710"><span class="linenos">710</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_retry-711"><a href="#MCPErrorHandler.execute_with_retry-711"><span class="linenos">711</span></a>                        <span class="s2">&quot;Operation succeeded on retry&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span>
</span><span id="MCPErrorHandler.execute_with_retry-712"><a href="#MCPErrorHandler.execute_with_retry-712"><span class="linenos">712</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-713"><a href="#MCPErrorHandler.execute_with_retry-713"><span class="linenos">713</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="MCPErrorHandler.execute_with_retry-714"><a href="#MCPErrorHandler.execute_with_retry-714"><span class="linenos">714</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-715"><a href="#MCPErrorHandler.execute_with_retry-715"><span class="linenos">715</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-716"><a href="#MCPErrorHandler.execute_with_retry-716"><span class="linenos">716</span></a>                <span class="n">last_exception</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="MCPErrorHandler.execute_with_retry-717"><a href="#MCPErrorHandler.execute_with_retry-717"><span class="linenos">717</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-718"><a href="#MCPErrorHandler.execute_with_retry-718"><span class="linenos">718</span></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-719"><a href="#MCPErrorHandler.execute_with_retry-719"><span class="linenos">719</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_retry-720"><a href="#MCPErrorHandler.execute_with_retry-720"><span class="linenos">720</span></a>                        <span class="s2">&quot;Operation failed after all retries&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-721"><a href="#MCPErrorHandler.execute_with_retry-721"><span class="linenos">721</span></a>                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-722"><a href="#MCPErrorHandler.execute_with_retry-722"><span class="linenos">722</span></a>                        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-723"><a href="#MCPErrorHandler.execute_with_retry-723"><span class="linenos">723</span></a>                        <span class="n">final_error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="MCPErrorHandler.execute_with_retry-724"><a href="#MCPErrorHandler.execute_with_retry-724"><span class="linenos">724</span></a>                    <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-725"><a href="#MCPErrorHandler.execute_with_retry-725"><span class="linenos">725</span></a>                    <span class="k">raise</span>
</span><span id="MCPErrorHandler.execute_with_retry-726"><a href="#MCPErrorHandler.execute_with_retry-726"><span class="linenos">726</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-727"><a href="#MCPErrorHandler.execute_with_retry-727"><span class="linenos">727</span></a>                <span class="c1"># Calculate delay with exponential backoff</span>
</span><span id="MCPErrorHandler.execute_with_retry-728"><a href="#MCPErrorHandler.execute_with_retry-728"><span class="linenos">728</span></a>                <span class="n">delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="n">exponential_base</span><span class="o">**</span><span class="n">attempt</span><span class="p">),</span> <span class="n">max_delay</span><span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-729"><a href="#MCPErrorHandler.execute_with_retry-729"><span class="linenos">729</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-730"><a href="#MCPErrorHandler.execute_with_retry-730"><span class="linenos">730</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="MCPErrorHandler.execute_with_retry-731"><a href="#MCPErrorHandler.execute_with_retry-731"><span class="linenos">731</span></a>                    <span class="s2">&quot;Operation failed, retrying&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-732"><a href="#MCPErrorHandler.execute_with_retry-732"><span class="linenos">732</span></a>                    <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-733"><a href="#MCPErrorHandler.execute_with_retry-733"><span class="linenos">733</span></a>                    <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-734"><a href="#MCPErrorHandler.execute_with_retry-734"><span class="linenos">734</span></a>                    <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-735"><a href="#MCPErrorHandler.execute_with_retry-735"><span class="linenos">735</span></a>                    <span class="n">delay_seconds</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span>
</span><span id="MCPErrorHandler.execute_with_retry-736"><a href="#MCPErrorHandler.execute_with_retry-736"><span class="linenos">736</span></a>                    <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="MCPErrorHandler.execute_with_retry-737"><a href="#MCPErrorHandler.execute_with_retry-737"><span class="linenos">737</span></a>                <span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-738"><a href="#MCPErrorHandler.execute_with_retry-738"><span class="linenos">738</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-739"><a href="#MCPErrorHandler.execute_with_retry-739"><span class="linenos">739</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</span><span id="MCPErrorHandler.execute_with_retry-740"><a href="#MCPErrorHandler.execute_with_retry-740"><span class="linenos">740</span></a>
</span><span id="MCPErrorHandler.execute_with_retry-741"><a href="#MCPErrorHandler.execute_with_retry-741"><span class="linenos">741</span></a>        <span class="c1"># This should never be reached, but just in case</span>
</span><span id="MCPErrorHandler.execute_with_retry-742"><a href="#MCPErrorHandler.execute_with_retry-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="n">last_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-743"><a href="#MCPErrorHandler.execute_with_retry-743"><span class="linenos">743</span></a>            <span class="k">raise</span> <span class="n">last_exception</span>
</span><span id="MCPErrorHandler.execute_with_retry-744"><a href="#MCPErrorHandler.execute_with_retry-744"><span class="linenos">744</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MCPErrorHandler.execute_with_retry-745"><a href="#MCPErrorHandler.execute_with_retry-745"><span class="linenos">745</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Retry operation failed without exception&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Execute a coroutine with retry logic and exponential backoff.</p>

<p>Args:
    operation: Name of the operation for logging
    coro_factory: Coroutine factory function or callable that returns a coroutine
    max_retries: Maximum number of retries (uses config default if None)
    base_delay: Base delay between retries (uses config default if None)
    max_delay: Maximum delay between retries (uses config default if None)
    exponential_base: Exponential backoff multiplier (uses config default if None)</p>

<p>Returns:
    Result of the coroutine execution.</p>

<p>Raises:
    Exception: If all retries are exhausted.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.get_error_summary" class="classattr">
                                        <input id="MCPErrorHandler.get_error_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_error_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.get_error_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.get_error_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.get_error_summary-776"><a href="#MCPErrorHandler.get_error_summary-776"><span class="linenos">776</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.get_error_summary-777"><a href="#MCPErrorHandler.get_error_summary-777"><span class="linenos">777</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error handling configuration.</span>
</span><span id="MCPErrorHandler.get_error_summary-778"><a href="#MCPErrorHandler.get_error_summary-778"><span class="linenos">778</span></a>
</span><span id="MCPErrorHandler.get_error_summary-779"><a href="#MCPErrorHandler.get_error_summary-779"><span class="linenos">779</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.get_error_summary-780"><a href="#MCPErrorHandler.get_error_summary-780"><span class="linenos">780</span></a><span class="sd">            Dictionary containing error handling configuration summary.</span>
</span><span id="MCPErrorHandler.get_error_summary-781"><a href="#MCPErrorHandler.get_error_summary-781"><span class="linenos">781</span></a>
</span><span id="MCPErrorHandler.get_error_summary-782"><a href="#MCPErrorHandler.get_error_summary-782"><span class="linenos">782</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.get_error_summary-783"><a href="#MCPErrorHandler.get_error_summary-783"><span class="linenos">783</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_error_summary-784"><a href="#MCPErrorHandler.get_error_summary-784"><span class="linenos">784</span></a>            <span class="s2">&quot;timeouts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeouts</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-785"><a href="#MCPErrorHandler.get_error_summary-785"><span class="linenos">785</span></a>            <span class="s2">&quot;retry_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_settings</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-786"><a href="#MCPErrorHandler.get_error_summary-786"><span class="linenos">786</span></a>            <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-787"><a href="#MCPErrorHandler.get_error_summary-787"><span class="linenos">787</span></a>            <span class="s2">&quot;error_codes&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_error_summary-788"><a href="#MCPErrorHandler.get_error_summary-788"><span class="linenos">788</span></a>                <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_error_summary-789"><a href="#MCPErrorHandler.get_error_summary-789"><span class="linenos">789</span></a>                    <span class="s2">&quot;PARSE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARSE_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-790"><a href="#MCPErrorHandler.get_error_summary-790"><span class="linenos">790</span></a>                    <span class="s2">&quot;INVALID_REQUEST&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_REQUEST</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-791"><a href="#MCPErrorHandler.get_error_summary-791"><span class="linenos">791</span></a>                    <span class="s2">&quot;METHOD_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">METHOD_NOT_FOUND</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-792"><a href="#MCPErrorHandler.get_error_summary-792"><span class="linenos">792</span></a>                    <span class="s2">&quot;INVALID_PARAMS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVALID_PARAMS</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-793"><a href="#MCPErrorHandler.get_error_summary-793"><span class="linenos">793</span></a>                    <span class="s2">&quot;INTERNAL_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">INTERNAL_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-794"><a href="#MCPErrorHandler.get_error_summary-794"><span class="linenos">794</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler.get_error_summary-795"><a href="#MCPErrorHandler.get_error_summary-795"><span class="linenos">795</span></a>                <span class="s2">&quot;server_defined&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_error_summary-796"><a href="#MCPErrorHandler.get_error_summary-796"><span class="linenos">796</span></a>                    <span class="s2">&quot;RESOURCE_NOT_FOUND&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-797"><a href="#MCPErrorHandler.get_error_summary-797"><span class="linenos">797</span></a>                    <span class="s2">&quot;RESOURCE_ACCESS_DENIED&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-798"><a href="#MCPErrorHandler.get_error_summary-798"><span class="linenos">798</span></a>                    <span class="s2">&quot;RESOURCE_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-799"><a href="#MCPErrorHandler.get_error_summary-799"><span class="linenos">799</span></a>                    <span class="s2">&quot;TOOL_UNAVAILABLE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOOL_UNAVAILABLE</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-800"><a href="#MCPErrorHandler.get_error_summary-800"><span class="linenos">800</span></a>                    <span class="s2">&quot;TIMEOUT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-801"><a href="#MCPErrorHandler.get_error_summary-801"><span class="linenos">801</span></a>                    <span class="s2">&quot;VALIDATION_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-802"><a href="#MCPErrorHandler.get_error_summary-802"><span class="linenos">802</span></a>                    <span class="s2">&quot;EXTERNAL_SERVICE_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-803"><a href="#MCPErrorHandler.get_error_summary-803"><span class="linenos">803</span></a>                    <span class="s2">&quot;RATE_LIMIT_ERROR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RATE_LIMIT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_summary-804"><a href="#MCPErrorHandler.get_error_summary-804"><span class="linenos">804</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler.get_error_summary-805"><a href="#MCPErrorHandler.get_error_summary-805"><span class="linenos">805</span></a>            <span class="p">},</span>
</span><span id="MCPErrorHandler.get_error_summary-806"><a href="#MCPErrorHandler.get_error_summary-806"><span class="linenos">806</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get a summary of error handling configuration.</p>

<p>Returns:
    Dictionary containing error handling configuration summary.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_resource_not_found_error" class="classattr">
                                        <input id="MCPErrorHandler.create_resource_not_found_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_resource_not_found_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_resource_not_found_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_resource_not_found_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_resource_not_found_error-810"><a href="#MCPErrorHandler.create_resource_not_found_error-810"><span class="linenos">810</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_not_found_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-811"><a href="#MCPErrorHandler.create_resource_not_found_error-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-812"><a href="#MCPErrorHandler.create_resource_not_found_error-812"><span class="linenos">812</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-813"><a href="#MCPErrorHandler.create_resource_not_found_error-813"><span class="linenos">813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource not found error response.</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-814"><a href="#MCPErrorHandler.create_resource_not_found_error-814"><span class="linenos">814</span></a>
</span><span id="MCPErrorHandler.create_resource_not_found_error-815"><a href="#MCPErrorHandler.create_resource_not_found_error-815"><span class="linenos">815</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-816"><a href="#MCPErrorHandler.create_resource_not_found_error-816"><span class="linenos">816</span></a><span class="sd">            resource_uri: URI of the resource that was not found</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-817"><a href="#MCPErrorHandler.create_resource_not_found_error-817"><span class="linenos">817</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-818"><a href="#MCPErrorHandler.create_resource_not_found_error-818"><span class="linenos">818</span></a>
</span><span id="MCPErrorHandler.create_resource_not_found_error-819"><a href="#MCPErrorHandler.create_resource_not_found_error-819"><span class="linenos">819</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-820"><a href="#MCPErrorHandler.create_resource_not_found_error-820"><span class="linenos">820</span></a><span class="sd">            Resource not found error response.</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-821"><a href="#MCPErrorHandler.create_resource_not_found_error-821"><span class="linenos">821</span></a>
</span><span id="MCPErrorHandler.create_resource_not_found_error-822"><a href="#MCPErrorHandler.create_resource_not_found_error-822"><span class="linenos">822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-823"><a href="#MCPErrorHandler.create_resource_not_found_error-823"><span class="linenos">823</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-824"><a href="#MCPErrorHandler.create_resource_not_found_error-824"><span class="linenos">824</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-825"><a href="#MCPErrorHandler.create_resource_not_found_error-825"><span class="linenos">825</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-826"><a href="#MCPErrorHandler.create_resource_not_found_error-826"><span class="linenos">826</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the resource URI and ensure it exists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-827"><a href="#MCPErrorHandler.create_resource_not_found_error-827"><span class="linenos">827</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-828"><a href="#MCPErrorHandler.create_resource_not_found_error-828"><span class="linenos">828</span></a>
</span><span id="MCPErrorHandler.create_resource_not_found_error-829"><a href="#MCPErrorHandler.create_resource_not_found_error-829"><span class="linenos">829</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-830"><a href="#MCPErrorHandler.create_resource_not_found_error-830"><span class="linenos">830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_NOT_FOUND</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_resource_not_found_error-831"><a href="#MCPErrorHandler.create_resource_not_found_error-831"><span class="linenos">831</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a resource not found error response.</p>

<p>Args:
    resource_uri: URI of the resource that was not found
    data: Additional error data</p>

<p>Returns:
    Resource not found error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_resource_access_denied_error" class="classattr">
                                        <input id="MCPErrorHandler.create_resource_access_denied_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_resource_access_denied_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Permission denied&#39;</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_resource_access_denied_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_resource_access_denied_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_resource_access_denied_error-833"><a href="#MCPErrorHandler.create_resource_access_denied_error-833"><span class="linenos">833</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_access_denied_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-834"><a href="#MCPErrorHandler.create_resource_access_denied_error-834"><span class="linenos">834</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-835"><a href="#MCPErrorHandler.create_resource_access_denied_error-835"><span class="linenos">835</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-836"><a href="#MCPErrorHandler.create_resource_access_denied_error-836"><span class="linenos">836</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-837"><a href="#MCPErrorHandler.create_resource_access_denied_error-837"><span class="linenos">837</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-838"><a href="#MCPErrorHandler.create_resource_access_denied_error-838"><span class="linenos">838</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-839"><a href="#MCPErrorHandler.create_resource_access_denied_error-839"><span class="linenos">839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource access denied error response.</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-840"><a href="#MCPErrorHandler.create_resource_access_denied_error-840"><span class="linenos">840</span></a>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-841"><a href="#MCPErrorHandler.create_resource_access_denied_error-841"><span class="linenos">841</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-842"><a href="#MCPErrorHandler.create_resource_access_denied_error-842"><span class="linenos">842</span></a><span class="sd">            resource_uri: URI of the resource that access was denied to</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-843"><a href="#MCPErrorHandler.create_resource_access_denied_error-843"><span class="linenos">843</span></a><span class="sd">            reason: Reason for access denial</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-844"><a href="#MCPErrorHandler.create_resource_access_denied_error-844"><span class="linenos">844</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-845"><a href="#MCPErrorHandler.create_resource_access_denied_error-845"><span class="linenos">845</span></a>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-846"><a href="#MCPErrorHandler.create_resource_access_denied_error-846"><span class="linenos">846</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-847"><a href="#MCPErrorHandler.create_resource_access_denied_error-847"><span class="linenos">847</span></a><span class="sd">            Resource access denied error response.</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-848"><a href="#MCPErrorHandler.create_resource_access_denied_error-848"><span class="linenos">848</span></a>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-849"><a href="#MCPErrorHandler.create_resource_access_denied_error-849"><span class="linenos">849</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-850"><a href="#MCPErrorHandler.create_resource_access_denied_error-850"><span class="linenos">850</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-851"><a href="#MCPErrorHandler.create_resource_access_denied_error-851"><span class="linenos">851</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-852"><a href="#MCPErrorHandler.create_resource_access_denied_error-852"><span class="linenos">852</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-853"><a href="#MCPErrorHandler.create_resource_access_denied_error-853"><span class="linenos">853</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-854"><a href="#MCPErrorHandler.create_resource_access_denied_error-854"><span class="linenos">854</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check your permissions and authentication&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-855"><a href="#MCPErrorHandler.create_resource_access_denied_error-855"><span class="linenos">855</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-856"><a href="#MCPErrorHandler.create_resource_access_denied_error-856"><span class="linenos">856</span></a>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-857"><a href="#MCPErrorHandler.create_resource_access_denied_error-857"><span class="linenos">857</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-858"><a href="#MCPErrorHandler.create_resource_access_denied_error-858"><span class="linenos">858</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_ACCESS_DENIED</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-859"><a href="#MCPErrorHandler.create_resource_access_denied_error-859"><span class="linenos">859</span></a>            <span class="sa">f</span><span class="s2">&quot;Access denied to resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-860"><a href="#MCPErrorHandler.create_resource_access_denied_error-860"><span class="linenos">860</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_access_denied_error-861"><a href="#MCPErrorHandler.create_resource_access_denied_error-861"><span class="linenos">861</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a resource access denied error response.</p>

<p>Args:
    resource_uri: URI of the resource that access was denied to
    reason: Reason for access denial
    data: Additional error data</p>

<p>Returns:
    Resource access denied error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_resource_unavailable_error" class="classattr">
                                        <input id="MCPErrorHandler.create_resource_unavailable_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_resource_unavailable_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Resource temporarily unavailable&#39;</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_resource_unavailable_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_resource_unavailable_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_resource_unavailable_error-863"><a href="#MCPErrorHandler.create_resource_unavailable_error-863"><span class="linenos">863</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_unavailable_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-864"><a href="#MCPErrorHandler.create_resource_unavailable_error-864"><span class="linenos">864</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-865"><a href="#MCPErrorHandler.create_resource_unavailable_error-865"><span class="linenos">865</span></a>        <span class="n">resource_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-866"><a href="#MCPErrorHandler.create_resource_unavailable_error-866"><span class="linenos">866</span></a>        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Resource temporarily unavailable&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-867"><a href="#MCPErrorHandler.create_resource_unavailable_error-867"><span class="linenos">867</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-868"><a href="#MCPErrorHandler.create_resource_unavailable_error-868"><span class="linenos">868</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-869"><a href="#MCPErrorHandler.create_resource_unavailable_error-869"><span class="linenos">869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a resource unavailable error response.</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-870"><a href="#MCPErrorHandler.create_resource_unavailable_error-870"><span class="linenos">870</span></a>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-871"><a href="#MCPErrorHandler.create_resource_unavailable_error-871"><span class="linenos">871</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-872"><a href="#MCPErrorHandler.create_resource_unavailable_error-872"><span class="linenos">872</span></a><span class="sd">            resource_uri: URI of the resource that is unavailable</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-873"><a href="#MCPErrorHandler.create_resource_unavailable_error-873"><span class="linenos">873</span></a><span class="sd">            reason: Reason for unavailability</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-874"><a href="#MCPErrorHandler.create_resource_unavailable_error-874"><span class="linenos">874</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-875"><a href="#MCPErrorHandler.create_resource_unavailable_error-875"><span class="linenos">875</span></a>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-876"><a href="#MCPErrorHandler.create_resource_unavailable_error-876"><span class="linenos">876</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-877"><a href="#MCPErrorHandler.create_resource_unavailable_error-877"><span class="linenos">877</span></a><span class="sd">            Resource unavailable error response.</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-878"><a href="#MCPErrorHandler.create_resource_unavailable_error-878"><span class="linenos">878</span></a>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-879"><a href="#MCPErrorHandler.create_resource_unavailable_error-879"><span class="linenos">879</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-880"><a href="#MCPErrorHandler.create_resource_unavailable_error-880"><span class="linenos">880</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-881"><a href="#MCPErrorHandler.create_resource_unavailable_error-881"><span class="linenos">881</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-882"><a href="#MCPErrorHandler.create_resource_unavailable_error-882"><span class="linenos">882</span></a>                <span class="s2">&quot;resource_uri&quot;</span><span class="p">:</span> <span class="n">resource_uri</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-883"><a href="#MCPErrorHandler.create_resource_unavailable_error-883"><span class="linenos">883</span></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-884"><a href="#MCPErrorHandler.create_resource_unavailable_error-884"><span class="linenos">884</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Try again later or contact support if the issue persists&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-885"><a href="#MCPErrorHandler.create_resource_unavailable_error-885"><span class="linenos">885</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-886"><a href="#MCPErrorHandler.create_resource_unavailable_error-886"><span class="linenos">886</span></a>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-887"><a href="#MCPErrorHandler.create_resource_unavailable_error-887"><span class="linenos">887</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-888"><a href="#MCPErrorHandler.create_resource_unavailable_error-888"><span class="linenos">888</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_UNAVAILABLE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Resource &#39;</span><span class="si">{</span><span class="n">resource_uri</span><span class="si">}</span><span class="s2">&#39; unavailable: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_resource_unavailable_error-889"><a href="#MCPErrorHandler.create_resource_unavailable_error-889"><span class="linenos">889</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a resource unavailable error response.</p>

<p>Args:
    resource_uri: URI of the resource that is unavailable
    reason: Reason for unavailability
    data: Additional error data</p>

<p>Returns:
    Resource unavailable error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_circuit_breaker_open_error" class="classattr">
                                        <input id="MCPErrorHandler.create_circuit_breaker_open_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_circuit_breaker_open_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_circuit_breaker_open_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_circuit_breaker_open_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_circuit_breaker_open_error-891"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-891"><span class="linenos">891</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_circuit_breaker_open_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-892"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-892"><span class="linenos">892</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-893"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-893"><span class="linenos">893</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-894"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-894"><span class="linenos">894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a circuit breaker open error response.</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-895"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-895"><span class="linenos">895</span></a>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-896"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-896"><span class="linenos">896</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-897"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-897"><span class="linenos">897</span></a><span class="sd">            service_name: Name of the service with open circuit breaker</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-898"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-898"><span class="linenos">898</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-899"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-899"><span class="linenos">899</span></a>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-900"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-900"><span class="linenos">900</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-901"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-901"><span class="linenos">901</span></a><span class="sd">            Circuit breaker open error response.</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-902"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-902"><span class="linenos">902</span></a>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-903"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-903"><span class="linenos">903</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-904"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-904"><span class="linenos">904</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-905"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-905"><span class="linenos">905</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-906"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-906"><span class="linenos">906</span></a>                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-907"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-907"><span class="linenos">907</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Service is temporarily unavailable due to repeated failures. Please try again later.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-908"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-908"><span class="linenos">908</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-909"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-909"><span class="linenos">909</span></a>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-910"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-910"><span class="linenos">910</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-911"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-911"><span class="linenos">911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">EXTERNAL_SERVICE_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; circuit breaker is open&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_circuit_breaker_open_error-912"><a href="#MCPErrorHandler.create_circuit_breaker_open_error-912"><span class="linenos">912</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a circuit breaker open error response.</p>

<p>Args:
    service_name: Name of the service with open circuit breaker
    data: Additional error data</p>

<p>Returns:
    Circuit breaker open error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_validation_error_with_context" class="classattr">
                                        <input id="MCPErrorHandler.create_validation_error_with_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_validation_error_with_context</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">validation_error</span><span class="p">:</span> <span class="n">pydantic_core</span><span class="o">.</span><span class="n">_pydantic_core</span><span class="o">.</span><span class="n">ValidationError</span>,</span><span class="param">	<span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_validation_error_with_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_validation_error_with_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_validation_error_with_context-914"><a href="#MCPErrorHandler.create_validation_error_with_context-914"><span class="linenos">914</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_validation_error_with_context</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-915"><a href="#MCPErrorHandler.create_validation_error_with_context-915"><span class="linenos">915</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-916"><a href="#MCPErrorHandler.create_validation_error_with_context-916"><span class="linenos">916</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-917"><a href="#MCPErrorHandler.create_validation_error_with_context-917"><span class="linenos">917</span></a>        <span class="n">validation_error</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-918"><a href="#MCPErrorHandler.create_validation_error_with_context-918"><span class="linenos">918</span></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-919"><a href="#MCPErrorHandler.create_validation_error_with_context-919"><span class="linenos">919</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-920"><a href="#MCPErrorHandler.create_validation_error_with_context-920"><span class="linenos">920</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-921"><a href="#MCPErrorHandler.create_validation_error_with_context-921"><span class="linenos">921</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a validation error response with additional context.</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-922"><a href="#MCPErrorHandler.create_validation_error_with_context-922"><span class="linenos">922</span></a>
</span><span id="MCPErrorHandler.create_validation_error_with_context-923"><a href="#MCPErrorHandler.create_validation_error_with_context-923"><span class="linenos">923</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-924"><a href="#MCPErrorHandler.create_validation_error_with_context-924"><span class="linenos">924</span></a><span class="sd">            tool_name: Name of the tool that failed validation</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-925"><a href="#MCPErrorHandler.create_validation_error_with_context-925"><span class="linenos">925</span></a><span class="sd">            validation_error: Pydantic validation error</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-926"><a href="#MCPErrorHandler.create_validation_error_with_context-926"><span class="linenos">926</span></a><span class="sd">            context: Additional context about the validation failure</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-927"><a href="#MCPErrorHandler.create_validation_error_with_context-927"><span class="linenos">927</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-928"><a href="#MCPErrorHandler.create_validation_error_with_context-928"><span class="linenos">928</span></a>
</span><span id="MCPErrorHandler.create_validation_error_with_context-929"><a href="#MCPErrorHandler.create_validation_error_with_context-929"><span class="linenos">929</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-930"><a href="#MCPErrorHandler.create_validation_error_with_context-930"><span class="linenos">930</span></a><span class="sd">            Enhanced validation error response.</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-931"><a href="#MCPErrorHandler.create_validation_error_with_context-931"><span class="linenos">931</span></a>
</span><span id="MCPErrorHandler.create_validation_error_with_context-932"><a href="#MCPErrorHandler.create_validation_error_with_context-932"><span class="linenos">932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-933"><a href="#MCPErrorHandler.create_validation_error_with_context-933"><span class="linenos">933</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-934"><a href="#MCPErrorHandler.create_validation_error_with_context-934"><span class="linenos">934</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-935"><a href="#MCPErrorHandler.create_validation_error_with_context-935"><span class="linenos">935</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-936"><a href="#MCPErrorHandler.create_validation_error_with_context-936"><span class="linenos">936</span></a>                <span class="s2">&quot;validation_errors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">validation_error</span><span class="o">.</span><span class="n">errors</span><span class="p">()],</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-937"><a href="#MCPErrorHandler.create_validation_error_with_context-937"><span class="linenos">937</span></a>                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-938"><a href="#MCPErrorHandler.create_validation_error_with_context-938"><span class="linenos">938</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;Check the input parameters and ensure they match the expected schema&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-939"><a href="#MCPErrorHandler.create_validation_error_with_context-939"><span class="linenos">939</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-940"><a href="#MCPErrorHandler.create_validation_error_with_context-940"><span class="linenos">940</span></a>
</span><span id="MCPErrorHandler.create_validation_error_with_context-941"><a href="#MCPErrorHandler.create_validation_error_with_context-941"><span class="linenos">941</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-942"><a href="#MCPErrorHandler.create_validation_error_with_context-942"><span class="linenos">942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation failed for tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">data</span>
</span><span id="MCPErrorHandler.create_validation_error_with_context-943"><a href="#MCPErrorHandler.create_validation_error_with_context-943"><span class="linenos">943</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a validation error response with additional context.</p>

<p>Args:
    tool_name: Name of the tool that failed validation
    validation_error: Pydantic validation error
    context: Additional context about the validation failure
    data: Additional error data</p>

<p>Returns:
    Enhanced validation error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.create_timeout_error_with_context" class="classattr">
                                        <input id="MCPErrorHandler.create_timeout_error_with_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_timeout_error_with_context</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">operation_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.create_timeout_error_with_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.create_timeout_error_with_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.create_timeout_error_with_context-945"><a href="#MCPErrorHandler.create_timeout_error_with_context-945"><span class="linenos">945</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_timeout_error_with_context</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-946"><a href="#MCPErrorHandler.create_timeout_error_with_context-946"><span class="linenos">946</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-947"><a href="#MCPErrorHandler.create_timeout_error_with_context-947"><span class="linenos">947</span></a>        <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-948"><a href="#MCPErrorHandler.create_timeout_error_with_context-948"><span class="linenos">948</span></a>        <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-949"><a href="#MCPErrorHandler.create_timeout_error_with_context-949"><span class="linenos">949</span></a>        <span class="n">operation_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-950"><a href="#MCPErrorHandler.create_timeout_error_with_context-950"><span class="linenos">950</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-951"><a href="#MCPErrorHandler.create_timeout_error_with_context-951"><span class="linenos">951</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-952"><a href="#MCPErrorHandler.create_timeout_error_with_context-952"><span class="linenos">952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a timeout error response with operation context.</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-953"><a href="#MCPErrorHandler.create_timeout_error_with_context-953"><span class="linenos">953</span></a>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-954"><a href="#MCPErrorHandler.create_timeout_error_with_context-954"><span class="linenos">954</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-955"><a href="#MCPErrorHandler.create_timeout_error_with_context-955"><span class="linenos">955</span></a><span class="sd">            tool_name: Name of the tool that timed out</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-956"><a href="#MCPErrorHandler.create_timeout_error_with_context-956"><span class="linenos">956</span></a><span class="sd">            timeout_seconds: Timeout value that was exceeded</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-957"><a href="#MCPErrorHandler.create_timeout_error_with_context-957"><span class="linenos">957</span></a><span class="sd">            operation_context: Context about the operation that timed out</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-958"><a href="#MCPErrorHandler.create_timeout_error_with_context-958"><span class="linenos">958</span></a><span class="sd">            data: Additional error data</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-959"><a href="#MCPErrorHandler.create_timeout_error_with_context-959"><span class="linenos">959</span></a>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-960"><a href="#MCPErrorHandler.create_timeout_error_with_context-960"><span class="linenos">960</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-961"><a href="#MCPErrorHandler.create_timeout_error_with_context-961"><span class="linenos">961</span></a><span class="sd">            Enhanced timeout error response.</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-962"><a href="#MCPErrorHandler.create_timeout_error_with_context-962"><span class="linenos">962</span></a>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-963"><a href="#MCPErrorHandler.create_timeout_error_with_context-963"><span class="linenos">963</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-964"><a href="#MCPErrorHandler.create_timeout_error_with_context-964"><span class="linenos">964</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-965"><a href="#MCPErrorHandler.create_timeout_error_with_context-965"><span class="linenos">965</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-966"><a href="#MCPErrorHandler.create_timeout_error_with_context-966"><span class="linenos">966</span></a>                <span class="s2">&quot;tool_name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-967"><a href="#MCPErrorHandler.create_timeout_error_with_context-967"><span class="linenos">967</span></a>                <span class="s2">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="n">timeout_seconds</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-968"><a href="#MCPErrorHandler.create_timeout_error_with_context-968"><span class="linenos">968</span></a>                <span class="s2">&quot;operation_context&quot;</span><span class="p">:</span> <span class="n">operation_context</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-969"><a href="#MCPErrorHandler.create_timeout_error_with_context-969"><span class="linenos">969</span></a>                <span class="s2">&quot;suggestion&quot;</span><span class="p">:</span> <span class="s2">&quot;The operation may be taking longer than expected. Try reducing the scope or increasing the timeout.&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-970"><a href="#MCPErrorHandler.create_timeout_error_with_context-970"><span class="linenos">970</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-971"><a href="#MCPErrorHandler.create_timeout_error_with_context-971"><span class="linenos">971</span></a>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-972"><a href="#MCPErrorHandler.create_timeout_error_with_context-972"><span class="linenos">972</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_error</span><span class="p">(</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-973"><a href="#MCPErrorHandler.create_timeout_error_with_context-973"><span class="linenos">973</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT_ERROR</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-974"><a href="#MCPErrorHandler.create_timeout_error_with_context-974"><span class="linenos">974</span></a>            <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-975"><a href="#MCPErrorHandler.create_timeout_error_with_context-975"><span class="linenos">975</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="MCPErrorHandler.create_timeout_error_with_context-976"><a href="#MCPErrorHandler.create_timeout_error_with_context-976"><span class="linenos">976</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a timeout error response with operation context.</p>

<p>Args:
    tool_name: Name of the tool that timed out
    timeout_seconds: Timeout value that was exceeded
    operation_context: Context about the operation that timed out
    data: Additional error data</p>

<p>Returns:
    Enhanced timeout error response.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.get_enhanced_error_summary" class="classattr">
                                        <input id="MCPErrorHandler.get_enhanced_error_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_enhanced_error_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.get_enhanced_error_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.get_enhanced_error_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.get_enhanced_error_summary-978"><a href="#MCPErrorHandler.get_enhanced_error_summary-978"><span class="linenos"> 978</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_enhanced_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-979"><a href="#MCPErrorHandler.get_enhanced_error_summary-979"><span class="linenos"> 979</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an enhanced summary including Phase 3 features.</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-980"><a href="#MCPErrorHandler.get_enhanced_error_summary-980"><span class="linenos"> 980</span></a>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-981"><a href="#MCPErrorHandler.get_enhanced_error_summary-981"><span class="linenos"> 981</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-982"><a href="#MCPErrorHandler.get_enhanced_error_summary-982"><span class="linenos"> 982</span></a><span class="sd">            Dictionary containing comprehensive error handling configuration and capabilities.</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-983"><a href="#MCPErrorHandler.get_enhanced_error_summary-983"><span class="linenos"> 983</span></a>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-984"><a href="#MCPErrorHandler.get_enhanced_error_summary-984"><span class="linenos"> 984</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-985"><a href="#MCPErrorHandler.get_enhanced_error_summary-985"><span class="linenos"> 985</span></a>        <span class="n">base_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">()</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-986"><a href="#MCPErrorHandler.get_enhanced_error_summary-986"><span class="linenos"> 986</span></a>        <span class="n">base_summary</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-987"><a href="#MCPErrorHandler.get_enhanced_error_summary-987"><span class="linenos"> 987</span></a>            <span class="p">{</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-988"><a href="#MCPErrorHandler.get_enhanced_error_summary-988"><span class="linenos"> 988</span></a>                <span class="s2">&quot;phase_3_features&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-989"><a href="#MCPErrorHandler.get_enhanced_error_summary-989"><span class="linenos"> 989</span></a>                    <span class="s2">&quot;circuit_breaker&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-990"><a href="#MCPErrorHandler.get_enhanced_error_summary-990"><span class="linenos"> 990</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-991"><a href="#MCPErrorHandler.get_enhanced_error_summary-991"><span class="linenos"> 991</span></a>                        <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-992"><a href="#MCPErrorHandler.get_enhanced_error_summary-992"><span class="linenos"> 992</span></a>                            <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-993"><a href="#MCPErrorHandler.get_enhanced_error_summary-993"><span class="linenos"> 993</span></a>                            <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-994"><a href="#MCPErrorHandler.get_enhanced_error_summary-994"><span class="linenos"> 994</span></a>                            <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">circuit_breaker</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-995"><a href="#MCPErrorHandler.get_enhanced_error_summary-995"><span class="linenos"> 995</span></a>                        <span class="p">},</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-996"><a href="#MCPErrorHandler.get_enhanced_error_summary-996"><span class="linenos"> 996</span></a>                    <span class="p">},</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-997"><a href="#MCPErrorHandler.get_enhanced_error_summary-997"><span class="linenos"> 997</span></a>                    <span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-998"><a href="#MCPErrorHandler.get_enhanced_error_summary-998"><span class="linenos"> 998</span></a>                        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">],</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-999"><a href="#MCPErrorHandler.get_enhanced_error_summary-999"><span class="linenos"> 999</span></a>                        <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">],</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1000"><a href="#MCPErrorHandler.get_enhanced_error_summary-1000"><span class="linenos">1000</span></a>                        <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1001"><a href="#MCPErrorHandler.get_enhanced_error_summary-1001"><span class="linenos">1001</span></a>                            <span class="s2">&quot;max_errors_per_window&quot;</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1002"><a href="#MCPErrorHandler.get_enhanced_error_summary-1002"><span class="linenos">1002</span></a>                        <span class="p">],</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1003"><a href="#MCPErrorHandler.get_enhanced_error_summary-1003"><span class="linenos">1003</span></a>                    <span class="p">},</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1004"><a href="#MCPErrorHandler.get_enhanced_error_summary-1004"><span class="linenos">1004</span></a>                    <span class="s2">&quot;enhanced_resource_handling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1005"><a href="#MCPErrorHandler.get_enhanced_error_summary-1005"><span class="linenos">1005</span></a>                    <span class="s2">&quot;context_aware_errors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1006"><a href="#MCPErrorHandler.get_enhanced_error_summary-1006"><span class="linenos">1006</span></a>                <span class="p">},</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1007"><a href="#MCPErrorHandler.get_enhanced_error_summary-1007"><span class="linenos">1007</span></a>            <span class="p">}</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1008"><a href="#MCPErrorHandler.get_enhanced_error_summary-1008"><span class="linenos">1008</span></a>        <span class="p">)</span>
</span><span id="MCPErrorHandler.get_enhanced_error_summary-1009"><a href="#MCPErrorHandler.get_enhanced_error_summary-1009"><span class="linenos">1009</span></a>        <span class="k">return</span> <span class="n">base_summary</span>
</span></pre></div>


            <div class="docstring"><p>Get an enhanced summary including Phase 3 features.</p>

<p>Returns:
    Dictionary containing comprehensive error handling configuration and capabilities.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.get_error_analytics" class="classattr">
                                        <input id="MCPErrorHandler.get_error_analytics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_error_analytics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.get_error_analytics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.get_error_analytics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.get_error_analytics-1011"><a href="#MCPErrorHandler.get_error_analytics-1011"><span class="linenos">1011</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_analytics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.get_error_analytics-1012"><a href="#MCPErrorHandler.get_error_analytics-1012"><span class="linenos">1012</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error analytics and patterns from the aggregator.</span>
</span><span id="MCPErrorHandler.get_error_analytics-1013"><a href="#MCPErrorHandler.get_error_analytics-1013"><span class="linenos">1013</span></a>
</span><span id="MCPErrorHandler.get_error_analytics-1014"><a href="#MCPErrorHandler.get_error_analytics-1014"><span class="linenos">1014</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.get_error_analytics-1015"><a href="#MCPErrorHandler.get_error_analytics-1015"><span class="linenos">1015</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="MCPErrorHandler.get_error_analytics-1016"><a href="#MCPErrorHandler.get_error_analytics-1016"><span class="linenos">1016</span></a>
</span><span id="MCPErrorHandler.get_error_analytics-1017"><a href="#MCPErrorHandler.get_error_analytics-1017"><span class="linenos">1017</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.get_error_analytics-1018"><a href="#MCPErrorHandler.get_error_analytics-1018"><span class="linenos">1018</span></a><span class="sd">            Dictionary containing error analytics and patterns.</span>
</span><span id="MCPErrorHandler.get_error_analytics-1019"><a href="#MCPErrorHandler.get_error_analytics-1019"><span class="linenos">1019</span></a>
</span><span id="MCPErrorHandler.get_error_analytics-1020"><a href="#MCPErrorHandler.get_error_analytics-1020"><span class="linenos">1020</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.get_error_analytics-1021"><a href="#MCPErrorHandler.get_error_analytics-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="MCPErrorHandler.get_error_analytics-1022"><a href="#MCPErrorHandler.get_error_analytics-1022"><span class="linenos">1022</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;disabled&quot;</span><span class="p">}</span>
</span><span id="MCPErrorHandler.get_error_analytics-1023"><a href="#MCPErrorHandler.get_error_analytics-1023"><span class="linenos">1023</span></a>
</span><span id="MCPErrorHandler.get_error_analytics-1024"><a href="#MCPErrorHandler.get_error_analytics-1024"><span class="linenos">1024</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MCPErrorHandler.get_error_analytics-1025"><a href="#MCPErrorHandler.get_error_analytics-1025"><span class="linenos">1025</span></a>            <span class="s2">&quot;error_summary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_summary</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">),</span>
</span><span id="MCPErrorHandler.get_error_analytics-1026"><a href="#MCPErrorHandler.get_error_analytics-1026"><span class="linenos">1026</span></a>            <span class="s2">&quot;error_trends&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_aggregator</span><span class="o">.</span><span class="n">get_error_trends</span><span class="p">(),</span>
</span><span id="MCPErrorHandler.get_error_analytics-1027"><a href="#MCPErrorHandler.get_error_analytics-1027"><span class="linenos">1027</span></a>            <span class="s2">&quot;aggregation_config&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">error_aggregation</span><span class="p">,</span>
</span><span id="MCPErrorHandler.get_error_analytics-1028"><a href="#MCPErrorHandler.get_error_analytics-1028"><span class="linenos">1028</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get error analytics and patterns from the aggregator.</p>

<p>Args:
    window_seconds: Time window in seconds (uses config default if None)</p>

<p>Returns:
    Dictionary containing error analytics and patterns.</p>
</div>


                            </div>
                            <div id="MCPErrorHandler.get_circuit_breaker_status" class="classattr">
                                        <input id="MCPErrorHandler.get_circuit_breaker_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_circuit_breaker_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MCPErrorHandler.get_circuit_breaker_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MCPErrorHandler.get_circuit_breaker_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MCPErrorHandler.get_circuit_breaker_status-1030"><a href="#MCPErrorHandler.get_circuit_breaker_status-1030"><span class="linenos">1030</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_circuit_breaker_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1031"><a href="#MCPErrorHandler.get_circuit_breaker_status-1031"><span class="linenos">1031</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get circuit breaker status for a specific service.</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1032"><a href="#MCPErrorHandler.get_circuit_breaker_status-1032"><span class="linenos">1032</span></a>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1033"><a href="#MCPErrorHandler.get_circuit_breaker_status-1033"><span class="linenos">1033</span></a><span class="sd">        Args:</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1034"><a href="#MCPErrorHandler.get_circuit_breaker_status-1034"><span class="linenos">1034</span></a><span class="sd">            service_name: Name of the service to check</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1035"><a href="#MCPErrorHandler.get_circuit_breaker_status-1035"><span class="linenos">1035</span></a>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1036"><a href="#MCPErrorHandler.get_circuit_breaker_status-1036"><span class="linenos">1036</span></a><span class="sd">        Returns:</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1037"><a href="#MCPErrorHandler.get_circuit_breaker_status-1037"><span class="linenos">1037</span></a><span class="sd">            Circuit breaker status or None if not found.</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1038"><a href="#MCPErrorHandler.get_circuit_breaker_status-1038"><span class="linenos">1038</span></a>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1039"><a href="#MCPErrorHandler.get_circuit_breaker_status-1039"><span class="linenos">1039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1040"><a href="#MCPErrorHandler.get_circuit_breaker_status-1040"><span class="linenos">1040</span></a>        <span class="c1"># This would be implemented when circuit breakers are added to specific services</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1041"><a href="#MCPErrorHandler.get_circuit_breaker_status-1041"><span class="linenos">1041</span></a>        <span class="c1"># For now, return None to indicate no circuit breaker exists</span>
</span><span id="MCPErrorHandler.get_circuit_breaker_status-1042"><a href="#MCPErrorHandler.get_circuit_breaker_status-1042"><span class="linenos">1042</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get circuit breaker status for a specific service.</p>

<p>Args:
    service_name: Name of the service to check</p>

<p>Returns:
    Circuit breaker status or None if not found.</p>
</div>


                            </div>
                </section>
                <section id="CircuitBreaker">
                            <input id="CircuitBreaker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CircuitBreaker</span>:

                <label class="view-source-button" for="CircuitBreaker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker-1045"><a href="#CircuitBreaker-1045"><span class="linenos">1045</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreaker</span><span class="p">:</span>
</span><span id="CircuitBreaker-1046"><a href="#CircuitBreaker-1046"><span class="linenos">1046</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Circuit breaker implementation for external service calls.</span>
</span><span id="CircuitBreaker-1047"><a href="#CircuitBreaker-1047"><span class="linenos">1047</span></a>
</span><span id="CircuitBreaker-1048"><a href="#CircuitBreaker-1048"><span class="linenos">1048</span></a><span class="sd">    This class implements the circuit breaker pattern to prevent cascading failures</span>
</span><span id="CircuitBreaker-1049"><a href="#CircuitBreaker-1049"><span class="linenos">1049</span></a><span class="sd">    when external services are experiencing issues. It tracks failures and</span>
</span><span id="CircuitBreaker-1050"><a href="#CircuitBreaker-1050"><span class="linenos">1050</span></a><span class="sd">    automatically opens the circuit when the failure threshold is reached.</span>
</span><span id="CircuitBreaker-1051"><a href="#CircuitBreaker-1051"><span class="linenos">1051</span></a>
</span><span id="CircuitBreaker-1052"><a href="#CircuitBreaker-1052"><span class="linenos">1052</span></a><span class="sd">    Attributes:</span>
</span><span id="CircuitBreaker-1053"><a href="#CircuitBreaker-1053"><span class="linenos">1053</span></a><span class="sd">        config: Circuit breaker configuration</span>
</span><span id="CircuitBreaker-1054"><a href="#CircuitBreaker-1054"><span class="linenos">1054</span></a><span class="sd">        state: Current circuit breaker state</span>
</span><span id="CircuitBreaker-1055"><a href="#CircuitBreaker-1055"><span class="linenos">1055</span></a><span class="sd">        failure_count: Number of consecutive failures</span>
</span><span id="CircuitBreaker-1056"><a href="#CircuitBreaker-1056"><span class="linenos">1056</span></a><span class="sd">        success_count: Number of consecutive successes</span>
</span><span id="CircuitBreaker-1057"><a href="#CircuitBreaker-1057"><span class="linenos">1057</span></a><span class="sd">        last_failure_time: Timestamp of last failure</span>
</span><span id="CircuitBreaker-1058"><a href="#CircuitBreaker-1058"><span class="linenos">1058</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="CircuitBreaker-1059"><a href="#CircuitBreaker-1059"><span class="linenos">1059</span></a>
</span><span id="CircuitBreaker-1060"><a href="#CircuitBreaker-1060"><span class="linenos">1060</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1061"><a href="#CircuitBreaker-1061"><span class="linenos">1061</span></a>
</span><span id="CircuitBreaker-1062"><a href="#CircuitBreaker-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">CircuitBreakerConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1063"><a href="#CircuitBreaker-1063"><span class="linenos">1063</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the circuit breaker.</span>
</span><span id="CircuitBreaker-1064"><a href="#CircuitBreaker-1064"><span class="linenos">1064</span></a>
</span><span id="CircuitBreaker-1065"><a href="#CircuitBreaker-1065"><span class="linenos">1065</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker-1066"><a href="#CircuitBreaker-1066"><span class="linenos">1066</span></a><span class="sd">            service_name: Name of the service being protected</span>
</span><span id="CircuitBreaker-1067"><a href="#CircuitBreaker-1067"><span class="linenos">1067</span></a><span class="sd">            config: Circuit breaker configuration</span>
</span><span id="CircuitBreaker-1068"><a href="#CircuitBreaker-1068"><span class="linenos">1068</span></a>
</span><span id="CircuitBreaker-1069"><a href="#CircuitBreaker-1069"><span class="linenos">1069</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1070"><a href="#CircuitBreaker-1070"><span class="linenos">1070</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
</span><span id="CircuitBreaker-1071"><a href="#CircuitBreaker-1071"><span class="linenos">1071</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">CircuitBreakerConfig</span><span class="p">()</span>
</span><span id="CircuitBreaker-1072"><a href="#CircuitBreaker-1072"><span class="linenos">1072</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>
</span><span id="CircuitBreaker-1073"><a href="#CircuitBreaker-1073"><span class="linenos">1073</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1074"><a href="#CircuitBreaker-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1075"><a href="#CircuitBreaker-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CircuitBreaker-1076"><a href="#CircuitBreaker-1076"><span class="linenos">1076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="CircuitBreaker-1077"><a href="#CircuitBreaker-1077"><span class="linenos">1077</span></a>
</span><span id="CircuitBreaker-1078"><a href="#CircuitBreaker-1078"><span class="linenos">1078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">can_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="CircuitBreaker-1079"><a href="#CircuitBreaker-1079"><span class="linenos">1079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the circuit breaker allows execution.</span>
</span><span id="CircuitBreaker-1080"><a href="#CircuitBreaker-1080"><span class="linenos">1080</span></a>
</span><span id="CircuitBreaker-1081"><a href="#CircuitBreaker-1081"><span class="linenos">1081</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker-1082"><a href="#CircuitBreaker-1082"><span class="linenos">1082</span></a><span class="sd">            True if execution is allowed, False otherwise.</span>
</span><span id="CircuitBreaker-1083"><a href="#CircuitBreaker-1083"><span class="linenos">1083</span></a>
</span><span id="CircuitBreaker-1084"><a href="#CircuitBreaker-1084"><span class="linenos">1084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1085"><a href="#CircuitBreaker-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
</span><span id="CircuitBreaker-1086"><a href="#CircuitBreaker-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CircuitBreaker-1087"><a href="#CircuitBreaker-1087"><span class="linenos">1087</span></a>
</span><span id="CircuitBreaker-1088"><a href="#CircuitBreaker-1088"><span class="linenos">1088</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
</span><span id="CircuitBreaker-1089"><a href="#CircuitBreaker-1089"><span class="linenos">1089</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_attempt_reset</span><span class="p">():</span>
</span><span id="CircuitBreaker-1090"><a href="#CircuitBreaker-1090"><span class="linenos">1090</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_half_open</span><span class="p">()</span>
</span><span id="CircuitBreaker-1091"><a href="#CircuitBreaker-1091"><span class="linenos">1091</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CircuitBreaker-1092"><a href="#CircuitBreaker-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CircuitBreaker-1093"><a href="#CircuitBreaker-1093"><span class="linenos">1093</span></a>
</span><span id="CircuitBreaker-1094"><a href="#CircuitBreaker-1094"><span class="linenos">1094</span></a>        <span class="c1"># HALF_OPEN state - allow limited execution</span>
</span><span id="CircuitBreaker-1095"><a href="#CircuitBreaker-1095"><span class="linenos">1095</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="CircuitBreaker-1096"><a href="#CircuitBreaker-1096"><span class="linenos">1096</span></a>
</span><span id="CircuitBreaker-1097"><a href="#CircuitBreaker-1097"><span class="linenos">1097</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1098"><a href="#CircuitBreaker-1098"><span class="linenos">1098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a successful operation.&quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1099"><a href="#CircuitBreaker-1099"><span class="linenos">1099</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
</span><span id="CircuitBreaker-1100"><a href="#CircuitBreaker-1100"><span class="linenos">1100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CircuitBreaker-1101"><a href="#CircuitBreaker-1101"><span class="linenos">1101</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">:</span>
</span><span id="CircuitBreaker-1102"><a href="#CircuitBreaker-1102"><span class="linenos">1102</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_closed</span><span class="p">()</span>
</span><span id="CircuitBreaker-1103"><a href="#CircuitBreaker-1103"><span class="linenos">1103</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker closed&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="CircuitBreaker-1104"><a href="#CircuitBreaker-1104"><span class="linenos">1104</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CircuitBreaker-1105"><a href="#CircuitBreaker-1105"><span class="linenos">1105</span></a>            <span class="c1"># Reset failure count on success</span>
</span><span id="CircuitBreaker-1106"><a href="#CircuitBreaker-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1107"><a href="#CircuitBreaker-1107"><span class="linenos">1107</span></a>
</span><span id="CircuitBreaker-1108"><a href="#CircuitBreaker-1108"><span class="linenos">1108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1109"><a href="#CircuitBreaker-1109"><span class="linenos">1109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a failed operation.</span>
</span><span id="CircuitBreaker-1110"><a href="#CircuitBreaker-1110"><span class="linenos">1110</span></a>
</span><span id="CircuitBreaker-1111"><a href="#CircuitBreaker-1111"><span class="linenos">1111</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker-1112"><a href="#CircuitBreaker-1112"><span class="linenos">1112</span></a><span class="sd">            exception: The exception that occurred</span>
</span><span id="CircuitBreaker-1113"><a href="#CircuitBreaker-1113"><span class="linenos">1113</span></a>
</span><span id="CircuitBreaker-1114"><a href="#CircuitBreaker-1114"><span class="linenos">1114</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1115"><a href="#CircuitBreaker-1115"><span class="linenos">1115</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">expected_exception</span><span class="p">):</span>
</span><span id="CircuitBreaker-1116"><a href="#CircuitBreaker-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CircuitBreaker-1117"><a href="#CircuitBreaker-1117"><span class="linenos">1117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="CircuitBreaker-1118"><a href="#CircuitBreaker-1118"><span class="linenos">1118</span></a>
</span><span id="CircuitBreaker-1119"><a href="#CircuitBreaker-1119"><span class="linenos">1119</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">:</span>
</span><span id="CircuitBreaker-1120"><a href="#CircuitBreaker-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_open</span><span class="p">()</span>
</span><span id="CircuitBreaker-1121"><a href="#CircuitBreaker-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="CircuitBreaker-1122"><a href="#CircuitBreaker-1122"><span class="linenos">1122</span></a>                    <span class="s2">&quot;Circuit breaker opened&quot;</span><span class="p">,</span>
</span><span id="CircuitBreaker-1123"><a href="#CircuitBreaker-1123"><span class="linenos">1123</span></a>                    <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="CircuitBreaker-1124"><a href="#CircuitBreaker-1124"><span class="linenos">1124</span></a>                    <span class="n">failure_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="CircuitBreaker-1125"><a href="#CircuitBreaker-1125"><span class="linenos">1125</span></a>                <span class="p">)</span>
</span><span id="CircuitBreaker-1126"><a href="#CircuitBreaker-1126"><span class="linenos">1126</span></a>
</span><span id="CircuitBreaker-1127"><a href="#CircuitBreaker-1127"><span class="linenos">1127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_attempt_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="CircuitBreaker-1128"><a href="#CircuitBreaker-1128"><span class="linenos">1128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if enough time has passed to attempt reset.</span>
</span><span id="CircuitBreaker-1129"><a href="#CircuitBreaker-1129"><span class="linenos">1129</span></a>
</span><span id="CircuitBreaker-1130"><a href="#CircuitBreaker-1130"><span class="linenos">1130</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker-1131"><a href="#CircuitBreaker-1131"><span class="linenos">1131</span></a><span class="sd">            True if reset should be attempted.</span>
</span><span id="CircuitBreaker-1132"><a href="#CircuitBreaker-1132"><span class="linenos">1132</span></a>
</span><span id="CircuitBreaker-1133"><a href="#CircuitBreaker-1133"><span class="linenos">1133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1134"><a href="#CircuitBreaker-1134"><span class="linenos">1134</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1135"><a href="#CircuitBreaker-1135"><span class="linenos">1135</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CircuitBreaker-1136"><a href="#CircuitBreaker-1136"><span class="linenos">1136</span></a>
</span><span id="CircuitBreaker-1137"><a href="#CircuitBreaker-1137"><span class="linenos">1137</span></a>        <span class="n">time_since_failure</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="CircuitBreaker-1138"><a href="#CircuitBreaker-1138"><span class="linenos">1138</span></a>        <span class="k">return</span> <span class="n">time_since_failure</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recovery_timeout</span>
</span><span id="CircuitBreaker-1139"><a href="#CircuitBreaker-1139"><span class="linenos">1139</span></a>
</span><span id="CircuitBreaker-1140"><a href="#CircuitBreaker-1140"><span class="linenos">1140</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_half_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1141"><a href="#CircuitBreaker-1141"><span class="linenos">1141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to half-open state.&quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1142"><a href="#CircuitBreaker-1142"><span class="linenos">1142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span>
</span><span id="CircuitBreaker-1143"><a href="#CircuitBreaker-1143"><span class="linenos">1143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1144"><a href="#CircuitBreaker-1144"><span class="linenos">1144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker set to half-open&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="CircuitBreaker-1145"><a href="#CircuitBreaker-1145"><span class="linenos">1145</span></a>
</span><span id="CircuitBreaker-1146"><a href="#CircuitBreaker-1146"><span class="linenos">1146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1147"><a href="#CircuitBreaker-1147"><span class="linenos">1147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to open state.&quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1148"><a href="#CircuitBreaker-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="CircuitBreaker-1149"><a href="#CircuitBreaker-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Circuit breaker opened&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="CircuitBreaker-1150"><a href="#CircuitBreaker-1150"><span class="linenos">1150</span></a>
</span><span id="CircuitBreaker-1151"><a href="#CircuitBreaker-1151"><span class="linenos">1151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker-1152"><a href="#CircuitBreaker-1152"><span class="linenos">1152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set circuit breaker to closed state.&quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1153"><a href="#CircuitBreaker-1153"><span class="linenos">1153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>
</span><span id="CircuitBreaker-1154"><a href="#CircuitBreaker-1154"><span class="linenos">1154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1155"><a href="#CircuitBreaker-1155"><span class="linenos">1155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker-1156"><a href="#CircuitBreaker-1156"><span class="linenos">1156</span></a>
</span><span id="CircuitBreaker-1157"><a href="#CircuitBreaker-1157"><span class="linenos">1157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="CircuitBreaker-1158"><a href="#CircuitBreaker-1158"><span class="linenos">1158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current status of the circuit breaker.</span>
</span><span id="CircuitBreaker-1159"><a href="#CircuitBreaker-1159"><span class="linenos">1159</span></a>
</span><span id="CircuitBreaker-1160"><a href="#CircuitBreaker-1160"><span class="linenos">1160</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker-1161"><a href="#CircuitBreaker-1161"><span class="linenos">1161</span></a><span class="sd">            Dictionary containing circuit breaker status.</span>
</span><span id="CircuitBreaker-1162"><a href="#CircuitBreaker-1162"><span class="linenos">1162</span></a>
</span><span id="CircuitBreaker-1163"><a href="#CircuitBreaker-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1164"><a href="#CircuitBreaker-1164"><span class="linenos">1164</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="CircuitBreaker-1165"><a href="#CircuitBreaker-1165"><span class="linenos">1165</span></a>            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="CircuitBreaker-1166"><a href="#CircuitBreaker-1166"><span class="linenos">1166</span></a>            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="CircuitBreaker-1167"><a href="#CircuitBreaker-1167"><span class="linenos">1167</span></a>            <span class="s2">&quot;failure_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="CircuitBreaker-1168"><a href="#CircuitBreaker-1168"><span class="linenos">1168</span></a>            <span class="s2">&quot;success_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span><span class="p">,</span>
</span><span id="CircuitBreaker-1169"><a href="#CircuitBreaker-1169"><span class="linenos">1169</span></a>            <span class="s2">&quot;last_failure_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="CircuitBreaker-1170"><a href="#CircuitBreaker-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span>
</span><span id="CircuitBreaker-1171"><a href="#CircuitBreaker-1171"><span class="linenos">1171</span></a>            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CircuitBreaker-1172"><a href="#CircuitBreaker-1172"><span class="linenos">1172</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="CircuitBreaker-1173"><a href="#CircuitBreaker-1173"><span class="linenos">1173</span></a>                <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="CircuitBreaker-1174"><a href="#CircuitBreaker-1174"><span class="linenos">1174</span></a>                <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="CircuitBreaker-1175"><a href="#CircuitBreaker-1175"><span class="linenos">1175</span></a>                <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="CircuitBreaker-1176"><a href="#CircuitBreaker-1176"><span class="linenos">1176</span></a>            <span class="p">},</span>
</span><span id="CircuitBreaker-1177"><a href="#CircuitBreaker-1177"><span class="linenos">1177</span></a>        <span class="p">}</span>
</span><span id="CircuitBreaker-1178"><a href="#CircuitBreaker-1178"><span class="linenos">1178</span></a>
</span><span id="CircuitBreaker-1179"><a href="#CircuitBreaker-1179"><span class="linenos">1179</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">error_handler</span><span class="p">:</span> <span class="s2">&quot;MCPErrorHandler&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CircuitBreaker-1180"><a href="#CircuitBreaker-1180"><span class="linenos">1180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with circuit breaker protection.</span>
</span><span id="CircuitBreaker-1181"><a href="#CircuitBreaker-1181"><span class="linenos">1181</span></a>
</span><span id="CircuitBreaker-1182"><a href="#CircuitBreaker-1182"><span class="linenos">1182</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker-1183"><a href="#CircuitBreaker-1183"><span class="linenos">1183</span></a><span class="sd">            coro_factory: Coroutine factory function or callable</span>
</span><span id="CircuitBreaker-1184"><a href="#CircuitBreaker-1184"><span class="linenos">1184</span></a><span class="sd">            error_handler: MCPErrorHandler instance for error responses</span>
</span><span id="CircuitBreaker-1185"><a href="#CircuitBreaker-1185"><span class="linenos">1185</span></a>
</span><span id="CircuitBreaker-1186"><a href="#CircuitBreaker-1186"><span class="linenos">1186</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker-1187"><a href="#CircuitBreaker-1187"><span class="linenos">1187</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="CircuitBreaker-1188"><a href="#CircuitBreaker-1188"><span class="linenos">1188</span></a>
</span><span id="CircuitBreaker-1189"><a href="#CircuitBreaker-1189"><span class="linenos">1189</span></a><span class="sd">        Raises:</span>
</span><span id="CircuitBreaker-1190"><a href="#CircuitBreaker-1190"><span class="linenos">1190</span></a><span class="sd">            Exception: If the circuit breaker is open or execution fails.</span>
</span><span id="CircuitBreaker-1191"><a href="#CircuitBreaker-1191"><span class="linenos">1191</span></a>
</span><span id="CircuitBreaker-1192"><a href="#CircuitBreaker-1192"><span class="linenos">1192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker-1193"><a href="#CircuitBreaker-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_execute</span><span class="p">():</span>
</span><span id="CircuitBreaker-1194"><a href="#CircuitBreaker-1194"><span class="linenos">1194</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker is open for service &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="CircuitBreaker-1195"><a href="#CircuitBreaker-1195"><span class="linenos">1195</span></a>
</span><span id="CircuitBreaker-1196"><a href="#CircuitBreaker-1196"><span class="linenos">1196</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CircuitBreaker-1197"><a href="#CircuitBreaker-1197"><span class="linenos">1197</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="CircuitBreaker-1198"><a href="#CircuitBreaker-1198"><span class="linenos">1198</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="CircuitBreaker-1199"><a href="#CircuitBreaker-1199"><span class="linenos">1199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CircuitBreaker-1200"><a href="#CircuitBreaker-1200"><span class="linenos">1200</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="CircuitBreaker-1201"><a href="#CircuitBreaker-1201"><span class="linenos">1201</span></a>
</span><span id="CircuitBreaker-1202"><a href="#CircuitBreaker-1202"><span class="linenos">1202</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="CircuitBreaker-1203"><a href="#CircuitBreaker-1203"><span class="linenos">1203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_success</span><span class="p">()</span>
</span><span id="CircuitBreaker-1204"><a href="#CircuitBreaker-1204"><span class="linenos">1204</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="CircuitBreaker-1205"><a href="#CircuitBreaker-1205"><span class="linenos">1205</span></a>
</span><span id="CircuitBreaker-1206"><a href="#CircuitBreaker-1206"><span class="linenos">1206</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CircuitBreaker-1207"><a href="#CircuitBreaker-1207"><span class="linenos">1207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="CircuitBreaker-1208"><a href="#CircuitBreaker-1208"><span class="linenos">1208</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Circuit breaker implementation for external service calls.</p>

<p>This class implements the circuit breaker pattern to prevent cascading failures
when external services are experiencing issues. It tracks failures and
automatically opens the circuit when the failure threshold is reached.</p>

<p>Attributes:
    config: Circuit breaker configuration
    state: Current circuit breaker state
    failure_count: Number of consecutive failures
    success_count: Number of consecutive successes
    last_failure_time: Timestamp of last failure
    logger: Structured logger instance</p>
</div>


                            <div id="CircuitBreaker.__init__" class="classattr">
                                        <input id="CircuitBreaker.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CircuitBreaker</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="n"><a href="#CircuitBreakerConfig">CircuitBreakerConfig</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="CircuitBreaker.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.__init__-1062"><a href="#CircuitBreaker.__init__-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">CircuitBreakerConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker.__init__-1063"><a href="#CircuitBreaker.__init__-1063"><span class="linenos">1063</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the circuit breaker.</span>
</span><span id="CircuitBreaker.__init__-1064"><a href="#CircuitBreaker.__init__-1064"><span class="linenos">1064</span></a>
</span><span id="CircuitBreaker.__init__-1065"><a href="#CircuitBreaker.__init__-1065"><span class="linenos">1065</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker.__init__-1066"><a href="#CircuitBreaker.__init__-1066"><span class="linenos">1066</span></a><span class="sd">            service_name: Name of the service being protected</span>
</span><span id="CircuitBreaker.__init__-1067"><a href="#CircuitBreaker.__init__-1067"><span class="linenos">1067</span></a><span class="sd">            config: Circuit breaker configuration</span>
</span><span id="CircuitBreaker.__init__-1068"><a href="#CircuitBreaker.__init__-1068"><span class="linenos">1068</span></a>
</span><span id="CircuitBreaker.__init__-1069"><a href="#CircuitBreaker.__init__-1069"><span class="linenos">1069</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.__init__-1070"><a href="#CircuitBreaker.__init__-1070"><span class="linenos">1070</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
</span><span id="CircuitBreaker.__init__-1071"><a href="#CircuitBreaker.__init__-1071"><span class="linenos">1071</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">CircuitBreakerConfig</span><span class="p">()</span>
</span><span id="CircuitBreaker.__init__-1072"><a href="#CircuitBreaker.__init__-1072"><span class="linenos">1072</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>
</span><span id="CircuitBreaker.__init__-1073"><a href="#CircuitBreaker.__init__-1073"><span class="linenos">1073</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker.__init__-1074"><a href="#CircuitBreaker.__init__-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="CircuitBreaker.__init__-1075"><a href="#CircuitBreaker.__init__-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CircuitBreaker.__init__-1076"><a href="#CircuitBreaker.__init__-1076"><span class="linenos">1076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the circuit breaker.</p>

<p>Args:
    service_name: Name of the service being protected
    config: Circuit breaker configuration</p>
</div>


                            </div>
                            <div id="CircuitBreaker.service_name" class="classattr">
                                <div class="attr variable">
            <span class="name">service_name</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.service_name"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.config"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.state" class="classattr">
                                <div class="attr variable">
            <span class="name">state</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.state"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.failure_count" class="classattr">
                                <div class="attr variable">
            <span class="name">failure_count</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.failure_count"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.success_count" class="classattr">
                                <div class="attr variable">
            <span class="name">success_count</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.success_count"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.last_failure_time" class="classattr">
                                <div class="attr variable">
            <span class="name">last_failure_time</span><span class="annotation">: datetime.datetime | None</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.last_failure_time"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#CircuitBreaker.logger"></a>
    
    

                            </div>
                            <div id="CircuitBreaker.can_execute" class="classattr">
                                        <input id="CircuitBreaker.can_execute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">can_execute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="CircuitBreaker.can_execute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.can_execute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.can_execute-1078"><a href="#CircuitBreaker.can_execute-1078"><span class="linenos">1078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">can_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="CircuitBreaker.can_execute-1079"><a href="#CircuitBreaker.can_execute-1079"><span class="linenos">1079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the circuit breaker allows execution.</span>
</span><span id="CircuitBreaker.can_execute-1080"><a href="#CircuitBreaker.can_execute-1080"><span class="linenos">1080</span></a>
</span><span id="CircuitBreaker.can_execute-1081"><a href="#CircuitBreaker.can_execute-1081"><span class="linenos">1081</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker.can_execute-1082"><a href="#CircuitBreaker.can_execute-1082"><span class="linenos">1082</span></a><span class="sd">            True if execution is allowed, False otherwise.</span>
</span><span id="CircuitBreaker.can_execute-1083"><a href="#CircuitBreaker.can_execute-1083"><span class="linenos">1083</span></a>
</span><span id="CircuitBreaker.can_execute-1084"><a href="#CircuitBreaker.can_execute-1084"><span class="linenos">1084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.can_execute-1085"><a href="#CircuitBreaker.can_execute-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
</span><span id="CircuitBreaker.can_execute-1086"><a href="#CircuitBreaker.can_execute-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="CircuitBreaker.can_execute-1087"><a href="#CircuitBreaker.can_execute-1087"><span class="linenos">1087</span></a>
</span><span id="CircuitBreaker.can_execute-1088"><a href="#CircuitBreaker.can_execute-1088"><span class="linenos">1088</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
</span><span id="CircuitBreaker.can_execute-1089"><a href="#CircuitBreaker.can_execute-1089"><span class="linenos">1089</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_attempt_reset</span><span class="p">():</span>
</span><span id="CircuitBreaker.can_execute-1090"><a href="#CircuitBreaker.can_execute-1090"><span class="linenos">1090</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_half_open</span><span class="p">()</span>
</span><span id="CircuitBreaker.can_execute-1091"><a href="#CircuitBreaker.can_execute-1091"><span class="linenos">1091</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CircuitBreaker.can_execute-1092"><a href="#CircuitBreaker.can_execute-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CircuitBreaker.can_execute-1093"><a href="#CircuitBreaker.can_execute-1093"><span class="linenos">1093</span></a>
</span><span id="CircuitBreaker.can_execute-1094"><a href="#CircuitBreaker.can_execute-1094"><span class="linenos">1094</span></a>        <span class="c1"># HALF_OPEN state - allow limited execution</span>
</span><span id="CircuitBreaker.can_execute-1095"><a href="#CircuitBreaker.can_execute-1095"><span class="linenos">1095</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Check if the circuit breaker allows execution.</p>

<p>Returns:
    True if execution is allowed, False otherwise.</p>
</div>


                            </div>
                            <div id="CircuitBreaker.on_success" class="classattr">
                                        <input id="CircuitBreaker.on_success-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_success</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="CircuitBreaker.on_success-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.on_success"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.on_success-1097"><a href="#CircuitBreaker.on_success-1097"><span class="linenos">1097</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_success-1098"><a href="#CircuitBreaker.on_success-1098"><span class="linenos">1098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a successful operation.&quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.on_success-1099"><a href="#CircuitBreaker.on_success-1099"><span class="linenos">1099</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_success-1100"><a href="#CircuitBreaker.on_success-1100"><span class="linenos">1100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CircuitBreaker.on_success-1101"><a href="#CircuitBreaker.on_success-1101"><span class="linenos">1101</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_success-1102"><a href="#CircuitBreaker.on_success-1102"><span class="linenos">1102</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_closed</span><span class="p">()</span>
</span><span id="CircuitBreaker.on_success-1103"><a href="#CircuitBreaker.on_success-1103"><span class="linenos">1103</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Circuit breaker closed&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>
</span><span id="CircuitBreaker.on_success-1104"><a href="#CircuitBreaker.on_success-1104"><span class="linenos">1104</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_success-1105"><a href="#CircuitBreaker.on_success-1105"><span class="linenos">1105</span></a>            <span class="c1"># Reset failure count on success</span>
</span><span id="CircuitBreaker.on_success-1106"><a href="#CircuitBreaker.on_success-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Record a successful operation.</p>
</div>


                            </div>
                            <div id="CircuitBreaker.on_failure" class="classattr">
                                        <input id="CircuitBreaker.on_failure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_failure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="CircuitBreaker.on_failure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.on_failure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.on_failure-1108"><a href="#CircuitBreaker.on_failure-1108"><span class="linenos">1108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_failure-1109"><a href="#CircuitBreaker.on_failure-1109"><span class="linenos">1109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a failed operation.</span>
</span><span id="CircuitBreaker.on_failure-1110"><a href="#CircuitBreaker.on_failure-1110"><span class="linenos">1110</span></a>
</span><span id="CircuitBreaker.on_failure-1111"><a href="#CircuitBreaker.on_failure-1111"><span class="linenos">1111</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker.on_failure-1112"><a href="#CircuitBreaker.on_failure-1112"><span class="linenos">1112</span></a><span class="sd">            exception: The exception that occurred</span>
</span><span id="CircuitBreaker.on_failure-1113"><a href="#CircuitBreaker.on_failure-1113"><span class="linenos">1113</span></a>
</span><span id="CircuitBreaker.on_failure-1114"><a href="#CircuitBreaker.on_failure-1114"><span class="linenos">1114</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.on_failure-1115"><a href="#CircuitBreaker.on_failure-1115"><span class="linenos">1115</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">expected_exception</span><span class="p">):</span>
</span><span id="CircuitBreaker.on_failure-1116"><a href="#CircuitBreaker.on_failure-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="CircuitBreaker.on_failure-1117"><a href="#CircuitBreaker.on_failure-1117"><span class="linenos">1117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="CircuitBreaker.on_failure-1118"><a href="#CircuitBreaker.on_failure-1118"><span class="linenos">1118</span></a>
</span><span id="CircuitBreaker.on_failure-1119"><a href="#CircuitBreaker.on_failure-1119"><span class="linenos">1119</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">:</span>
</span><span id="CircuitBreaker.on_failure-1120"><a href="#CircuitBreaker.on_failure-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_set_open</span><span class="p">()</span>
</span><span id="CircuitBreaker.on_failure-1121"><a href="#CircuitBreaker.on_failure-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="CircuitBreaker.on_failure-1122"><a href="#CircuitBreaker.on_failure-1122"><span class="linenos">1122</span></a>                    <span class="s2">&quot;Circuit breaker opened&quot;</span><span class="p">,</span>
</span><span id="CircuitBreaker.on_failure-1123"><a href="#CircuitBreaker.on_failure-1123"><span class="linenos">1123</span></a>                    <span class="n">service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="CircuitBreaker.on_failure-1124"><a href="#CircuitBreaker.on_failure-1124"><span class="linenos">1124</span></a>                    <span class="n">failure_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="CircuitBreaker.on_failure-1125"><a href="#CircuitBreaker.on_failure-1125"><span class="linenos">1125</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Record a failed operation.</p>

<p>Args:
    exception: The exception that occurred</p>
</div>


                            </div>
                            <div id="CircuitBreaker.get_status" class="classattr">
                                        <input id="CircuitBreaker.get_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="CircuitBreaker.get_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.get_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.get_status-1157"><a href="#CircuitBreaker.get_status-1157"><span class="linenos">1157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="CircuitBreaker.get_status-1158"><a href="#CircuitBreaker.get_status-1158"><span class="linenos">1158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current status of the circuit breaker.</span>
</span><span id="CircuitBreaker.get_status-1159"><a href="#CircuitBreaker.get_status-1159"><span class="linenos">1159</span></a>
</span><span id="CircuitBreaker.get_status-1160"><a href="#CircuitBreaker.get_status-1160"><span class="linenos">1160</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker.get_status-1161"><a href="#CircuitBreaker.get_status-1161"><span class="linenos">1161</span></a><span class="sd">            Dictionary containing circuit breaker status.</span>
</span><span id="CircuitBreaker.get_status-1162"><a href="#CircuitBreaker.get_status-1162"><span class="linenos">1162</span></a>
</span><span id="CircuitBreaker.get_status-1163"><a href="#CircuitBreaker.get_status-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.get_status-1164"><a href="#CircuitBreaker.get_status-1164"><span class="linenos">1164</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="CircuitBreaker.get_status-1165"><a href="#CircuitBreaker.get_status-1165"><span class="linenos">1165</span></a>            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1166"><a href="#CircuitBreaker.get_status-1166"><span class="linenos">1166</span></a>            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1167"><a href="#CircuitBreaker.get_status-1167"><span class="linenos">1167</span></a>            <span class="s2">&quot;failure_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1168"><a href="#CircuitBreaker.get_status-1168"><span class="linenos">1168</span></a>            <span class="s2">&quot;success_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1169"><a href="#CircuitBreaker.get_status-1169"><span class="linenos">1169</span></a>            <span class="s2">&quot;last_failure_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="CircuitBreaker.get_status-1170"><a href="#CircuitBreaker.get_status-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_failure_time</span>
</span><span id="CircuitBreaker.get_status-1171"><a href="#CircuitBreaker.get_status-1171"><span class="linenos">1171</span></a>            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1172"><a href="#CircuitBreaker.get_status-1172"><span class="linenos">1172</span></a>            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="CircuitBreaker.get_status-1173"><a href="#CircuitBreaker.get_status-1173"><span class="linenos">1173</span></a>                <span class="s2">&quot;failure_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1174"><a href="#CircuitBreaker.get_status-1174"><span class="linenos">1174</span></a>                <span class="s2">&quot;recovery_timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">recovery_timeout</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1175"><a href="#CircuitBreaker.get_status-1175"><span class="linenos">1175</span></a>                <span class="s2">&quot;success_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">success_threshold</span><span class="p">,</span>
</span><span id="CircuitBreaker.get_status-1176"><a href="#CircuitBreaker.get_status-1176"><span class="linenos">1176</span></a>            <span class="p">},</span>
</span><span id="CircuitBreaker.get_status-1177"><a href="#CircuitBreaker.get_status-1177"><span class="linenos">1177</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get the current status of the circuit breaker.</p>

<p>Returns:
    Dictionary containing circuit breaker status.</p>
</div>


                            </div>
                            <div id="CircuitBreaker.execute" class="classattr">
                                        <input id="CircuitBreaker.execute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">execute</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">error_handler</span><span class="p">:</span> <span class="n"><a href="#MCPErrorHandler">MCPErrorHandler</a></span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="CircuitBreaker.execute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CircuitBreaker.execute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CircuitBreaker.execute-1179"><a href="#CircuitBreaker.execute-1179"><span class="linenos">1179</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro_factory</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">error_handler</span><span class="p">:</span> <span class="s2">&quot;MCPErrorHandler&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="CircuitBreaker.execute-1180"><a href="#CircuitBreaker.execute-1180"><span class="linenos">1180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a coroutine with circuit breaker protection.</span>
</span><span id="CircuitBreaker.execute-1181"><a href="#CircuitBreaker.execute-1181"><span class="linenos">1181</span></a>
</span><span id="CircuitBreaker.execute-1182"><a href="#CircuitBreaker.execute-1182"><span class="linenos">1182</span></a><span class="sd">        Args:</span>
</span><span id="CircuitBreaker.execute-1183"><a href="#CircuitBreaker.execute-1183"><span class="linenos">1183</span></a><span class="sd">            coro_factory: Coroutine factory function or callable</span>
</span><span id="CircuitBreaker.execute-1184"><a href="#CircuitBreaker.execute-1184"><span class="linenos">1184</span></a><span class="sd">            error_handler: MCPErrorHandler instance for error responses</span>
</span><span id="CircuitBreaker.execute-1185"><a href="#CircuitBreaker.execute-1185"><span class="linenos">1185</span></a>
</span><span id="CircuitBreaker.execute-1186"><a href="#CircuitBreaker.execute-1186"><span class="linenos">1186</span></a><span class="sd">        Returns:</span>
</span><span id="CircuitBreaker.execute-1187"><a href="#CircuitBreaker.execute-1187"><span class="linenos">1187</span></a><span class="sd">            Result of the coroutine execution.</span>
</span><span id="CircuitBreaker.execute-1188"><a href="#CircuitBreaker.execute-1188"><span class="linenos">1188</span></a>
</span><span id="CircuitBreaker.execute-1189"><a href="#CircuitBreaker.execute-1189"><span class="linenos">1189</span></a><span class="sd">        Raises:</span>
</span><span id="CircuitBreaker.execute-1190"><a href="#CircuitBreaker.execute-1190"><span class="linenos">1190</span></a><span class="sd">            Exception: If the circuit breaker is open or execution fails.</span>
</span><span id="CircuitBreaker.execute-1191"><a href="#CircuitBreaker.execute-1191"><span class="linenos">1191</span></a>
</span><span id="CircuitBreaker.execute-1192"><a href="#CircuitBreaker.execute-1192"><span class="linenos">1192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CircuitBreaker.execute-1193"><a href="#CircuitBreaker.execute-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_execute</span><span class="p">():</span>
</span><span id="CircuitBreaker.execute-1194"><a href="#CircuitBreaker.execute-1194"><span class="linenos">1194</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker is open for service &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="CircuitBreaker.execute-1195"><a href="#CircuitBreaker.execute-1195"><span class="linenos">1195</span></a>
</span><span id="CircuitBreaker.execute-1196"><a href="#CircuitBreaker.execute-1196"><span class="linenos">1196</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CircuitBreaker.execute-1197"><a href="#CircuitBreaker.execute-1197"><span class="linenos">1197</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">coro_factory</span><span class="p">):</span>
</span><span id="CircuitBreaker.execute-1198"><a href="#CircuitBreaker.execute-1198"><span class="linenos">1198</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span><span class="p">()</span>
</span><span id="CircuitBreaker.execute-1199"><a href="#CircuitBreaker.execute-1199"><span class="linenos">1199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CircuitBreaker.execute-1200"><a href="#CircuitBreaker.execute-1200"><span class="linenos">1200</span></a>                <span class="n">coro</span> <span class="o">=</span> <span class="n">coro_factory</span>
</span><span id="CircuitBreaker.execute-1201"><a href="#CircuitBreaker.execute-1201"><span class="linenos">1201</span></a>
</span><span id="CircuitBreaker.execute-1202"><a href="#CircuitBreaker.execute-1202"><span class="linenos">1202</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
</span><span id="CircuitBreaker.execute-1203"><a href="#CircuitBreaker.execute-1203"><span class="linenos">1203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_success</span><span class="p">()</span>
</span><span id="CircuitBreaker.execute-1204"><a href="#CircuitBreaker.execute-1204"><span class="linenos">1204</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="CircuitBreaker.execute-1205"><a href="#CircuitBreaker.execute-1205"><span class="linenos">1205</span></a>
</span><span id="CircuitBreaker.execute-1206"><a href="#CircuitBreaker.execute-1206"><span class="linenos">1206</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CircuitBreaker.execute-1207"><a href="#CircuitBreaker.execute-1207"><span class="linenos">1207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="CircuitBreaker.execute-1208"><a href="#CircuitBreaker.execute-1208"><span class="linenos">1208</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Execute a coroutine with circuit breaker protection.</p>

<p>Args:
    coro_factory: Coroutine factory function or callable
    error_handler: MCPErrorHandler instance for error responses</p>

<p>Returns:
    Result of the coroutine execution.</p>

<p>Raises:
    Exception: If the circuit breaker is open or execution fails.</p>
</div>


                            </div>
                </section>
                <section id="ErrorAggregator">
                            <input id="ErrorAggregator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ErrorAggregator</span>:

                <label class="view-source-button" for="ErrorAggregator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator-1211"><a href="#ErrorAggregator-1211"><span class="linenos">1211</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ErrorAggregator</span><span class="p">:</span>
</span><span id="ErrorAggregator-1212"><a href="#ErrorAggregator-1212"><span class="linenos">1212</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Error aggregation and analytics for monitoring and debugging.</span>
</span><span id="ErrorAggregator-1213"><a href="#ErrorAggregator-1213"><span class="linenos">1213</span></a>
</span><span id="ErrorAggregator-1214"><a href="#ErrorAggregator-1214"><span class="linenos">1214</span></a><span class="sd">    This class tracks error patterns, frequencies, and trends to help</span>
</span><span id="ErrorAggregator-1215"><a href="#ErrorAggregator-1215"><span class="linenos">1215</span></a><span class="sd">    identify systemic issues and provide insights for debugging.</span>
</span><span id="ErrorAggregator-1216"><a href="#ErrorAggregator-1216"><span class="linenos">1216</span></a>
</span><span id="ErrorAggregator-1217"><a href="#ErrorAggregator-1217"><span class="linenos">1217</span></a><span class="sd">    Attributes:</span>
</span><span id="ErrorAggregator-1218"><a href="#ErrorAggregator-1218"><span class="linenos">1218</span></a><span class="sd">        config: Error aggregation configuration</span>
</span><span id="ErrorAggregator-1219"><a href="#ErrorAggregator-1219"><span class="linenos">1219</span></a><span class="sd">        error_counts: Count of errors by type and time window</span>
</span><span id="ErrorAggregator-1220"><a href="#ErrorAggregator-1220"><span class="linenos">1220</span></a><span class="sd">        error_history: Recent error history for analysis</span>
</span><span id="ErrorAggregator-1221"><a href="#ErrorAggregator-1221"><span class="linenos">1221</span></a><span class="sd">        logger: Structured logger instance</span>
</span><span id="ErrorAggregator-1222"><a href="#ErrorAggregator-1222"><span class="linenos">1222</span></a>
</span><span id="ErrorAggregator-1223"><a href="#ErrorAggregator-1223"><span class="linenos">1223</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1224"><a href="#ErrorAggregator-1224"><span class="linenos">1224</span></a>
</span><span id="ErrorAggregator-1225"><a href="#ErrorAggregator-1225"><span class="linenos">1225</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator-1226"><a href="#ErrorAggregator-1226"><span class="linenos">1226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the error aggregator.</span>
</span><span id="ErrorAggregator-1227"><a href="#ErrorAggregator-1227"><span class="linenos">1227</span></a>
</span><span id="ErrorAggregator-1228"><a href="#ErrorAggregator-1228"><span class="linenos">1228</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1229"><a href="#ErrorAggregator-1229"><span class="linenos">1229</span></a><span class="sd">            config: Error aggregation configuration</span>
</span><span id="ErrorAggregator-1230"><a href="#ErrorAggregator-1230"><span class="linenos">1230</span></a>
</span><span id="ErrorAggregator-1231"><a href="#ErrorAggregator-1231"><span class="linenos">1231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1232"><a href="#ErrorAggregator-1232"><span class="linenos">1232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="ErrorAggregator-1233"><a href="#ErrorAggregator-1233"><span class="linenos">1233</span></a>            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorAggregator-1234"><a href="#ErrorAggregator-1234"><span class="linenos">1234</span></a>            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># 5 minutes</span>
</span><span id="ErrorAggregator-1235"><a href="#ErrorAggregator-1235"><span class="linenos">1235</span></a>            <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="ErrorAggregator-1236"><a href="#ErrorAggregator-1236"><span class="linenos">1236</span></a>            <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="ErrorAggregator-1237"><a href="#ErrorAggregator-1237"><span class="linenos">1237</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator-1238"><a href="#ErrorAggregator-1238"><span class="linenos">1238</span></a>
</span><span id="ErrorAggregator-1239"><a href="#ErrorAggregator-1239"><span class="linenos">1239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ErrorAggregator-1240"><a href="#ErrorAggregator-1240"><span class="linenos">1240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="p">:</span> <span class="n">deque</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;history_size&quot;</span><span class="p">])</span>
</span><span id="ErrorAggregator-1241"><a href="#ErrorAggregator-1241"><span class="linenos">1241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="ErrorAggregator-1242"><a href="#ErrorAggregator-1242"><span class="linenos">1242</span></a>
</span><span id="ErrorAggregator-1243"><a href="#ErrorAggregator-1243"><span class="linenos">1243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator-1244"><a href="#ErrorAggregator-1244"><span class="linenos">1244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record an error occurrence.</span>
</span><span id="ErrorAggregator-1245"><a href="#ErrorAggregator-1245"><span class="linenos">1245</span></a>
</span><span id="ErrorAggregator-1246"><a href="#ErrorAggregator-1246"><span class="linenos">1246</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1247"><a href="#ErrorAggregator-1247"><span class="linenos">1247</span></a><span class="sd">            error_code: JSON-RPC error code</span>
</span><span id="ErrorAggregator-1248"><a href="#ErrorAggregator-1248"><span class="linenos">1248</span></a><span class="sd">            error_type: Type of error (e.g., &#39;timeout&#39;, &#39;validation&#39;, &#39;external_service&#39;)</span>
</span><span id="ErrorAggregator-1249"><a href="#ErrorAggregator-1249"><span class="linenos">1249</span></a><span class="sd">            context: Additional context about the error</span>
</span><span id="ErrorAggregator-1250"><a href="#ErrorAggregator-1250"><span class="linenos">1250</span></a>
</span><span id="ErrorAggregator-1251"><a href="#ErrorAggregator-1251"><span class="linenos">1251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1252"><a href="#ErrorAggregator-1252"><span class="linenos">1252</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="ErrorAggregator-1253"><a href="#ErrorAggregator-1253"><span class="linenos">1253</span></a>            <span class="k">return</span>
</span><span id="ErrorAggregator-1254"><a href="#ErrorAggregator-1254"><span class="linenos">1254</span></a>
</span><span id="ErrorAggregator-1255"><a href="#ErrorAggregator-1255"><span class="linenos">1255</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="ErrorAggregator-1256"><a href="#ErrorAggregator-1256"><span class="linenos">1256</span></a>
</span><span id="ErrorAggregator-1257"><a href="#ErrorAggregator-1257"><span class="linenos">1257</span></a>        <span class="c1"># Record error count</span>
</span><span id="ErrorAggregator-1258"><a href="#ErrorAggregator-1258"><span class="linenos">1258</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ErrorAggregator-1259"><a href="#ErrorAggregator-1259"><span class="linenos">1259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator-1260"><a href="#ErrorAggregator-1260"><span class="linenos">1260</span></a>
</span><span id="ErrorAggregator-1261"><a href="#ErrorAggregator-1261"><span class="linenos">1261</span></a>        <span class="c1"># Record error history</span>
</span><span id="ErrorAggregator-1262"><a href="#ErrorAggregator-1262"><span class="linenos">1262</span></a>        <span class="n">error_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ErrorAggregator-1263"><a href="#ErrorAggregator-1263"><span class="linenos">1263</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
</span><span id="ErrorAggregator-1264"><a href="#ErrorAggregator-1264"><span class="linenos">1264</span></a>            <span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="n">error_code</span><span class="p">,</span>
</span><span id="ErrorAggregator-1265"><a href="#ErrorAggregator-1265"><span class="linenos">1265</span></a>            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="ErrorAggregator-1266"><a href="#ErrorAggregator-1266"><span class="linenos">1266</span></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="ErrorAggregator-1267"><a href="#ErrorAggregator-1267"><span class="linenos">1267</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator-1268"><a href="#ErrorAggregator-1268"><span class="linenos">1268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_record</span><span class="p">)</span>
</span><span id="ErrorAggregator-1269"><a href="#ErrorAggregator-1269"><span class="linenos">1269</span></a>
</span><span id="ErrorAggregator-1270"><a href="#ErrorAggregator-1270"><span class="linenos">1270</span></a>        <span class="c1"># Check if we&#39;re exceeding error thresholds</span>
</span><span id="ErrorAggregator-1271"><a href="#ErrorAggregator-1271"><span class="linenos">1271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_error_thresholds</span><span class="p">(</span><span class="n">error_type</span><span class="p">)</span>
</span><span id="ErrorAggregator-1272"><a href="#ErrorAggregator-1272"><span class="linenos">1272</span></a>
</span><span id="ErrorAggregator-1273"><a href="#ErrorAggregator-1273"><span class="linenos">1273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_error_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator-1274"><a href="#ErrorAggregator-1274"><span class="linenos">1274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if error thresholds are exceeded and log warnings.</span>
</span><span id="ErrorAggregator-1275"><a href="#ErrorAggregator-1275"><span class="linenos">1275</span></a>
</span><span id="ErrorAggregator-1276"><a href="#ErrorAggregator-1276"><span class="linenos">1276</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1277"><a href="#ErrorAggregator-1277"><span class="linenos">1277</span></a><span class="sd">            error_type: Type of error to check</span>
</span><span id="ErrorAggregator-1278"><a href="#ErrorAggregator-1278"><span class="linenos">1278</span></a>
</span><span id="ErrorAggregator-1279"><a href="#ErrorAggregator-1279"><span class="linenos">1279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1280"><a href="#ErrorAggregator-1280"><span class="linenos">1280</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">])</span>
</span><span id="ErrorAggregator-1281"><a href="#ErrorAggregator-1281"><span class="linenos">1281</span></a>        <span class="n">error_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">recent_errors</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;error_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">error_type</span><span class="p">])</span>
</span><span id="ErrorAggregator-1282"><a href="#ErrorAggregator-1282"><span class="linenos">1282</span></a>
</span><span id="ErrorAggregator-1283"><a href="#ErrorAggregator-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">error_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">]:</span>
</span><span id="ErrorAggregator-1284"><a href="#ErrorAggregator-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ErrorAggregator-1285"><a href="#ErrorAggregator-1285"><span class="linenos">1285</span></a>                <span class="s2">&quot;Error threshold exceeded&quot;</span><span class="p">,</span>
</span><span id="ErrorAggregator-1286"><a href="#ErrorAggregator-1286"><span class="linenos">1286</span></a>                <span class="n">error_type</span><span class="o">=</span><span class="n">error_type</span><span class="p">,</span>
</span><span id="ErrorAggregator-1287"><a href="#ErrorAggregator-1287"><span class="linenos">1287</span></a>                <span class="n">count</span><span class="o">=</span><span class="n">error_count</span><span class="p">,</span>
</span><span id="ErrorAggregator-1288"><a href="#ErrorAggregator-1288"><span class="linenos">1288</span></a>                <span class="n">threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">],</span>
</span><span id="ErrorAggregator-1289"><a href="#ErrorAggregator-1289"><span class="linenos">1289</span></a>            <span class="p">)</span>
</span><span id="ErrorAggregator-1290"><a href="#ErrorAggregator-1290"><span class="linenos">1290</span></a>
</span><span id="ErrorAggregator-1291"><a href="#ErrorAggregator-1291"><span class="linenos">1291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_recent_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="ErrorAggregator-1292"><a href="#ErrorAggregator-1292"><span class="linenos">1292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get errors from the recent time window.</span>
</span><span id="ErrorAggregator-1293"><a href="#ErrorAggregator-1293"><span class="linenos">1293</span></a>
</span><span id="ErrorAggregator-1294"><a href="#ErrorAggregator-1294"><span class="linenos">1294</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1295"><a href="#ErrorAggregator-1295"><span class="linenos">1295</span></a><span class="sd">            window_seconds: Time window in seconds</span>
</span><span id="ErrorAggregator-1296"><a href="#ErrorAggregator-1296"><span class="linenos">1296</span></a>
</span><span id="ErrorAggregator-1297"><a href="#ErrorAggregator-1297"><span class="linenos">1297</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator-1298"><a href="#ErrorAggregator-1298"><span class="linenos">1298</span></a><span class="sd">            List of recent errors</span>
</span><span id="ErrorAggregator-1299"><a href="#ErrorAggregator-1299"><span class="linenos">1299</span></a>
</span><span id="ErrorAggregator-1300"><a href="#ErrorAggregator-1300"><span class="linenos">1300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1301"><a href="#ErrorAggregator-1301"><span class="linenos">1301</span></a>        <span class="n">cutoff_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="ErrorAggregator-1302"><a href="#ErrorAggregator-1302"><span class="linenos">1302</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cutoff_time</span><span class="p">]</span>
</span><span id="ErrorAggregator-1303"><a href="#ErrorAggregator-1303"><span class="linenos">1303</span></a>
</span><span id="ErrorAggregator-1304"><a href="#ErrorAggregator-1304"><span class="linenos">1304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ErrorAggregator-1305"><a href="#ErrorAggregator-1305"><span class="linenos">1305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error patterns.</span>
</span><span id="ErrorAggregator-1306"><a href="#ErrorAggregator-1306"><span class="linenos">1306</span></a>
</span><span id="ErrorAggregator-1307"><a href="#ErrorAggregator-1307"><span class="linenos">1307</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1308"><a href="#ErrorAggregator-1308"><span class="linenos">1308</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="ErrorAggregator-1309"><a href="#ErrorAggregator-1309"><span class="linenos">1309</span></a>
</span><span id="ErrorAggregator-1310"><a href="#ErrorAggregator-1310"><span class="linenos">1310</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator-1311"><a href="#ErrorAggregator-1311"><span class="linenos">1311</span></a><span class="sd">            Dictionary containing error summary and patterns.</span>
</span><span id="ErrorAggregator-1312"><a href="#ErrorAggregator-1312"><span class="linenos">1312</span></a>
</span><span id="ErrorAggregator-1313"><a href="#ErrorAggregator-1313"><span class="linenos">1313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1314"><a href="#ErrorAggregator-1314"><span class="linenos">1314</span></a>        <span class="k">if</span> <span class="n">window_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator-1315"><a href="#ErrorAggregator-1315"><span class="linenos">1315</span></a>            <span class="n">window_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="ErrorAggregator-1316"><a href="#ErrorAggregator-1316"><span class="linenos">1316</span></a>
</span><span id="ErrorAggregator-1317"><a href="#ErrorAggregator-1317"><span class="linenos">1317</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="ErrorAggregator-1318"><a href="#ErrorAggregator-1318"><span class="linenos">1318</span></a>
</span><span id="ErrorAggregator-1319"><a href="#ErrorAggregator-1319"><span class="linenos">1319</span></a>        <span class="c1"># Group errors by type and code</span>
</span><span id="ErrorAggregator-1320"><a href="#ErrorAggregator-1320"><span class="linenos">1320</span></a>        <span class="n">error_summary</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="ErrorAggregator-1321"><a href="#ErrorAggregator-1321"><span class="linenos">1321</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="ErrorAggregator-1322"><a href="#ErrorAggregator-1322"><span class="linenos">1322</span></a>        <span class="p">)</span>
</span><span id="ErrorAggregator-1323"><a href="#ErrorAggregator-1323"><span class="linenos">1323</span></a>
</span><span id="ErrorAggregator-1324"><a href="#ErrorAggregator-1324"><span class="linenos">1324</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="ErrorAggregator-1325"><a href="#ErrorAggregator-1325"><span class="linenos">1325</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ErrorAggregator-1326"><a href="#ErrorAggregator-1326"><span class="linenos">1326</span></a>            <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator-1327"><a href="#ErrorAggregator-1327"><span class="linenos">1327</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Keep only first 5 examples</span>
</span><span id="ErrorAggregator-1328"><a href="#ErrorAggregator-1328"><span class="linenos">1328</span></a>                <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ErrorAggregator-1329"><a href="#ErrorAggregator-1329"><span class="linenos">1329</span></a>                    <span class="p">{</span>
</span><span id="ErrorAggregator-1330"><a href="#ErrorAggregator-1330"><span class="linenos">1330</span></a>                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="ErrorAggregator-1331"><a href="#ErrorAggregator-1331"><span class="linenos">1331</span></a>                        <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span>
</span><span id="ErrorAggregator-1332"><a href="#ErrorAggregator-1332"><span class="linenos">1332</span></a>                    <span class="p">}</span>
</span><span id="ErrorAggregator-1333"><a href="#ErrorAggregator-1333"><span class="linenos">1333</span></a>                <span class="p">)</span>
</span><span id="ErrorAggregator-1334"><a href="#ErrorAggregator-1334"><span class="linenos">1334</span></a>
</span><span id="ErrorAggregator-1335"><a href="#ErrorAggregator-1335"><span class="linenos">1335</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ErrorAggregator-1336"><a href="#ErrorAggregator-1336"><span class="linenos">1336</span></a>            <span class="s2">&quot;window_seconds&quot;</span><span class="p">:</span> <span class="n">window_seconds</span><span class="p">,</span>
</span><span id="ErrorAggregator-1337"><a href="#ErrorAggregator-1337"><span class="linenos">1337</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="ErrorAggregator-1338"><a href="#ErrorAggregator-1338"><span class="linenos">1338</span></a>            <span class="s2">&quot;error_patterns&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">error_summary</span><span class="p">),</span>
</span><span id="ErrorAggregator-1339"><a href="#ErrorAggregator-1339"><span class="linenos">1339</span></a>            <span class="s2">&quot;most_common_errors&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="ErrorAggregator-1340"><a href="#ErrorAggregator-1340"><span class="linenos">1340</span></a>                <span class="n">error_summary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span><span id="ErrorAggregator-1341"><a href="#ErrorAggregator-1341"><span class="linenos">1341</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">],</span>
</span><span id="ErrorAggregator-1342"><a href="#ErrorAggregator-1342"><span class="linenos">1342</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorAggregator-1343"><a href="#ErrorAggregator-1343"><span class="linenos">1343</span></a>            <span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>  <span class="c1"># Top 10 most common errors</span>
</span><span id="ErrorAggregator-1344"><a href="#ErrorAggregator-1344"><span class="linenos">1344</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator-1345"><a href="#ErrorAggregator-1345"><span class="linenos">1345</span></a>
</span><span id="ErrorAggregator-1346"><a href="#ErrorAggregator-1346"><span class="linenos">1346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ErrorAggregator-1347"><a href="#ErrorAggregator-1347"><span class="linenos">1347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error trends over a longer time period.</span>
</span><span id="ErrorAggregator-1348"><a href="#ErrorAggregator-1348"><span class="linenos">1348</span></a>
</span><span id="ErrorAggregator-1349"><a href="#ErrorAggregator-1349"><span class="linenos">1349</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1350"><a href="#ErrorAggregator-1350"><span class="linenos">1350</span></a><span class="sd">            hours: Number of hours to analyze</span>
</span><span id="ErrorAggregator-1351"><a href="#ErrorAggregator-1351"><span class="linenos">1351</span></a>
</span><span id="ErrorAggregator-1352"><a href="#ErrorAggregator-1352"><span class="linenos">1352</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator-1353"><a href="#ErrorAggregator-1353"><span class="linenos">1353</span></a><span class="sd">            Dictionary containing error trends and patterns.</span>
</span><span id="ErrorAggregator-1354"><a href="#ErrorAggregator-1354"><span class="linenos">1354</span></a>
</span><span id="ErrorAggregator-1355"><a href="#ErrorAggregator-1355"><span class="linenos">1355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1356"><a href="#ErrorAggregator-1356"><span class="linenos">1356</span></a>        <span class="n">window_seconds</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="ErrorAggregator-1357"><a href="#ErrorAggregator-1357"><span class="linenos">1357</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="ErrorAggregator-1358"><a href="#ErrorAggregator-1358"><span class="linenos">1358</span></a>
</span><span id="ErrorAggregator-1359"><a href="#ErrorAggregator-1359"><span class="linenos">1359</span></a>        <span class="c1"># Group errors by hour</span>
</span><span id="ErrorAggregator-1360"><a href="#ErrorAggregator-1360"><span class="linenos">1360</span></a>        <span class="n">hourly_errors</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ErrorAggregator-1361"><a href="#ErrorAggregator-1361"><span class="linenos">1361</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="ErrorAggregator-1362"><a href="#ErrorAggregator-1362"><span class="linenos">1362</span></a>            <span class="n">hour_key</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ErrorAggregator-1363"><a href="#ErrorAggregator-1363"><span class="linenos">1363</span></a>            <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hour_key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator-1364"><a href="#ErrorAggregator-1364"><span class="linenos">1364</span></a>
</span><span id="ErrorAggregator-1365"><a href="#ErrorAggregator-1365"><span class="linenos">1365</span></a>        <span class="c1"># Calculate trend</span>
</span><span id="ErrorAggregator-1366"><a href="#ErrorAggregator-1366"><span class="linenos">1366</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hourly_errors</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="ErrorAggregator-1367"><a href="#ErrorAggregator-1367"><span class="linenos">1367</span></a>            <span class="n">hours_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hourly_errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ErrorAggregator-1368"><a href="#ErrorAggregator-1368"><span class="linenos">1368</span></a>            <span class="n">first_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="ErrorAggregator-1369"><a href="#ErrorAggregator-1369"><span class="linenos">1369</span></a>            <span class="n">last_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="ErrorAggregator-1370"><a href="#ErrorAggregator-1370"><span class="linenos">1370</span></a>
</span><span id="ErrorAggregator-1371"><a href="#ErrorAggregator-1371"><span class="linenos">1371</span></a>            <span class="k">if</span> <span class="n">first_hour_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ErrorAggregator-1372"><a href="#ErrorAggregator-1372"><span class="linenos">1372</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="p">((</span><span class="n">last_hour_count</span> <span class="o">-</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="ErrorAggregator-1373"><a href="#ErrorAggregator-1373"><span class="linenos">1373</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ErrorAggregator-1374"><a href="#ErrorAggregator-1374"><span class="linenos">1374</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ErrorAggregator-1375"><a href="#ErrorAggregator-1375"><span class="linenos">1375</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ErrorAggregator-1376"><a href="#ErrorAggregator-1376"><span class="linenos">1376</span></a>            <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ErrorAggregator-1377"><a href="#ErrorAggregator-1377"><span class="linenos">1377</span></a>
</span><span id="ErrorAggregator-1378"><a href="#ErrorAggregator-1378"><span class="linenos">1378</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ErrorAggregator-1379"><a href="#ErrorAggregator-1379"><span class="linenos">1379</span></a>            <span class="s2">&quot;analysis_period_hours&quot;</span><span class="p">:</span> <span class="n">hours</span><span class="p">,</span>
</span><span id="ErrorAggregator-1380"><a href="#ErrorAggregator-1380"><span class="linenos">1380</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="ErrorAggregator-1381"><a href="#ErrorAggregator-1381"><span class="linenos">1381</span></a>            <span class="s2">&quot;hourly_breakdown&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> <span class="n">c</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hourly_errors</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="ErrorAggregator-1382"><a href="#ErrorAggregator-1382"><span class="linenos">1382</span></a>            <span class="s2">&quot;trend_percentage&quot;</span><span class="p">:</span> <span class="n">trend_percentage</span><span class="p">,</span>
</span><span id="ErrorAggregator-1383"><a href="#ErrorAggregator-1383"><span class="linenos">1383</span></a>            <span class="s2">&quot;trend_description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_describe_trend</span><span class="p">(</span><span class="n">trend_percentage</span><span class="p">),</span>
</span><span id="ErrorAggregator-1384"><a href="#ErrorAggregator-1384"><span class="linenos">1384</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator-1385"><a href="#ErrorAggregator-1385"><span class="linenos">1385</span></a>
</span><span id="ErrorAggregator-1386"><a href="#ErrorAggregator-1386"><span class="linenos">1386</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_describe_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trend_percentage</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ErrorAggregator-1387"><a href="#ErrorAggregator-1387"><span class="linenos">1387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Describe the error trend in human-readable terms.</span>
</span><span id="ErrorAggregator-1388"><a href="#ErrorAggregator-1388"><span class="linenos">1388</span></a>
</span><span id="ErrorAggregator-1389"><a href="#ErrorAggregator-1389"><span class="linenos">1389</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator-1390"><a href="#ErrorAggregator-1390"><span class="linenos">1390</span></a><span class="sd">            trend_percentage: Percentage change in error rate</span>
</span><span id="ErrorAggregator-1391"><a href="#ErrorAggregator-1391"><span class="linenos">1391</span></a>
</span><span id="ErrorAggregator-1392"><a href="#ErrorAggregator-1392"><span class="linenos">1392</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator-1393"><a href="#ErrorAggregator-1393"><span class="linenos">1393</span></a><span class="sd">            Human-readable trend description.</span>
</span><span id="ErrorAggregator-1394"><a href="#ErrorAggregator-1394"><span class="linenos">1394</span></a>
</span><span id="ErrorAggregator-1395"><a href="#ErrorAggregator-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1396"><a href="#ErrorAggregator-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="ErrorAggregator-1397"><a href="#ErrorAggregator-1397"><span class="linenos">1397</span></a>            <span class="k">return</span> <span class="s2">&quot;Significantly increasing&quot;</span>
</span><span id="ErrorAggregator-1398"><a href="#ErrorAggregator-1398"><span class="linenos">1398</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="ErrorAggregator-1399"><a href="#ErrorAggregator-1399"><span class="linenos">1399</span></a>            <span class="k">return</span> <span class="s2">&quot;Moderately increasing&quot;</span>
</span><span id="ErrorAggregator-1400"><a href="#ErrorAggregator-1400"><span class="linenos">1400</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
</span><span id="ErrorAggregator-1401"><a href="#ErrorAggregator-1401"><span class="linenos">1401</span></a>            <span class="k">return</span> <span class="s2">&quot;Stable&quot;</span>
</span><span id="ErrorAggregator-1402"><a href="#ErrorAggregator-1402"><span class="linenos">1402</span></a>        <span class="k">if</span> <span class="n">trend_percentage</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">20</span><span class="p">:</span>
</span><span id="ErrorAggregator-1403"><a href="#ErrorAggregator-1403"><span class="linenos">1403</span></a>            <span class="k">return</span> <span class="s2">&quot;Moderately decreasing&quot;</span>
</span><span id="ErrorAggregator-1404"><a href="#ErrorAggregator-1404"><span class="linenos">1404</span></a>        <span class="k">return</span> <span class="s2">&quot;Significantly decreasing&quot;</span>
</span><span id="ErrorAggregator-1405"><a href="#ErrorAggregator-1405"><span class="linenos">1405</span></a>
</span><span id="ErrorAggregator-1406"><a href="#ErrorAggregator-1406"><span class="linenos">1406</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator-1407"><a href="#ErrorAggregator-1407"><span class="linenos">1407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all error tracking data.&quot;&quot;&quot;</span>
</span><span id="ErrorAggregator-1408"><a href="#ErrorAggregator-1408"><span class="linenos">1408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ErrorAggregator-1409"><a href="#ErrorAggregator-1409"><span class="linenos">1409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ErrorAggregator-1410"><a href="#ErrorAggregator-1410"><span class="linenos">1410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error aggregator reset&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Error aggregation and analytics for monitoring and debugging.</p>

<p>This class tracks error patterns, frequencies, and trends to help
identify systemic issues and provide insights for debugging.</p>

<p>Attributes:
    config: Error aggregation configuration
    error_counts: Count of errors by type and time window
    error_history: Recent error history for analysis
    logger: Structured logger instance</p>
</div>


                            <div id="ErrorAggregator.__init__" class="classattr">
                                        <input id="ErrorAggregator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ErrorAggregator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ErrorAggregator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator.__init__-1225"><a href="#ErrorAggregator.__init__-1225"><span class="linenos">1225</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator.__init__-1226"><a href="#ErrorAggregator.__init__-1226"><span class="linenos">1226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the error aggregator.</span>
</span><span id="ErrorAggregator.__init__-1227"><a href="#ErrorAggregator.__init__-1227"><span class="linenos">1227</span></a>
</span><span id="ErrorAggregator.__init__-1228"><a href="#ErrorAggregator.__init__-1228"><span class="linenos">1228</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator.__init__-1229"><a href="#ErrorAggregator.__init__-1229"><span class="linenos">1229</span></a><span class="sd">            config: Error aggregation configuration</span>
</span><span id="ErrorAggregator.__init__-1230"><a href="#ErrorAggregator.__init__-1230"><span class="linenos">1230</span></a>
</span><span id="ErrorAggregator.__init__-1231"><a href="#ErrorAggregator.__init__-1231"><span class="linenos">1231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator.__init__-1232"><a href="#ErrorAggregator.__init__-1232"><span class="linenos">1232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="ErrorAggregator.__init__-1233"><a href="#ErrorAggregator.__init__-1233"><span class="linenos">1233</span></a>            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorAggregator.__init__-1234"><a href="#ErrorAggregator.__init__-1234"><span class="linenos">1234</span></a>            <span class="s2">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># 5 minutes</span>
</span><span id="ErrorAggregator.__init__-1235"><a href="#ErrorAggregator.__init__-1235"><span class="linenos">1235</span></a>            <span class="s2">&quot;max_errors_per_window&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="ErrorAggregator.__init__-1236"><a href="#ErrorAggregator.__init__-1236"><span class="linenos">1236</span></a>            <span class="s2">&quot;history_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="ErrorAggregator.__init__-1237"><a href="#ErrorAggregator.__init__-1237"><span class="linenos">1237</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator.__init__-1238"><a href="#ErrorAggregator.__init__-1238"><span class="linenos">1238</span></a>
</span><span id="ErrorAggregator.__init__-1239"><a href="#ErrorAggregator.__init__-1239"><span class="linenos">1239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ErrorAggregator.__init__-1240"><a href="#ErrorAggregator.__init__-1240"><span class="linenos">1240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="p">:</span> <span class="n">deque</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;history_size&quot;</span><span class="p">])</span>
</span><span id="ErrorAggregator.__init__-1241"><a href="#ErrorAggregator.__init__-1241"><span class="linenos">1241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the error aggregator.</p>

<p>Args:
    config: Error aggregation configuration</p>
</div>


                            </div>
                            <div id="ErrorAggregator.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#ErrorAggregator.config"></a>
    
    

                            </div>
                            <div id="ErrorAggregator.error_counts" class="classattr">
                                <div class="attr variable">
            <span class="name">error_counts</span><span class="annotation">: collections.defaultdict[str, int]</span>

        
    </div>
    <a class="headerlink" href="#ErrorAggregator.error_counts"></a>
    
    

                            </div>
                            <div id="ErrorAggregator.error_history" class="classattr">
                                <div class="attr variable">
            <span class="name">error_history</span><span class="annotation">: collections.deque[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#ErrorAggregator.error_history"></a>
    
    

                            </div>
                            <div id="ErrorAggregator.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#ErrorAggregator.logger"></a>
    
    

                            </div>
                            <div id="ErrorAggregator.record_error" class="classattr">
                                        <input id="ErrorAggregator.record_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">record_error</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">error_code</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ErrorAggregator.record_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator.record_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator.record_error-1243"><a href="#ErrorAggregator.record_error-1243"><span class="linenos">1243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator.record_error-1244"><a href="#ErrorAggregator.record_error-1244"><span class="linenos">1244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record an error occurrence.</span>
</span><span id="ErrorAggregator.record_error-1245"><a href="#ErrorAggregator.record_error-1245"><span class="linenos">1245</span></a>
</span><span id="ErrorAggregator.record_error-1246"><a href="#ErrorAggregator.record_error-1246"><span class="linenos">1246</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator.record_error-1247"><a href="#ErrorAggregator.record_error-1247"><span class="linenos">1247</span></a><span class="sd">            error_code: JSON-RPC error code</span>
</span><span id="ErrorAggregator.record_error-1248"><a href="#ErrorAggregator.record_error-1248"><span class="linenos">1248</span></a><span class="sd">            error_type: Type of error (e.g., &#39;timeout&#39;, &#39;validation&#39;, &#39;external_service&#39;)</span>
</span><span id="ErrorAggregator.record_error-1249"><a href="#ErrorAggregator.record_error-1249"><span class="linenos">1249</span></a><span class="sd">            context: Additional context about the error</span>
</span><span id="ErrorAggregator.record_error-1250"><a href="#ErrorAggregator.record_error-1250"><span class="linenos">1250</span></a>
</span><span id="ErrorAggregator.record_error-1251"><a href="#ErrorAggregator.record_error-1251"><span class="linenos">1251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator.record_error-1252"><a href="#ErrorAggregator.record_error-1252"><span class="linenos">1252</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
</span><span id="ErrorAggregator.record_error-1253"><a href="#ErrorAggregator.record_error-1253"><span class="linenos">1253</span></a>            <span class="k">return</span>
</span><span id="ErrorAggregator.record_error-1254"><a href="#ErrorAggregator.record_error-1254"><span class="linenos">1254</span></a>
</span><span id="ErrorAggregator.record_error-1255"><a href="#ErrorAggregator.record_error-1255"><span class="linenos">1255</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
</span><span id="ErrorAggregator.record_error-1256"><a href="#ErrorAggregator.record_error-1256"><span class="linenos">1256</span></a>
</span><span id="ErrorAggregator.record_error-1257"><a href="#ErrorAggregator.record_error-1257"><span class="linenos">1257</span></a>        <span class="c1"># Record error count</span>
</span><span id="ErrorAggregator.record_error-1258"><a href="#ErrorAggregator.record_error-1258"><span class="linenos">1258</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error_type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ErrorAggregator.record_error-1259"><a href="#ErrorAggregator.record_error-1259"><span class="linenos">1259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator.record_error-1260"><a href="#ErrorAggregator.record_error-1260"><span class="linenos">1260</span></a>
</span><span id="ErrorAggregator.record_error-1261"><a href="#ErrorAggregator.record_error-1261"><span class="linenos">1261</span></a>        <span class="c1"># Record error history</span>
</span><span id="ErrorAggregator.record_error-1262"><a href="#ErrorAggregator.record_error-1262"><span class="linenos">1262</span></a>        <span class="n">error_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ErrorAggregator.record_error-1263"><a href="#ErrorAggregator.record_error-1263"><span class="linenos">1263</span></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
</span><span id="ErrorAggregator.record_error-1264"><a href="#ErrorAggregator.record_error-1264"><span class="linenos">1264</span></a>            <span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="n">error_code</span><span class="p">,</span>
</span><span id="ErrorAggregator.record_error-1265"><a href="#ErrorAggregator.record_error-1265"><span class="linenos">1265</span></a>            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
</span><span id="ErrorAggregator.record_error-1266"><a href="#ErrorAggregator.record_error-1266"><span class="linenos">1266</span></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
</span><span id="ErrorAggregator.record_error-1267"><a href="#ErrorAggregator.record_error-1267"><span class="linenos">1267</span></a>        <span class="p">}</span>
</span><span id="ErrorAggregator.record_error-1268"><a href="#ErrorAggregator.record_error-1268"><span class="linenos">1268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_record</span><span class="p">)</span>
</span><span id="ErrorAggregator.record_error-1269"><a href="#ErrorAggregator.record_error-1269"><span class="linenos">1269</span></a>
</span><span id="ErrorAggregator.record_error-1270"><a href="#ErrorAggregator.record_error-1270"><span class="linenos">1270</span></a>        <span class="c1"># Check if we&#39;re exceeding error thresholds</span>
</span><span id="ErrorAggregator.record_error-1271"><a href="#ErrorAggregator.record_error-1271"><span class="linenos">1271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_error_thresholds</span><span class="p">(</span><span class="n">error_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Record an error occurrence.</p>

<p>Args:
    error_code: JSON-RPC error code
    error_type: Type of error (e.g., 'timeout', 'validation', 'external_service')
    context: Additional context about the error</p>
</div>


                            </div>
                            <div id="ErrorAggregator.get_error_summary" class="classattr">
                                        <input id="ErrorAggregator.get_error_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_error_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ErrorAggregator.get_error_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator.get_error_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator.get_error_summary-1304"><a href="#ErrorAggregator.get_error_summary-1304"><span class="linenos">1304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ErrorAggregator.get_error_summary-1305"><a href="#ErrorAggregator.get_error_summary-1305"><span class="linenos">1305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a summary of error patterns.</span>
</span><span id="ErrorAggregator.get_error_summary-1306"><a href="#ErrorAggregator.get_error_summary-1306"><span class="linenos">1306</span></a>
</span><span id="ErrorAggregator.get_error_summary-1307"><a href="#ErrorAggregator.get_error_summary-1307"><span class="linenos">1307</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator.get_error_summary-1308"><a href="#ErrorAggregator.get_error_summary-1308"><span class="linenos">1308</span></a><span class="sd">            window_seconds: Time window in seconds (uses config default if None)</span>
</span><span id="ErrorAggregator.get_error_summary-1309"><a href="#ErrorAggregator.get_error_summary-1309"><span class="linenos">1309</span></a>
</span><span id="ErrorAggregator.get_error_summary-1310"><a href="#ErrorAggregator.get_error_summary-1310"><span class="linenos">1310</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator.get_error_summary-1311"><a href="#ErrorAggregator.get_error_summary-1311"><span class="linenos">1311</span></a><span class="sd">            Dictionary containing error summary and patterns.</span>
</span><span id="ErrorAggregator.get_error_summary-1312"><a href="#ErrorAggregator.get_error_summary-1312"><span class="linenos">1312</span></a>
</span><span id="ErrorAggregator.get_error_summary-1313"><a href="#ErrorAggregator.get_error_summary-1313"><span class="linenos">1313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator.get_error_summary-1314"><a href="#ErrorAggregator.get_error_summary-1314"><span class="linenos">1314</span></a>        <span class="k">if</span> <span class="n">window_seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_summary-1315"><a href="#ErrorAggregator.get_error_summary-1315"><span class="linenos">1315</span></a>            <span class="n">window_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="ErrorAggregator.get_error_summary-1316"><a href="#ErrorAggregator.get_error_summary-1316"><span class="linenos">1316</span></a>
</span><span id="ErrorAggregator.get_error_summary-1317"><a href="#ErrorAggregator.get_error_summary-1317"><span class="linenos">1317</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="ErrorAggregator.get_error_summary-1318"><a href="#ErrorAggregator.get_error_summary-1318"><span class="linenos">1318</span></a>
</span><span id="ErrorAggregator.get_error_summary-1319"><a href="#ErrorAggregator.get_error_summary-1319"><span class="linenos">1319</span></a>        <span class="c1"># Group errors by type and code</span>
</span><span id="ErrorAggregator.get_error_summary-1320"><a href="#ErrorAggregator.get_error_summary-1320"><span class="linenos">1320</span></a>        <span class="n">error_summary</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="ErrorAggregator.get_error_summary-1321"><a href="#ErrorAggregator.get_error_summary-1321"><span class="linenos">1321</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</span><span id="ErrorAggregator.get_error_summary-1322"><a href="#ErrorAggregator.get_error_summary-1322"><span class="linenos">1322</span></a>        <span class="p">)</span>
</span><span id="ErrorAggregator.get_error_summary-1323"><a href="#ErrorAggregator.get_error_summary-1323"><span class="linenos">1323</span></a>
</span><span id="ErrorAggregator.get_error_summary-1324"><a href="#ErrorAggregator.get_error_summary-1324"><span class="linenos">1324</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_summary-1325"><a href="#ErrorAggregator.get_error_summary-1325"><span class="linenos">1325</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ErrorAggregator.get_error_summary-1326"><a href="#ErrorAggregator.get_error_summary-1326"><span class="linenos">1326</span></a>            <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator.get_error_summary-1327"><a href="#ErrorAggregator.get_error_summary-1327"><span class="linenos">1327</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Keep only first 5 examples</span>
</span><span id="ErrorAggregator.get_error_summary-1328"><a href="#ErrorAggregator.get_error_summary-1328"><span class="linenos">1328</span></a>                <span class="n">error_summary</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;examples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ErrorAggregator.get_error_summary-1329"><a href="#ErrorAggregator.get_error_summary-1329"><span class="linenos">1329</span></a>                    <span class="p">{</span>
</span><span id="ErrorAggregator.get_error_summary-1330"><a href="#ErrorAggregator.get_error_summary-1330"><span class="linenos">1330</span></a>                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="ErrorAggregator.get_error_summary-1331"><a href="#ErrorAggregator.get_error_summary-1331"><span class="linenos">1331</span></a>                        <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span>
</span><span id="ErrorAggregator.get_error_summary-1332"><a href="#ErrorAggregator.get_error_summary-1332"><span class="linenos">1332</span></a>                    <span class="p">}</span>
</span><span id="ErrorAggregator.get_error_summary-1333"><a href="#ErrorAggregator.get_error_summary-1333"><span class="linenos">1333</span></a>                <span class="p">)</span>
</span><span id="ErrorAggregator.get_error_summary-1334"><a href="#ErrorAggregator.get_error_summary-1334"><span class="linenos">1334</span></a>
</span><span id="ErrorAggregator.get_error_summary-1335"><a href="#ErrorAggregator.get_error_summary-1335"><span class="linenos">1335</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ErrorAggregator.get_error_summary-1336"><a href="#ErrorAggregator.get_error_summary-1336"><span class="linenos">1336</span></a>            <span class="s2">&quot;window_seconds&quot;</span><span class="p">:</span> <span class="n">window_seconds</span><span class="p">,</span>
</span><span id="ErrorAggregator.get_error_summary-1337"><a href="#ErrorAggregator.get_error_summary-1337"><span class="linenos">1337</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="ErrorAggregator.get_error_summary-1338"><a href="#ErrorAggregator.get_error_summary-1338"><span class="linenos">1338</span></a>            <span class="s2">&quot;error_patterns&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">error_summary</span><span class="p">),</span>
</span><span id="ErrorAggregator.get_error_summary-1339"><a href="#ErrorAggregator.get_error_summary-1339"><span class="linenos">1339</span></a>            <span class="s2">&quot;most_common_errors&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="ErrorAggregator.get_error_summary-1340"><a href="#ErrorAggregator.get_error_summary-1340"><span class="linenos">1340</span></a>                <span class="n">error_summary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
</span><span id="ErrorAggregator.get_error_summary-1341"><a href="#ErrorAggregator.get_error_summary-1341"><span class="linenos">1341</span></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">],</span>
</span><span id="ErrorAggregator.get_error_summary-1342"><a href="#ErrorAggregator.get_error_summary-1342"><span class="linenos">1342</span></a>                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ErrorAggregator.get_error_summary-1343"><a href="#ErrorAggregator.get_error_summary-1343"><span class="linenos">1343</span></a>            <span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>  <span class="c1"># Top 10 most common errors</span>
</span><span id="ErrorAggregator.get_error_summary-1344"><a href="#ErrorAggregator.get_error_summary-1344"><span class="linenos">1344</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get a summary of error patterns.</p>

<p>Args:
    window_seconds: Time window in seconds (uses config default if None)</p>

<p>Returns:
    Dictionary containing error summary and patterns.</p>
</div>


                            </div>
                            <div id="ErrorAggregator.get_error_trends" class="classattr">
                                        <input id="ErrorAggregator.get_error_trends-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_error_trends</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ErrorAggregator.get_error_trends-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator.get_error_trends"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator.get_error_trends-1346"><a href="#ErrorAggregator.get_error_trends-1346"><span class="linenos">1346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ErrorAggregator.get_error_trends-1347"><a href="#ErrorAggregator.get_error_trends-1347"><span class="linenos">1347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get error trends over a longer time period.</span>
</span><span id="ErrorAggregator.get_error_trends-1348"><a href="#ErrorAggregator.get_error_trends-1348"><span class="linenos">1348</span></a>
</span><span id="ErrorAggregator.get_error_trends-1349"><a href="#ErrorAggregator.get_error_trends-1349"><span class="linenos">1349</span></a><span class="sd">        Args:</span>
</span><span id="ErrorAggregator.get_error_trends-1350"><a href="#ErrorAggregator.get_error_trends-1350"><span class="linenos">1350</span></a><span class="sd">            hours: Number of hours to analyze</span>
</span><span id="ErrorAggregator.get_error_trends-1351"><a href="#ErrorAggregator.get_error_trends-1351"><span class="linenos">1351</span></a>
</span><span id="ErrorAggregator.get_error_trends-1352"><a href="#ErrorAggregator.get_error_trends-1352"><span class="linenos">1352</span></a><span class="sd">        Returns:</span>
</span><span id="ErrorAggregator.get_error_trends-1353"><a href="#ErrorAggregator.get_error_trends-1353"><span class="linenos">1353</span></a><span class="sd">            Dictionary containing error trends and patterns.</span>
</span><span id="ErrorAggregator.get_error_trends-1354"><a href="#ErrorAggregator.get_error_trends-1354"><span class="linenos">1354</span></a>
</span><span id="ErrorAggregator.get_error_trends-1355"><a href="#ErrorAggregator.get_error_trends-1355"><span class="linenos">1355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ErrorAggregator.get_error_trends-1356"><a href="#ErrorAggregator.get_error_trends-1356"><span class="linenos">1356</span></a>        <span class="n">window_seconds</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="ErrorAggregator.get_error_trends-1357"><a href="#ErrorAggregator.get_error_trends-1357"><span class="linenos">1357</span></a>        <span class="n">recent_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_errors</span><span class="p">(</span><span class="n">window_seconds</span><span class="p">)</span>
</span><span id="ErrorAggregator.get_error_trends-1358"><a href="#ErrorAggregator.get_error_trends-1358"><span class="linenos">1358</span></a>
</span><span id="ErrorAggregator.get_error_trends-1359"><a href="#ErrorAggregator.get_error_trends-1359"><span class="linenos">1359</span></a>        <span class="c1"># Group errors by hour</span>
</span><span id="ErrorAggregator.get_error_trends-1360"><a href="#ErrorAggregator.get_error_trends-1360"><span class="linenos">1360</span></a>        <span class="n">hourly_errors</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ErrorAggregator.get_error_trends-1361"><a href="#ErrorAggregator.get_error_trends-1361"><span class="linenos">1361</span></a>        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">recent_errors</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_trends-1362"><a href="#ErrorAggregator.get_error_trends-1362"><span class="linenos">1362</span></a>            <span class="n">hour_key</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ErrorAggregator.get_error_trends-1363"><a href="#ErrorAggregator.get_error_trends-1363"><span class="linenos">1363</span></a>            <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hour_key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ErrorAggregator.get_error_trends-1364"><a href="#ErrorAggregator.get_error_trends-1364"><span class="linenos">1364</span></a>
</span><span id="ErrorAggregator.get_error_trends-1365"><a href="#ErrorAggregator.get_error_trends-1365"><span class="linenos">1365</span></a>        <span class="c1"># Calculate trend</span>
</span><span id="ErrorAggregator.get_error_trends-1366"><a href="#ErrorAggregator.get_error_trends-1366"><span class="linenos">1366</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hourly_errors</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_trends-1367"><a href="#ErrorAggregator.get_error_trends-1367"><span class="linenos">1367</span></a>            <span class="n">hours_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hourly_errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ErrorAggregator.get_error_trends-1368"><a href="#ErrorAggregator.get_error_trends-1368"><span class="linenos">1368</span></a>            <span class="n">first_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="ErrorAggregator.get_error_trends-1369"><a href="#ErrorAggregator.get_error_trends-1369"><span class="linenos">1369</span></a>            <span class="n">last_hour_count</span> <span class="o">=</span> <span class="n">hourly_errors</span><span class="p">[</span><span class="n">hours_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="ErrorAggregator.get_error_trends-1370"><a href="#ErrorAggregator.get_error_trends-1370"><span class="linenos">1370</span></a>
</span><span id="ErrorAggregator.get_error_trends-1371"><a href="#ErrorAggregator.get_error_trends-1371"><span class="linenos">1371</span></a>            <span class="k">if</span> <span class="n">first_hour_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_trends-1372"><a href="#ErrorAggregator.get_error_trends-1372"><span class="linenos">1372</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="p">((</span><span class="n">last_hour_count</span> <span class="o">-</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">first_hour_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="ErrorAggregator.get_error_trends-1373"><a href="#ErrorAggregator.get_error_trends-1373"><span class="linenos">1373</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_trends-1374"><a href="#ErrorAggregator.get_error_trends-1374"><span class="linenos">1374</span></a>                <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ErrorAggregator.get_error_trends-1375"><a href="#ErrorAggregator.get_error_trends-1375"><span class="linenos">1375</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ErrorAggregator.get_error_trends-1376"><a href="#ErrorAggregator.get_error_trends-1376"><span class="linenos">1376</span></a>            <span class="n">trend_percentage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ErrorAggregator.get_error_trends-1377"><a href="#ErrorAggregator.get_error_trends-1377"><span class="linenos">1377</span></a>
</span><span id="ErrorAggregator.get_error_trends-1378"><a href="#ErrorAggregator.get_error_trends-1378"><span class="linenos">1378</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ErrorAggregator.get_error_trends-1379"><a href="#ErrorAggregator.get_error_trends-1379"><span class="linenos">1379</span></a>            <span class="s2">&quot;analysis_period_hours&quot;</span><span class="p">:</span> <span class="n">hours</span><span class="p">,</span>
</span><span id="ErrorAggregator.get_error_trends-1380"><a href="#ErrorAggregator.get_error_trends-1380"><span class="linenos">1380</span></a>            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_errors</span><span class="p">),</span>
</span><span id="ErrorAggregator.get_error_trends-1381"><a href="#ErrorAggregator.get_error_trends-1381"><span class="linenos">1381</span></a>            <span class="s2">&quot;hourly_breakdown&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> <span class="n">c</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hourly_errors</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="ErrorAggregator.get_error_trends-1382"><a href="#ErrorAggregator.get_error_trends-1382"><span class="linenos">1382</span></a>            <span class="s2">&quot;trend_percentage&quot;</span><span class="p">:</span> <span class="n">trend_percentage</span><span class="p">,</span>
</span><span id="ErrorAggregator.get_error_trends-1383"><a href="#ErrorAggregator.get_error_trends-1383"><span class="linenos">1383</span></a>            <span class="s2">&quot;trend_description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_describe_trend</span><span class="p">(</span><span class="n">trend_percentage</span><span class="p">),</span>
</span><span id="ErrorAggregator.get_error_trends-1384"><a href="#ErrorAggregator.get_error_trends-1384"><span class="linenos">1384</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get error trends over a longer time period.</p>

<p>Args:
    hours: Number of hours to analyze</p>

<p>Returns:
    Dictionary containing error trends and patterns.</p>
</div>


                            </div>
                            <div id="ErrorAggregator.reset" class="classattr">
                                        <input id="ErrorAggregator.reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ErrorAggregator.reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ErrorAggregator.reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ErrorAggregator.reset-1406"><a href="#ErrorAggregator.reset-1406"><span class="linenos">1406</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ErrorAggregator.reset-1407"><a href="#ErrorAggregator.reset-1407"><span class="linenos">1407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all error tracking data.&quot;&quot;&quot;</span>
</span><span id="ErrorAggregator.reset-1408"><a href="#ErrorAggregator.reset-1408"><span class="linenos">1408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_counts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ErrorAggregator.reset-1409"><a href="#ErrorAggregator.reset-1409"><span class="linenos">1409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ErrorAggregator.reset-1410"><a href="#ErrorAggregator.reset-1410"><span class="linenos">1410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Error aggregator reset&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset all error tracking data.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>